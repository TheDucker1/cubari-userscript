// ==UserScript==
// @name         Cubari Custom Reader
// @namespace    http://tampermonkey.net/ 
// @version      0.4
// @description  Custom manga reader using Cubari UI
// @author       You
// @match        *://*/*
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==

(function() {
    'use strict';

    // Placeholders replaced by build script
    const combined_css = "/*! Pickr 1.8.0 MIT | https://github.com/Simonwep/pickr */.pickr{position:relative;overflow:visible;transform:translateY(0)}.pickr *{box-sizing:border-box;outline:none;border:none;-webkit-appearance:none}.pickr .pcr-button{position:relative;height:2em;width:2em;padding:.5em;cursor:pointer;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;border-radius:.15em;background:url('data:image/svg+xml;utf8, <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\" stroke=\"%2342445A\" stroke-width=\"5px\" stroke-linecap=\"round\"><path d=\"M45,45L5,5\"></path><path d=\"M45,5L5,45\"></path></svg>') no-repeat 50%;background-size:0;transition:all .3s}.pickr .pcr-button:before{background:url('data:image/svg+xml;utf8, <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2 2\"><path fill=\"white\" d=\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\"/><path fill=\"gray\" d=\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\"/></svg>');background-size:.5em;z-index:-1;z-index:auto}.pickr .pcr-button:after,.pickr .pcr-button:before{position:absolute;content:\"\";top:0;left:0;width:100%;height:100%;border-radius:.15em}.pickr .pcr-button:after{transition:background .3s;background:currentColor}.pickr .pcr-button.clear{background-size:70%}.pickr .pcr-button.clear:before{opacity:0}.pickr .pcr-button.clear:focus{box-shadow:0 0 0 1px hsla(0,0%,100%,.85),0 0 0 3px currentColor}.pickr .pcr-button.disabled{cursor:not-allowed}.pcr-app *,.pickr *{box-sizing:border-box;outline:none;border:none;-webkit-appearance:none}.pcr-app button.pcr-active,.pcr-app button:focus,.pcr-app input.pcr-active,.pcr-app input:focus,.pickr button.pcr-active,.pickr button:focus,.pickr input.pcr-active,.pickr input:focus{box-shadow:0 0 0 1px hsla(0,0%,100%,.85),0 0 0 3px currentColor}.pcr-app .pcr-palette,.pcr-app .pcr-slider,.pickr .pcr-palette,.pickr .pcr-slider{transition:box-shadow .3s}.pcr-app .pcr-palette:focus,.pcr-app .pcr-slider:focus,.pickr .pcr-palette:focus,.pickr .pcr-slider:focus{box-shadow:0 0 0 1px hsla(0,0%,100%,.85),0 0 0 3px rgba(0,0,0,.25)}.pcr-app{position:fixed;display:flex;flex-direction:column;z-index:10000;border-radius:.1em;background:#fff;opacity:0;visibility:hidden;transition:opacity .3s,visibility 0s .3s;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;box-shadow:0 .15em 1.5em 0 rgba(0,0,0,.1),0 0 1em 0 rgba(0,0,0,.03);left:0;top:0}.pcr-app.visible{transition:opacity .3s;visibility:visible;opacity:1}.pcr-app .pcr-swatches{display:flex;flex-wrap:wrap;margin-top:.75em}.pcr-app .pcr-swatches.pcr-last{margin:0}@supports (display:grid){.pcr-app .pcr-swatches{display:grid;align-items:center;grid-template-columns:repeat(auto-fit,1.75em)}}.pcr-app .pcr-swatches>button{font-size:1em;position:relative;width:calc(1.75em - 5px);height:calc(1.75em - 5px);border-radius:.15em;cursor:pointer;margin:2.5px;flex-shrink:0;justify-self:center;transition:all .15s;overflow:hidden;background:transparent;z-index:1}.pcr-app .pcr-swatches>button:before{position:absolute;content:\"\";top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml;utf8, <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2 2\"><path fill=\"white\" d=\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\"/><path fill=\"gray\" d=\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\"/></svg>');background-size:6px;border-radius:.15em;z-index:-1}.pcr-app .pcr-swatches>button:after{content:\"\";position:absolute;top:0;left:0;width:100%;height:100%;background:currentColor;border:1px solid rgba(0,0,0,.05);border-radius:.15em;box-sizing:border-box}.pcr-app .pcr-swatches>button:hover{filter:brightness(1.05)}.pcr-app .pcr-swatches>button:not(.pcr-active){box-shadow:none}.pcr-app .pcr-interaction{display:flex;flex-wrap:wrap;align-items:center;margin:0 -.2em}.pcr-app .pcr-interaction>*{margin:0 .2em}.pcr-app .pcr-interaction input{letter-spacing:.07em;font-size:.75em;text-align:center;cursor:pointer;color:#75797e;background:#f1f3f4;border-radius:.15em;transition:all .15s;padding:.45em .5em;margin-top:.75em}.pcr-app .pcr-interaction input:hover{filter:brightness(.975)}.pcr-app .pcr-interaction input:focus{box-shadow:0 0 0 1px hsla(0,0%,100%,.85),0 0 0 3px rgba(66,133,244,.75)}.pcr-app .pcr-interaction .pcr-result{color:#75797e;text-align:left;flex:1 1 8em;min-width:8em;transition:all .2s;border-radius:.15em;background:#f1f3f4;cursor:text}.pcr-app .pcr-interaction .pcr-result::-moz-selection{background:#4285f4;color:#fff}.pcr-app .pcr-interaction .pcr-result::selection{background:#4285f4;color:#fff}.pcr-app .pcr-interaction .pcr-type.active{color:#fff;background:#4285f4}.pcr-app .pcr-interaction .pcr-cancel,.pcr-app .pcr-interaction .pcr-clear,.pcr-app .pcr-interaction .pcr-save{width:auto;color:#fff}.pcr-app .pcr-interaction .pcr-cancel:hover,.pcr-app .pcr-interaction .pcr-clear:hover,.pcr-app .pcr-interaction .pcr-save:hover{filter:brightness(.925)}.pcr-app .pcr-interaction .pcr-save{background:#4285f4}.pcr-app .pcr-interaction .pcr-cancel,.pcr-app .pcr-interaction .pcr-clear{background:#f44250}.pcr-app .pcr-interaction .pcr-cancel:focus,.pcr-app .pcr-interaction .pcr-clear:focus{box-shadow:0 0 0 1px hsla(0,0%,100%,.85),0 0 0 3px rgba(244,66,80,.75)}.pcr-app .pcr-selection .pcr-picker{position:absolute;height:18px;width:18px;border:2px solid #fff;border-radius:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.pcr-app .pcr-selection .pcr-color-chooser,.pcr-app .pcr-selection .pcr-color-opacity,.pcr-app .pcr-selection .pcr-color-palette{position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex-direction:column;cursor:grab;cursor:-webkit-grab}.pcr-app .pcr-selection .pcr-color-chooser:active,.pcr-app .pcr-selection .pcr-color-opacity:active,.pcr-app .pcr-selection .pcr-color-palette:active{cursor:grabbing;cursor:-webkit-grabbing}.pcr-app[data-theme=nano]{width:14.25em;max-width:95vw}.pcr-app[data-theme=nano] .pcr-swatches{margin-top:.6em;padding:0 .6em}.pcr-app[data-theme=nano] .pcr-interaction{padding:0 .6em .6em}.pcr-app[data-theme=nano] .pcr-selection{display:grid;grid-gap:.6em;grid-template-columns:1fr 4fr;grid-template-rows:5fr auto auto;align-items:center;height:10.5em;width:100%;align-self:flex-start}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview{grid-area:2/1/4/1;height:100%;width:100%;display:flex;flex-direction:row;justify-content:center;margin-left:.6em}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview .pcr-last-color{display:none}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview .pcr-current-color{position:relative;background:currentColor;width:2em;height:2em;border-radius:50em;overflow:hidden}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview .pcr-current-color:before{position:absolute;content:\"\";top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml;utf8, <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2 2\"><path fill=\"white\" d=\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\"/><path fill=\"gray\" d=\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\"/></svg>');background-size:.5em;border-radius:.15em;z-index:-1}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette{grid-area:1/1/2/3;width:100%;height:100%;z-index:1}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette .pcr-palette{border-radius:.15em;width:100%;height:100%}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette .pcr-palette:before{position:absolute;content:\"\";top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml;utf8, <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2 2\"><path fill=\"white\" d=\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\"/><path fill=\"gray\" d=\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\"/></svg>');background-size:.5em;border-radius:.15em;z-index:-1}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser{grid-area:2/2/2/2}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity{grid-area:3/2/3/2}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity{height:.5em;margin:0 .6em}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser .pcr-picker,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity .pcr-picker{top:50%;transform:translateY(-50%)}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser .pcr-slider,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity .pcr-slider{flex-grow:1;border-radius:50em}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser .pcr-slider{background:linear-gradient(90deg,red,#ff0,#0f0,#0ff,#00f,#f0f,red)}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity .pcr-slider{background:linear-gradient(90deg,transparent,#000),url('data:image/svg+xml;utf8, <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 2 2\"><path fill=\"white\" d=\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\"/><path fill=\"gray\" d=\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\"/></svg>');background-size:100%,.25em}\n\n/* Variables, dependent on theme */\n:root {\n--readerBg: #000000;\n--sidebarCol: #28292B;\n--accentCol: #B73636;\n--icoCol: #eee;\n--textCol: #ddd;\n--sidebarColDark: #2b2f33;\n--sidebarColDarkA: #2b2f3300;\n--prevCol: #34393d;\n--accentSelected: #ffffff;\n--accentSelectedInvert: #333333;\n--sidebarColFocus: rgba(0, 0, 0, 0.3);\n--borderColor: rgba(0,0,0,0.7);\n--blackFlag: rgba(0,0,0,0.7);\n--blackLight: rgba(0,0,0,0.2);\n/* One time use */\n--rdrBorderL: 1px;\n--rdr-wb: 2px;\n--rdrAncBottomWhite: rgba(255,255,255,0.35);\n--rescueShade: unset;\n}\n\n@font-face {\n\tfont-family: 'guya';\n\tsrc: url('data:application/font-woff;base64,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') format('woff');\n\tfont-weight: normal;\n\tfont-style: normal;\n}\n\n@font-face {\n\tfont-family: 'inline-icons';\n\tsrc: url('data:application/font-woff;charset=utf-8;base64,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') format('woff');\n\tfont-weight: normal;\n\tfont-style: normal\n}\n\n.ico-btn {\n\t/* use !important to prevent issues with browser extensions that change fonts */\n\tfont-family: 'guya' !important;\n\tspeak: none;\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\ttext-transform: none;\n\tline-height: 1;\n\n\t/* Better Font Rendering =========== */\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n}\n\n/* http://meyerweb.com/eric/tools/css/reset/ \n\tv2.0 | 20110126\n   License: none (public domain)\n*/\n\n* {\n\t-webkit-tap-highlight-color: rgba(0,0,0,0);\n\t-webkit-tap-highlight-color: transparent;\n}\n\nhtml, body, div, span, applet, object, iframe,\nh1, h2, h3, h4, h5, h6, p, blockquote, pre,\na, abbr, acronym, address, big, cite, code,\ndel, dfn, em, img, ins, kbd, q, s, samp,\nsmall, strike, sub, sup, tt, var, center,\ndl, dt, dd, ol, ul, li,\nfieldset, form, label, legend,\ntable, caption, tbody, tfoot, thead, tr, th, td,\narticle, aside, canvas, details, embed, \nfigure, figcaption, footer, header, hgroup, \nmenu, nav, output, ruby, section, summary,\ntime, mark, audio, video {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\tfont: inherit;\n\tvertical-align: baseline;\n}\n/* HTML5 display-role reset for older browsers */\narticle, aside, details, figcaption, figure, \nfooter, header, hgroup, menu, nav, section {\n\tdisplay: block;\n}\nbody {\n\tline-height: 1;\n\tposition: relative;\n\tmax-height: 100vh;\n}\nol, ul {\n\tlist-style: none;\n}\nblockquote, q {\n\tquotes: none;\n}\nblockquote:before, blockquote:after,\nq:before, q:after {\n\tcontent: '';\n\tcontent: none;\n}\ntable {\n\tborder-collapse: collapse;\n\tborder-spacing: 0;\n}\n@supports (-webkit-overflow-scrolling: touch) {\n\thtml, body {\n\t\theight: 100.001vh;\n\t}\n}\n\nbutton {\n\tborder: 0;\n\tmargin: 0;\n\tpadding: 0;\n\tcursor: pointer;\n\tbackground: none;\n\tborder:none;\n\tunset: all;\n}\n\nbutton::-moz-focus-inner {\n\tborder: 0;\n\tmargin: 0;\n\tpadding: 0;\n\tcursor: pointer;\n\tbackground: none;\n\tborder:none;\n}\n\nbutton:focus, option, details, summary {\n\toutline: none !important;\n}\n\n*[tabindex=\"-1\"] {\n\toutline: none;\n\toutline-style:none;\n\tbox-shadow:none;\n\tborder-color:transparent;\n}\n/* ---------------------- */\n\nhtml {\n\tbackground: var(--readerBg);\n}\n\nbody {\n\tbackground: var(--readerBg);\n\tfont-size: 1.2rem;\n\tfont-family: Open Sans, sans-serif;\n\tline-height: 1.3;\n\tcolor: var(--textCol);\n}\n\nmain {\n\tdisplay: flex;\n\theight: 100vh;\n\twidth: calc(100vw+24px);\n\toverflow: hidden;\n\tmax-height: 100vh;\n\tposition: relative;\n}\n\nmain > aside {\n\theight: 100vh;\n\tmin-width: 16em;\n\tmax-width: 16em;\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--sidebarCol);\n\tposition: relative;\n\ttransition: margin-left 0.3s ease;\n}\n\n\nmain > aside > header {\n\tdisplay: flex;\n\talign-items: flex-top;\n\talign-content: stretch;\n\n}\n* {\n\tscrollbar-width: thin;\n\tscrollbar-color: rgba(0,0,0,0.3) var(--prevCol);\n}\n\n*::-webkit-scrollbar {\n\tborder-radius: 4px;\n\twidth: 6px;\n}\n\n*::-webkit-scrollbar-track {\n\tborder-radius: 4px;\n\tbackground: var(--prevCol);\n\tbackground-clip: content-box;\n}\n\n*::-webkit-scrollbar-thumb {\n\tborder-radius: 4px;\n\tbackground: rgba(0,0,0,0.3);\n}\n\n.ico-btn {\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tfont-size: 18px; \n\twidth: 3rem;\n\theight: 3rem;\n\tflex-shrink: 0;\n\tcolor: var(--icoCol);\n\ttext-decoration: none;\n\tcursor: default;\n\tposition: relative;\n\ttransition: all 0.1s ease, top 0s linear;\n}\n.ico-btn:hover {\n\tcolor: var(--accentCol);\n\t/*text-shadow: 0px 0px 2px rgba(0,0,0,1);*/\n\ttop: -1px;\n}\n.ico-btn:before {\n\n}\n\n.inline-icon {\n\tfont-family: guya !important;\n\tfont-size: 1em;\n}\n\n.ico-btn:active {\n\ttop: 0px;\n}\n\nheader > h1 {\n\tdisplay: flex;\n\tjustify-content: center;\n\ttext-align: center;\n\tpadding: 0.5rem 0.5rem;\n\tfont-size: 1rem;\n\tflex-grow: 1;\n\talign-items: center;\n\tmin-height: 3rem;\n\tbox-sizing: border-box;\n}\nheader > h1 a {\n\tcolor: inherit;\n\ttext-decoration: none;\n}\nheader > h1 a:hover {\n\ttext-decoration: underline;\n}\n/*\naside header > .guya {\n\tcursor: pointer;\n\tbackground: url('/static/logo_small.png');\n\tbackground-size: contain;\n\tbackground-repeat: no-repeat;\n\tbox-sizing: border-box;\n\tbackground-size: 50%;\n\tbackground-position: 50% 50%;\n\toutline: none;\n}*/\n\n.ico-btn.guya:before {\n\tcontent:\"\\e907\";\n\tfont-size: 1.2em;\n}\n.ico-btn.close:before {\n\tcontent:\"\\e907\";\n}\n.ico-btn.search {\n\tcursor: pointer;\n}\n.ico-btn.search:before {\n\tcontent: \"\ue928\";\n}\n\n.ico-btn.jump {\n\tcursor: pointer;\n}\n.ico-btn.jump:before {\n\tcontent: \"\\2ba0\";\n\ttransform: scale(-1, 1);\n}\n\n.ico-btn.download:before {\n\tcontent: \"\\e938\";\n}\n\n.download-anchor {\n\twidth: 0.1px;\n\tposition: relative;\n}\n\n.download-wrapper {\n\tdisplay: flex;\n\tborder-radius: 1px;\n\tbackground: var(--blackLight);\n\tbox-shadow: 2px 10px 20px var(--borderColor);\n\theight: 2rem;\n\tposition: absolute;\n\tright: 0;\n}\n\n.ico-btn.downloading {\n\twidth:7rem !important;\n\tfont-family: \"Open Sans\", sans-serif !important;\n\tfont-size: 70%;\n\tfont-weight: 600;\n\ttop: 0px !important;\n\tbackground: var(--sidebarCol);\n\tcolor: var(--accentCol);\n\tdisplay: inherit;\n\theight: 99% !important;\n\n} \n\n.ico-btn.ico-btn.download-cancel {\n\tdisplay: inherit; \n}\n\n.ico-btn.download-cancel:before {\n\tcontent: \"\ue907\";\n}\n\n.rdr-aside-content {\n\tdisplay: flex;\n\twidth: 100%;\n\tflex-grow: 1;\n\tflex-direction: column;\n}\n\n.rdr-selector {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex-grow: 0;\n}\n\n.rdr-selector > div {\n\tdisplay: flex;\n\talign-items: stretch;\n\talign-content: stretch;\n}\n.rdr-selector select {\n\tflex-grow: 1;\n\tborder: 0;\n\tbackground: transparent;\n\tcolor: var(--icoCol);\n}\n.rdr-selector option {\n\tcolor: var(--icoCol);\n\tbackground: var(--sidebarColDark);\n\tpadding: 0.4em 0.2em;\n\tdisplay: block;\n\tline-height: 1.3em;\n\tcursor: pointer;\n}\n\n\n.rdr-selector-top, .rdr-selector-bot {\n\tpadding-left: 2rem;\n\theight: 2rem;\n}\n\n.rdr-selector-top .ico-btn,\n.rdr-selector-bot .ico-btn {\n\theight: 2rem;\n\twidth: 2.6rem;\n}\n\n.rdr-selector-mid {\n\theight: 2.5rem;\n\tbackground: var(--sidebarColDark);\n\n}\n\n#message-box {\n\tflex-grow: 1;\n\ttext-align: right;\n\tfont-size: 0.7rem;\n\tpadding: 0 1rem;\n\tline-height: 2.2rem;\n\tcolor: #aaa;\n\topacity: 1;\n\ttransition: opacity 0.3s ease;\n}\n.initFlash {\n\tanimation: initFlash 2s;\n}\n.flash {\n\tanimation: flash 0.5s;\n}\n.fade {\n\tanimation: fade 0.5s;\n}\n.fadeOut {\n\topacity: 0;\n\ttransition: opacity 0.3s ease;\n}\n\n@keyframes flash {\n\t0% {\n\t\tcolor: white;\n\t}\n\t100% {\n\t\tcolor: #aaa;\n\t\ttext-shadow: none;\n\t}\n}\n@keyframes initFlash {\n\t0% {\n\t\tbackground: rgba(255,255,255,0.3);\n\t}\n\t100% {\n\t\tbackground: none;\n\t}\n}\n@keyframes fade {\n\t0% {\n\t\topacity: 0;\n\t}\n\t100% {\n\t\topacity: 1;\n\t}\n}\n\n.rdr-selector-mid .ico-btn {\n\theight: 2.5rem;\n\twidth: 2.5rem;\n}\n\n\n.rdr-selector-vol {\n\theight: 2rem;\n}\n\n.flex-spacer {\n\tflex-grow: 1000;\n}\n\n.rdr-selector-chap.prev:before {\n\tcontent: \"\\e909\";\n}\n.rdr-selector-chap.next:before {\n\tcontent: \"\\e90a\";\n}\n.rdr-selector-vol.prev,\n.rdr-selector-vol.next {\n\twidth: 2.9rem;\n}\n.rdr-selector-vol.prev:before {\n\tcontent: \"\\e90b\";\n}\n.rdr-selector-vol.next:before {\n\tcontent: \"\\e902\";\n}\n[data-apr\\.selpinned].ico-btn:before {\n\tcontent: \"\\e906\";\n\ttransform: rotate(270deg);\n}\n[data-apr\\.selpinned=\"true\"].ico-btn:before {\n\tcontent: \"\\e905\";\n}\n[data-lyt\\.fit].ico-btn {\n\n}\n[data-lyt\\.fit=\"height\"].ico-btn:before {\n\tcontent: \"h\";\n}\n[data-lyt\\.fit=\"width\"].ico-btn:before {\n\tcontent: \"w\";\n}\n[data-lyt\\.fit=\"height_limit\"].ico-btn:before {\n\tcontent: \"H\";\n}\n[data-lyt\\.fit=\"width_limit\"].ico-btn:before {\n\tcontent: \"W\";\n}\n[data-lyt\\.fit=\"all\"].ico-btn:before {\n\tcontent: \"\\e900\";\n}\n[data-lyt\\.fit=\"all_limit\"].ico-btn:before {\n\tcontent: \"\\e923\";\n}\n[data-lyt\\.fit=\"none\"].ico-btn:before {\n\tcontent: \"\\e904\";\n}\n[data-lyt\\.direction].ico-btn:before {\n\tfont-size: 0.8em;\n}\n[data-lyt\\.direction=\"ltr\"].ico-btn:before {\n\tcontent: \"\\e90c\";\n}\n[data-lyt\\.direction=\"rtl\"].ico-btn:before {\n\tcontent: \"\\e90c\";\n\ttransform: scaleX(-1);\n}\n[data-lyt\\.direction=\"ttb\"].ico-btn:before {\n\tcontent: \"\\e90c\";\n\ttransform: rotate(90deg);\n}\n[data-lyt\\.spread=\"1\"].ico-btn:before {\n\tcontent: \"\\e92c\";\n}\n[data-lyt\\.spread=\"2\"].ico-btn:before {\n\tcontent: \"\\e92a\";\n}\n[data-lyt\\.spread=\"2-odd\"].ico-btn:before {\n\tcontent: \"\\e92d\";\n\ttransform: scaleX(-1);\n}\n[data-bind=\"settings_button\"].ico-btn {\n\tbox-shadow: -4px 1px 4px -5px black;\n\tmargin-left: 0.3rem;\n\tcolor: var(--icoCol);\n\ttext-shadow: 1px 1px 3px var(--borderColor);\n}\n[data-bind=\"settings_button\"].ico-btn:before {\n\tcontent: \"\ue929\";\n}\n.rdr-comment {\n\tcursor: pointer;\n}\n.rdr-comment.ico-btn:before {\n\tcontent: \"\\e91d\";\n\tfont-size:0.9em;\n}\n.rdr-share.ico-btn:before {\n\tcontent: \"\\e91e\";\t\n}\n\n[data-bhv\\.preload=\"1\"].ico-btn:before {\n\tcontent: \"\\e90d\";\n}\n[data-bhv\\.preload=\"2\"].ico-btn:before {\n\tcontent: \"\\e90e\";\n}\n[data-bhv\\.preload=\"3\"].ico-btn:before {\n\tcontent: \"\\e90f\";\n}\n[data-bhv\\.preload=\"4\"].ico-btn:before {\n\tcontent: \"\\e914\";\n}\n[data-bhv\\.preload=\"5\"].ico-btn:before {\n\tcontent: \"\\e915\";\n}\n[data-bhv\\.preload=\"6\"].ico-btn:before {\n\tcontent: \"\\e916\";\n}\n[data-bhv\\.preload=\"7\"].ico-btn:before {\n\tcontent: \"\\e917\";\n}\n[data-bhv\\.preload=\"8\"].ico-btn:before {\n\tcontent: \"\\e918\";\n}\n[data-bhv\\.preload=\"9\"].ico-btn:before {\n\tcontent: \"\\e919\";\n}\n[data-bhv\\.preload=\"100\"].ico-btn:before {\n\tcontent: \"\\e91b\";\n}\n\n\n.rdr-page-selector .preloaded {\n\tborder-left-color: var(--accentCol);\n}\n\n\n.rdr-vol-wrap {\n\tposition: relative;\n\tflex-grow: 0;\n\tmin-width: 2rem;\n\toverflow: hidden;\n\tfont-size: 12px;\n}\n\n.rdr-chap-wrap {\n\tposition: relative;\n\tflex-grow: 7;\n\toverflow: hidden;\n\tfont-size: 12px;\n}\n\n.rdr-chap-wrap:after {\n\tcontent: \"\";\n\tposition: absolute;\n\tbottom: 0;\n\tright: 0;\n\ttop: 0;\n\twidth: 2rem;\n\tbackground: linear-gradient(90deg, var(--sidebarColDarkA) 0%, var(--sidebarColDark) 100%);\n\tpointer-events: none;\n}\n\n.rdr-vol-wrap label {\n\tjustify-content: center;\n}\n.rdr-chap-wrap label {\n\tpadding-left: 1ch;\n\twhite-space: nowrap;\n}\n\n.rdr-vol-wrap:hover label, .rdr-chap-wrap:hover label {\n\tcolor: var(--accentCol);\n}\n\n.rdr-groups {\n\tmargin-top: 0.5rem;\n\tflex-grow: 0;\n}\n\n.rdr-groups div {\n\tfont-size: 0.7em;\n\tpadding: 0.7rem;\n\ttext-emphasis: ;\n\ttext-align: center;\n\tcursor: default;\n}\n\n.rdr-groups div:hover {\n\tbackground: rgba(255,255,255,0.03);\n\tcolor: var(--accentCol);\n}\n\n.rdr-groups div.is-active {\n\tbackground: var(--sidebarColFocus);\n\tcolor: var(--icoCol);\n }\n\n.rdr-description div {\n\tmargin: 2em 0.8em 2em 0.8em;\n\tline-height: 1.8;\n\twhite-space: pre-wrap;\n\tfont-size: 0.7em;\n\tmax-height: 50vh;\n\toverflow-y: auto;\n}\n\n.rdr-previews {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin-top: 1rem;\n\toverflow: hidden;\n\tflex-basis: 0;\n\tflex-grow: 1;\n}\n\n.rdr-previews .header {\n\tdisplay: flex;\n\tflex-wrap: nowrap;\n\tlist-style: none;\n\tbackground: var(--prevCol);\n\tflex-grow: 0;\n\tfont-size: 0;\n}\n\n.rdr-previews .header:hover {\n\tcolor: var(--accentCol);\n}\n.rdr-previews .header:hover .expander {\n\tcolor: var(--accentCol);\n}\n\n.rdr-previews .header span {\n \tdisplay: flex;\n \talign-items: center;\n \tpadding: 0 0 0 1rem;\n\tflex-grow: 1;\n\tfont-size: 0.8rem;\n}\n\n.rdr-previews .header .expander {\n\theight: 2.6rem;\n\tfont-size: 1.5rem;\n}\n\n.rdr-previews .header .expander:before {\n\tcontent: \"\\e90a\";\n}\n\n.previews-true .rdr-previews .header .expander:before {\n\tcontent: \"\\e902\";\n}\n\n.rdr-previews-gallery {\n\n\tflex-wrap: wrap;\n\tjustify-content: space-around;\n\talign-items: center;\n\tpadding-top: 0.25rem;\n\toverflow: auto;\n\tdisplay: none;\n\tmax-height: calc(100% - 3rem);\n}\n\n.previews-true .rdr-previews-gallery {\n\tdisplay: flex;\n}\n\n.rdr-previews-gallery img {\n\tflex-basis: 30%;\n\twidth: 30%;\n\tmargin-bottom: 0.50rem;\n\tbox-shadow: 0px 1px 3px rgba(0,0,0,0.3);\n\tcursor: pointer;\n}\n\n.rdr-previews-gallery .is-active {\n\topacity: 0.7;\n\toutline: 2px solid var(--accentCol);\n}\n\n.unload .rdr-selector-chap.next {\n  transform: translateX(-18rem);\n}\n.unload .rdr-selector-chap.prev {\n  transform: translateX(18rem);\n}\n.unload .rdr-selector-vol.prev {\n transform: translateY(230%); \n}\n.unload .rdr-selector-vol.next {\n transform: translateY(-230%); \n}\n\n.unload .rdr-vol-wrap label {\n  transform: scaleY(0);\n}\n.unload .rdr-chap-wrap label{\n  transform: scaleX(0);\n}\n.unload .rdr-groups {\n  transform: translateY(2rem);\n}\n\n.rdr-selector-chap.next,\n.rdr-selector-chap.prev,\n.rdr-selector-vol.next,\n.rdr-selector-vol.prev,\n.rdr-selector-top,\n.rdr-selector-bot,\n.rdr-chap-wrap label,\n.rdr-vol-wrap label,\n.rdr-groups,\n.rdr-previews {\n  transition: all 0.5s cubic-bezier(.22,.61,.36,1);\n}\n.rdr-chap-wrap label,\n.rdr-vol-wrap label {\n\ttransform-origin: 5.1rem center;\n\ttransition-delay: 0.1s;\n}\n.rdr-selector-top,\n.rdr-selector-bot {\n\ttransition-delay: 0.2s;\n\ttransition-duration: 0.5s;\n}\n\n.unload .rdr-selector-chap.next,\n.unload .rdr-selector-chap.prev,\n.unload .rdr-selector-top,\n.unload .rdr-selector-bot,\n.unload .rdr-chap-wrap label,\n.unload .rdr-vol-wrap label,\n.unload .rdr-groups,\n.unload .rdr-previews {\n  opacity: 0;\n}\n\n.unload .rdr-selector-mid:before {\n  content: \"\ue910\";\n  font-family: Guya;\n  display: block;\n  position: absolute;\n  left: 50%;\n  animation: rotat 1.1s infinite linear;\n  font-size: 24px;\n  line-height: 2.4rem;\n  transform-origin: center 52.5%;\n}\n\n@keyframes rotat {\n  from {\n\ttransform: translate3d(-50%,0%,0) rotate(0deg);\n  }\n  to {\n\ttransform: translate3d(-50%,0%,0) rotate(360deg);\n  }\n}\n\n.rdr-area {\n\toverflow: hidden;\n\tposition: relative;\n\tmin-height: 100%;\n\tflex-grow: 1;\n\tcursor: pointer;\n}\n\n\n.rdr-area .hover-prev,\n.rdr-area .hover-next {\n\tposition: fixed;\n\tbottom: 0;\n\tright: 0;\n\twidth: 10rem;\n\theight: 13rem;\n\tbackground: linear-gradient(310deg, rgba(0,0,0,0.45) 0%, rgba(0,0,0,0) 50%);\n\ttransition: opacity 1s ease;\n\topacity: 0;\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\talign-items: flex-end;\n\talign-content: flex-end;\n\tpointer-events: none;\n\tuser-select: none;\n\tpadding-bottom: 1.5rem;\n\tz-index: 1;\n\tbox-sizing: border-box;\n\twill-change: transform;\n}\n\n.direction-ttb .hover-prev,\n.direction-ttb .hover-next,\n.hoverinos-false .hover-prev,\n.hoverinos-false .hover-next {\n\tdisplay: none;\n}\n\n.rdr-area .hover-prev {\n\tjustify-content: flex-start;\n\talign-items: flex-end;\n\tright: unset;\n\tbackground: linear-gradient(50deg, rgba(0,0,0,0.45) 0%, rgba(0,0,0,0) 50%);\n\tpadding-left: 2rem;\n}\n\n.rdr-area .hover-prev.viz,\n.rdr-area .hover-next.viz {\n\ttransition: opacity .5s ease;\n\topacity: 1;\n}\n\n.rdr-area .hover-prev.nodelay,\n.rdr-area .hover-next.nodelay {\n\ttransition: opacity .5s ease;\n}\n\n.direction-ttb .rdr-area .hover-arrow {\n\ttransform: translateX(18%) rotate(90deg) translateX(18%);\n}\n\n.rdr-area .hover-wrap {\n\tdisplay: flex;\n\tflex-direction: column;\n\ttext-align: center;\n}\n\n.rdr-area .hover-arrow {\n\tcolor: white;\n\tdisplay: block;\n\tfont-family: guya;\n\tfont-size: 2em;\n\tpadding: 2rem 2rem 0rem 2rem;\n\ttext-shadow: 0px 2px 1px rgba(0,0,0,0.7), 0px 1px 3px rgba(0,0,0,0.7);\n}\n\n.rdr-area .hover-sub {\n\tcolor: white;\n\tdisplay: block;\n\tmargin-top: 0.1rem;\n\ttext-shadow: 0px 2px 1px rgba(0,0,0,0.7), 0px 1px 3px rgba(0,0,0,0.7);\n\twidth: 100%;\n\tfont-size: 0.8em;\n\tfont-variant: small-caps;\n}\n\n.rdr-area .hover-prev .hover-sub:before { content: \"prev\" }\n.rdr-area .hover-next .hover-sub:before { content: \"next\" }\n.direction-rtl .rdr-area .hover-prev .hover-sub:before { content: \"next\" }\n.direction-rtl .rdr-area .hover-next .hover-sub:before { content: \"prev\" }\n\n#test_element {\n\tposition: absolute;\n\twidth: 100%;\n\tleft: 0;\n\tz-index: 3000;\n\theight: 1px;\n\tbackground: red;\n}\n\n.rdr-image-wrap {\n\tdisplay: flex;\n\theight: 100%;\n\twidth: 100%;\n\tposition: relative;\n\toutline: none;\n\toutline-style:none;\n\tbox-shadow:none;\n\tborder-color:transparent;\n\ttransform: translate3d(0, 0, 0);\n\t-webkit-transform: translate3d(0, 0, 0);\n\tperspective: 1000;\n\t-webkit-perspective: 1000;\n}\n\n.direction-rtl .rdr-image-wrap,\n.direction-ltr .rdr-image-wrap {\n\twill-change: transform;\n}\n.direction-ttb .rdr-image-wrap {\n\tmargin-left: unset !important;\n}\n\n.loaded .rdr-image-wrap {\n\tscroll-behavior: smooth;\n}\n\n/* DO NOT\nI REPEAT, DO NOT\nEVER TOUCH THIS DECLARATION. */\n.rdr-image-wrap:after {\n\tcontent: \"\u044b\";\n\tfont-size: 0.005em;\n}\n\n.rdr-image-wrap * {\n\ttransform: translate3d(0, 0, 0);\n\t-webkit-transform: translate3d(0, 0, 0);\n\tperspective: 1000;\n\t-webkit-perspective: 1000;\n}\n\n/* DO NOT\nI REPEAT, DO NOT\nEVER TOUCH THIS DECLARATION. */\n.rdr-image-wrap:after {\n\tcontent: \"\u8b8e\";\n\tfont-size: 0.005em;\n}\n\n.rdr-image-wrap .ReaderImageWrapper {\n\tdisplay: flex;\n\tmin-width: 100%;\n\tmin-height: 100%;\n\tjustify-content: center;\n\talign-items: flex-start;\n\tposition: relative;\n\toverflow: auto;\n\toutline-style:none;\n\tbox-shadow:none;\n\tborder-color:transparent;\n\tbox-sizing: border-box;\n}\n\n.o .rdr-image-wrap {\n\topacity: 0.03;\n}\n\n.rdr-image-wrap .ReaderImageWrapper img {\n\tuser-select: none;\n\tmin-height: 16rem;\n\tmin-width: 9rem;\n\tbackground:   url('data:image/png;base64,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');\n\tbackground-size: 10vw auto;\n\tbackground-position: 50% 50%;\n\tbackground-repeat: no-repeat;\n}\n.fit-width .rdr-image-wrap .ReaderImageWrapper img {\n\tmin-width: 0;\n\twidth: 100%;\n\tmax-width: unset;\n\tflex-grow: 1;\n}\n\n.fit-width_limit .rdr-image-wrap .ReaderImageWrapper {\n\n}\n\n.fit-width_limit .rdr-image-wrap .ReaderImageWrapper img {\n\tmax-width: 100%;\n\tobject-fit: contain;\n}\n.fit-width_limit .rdr-image-wrap .ReaderImageWrapper.two-page img {\n\tmax-width: 50%;\n}\n\n\n.fit-height .rdr-image-wrap .ReaderImageWrapper.too-wide {\n\tjustify-content: flex-start;\n}\n\n.fit-height .rdr-image-wrap .ReaderImageWrapper img {\n\tmax-width: unset;\n\tmin-width: unset;\n\tmax-height: 100%;\n\tmin-height: 100%;\n\tflex-shrink: 1;\n}\n\n.fit-height_limit .rdr-image-wrap .ReaderImageWrapper {\n\tmax-height: 100vh;\n}\n.fit-height_limit .rdr-image-wrap .ReaderImageWrapper img {\n\tmax-width: unset;\n\tmax-height: 100%;\n\twidth: auto;\n\theight: auto;\n\tflex-shrink: 0;\n}\n/*SAFARIHACC*/\n_:-webkit-full-screen:not(:root:root), .fit-height_limit .rdr-image-wrap .ReaderImageWrapper img {\n\tflex-shrink: 1;\n}\n\n.fit-none .rdr-image-wrap .ReaderImageWrapper {\n\tmin-height: 100vh;\n}\n\n.too-wide {\n\tjustify-content: flex-start !important;\n}\n\n.fit-none .rdr-image-wrap .ReaderImageWrapper img {\n\tflex-shrink: 0;\n}\n\n.fit-all .rdr-image-wrap .ReaderImageWrapper {\n\tmin-height: 100vh;\n\tmin-width: 100%;\n\talign-items: center;\n}\n\n.fit-all .rdr-image-wrap .ReaderImageWrapper img {\n\tobject-fit: contain;\n\tmin-width: 0;\n\theight: 100%;\n}\n\n.fit-all_limit .rdr-image-wrap .ReaderImageWrapper {\n\n}\n\n.fit-all_limit .rdr-image-wrap .ReaderImageWrapper img {\n\twidth: auto;\n\theight: 100%;\n\tmax-width: 100%;\n\tmax-height: 100%;\n\tobject-fit: contain;\n}\n\n.direction-ttb .rdr-image-wrap {\n\ttransform: none !important;\n\tflex-direction: row;\n\tflex-wrap: wrap;\n\toverflow-y: auto;\n}\n\n.direction-ttb .rdr-image-wrap .ReaderImageWrapper {\n\tflex-shrink: 0;\n\tmargin-bottom: 1em;\n\tmin-height: 20% !important;\n\tmax-width: 100%;\n}\n\n.gap-true .rdr-image-wrap .ReaderImageWrapper { \n\tmargin-bottom: 0 !important;\n}\n\n.direction-ttb .rdr-image-wrap .ReaderImageWrapper img {\n\t/*box-shadow: 0 0 6px black;*/\n}\n\n.direction-ttb.fit-width .rdr-image-wrap .ReaderImageWrapper {\n\tmin-height: auto;\n}\n.direction-ttb.fit-all .rdr-image-wrap .ReaderImageWrapper {\n\tmin-height: auto;\n}\n.direction-ttb.fit-all .rdr-image-wrap .ReaderImageWrapper img {\n\tmax-height: 100vh;\n}\n.direction-ttb.fit-height .rdr-image-wrap .ReaderImageWrapper img {\n\tmin-height: 100vh;\n\tmax-height: 100vh;\n}\n\n/*\n.spread-2 .UI.ReaderImageWrapper,\n.spread-2-odd .UI.ReaderImageWrapper {\n\tmax-width: 50%;\n\tmin-width: 50%;\n}\n\n.direction-ltr.spread-2 .UI.ReaderImageWrapper:nth-child(2n),\n.direction-ttb.spread-2 .UI.ReaderImageWrapper:nth-child(2n) {\n\tjustify-content: flex-start;\n\tpadding-left: 0.2em;\n}\n\n.direction-ltr.spread-2 .UI.ReaderImageWrapper:nth-child(2n+1),\n.direction-ttb.spread-2 .UI.ReaderImageWrapper:nth-child(2n+1) {\n\tjustify-content: flex-end;\n\tpadding-right: 0.2em;\n}\n.direction-ltr.spread-2-odd .UI.ReaderImageWrapper:nth-child(2n),\n.direction-ttb.spread-2-odd .UI.ReaderImageWrapper:nth-child(2n) {\n\tjustify-content: flex-end;\n\tpadding-right: 0.2em;\n}\n.direction-ltr.spread-2-odd .UI.ReaderImageWrapper:nth-child(2n+1),\n.direction-ttb.spread-2-odd .UI.ReaderImageWrapper:nth-child(2n+1) {\n\tjustify-content: flex-start;\n\tpadding-left: 0.2em;\n}\n.direction-ltr.spread-2 .UI.ReaderImageWrapper:nth-child(2n+1):last-child,\n.direction-ttb.spread-2 .UI.ReaderImageWrapper:nth-child(2n+1):last-child,\n.direction-ltr.spread-2-odd .UI.ReaderImageWrapper:first-child,\n.direction-ttb.spread-2-odd .UI.ReaderImageWrapper:first-child,\n.direction-ltr.spread-2-odd .UI.ReaderImageWrapper:nth-child(2n):last-child,\n.direction-ttb.spread-2-odd .UI.ReaderImageWrapper:nth-child(2n):last-child {\n\tmax-width: unset;\n\tmin-width: 100%;\n\tjustify-content: center;\n}\n\n\n.direction-rtl.spread-2 .UI.ReaderImageWrapper:nth-last-child(2n) {\n\tjustify-content: flex-end;\n\tpadding-right: 0.2em;\n}\n.direction-rtl.spread-2 .UI.ReaderImageWrapper:nth-last-child(2n+1) {\n\tjustify-content: flex-start;\n\tpadding-left: 0.2em;\t\n}\n\n.direction-rtl.spread-2-odd .UI.ReaderImageWrapper:nth-last-child(2n) {\n\tjustify-content: flex-start;\n\tpadding-left: 0.2em;\n}\n.direction-rtl.spread-2-odd .UI.ReaderImageWrapper:nth-last-child(2n+1) {\n\tjustify-content: flex-end;\n\tpadding-right: 0.2em;\n}\n.direction-rtl.spread-2 .UI.ReaderImageWrapper:nth-last-child(2n+1):first-child,\n.direction-rtl.spread-2-odd .UI.ReaderImageWrapper:last-child,\n.direction-rtl.spread-2-odd .UI.ReaderImageWrapper:nth-last-child(2n):first-child {\n\tmax-width: unset;\n\tmin-width: 100%;\n\tjustify-content: center;\n}\n*/\n\n\n/*\n.rdr-float-prev, .rdr-float-next {\n\tposition: absolute;\n\ttop: 0;\n\theight: 100%;\n\tcursor: pointer;\n\tz-index: 2;\n}\n\n.rdr-float-prev {\n\twidth: 30%;\n}\n.rdr-float-next {\n\tright: 0;\n\twidth: 70%;\n}\n*/\n\n.rdr-page-selector {\n\theight: 100vh;\n\twidth: 1px;\n\ttop: 0;\n\topacity: 0;\n\tposition: relative;\n\tz-index: 3;\n\ttransition: left .3s ease, opacity .3s ease;\n\tmin-width: 2rem;\n\tmargin-right: -2rem;\n\tcursor: pointer;\n}\n\n.selPinned-true .rdr-page-selector,\n.vis,\n.rdr-page-selector:hover {\n\topacity: 1 !important;\n}\n\n.rdr-page-selector:hover .rdr-page-selector-keys,\n.rdr-page-selector.vis .rdr-page-selector-keys,\n.selPinned-true .rdr-page-selector-keys {\n\tleft: 3px;\n}\n\n.rdr-page-selector-keys {\n\theight: 100%;\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tleft: 0em;\n\ttransition: left .3s ease, opacity 0.2s ease, box-shadow 0.2s ease;\n}\n\n.rdr-page-selector-keys div {\n\tflex-grow: 1;\n\tposition: relative;\n\tz-index: 2;\n\tmargin-bottom: 2px;\n\tborder-left: var(--rdrBorderL) solid #555;\n\ttransition: left .2s ease, opacity 0.2s ease, box-shadow 0.2s ease, margin 0.2s ease, padding 0.2s ease, color 0.2s ease, text-shadow 0.2s ease, border 0.2s ease;\n\tposition: relative;\n\ttext-align: left;\n\tcolor: transparent;\n\tfont-size: 2vh;\n\tline-height: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: flex-start;\n\tpadding-left: 1em;\n\twill-change: transform;\n\ttext-shadow: none;\n}\n\n.rdr-page-selector-keys div:before {\n\tcontent: \"\";\n\tdisplay: block;\n\tposition: absolute;\n\tvertical-align: middle;\n\tmargin-right: 1.4ch;\n\theight: 100%;\n\twidth: var(--rdr-wb);\n\tleft: -4px;\n\tbackground: #272b30;\n}\n.rdr-page-selector-keys div:after {\n\tcontent: \"\";\n\tdisplay: block;\n\theight: 102%;\n\twidth: 100%;\n\tposition: absolute;\n}\n\n.rdr-page-selector-keys div:hover {\n\tborder-left: 1px solid lightgray;\n\tbox-shadow: 100px 0px 20px -100px rgba(255,255,255,0.5) inset, 100px 0px 20px -100px rgba(0,0,0,0.55) inset;\n\tleft: 2px;\n\tcolor: rgba(255,255,255,1);\n\ttext-shadow: 1px 1px 0px rgba(0,0,0,0.5), -1px -1px 0px rgba(0,0,0,0.5), 1px -1px 0px rgba(0,0,0,0.5), -1px 1px 0px rgba(0,0,0,0.5), 1px 0px 0px rgba(0,0,0,0.5), -1px 0px 0px rgba(0,0,0,0.5), 0px -1px 0px rgba(0,0,0,0.5), 0px 1px 0px rgba(0,0,0,0.5), 0px 0px 3px rgba(0,0,0,0.5);\n}\n\n.rdr-page-selector-keys div.shown {\n\tborder-left: 1px solid white;\n\tcolor: white;\n\tbox-shadow: 100px 0px 20px -100px white inset, 100px 0px 20px -90px inset rgba(0,0,0,0.62);\n\ttext-shadow: 1px 1px 0px rgba(0,0,0,0.5), -1px -1px 0px rgba(0,0,0,0.5), 1px -1px 0px rgba(0,0,0,0.5), -1px 1px 0px rgba(0,0,0,0.5), 1px 0px 0px rgba(0,0,0,0.5), -1px 0px 0px rgba(0,0,0,0.5), 0px -1px 0px rgba(0,0,0,0.5), 0px 1px 0px rgba(0,0,0,0.5), 0px 0px 3px rgba(0,0,0,0.5);\n\tleft: 0;\n\t\n}\n\n.selPinned-true .rdr-page-selector-keys div.shown {\n\tcolor: rgba(255,255,255,0.9)\n}\n\n.selPinned-true.selNum-false .rdr-page-selector-keys div.shown {\n\tcolor: transparent;\n\ttext-shadow: none;\n}\n.selPinned-true.selNum-false .rdr-page-selector-keys div.shown:hover {\n\tcolor: rgba(255,255,255,1);\n\ttext-shadow: 1px 1px 1px black, -1px -1px 1px black, 1px -1px 1px black, -1px 1px 1px black;\n}\n\n.rdr-page-selector-keys div.shown {\n\tpadding-bottom: 2px;\n\tmargin-bottom: 0;\n}\n\n.rdr-page-selector-counter {\n\tdisplay: none;\n}\n\n\n/*\n.rdr-page-selector {\n\tmargin-right: 0;\n\tmargin-left: -5rem;\n}\n\n.rdr-page-selector-keys div::before {\n\tmargin-right: 0;\n\tleft: auto;\n\tright: -4px;\n}\n\n.rdr-page-selector-keys div {\n\tborder-left: none;\n\tborder-right: 1px solid #555;\n\ttext-align: right;\n\tleft: 0;\n}\n\n.rdr-page-selector-keys div:hover {\n\tborder-left: none;\n\tleft: 0;\n\tborder-right: 1px solid lightgray;\n\tbox-shadow: -100px 0px 20px -100px rgba(255,255,255,0.5) inset, -100px 0px 20px -100px black inset;\n\tleft: -2px;\n}\n\n.rdr-page-selector-keys div.is-active {\n\tborder-left: none;\n\tborder-right: 1px solid white;\n\tbox-shadow: -100px 0px 20px -100px white inset;\n}\n\n\n.rdr-page-selector-keys {\n\tright: 0;\n}\n\n.rdr-page-selector:hover .rdr-page-selector-keys,\n.rdr-page-selector.vis .rdr-page-selector-keys {\n\tleft: -20px;\n}\n*/\n\n\n.hide-side {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\ttop: unset !important;\n\tz-index: 500;\n\twidth: 3rem;\n}\n\n.hide-side div {\n\ttop: unset !important;\n}\n\n.hide-side div::after {\n\tcontent: \"\\e90a\";\n\ttransform: scaleX(-1);\n\tposition: relative;\n\tbottom: 0.5rem;\n\tleft: 0.6rem;\n}\n\n.hide-side div:before {\n\tcontent: \"\";\n\tposition: absolute;\n\twidth: 0;\n\theight: 0;\n\tborder-style: solid;\n\tborder-width: 0 3rem 3rem 0;\n\tborder-color: transparent var(--sidebarColDark) transparent  transparent;\n}\n\n.hide-side:hover div:before {\n\tborder-color: transparent var(--prevCol) transparent  transparent;\n}\n\n.zoom-level {\n\ttop: 0;\n\tflex-direction: column;\n\toverflow: hidden;\n\tright: 24px;\n\tpadding: 2rem 3.5rem;\n\topacity: 0.01;\n\ttransition: opacity 0.3s ease;\n\tposition: absolute;\n\tuser-select: none;\n\tdisplay: none;\n}\n\n.fit-width .zoom-level,\n.fit-width_limit .zoom-level {\n\tdisplay: block;\n\tanimation: zoomFlash 3s;\n}\n\n@keyframes zoomFlash {\n\t0% {\n\t\topacity: 0;\n\t\tpadding: 2rem 0rem;\n\t}\n\t10% {\n\t\topacity: 1;\n\t\tpadding: 2rem 3.5rem;\n\t}\n\t70%{\n\t\topacity: 1;\n\t}\n\t100% {\n\t\topacity: 0;\n\t}\n}\n\n.zoom-level .ico-btn {\n\tbackground: var(--sidebarCol);\n\twidth: 3rem;\n\theight: 3rem;\n\tborder-top-left-radius: 4px;\n\tborder-top-right-radius: 4px;\n}\n\n.zoom-level .ico-btn:last-child {\n\twidth: 3rem;\n\theight: 3rem;\n\tborder-radius: 0;\n\tborder-bottom-left-radius: 4px;\n\tborder-bottom-right-radius: 4px;\n\tmargin-top: -1px;\n}\n\n.zoom-level .ico-btn:hover {\n\tbackground: var(--sidebarColDark);\n}\n\n.fit-width .zoom-level:hover,\n.fit-width_limit .zoom-level:hover {\n\topacity: 1 !important;\n\tanimation-play-state: paused;\n}\n\n\n/*.zoom-11 .fit-width .ReaderImageWrapper img {min-width: 110%; max-width: 110%}\n.zoom-12 .fit-width .ReaderImageWrapper img {min-width: 120%; max-width: 120%}\n.zoom-13 .fit-width .ReaderImageWrapper img {min-width: 130%; max-width: 130%}\n.zoom-14 .fit-width .ReaderImageWrapper img {min-width: 140%; max-width: 140%}\n.zoom-15 .fit-width .ReaderImageWrapper img {min-width: 150%; max-width: 150%}\n.zoom-16 .fit-width .ReaderImageWrapper img {min-width: 160%; max-width: 160%}\n.zoom-17 .fit-width .ReaderImageWrapper img {min-width: 170%; max-width: 170%}\n.zoom-18 .fit-width .ReaderImageWrapper img {min-width: 180%; max-width: 180%}\n.zoom-19 .fit-width .ReaderImageWrapper img {min-width: 190%; max-width: 190%}\n.zoom-20 .fit-width .ReaderImageWrapper img {min-width: 200%; max-width: 200%}*/\n\n\n.Tooltippy {\n\tposition: absolute;\n\tpadding: 0.4em 0.8em;\n\tbackground: var(--sidebarColFocus);\n\tborder-radius: 2px;\n\tbox-shadow: 2px 2px 3px rgba(0,0,0,0.5);\n\tz-index: 3000;\n\tfont-size: 11px;\n\tpointer-events: none; \n\tdisplay: none;\n}\n\n.Tooltippy.Error {\n\tborder: 1px solid rgb(230, 60, 60)\n}\n\n.Tooltippy .Tooltippy-key {\n\tdisplay: inline-block;\n\tborder: 1px solid rgba(255,255,255,0.2);\n\tpadding: 0.1em 0.2em;\n\tmin-width: 1em;\n\ttext-align: center;\n\tborder-radius: 2px;\n\tfont-family: monospace;\n\n}\n\n.Tooltippy .Tooltippy-key:first-of-type {\n\tmargin-left: 1ch;\n}\n\n.FauxDrop {\n\tposition: relative;\n\tdisplay: flex;\n}\n\n.FauxDrop select {\n\tposition: absolute;\n\twidth: 100%;\n\tleft: 0;\n\ttop: 0;\n\tbottom: 0;\n\topacity: 0;\n}\n\n#rdr-vol, #rdr-chap {\n\topacity: 0;\n}\n\n.FauxDrop label {\n\tdisplay: flex;\n\tflex-grow: 1;\n\talign-items: center;\n\tpointer-events: none;\n}\n\n.LodaManager {\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tz-index: 2000;\n\tdisplay: flex;\n\toverflow: auto;\n\tposition: fixed;\n\twill-change: transform;\n\tbackground: rgba(0,0,0,0.6);\n\tjustify-content: center;\n\talign-items: flex-start;\n\tflex-direction: row;\n\tflex-wrap: wrap;\n}\n.LodaManager:after {\n\tcontent: '';\n\tdisplay: block;\n\tpadding: 5vh 0;\n\tmin-width: 100%;\n}\n\n.Loda {\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--prevCol);\n\tborder-radius: 4px;\n\tposition: relative;\n\tbox-shadow: 0px 4px 7px 3px rgba(0,0,0,0.3);\n\tmargin-top: 10vh;\n\tmin-width: 40vw;\n}\n\n.Loda .close {\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\tz-index: 20;\n}\n\n.Loda header {\n\tdisplay: flex;\n\tmin-width: 10rem;\n\tpadding: 0 4rem 0 1rem;\n\tfont-size: 0.8rem;\n\ttext-transform: uppercase;\n\talign-items: center;\n\tmin-height: 3rem;\n\tfont-weight: 600;\n\tletter-spacing: 0.04ch;\n\tcolor: var(--textCol);\n}\n\n.Loda_Search content {\n\tpadding: 0 0.8em 0.8em 0.8em;\n}\n\n.Loda_Search input {\n\tbackground: rgba(255,255,255,.1);\n\twidth: 100%;\n\theight: 3rem;\n\tline-height: 3rem;\n\tpadding: 0 1rem;\n\tbox-sizing: border-box;\n\tborder: none;\n\tfont-size: 1.2rem;\n\tcolor: var(--textCol);\n\tbox-shadow: 0px 4px 8px var(--blackLight);\n}\n.Loda_Search input::-webkit-input-placeholder,\n.Loda_Search input::-moz-placeholder,\n.Loda_Search input:-ms-input-placeholder, \n.Loda_Search input:-moz-placeholder,\n.Loda_Jump input::-webkit-input-placeholder,\n.Loda_Jump input::-moz-placeholder,\n.Loda_Jump input:-ms-input-placeholder, \n.Loda_Jump input:-moz-placeholder {\n  font-family: 'guya';\n  opacity: 0.5;\n}\n\n.Loda_Search .list {\n\tpadding: 1rem 0 0 0;\n}\n\n.Loda_Search .list:empty {\n\tpadding: 0;\n}\n\n.Loda.Loda_Jump {\n\tmax-width: 35ch;\n\tmin-width: 27ch;\n\tmargin-top: 0;\n\talign-self: center;\n}\n\n.Loda_Jump .close {\n\tright: auto;\n\ttop: -3rem;\n\ttext-shadow: 0px 1px 3px black;\n}\n\n.Loda_Jump header {\n\tdisplay: none;\n}\n\n.Jump-Wrapper {\n\tdisplay: flex;\n\tjustify-content: stretch;\n\theight: 3.5rem;\n\talign-items: stretch;\n\talign-content: stretch;\n\tborder-radius: 4px;\n\toverflow: hidden;\n}\n\n.Loda_Jump input::placeholder {\n\tfont-size: 0.7em;\n}\n.Loda_Jump input {\n\tbackground: rgba(255,255,255,.1);\n\twidth: 0%;\n\ttext-align: center;\n\tline-height: 2.5rem;\n\tpadding: 0 1rem;\n\tbox-sizing: border-box;\n\tborder: none;\n\tfont-size: 1.4rem;\n\tcolor: rgba(var(--textCol), 0.9);\n\tbox-shadow: 0px 3.5px 6px rgba(0,0,0,0.2);\n\tflex-grow: 1;\n\theight: auto;\n\tfont-family: 'Open Sans';\n}\n\n.Loda_Jump input:focus {\n\toutline: none;\n\tborder: none;\n}\n\n\n.Loda_Jump input:first-child {\n\tborder-bottom-left-radius: 4px;\n\tborder-top-left-radius: 4px;\n}\n\n.Loda_Jump .Button {\n\tdisplay: inline-block;\n\tcolor: #333;\n\tbox-shadow: 0px 3.5px 6px rgba(0,0,0,0.2);\n\tfont-family: 'Open Sans';\n\theight: auto;\n\tfont-size: 1.5em;\n\tcolor: var(--accentCol);\n}\n\n.Loda_Settings {\n\tmargin-right: auto;\n\tmargin-left: 8rem;\n\tflex-direction: row;\n\talign-content: stretch;\n\tuser-select: none;\n\tmin-width: 31.2rem;\n}\n.Loda_Settings aside {\n\twidth: 11.2rem;\n\tbackground-color: var(--sidebarColDark);\n\tpadding-bottom: 2rem;\n}\n.Loda_Settings content {\n\tpadding-bottom: 2rem;\n\tmin-width: 20rem;\n\tmax-width: 30rem;\n}\n.Loda_Settings .Tab {\n\tpadding: 0.5rem 1rem;\n\tfont-size: 0.9em;\n}\n.Loda_Settings .Tab:hover {\n\tbackground: rgba(255,255,255,0.15);\n\tcursor: default;\n}\n.Loda_Settings .Tab.is-active {\n\tbackground: var(--sidebarColFocus);\n\tpadding: 0.5rem 1rem;\n\tfont-size: 0.9em;\n}\n.Loda_Settings .Tab .ico-btn {\n\tdisplay: none;\n}\n.Loda_Settings .setting-wrapper  {\n\tpadding: 0.3rem 1rem 1.2rem 1rem;\n\tborder-bottom: 1px solid rgba(0,0,0,0.3);\n}\n.Loda_Settings .setting-wrapper:last-child  {\n\tborder-bottom: none;\n}\n.Loda_Settings .setting-header {\n\tpadding: 0;\n\tmin-height: 2.5rem;\n\tpadding-top: 0.5rem;\n\tcolor: var(--textCol);\n}\n\n.Loda_Settings .t-row {\n  margin: 0 0 0.7rem 0;\n}\n\n.Loda_Settings .ico-btn {\n  font-size: 17.8px;\n}\n\n\n.compact.setting-wrapper {\n\tpadding: 0.5rem 1rem 0.5rem 1rem;\n\tdisplay: flex;\n}\n\n.Loda_Settings .setting-header {\n\tpadding-top: 0;\n}\n\n.compact .UI.SettingDisplay {\n\talign-items: center;\n\talign-content: center;\n\tdisplay: flex;\n\tflex-grow: 1;\n\tjustify-content: flex-end;\n}\n\n.SettingUnit.compact .ToggleButton > * {\n\tdisplay: none;\n}\n\n.SettingUnit.compact .ToggleButton:before {\n\tcontent: \"\ue939\";\n\tdisplay: inline-block;\n\tfont-family: Guya;\n\tfont-size: 1.7em;\n\tline-height: 0;\n\tmargin-right: -0.2em;\n}\n\n.SettingUnit.compact .ToggleButton:last-child::before {\n\tcontent: \"\ue907\";\n}\n\n.SettingUnit.compact .t-1 {\n\tflex-grow: 0;\n\tmargin-left: 1rem;\n}\n\n.SettingUnit.compact .ButtonGroup {\n\tmargin-bottom: 0;\n}\n\n\n.IndexSearch:empty:before {\n\tcontent: \"Type your query and press Enter to search the entire manga contents.\";\n\twidth: 100%;\n\tdisplay: flex;\n\tpadding: 1rem 4rem;\n\ttext-align: center;\n\topacity: 0.5;\n\tbox-sizing: border-box;\n}\n\n.ChapterUnit {\n\tdisplay: flex;\n\tflex-grow: 1;\n\tjustify-content: flex-start;\n\talign-items: stretch;\n\tmargin-bottom: 0.8rem;\n\tborder-radius: 3px;\n\toverflow: hidden;\n\tborder: 1px solid transparent;\n\tcursor: pointer;\n}\n.ChapterUnit:last-child {\n\tmargin-bottom: 0;\n}\n\n\n\n.ChapterUnit:hover {\n\tborder: 1px solid #393939;\n\tbackground: rgba(0,0,0,0.3)\n}\n\n.ChapterUnit figure {\n\tflex-grow: 0;\n\tmax-width: 3rem;\n\tmin-width: 3rem;\n\tmargin-right: 0.2rem;\n\tbackground-size: cover;\n\tbackground-position: center center;\n}\n\n.ChapterUnit content {\n\tdisplay: flex;\n\tflex-direction: column;\n\tfont-size: 1rem;\n\tpadding: 0.8em;\n}\n\n.ChapterUnit h2 {\n\tfont-size: 1.2em;\n\tpadding-bottom: 0.5em;\n}\n\n.ChapterUnit blockquote:before {\n/*\tcontent:\"Chapter text not yet available...\"; */\n\tcolor: rgba(255,255,255,0.1);\n\tfont-size: 0.8rem;\n}\n\n.ChapterUnit .pages div {\n\tdisplay: inline-block;\n\tborder: 1px solid rgba(255,255,255,0.2);\n\tpadding: 0.1em 0.2em;\n\tmin-width: 1em;\n\ttext-align: center;\n\tborder-radius: 2px;\n\tfont-family: monospace;\n\tmargin-right: 0.4rem;\n}\n.ChapterUnit .pages div:hover {\n\tbackground: rgba(255,255,255,0.5);\n\tcolor: black;\n}\n\n.ChapterUnit i {\n\tcolor: var(--accentCol);\n\ttext-decoration: none;\n\tfont-style: normal;\n}\n\n.Loadable {\n\tposition: relative;\n}\n\n.Loadable:after {\n\tcontent: \"Loading...\";\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translateX(-50%) translateY(-50%);\n\tdisplay: flex;\n\twidth: 10rem;\n\tmax-width: 100%;\n\theight: 5rem;\n\tbackground-position: left center;\n\tbackground-repeat: no-repeat;\n\tbackground-size: contain;\n\tdisplay: none;\n}\n\n.Loadable.loading:after {\n\tmin-height: 6rem;\n\tdisplay: flex;\n\tbackground-image: url(../img/fujiload.png);\n\tanimation: weewoo 1s infinite;\n}\n\n@keyframes weewoo {\n\t0% {\n\t\ttransform: translateX(-50%), translateY(-50%) scale(1) rotate(0deg);\n\t}\n\t20% {\n\t\ttransform: translateX(-50%) translateY(-50%) scale(1.2) rotate(10deg);\n\t}\n\t50% {\n\t\ttransform: translateX(-50%) translateY(-50%) scale(1) rotate(0deg);\n\t}\n\t75% {\n\t\ttransform: translateX(-50%) translateY(-50%) scale(1.2) rotate(-10deg);\n\t}\n\t100% {\n\t\ttransform: translateX(-50%) translateY(-50%) scale(1) rotate(0deg);\n\t}\n}\n\n.search-tabs {\n\tdisplay: flex;\n\twidth: 100%;\n\tjustify-content: stretch;\n\talign-items: center;\n\tmargin-top: 0.5rem;\n}\n\n.search-tabs .Tab {\n\tflex-grow: 1;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 0.5rem 0;\n\tfont-size: 0.8em;\n\tcursor: default;\n\tborder-bottom: 1px solid transparent;\n}\n\n.search-tabs .Tab:hover {\n\tborder-bottom: 1px solid rgba(255,255,255,0.2);\n}\n.search-tabs .Tab.is-active {\n\tborder-bottom: 1px solid var(--accentCol, 0.8);\n}\n.search-tabs .Tab i {\n\tfont-style: normal;\n\tfont-weight: normal;\n\tdisplay: inline-block;\n\tpadding: 0.1em 0.3em;\n\tborder: 1px solid gray;\n\tborder-radius: 3px;\n\tfont-size: 0.8em;\n\tmargin-left: 1em;\n\ttext-align: center;\n\tmin-width: 2ch;\n}\n\n.search-tabs .Tab i:empty {\n\tdisplay: none;\n}\n\n.search-tabs .Tab:nth-child(2) > i {\n\n}\n\n.rdr-aside-overlay {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\twidth: 100%;\n\tbackground: rgba(0,0,0,0.7);\n\tz-index: 100;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: flex-start;\n\talign-items: stretch;\n\tpadding: 1rem;\n\tbox-sizing: border-box;\n\tcursor: pointer;\n}\n.card-arrow-up {\n\twidth: 0;\n\theight: 0;\n\tborder-style: solid;\n\tborder-width: 0 0.6em 0.6em 0.6em;\n\tborder-color: transparent transparent #3a3f40 transparent;\n}\n.rdr-aside-overlay:before {\n\tcontent: \"\u00d7\";\n\tfont-family: 'Open Sans';\n\tfont-size: 1.5em;\n\theight: 2em;\n\twidth: 1.7em;\n\tfont-weight: bold;\n\ttext-shadow: 0px 1px 2px rgba(0,0,0,0.4);\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tcursor: pointer;\n\talign-self: flex-start;\n}\n\n.rdr-aside-view {\n\tcursor: default;\n\tpadding: 0.5rem 1rem;\n\tbackground: var(--sidebarCol);\n\tborder-radius: 3px;\n\tposition: relative;\n\tbox-shadow: 0px 4px 7px 3px rgba(0,0,0,0.4);\n}\n\n.zoom-level.refresh-chapter {\n\twill-change: transform;\n\tflex-direction: row;\n\tdisplay: flex;\n\tbottom: 10px;\n\ttop: unset;\t\n\tright: 20px;\n\tleft: unset;\n\topacity: 1;\n}\n\n.zoom-level.refresh-chapter .ico-btn {\n\tborder-radius: 4px;\n\tbackground: rgba(200, 50, 0, 0.7);\n}\n.refresh-chapter-note {\n\tbackground: rgba(0,0,0,.8);\n\tmargin-right: 6px;\n\tpadding: 0.5em 0.7em;\n\tfont-size: 1rem;\n\tcolor: white;\n\topacity: 0;\n\tborder-radius: 4px;\n\ttransition: opacity 0.2s ease;\n}\n\n.zoom-level.refresh-chapter:hover .refresh-chapter-note {\n\topacity: 1;\n}\n\n.rdr-aside-view .header {\n\ttext-align: left;\n\tpadding: 0.5em 0;\n\tfont-size: 0.6em;\n\ttext-transform: uppercase;\n\tfont-weight: bold;\n}\n\n.rdr-aside-view .ToggleButton {\n\tflex-grow: 1;\n\ttext-align: center;\n}\n\n.t-row {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tflex-wrap: nowrap;\n\twidth: 100%;\n\tmargin: 0.7rem 0;\n}\n\n.t-row > div {\n\tdisplay: flex;\n\talign-items: stretch;\n}\n\n.t-0 {\n\tflex-grow: 0;\n}\n.t-1 {\n\tflex-grow: 1;\n}\n.t-tooltip {\n\tdisplay: flex;\n\tflex-basis: 5em;\n\tfont-size: 12px;\n\talign-items: center !important;\n\tpadding-right: 0.4em;\n}\n\n\n.ToggleButton {\n\tdisplay: inline-block;\n\tpadding: 0.5em 1.4em 0.5em 1.0em;\n\tline-height: 1;\n\tfont-size: 0.59em;\n\tline-height: 1.2;\n\tcursor: default;\n\tuser-select: none;\n\ttext-align: center;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n \tbackground: var(--blackLight);\n \tmin-height: 1.1rem;\n \tflex-grow: 1;\n \tborder-left: 1px solid var(--borderColor);\n\tborder-top: 1px solid var(--borderColor);\n\tmargin-top: -1px;\n\tmargin-left: -1px;\n}\n\n.ToggleButton.s {\n\tbackground: var(--accentCol);\n\tcolor: var(--accentSelected);\n}\n.ToggleButton.s .ico-btn {\n\tcolor: var(--accentSelected);\n}\n\n/*.ToggleButton:nth-child(2):not(:last-child),\n.ToggleButton:nth-child(2) ~ .ToggleButton:not(:last-child) {\n\tborder-left: none;\n}*/\n\n.ButtonGroup .t-1 {\n\tflex-wrap: wrap;\n\tmax-width: 99.499%;\n\tborder: 1px solid var(--borderColor);\n\tborder-radius: 3px;\n\toverflow: hidden;\n}\n\n.ButtonGroup.b4 .ToggleButton {\n\tflex-basis: 30%;\n}\n\n.ButtonGroup .Button .ico-btn {\n\tpadding: 0;\n\theight: auto;\n\twidth: auto;\n\tpadding-right: 0.4em;\n\tpointer-events: none;\n\ttransition: none;\n}\n\n.s .ico-btn {\n\tcolor: #333;\n}\n\n.selectorAnchor-bottom .rdr-page-selector {\n\tmin-width: unset;\n\tmargin-right: unset;\n\tposition: fixed;\n\twill-change: transform;\n\twidth: 100vw;\n\theight: 1px;\n\tmin-height: 3rem;\n\tbottom: 0;\n\tbackground: linear-gradient(0deg, var(--blackFlag) 10%, rgba(0,0,0,0) 100%);\n\t\t\ttop: unset !important;\n}\n\n.selPinned-true .rdr-page-selector,\n.vis,\n.rdr-page-selector:hover {\n\t\n}\n\n.selectorAnchor-bottom .rdr-page-selector:hover .rdr-page-selector-keys,\n.selectorAnchor-bottom .rdr-page-selector.vis .rdr-page-selector-keys,\n.selectorAnchor-bottom.selPinned-true .rdr-page-selector-keys {\n\tleft: unset;\n\tbottom: 3px;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-counter {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 2.2rem;\n\tbottom: -3px;\n\tfont-size: 0.7rem;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: flex-start;\n\tcolor: white;\n\ttext-shadow: 1px 1px 1px black, -1px -1px 1px black, 1px -1px 1px black, -1px 1px 1px black, 1px 1px 6px black;\n\ttransition: all 0.3s ease;\n}\n.selectorAnchor-bottom.selPinned-true.selNum-false .rdr-page-selector-counter {\n\topacity: 0;\n}\n\n.selectorAnchor-bottom.direction-rtl .rdr-page-selector-keys {\n\ttransform: scaleX(-1);\n}\n\n.selectorAnchor-bottom .rdr-page-selector:hover .rdr-page-selector-counter,\n.selectorAnchor-bottom .rdr-page-selector.vis .rdr-page-selector-counter,\n.selectorAnchor-bottom.selPinned-true .rdr-page-selector-counter {\n\tbottom: 0px;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-keys {\n\theight: unset;\n\twidth: 100%;\n\theight: 100%;\n\tflex-direction: row;\n\tleft: unset;\n\tbottom: 0;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-keys div {\n\tmargin-right: 1px;\n\tmargin-bottom: unset;\n\tborder-left: none;\n\tborder-bottom: 1.5px solid #555;\n\ttext-align: center;\n\tfont-size: 3vw;\n\tmin-width: 0px;\n\talign-items: flex-start;\n\tjustify-content: center;\n\tpadding-left: 0;\n\tfont-size: 0;\n\tpadding-bottom: 1em;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-keys div:before {\n\tcontent: \"\";\n\tdisplay: block;\n\tposition: absolute;\n\tvertical-align: middle;\n\tmargin-right: 1.4ch;\n\theight: 3px;\n\twidth: 100%;\n\tleft: 0;\n\tbottom: -4px;\n}\n.selectorAnchor-bottom .rdr-page-selector-keys div:after {\n\tcontent: \"\";\n\tdisplay: block;\n\theight: 100%;\n\twidth: 102%;\n\tposition: absolute;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-keys div:hover {\n\tborder-left: none;\n\tborder-bottom: 1px solid lightgray;\n\tbox-shadow: 0px -100px 20px -100px rgba(255,255,255,0.8) inset, 0px -100px 20px -100px rgba(0,0,0,0.5) inset;\n\tleft: 0px;\n\tbottom: 2px;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-keys div.shown {\n\tborder-left: none;\n\tborder-bottom: 3.5px solid var(--accentCol);\n\tbox-shadow:  0px -100px 20px -80px var(--rdrAncBottomWhite) inset;\n}\n\n.selectorAnchor-bottom .rdr-page-selector-keys div.shown:hover {\n\tbottom: 0 !important;\n}\n.selectorAnchor-bottom .rdr-page-selector .preloaded {\n\tborder-bottom-color: var(--accentCol);\n}\n\n\n\n\n\n\n\n\n\n@media (min-width: 699px) {\n\t.sidebar-false main > aside {\n\t\tmargin-left: -16em;\n\t}\n\n\t.rdr-aside-buffer {\n\t\tdisplay: none;\n\t}\n\n\t.selectorAnchor-left.sidebar-false .rdr-page-selector {\n\t\theight: calc(100vh - 3rem);\n\t\ttop: 3rem;\n\t}\n\n\t.sidebar-false .hide-side {\n\t\tright: -3rem;\n\t\tz-index: 20;\n\t\ttransform: scaleX(-1);\n\t}\n\n\t.sidebar-false .hide-side div::after {\n\t\t\n\t}\n\n\t.sidebar-false .hide-side {\n\t}\n\n\t.sidebar-false .hide-side div::before {\n\t\t/*border-color: transparent  #3a3f44 transparent  transparent;*/\n\t}\n\t.sidebar-false .hide-side div:hover:before {\n\t\tfilter: brightness(110%);\n\t\t/*border-color: transparent #2b2f33 transparent  transparent;*/\n\t}\n\n\t.fit-width.zoom-10 .ReaderImageWrapper img {max-width: 10%; min-height: 0}\n\t.fit-width_limit.zoom-10 .ReaderImageWrapper img {max-width: 10%}\n\t.fit-width.zoom-20 .ReaderImageWrapper img {max-width: 20%; min-height: 0}\n\t.fit-width_limit.zoom-20 .ReaderImageWrapper img {max-width: 20%}\n\t.fit-width.zoom-30 .ReaderImageWrapper img {max-width: 30%; min-height: 0}\n\t.fit-width_limit.zoom-30 .ReaderImageWrapper img {max-width: 30%}\n\t.fit-width.zoom-40 .ReaderImageWrapper img {max-width: 40%; min-height: 0}\n\t.fit-width_limit.zoom-40 .ReaderImageWrapper img {max-width: 40%}\n\t.fit-width.zoom-50 .ReaderImageWrapper img {max-width: 50%; min-height: 0}\n\t.fit-width_limit.zoom-50 .ReaderImageWrapper img {max-width: 50%}\n\t.fit-width.zoom-60 .ReaderImageWrapper img {max-width: 60%; min-height: 0}\n\t.fit-width_limit.zoom-60 .ReaderImageWrapper img {max-width: 60%}\n\t.fit-width.zoom-70 .ReaderImageWrapper img {max-width: 70%; min-height: 0}\n\t.fit-width_limit.zoom-70 .ReaderImageWrapper img {max-width: 70%}\n\t.fit-width.zoom-80 .ReaderImageWrapper img {max-width: 80%; min-height: 0}\n\t.fit-width_limit.zoom-80 .ReaderImageWrapper img {max-width: 80%}\n\t.fit-width.zoom-90 .ReaderImageWrapper img {max-width: 90%; min-height: 0}\n\t.fit-width_limit.zoom-90 .ReaderImageWrapper img {max-width: 90%}\n\n\t.fit-width.zoom-10 .two-page.ReaderImageWrapper img {max-width: 25% !important; min-height: 0}\n\t.fit-width_limit.zoom-10 .two-page.ReaderImageWrapper img {max-width: 25% !important}\n\t.fit-width.zoom-20 .two-page.ReaderImageWrapper img {max-width: 25% !important; min-height: 0}\n\t.fit-width_limit.zoom-20 .two-page.ReaderImageWrapper img {max-width: 25% !important}\n\t.fit-width.zoom-30 .two-page.ReaderImageWrapper img {max-width: 25% !important; min-height: 0}\n\t.fit-width_limit.zoom-30 .two-page.ReaderImageWrapper img {max-width: 25% !important}\n\t.fit-width.zoom-40 .two-page.ReaderImageWrapper img {max-width: 25% !important; min-height: 0}\n\t.fit-width_limit.zoom-40 .two-page.ReaderImageWrapper img {max-width: 25% !important}\n\t.fit-width.zoom-50 .two-page.ReaderImageWrapper img {max-width: 25% !important; min-height: 0}\n\t.fit-width_limit.zoom-50 .two-page.ReaderImageWrapper img {max-width: 25% !important}\n\t.fit-width.zoom-60 .two-page.ReaderImageWrapper img {max-width: 30% !important; min-height: 0}\n\t.fit-width_limit.zoom-60 .two-page.ReaderImageWrapper img {max-width: 30% !important}\n\t.fit-width.zoom-70 .two-page.ReaderImageWrapper img {max-width: 35% !important; min-height: 0}\n\t.fit-width_limit.zoom-70 .two-page.ReaderImageWrapper img {max-width: 35% !important}\n\t.fit-width.zoom-80 .two-page.ReaderImageWrapper img {max-width: 40% !important; min-height: 0}\n\t.fit-width_limit.zoom-80 .two-page.ReaderImageWrapper img {max-width: 40% !important}\n\t.fit-width.zoom-90 .two-page.ReaderImageWrapper img {max-width: 45% !important; min-height: 0}\n\t.fit-width_limit.zoom-90 .two-page.ReaderImageWrapper img {max-width: 45% !important}\n}\n\n\n@media (max-width: 700px) {\n\n\tmain {\n\t\tflex-direction: column;\n\t\theight: auto;\n\t\tmax-height: unset;\n\t\tmax-height: auto;\n\t\toverflow: auto;\n\t}\n\n\tmain > aside {\n\t\tmin-width: 100%;\n\t\theight: auto;\n\t\tposition: relative;\n\t\tflex-shrink: 0;\n\t\ttransition: none;\n\t}\n\n\tmain > aside > header {\n\t\toverflow-y: auto;\n\t\tmax-height: 3rem;\n\t}\n\n\t.rdr-aside-overlay {\n\t\tposition: fixed;\n\t\tjustify-content: flex-start;\n\t\twill-change: transform;\n\t}\n\t.rdr-aside-overlay:before {\n\t\talign-self: flex-end;\n\t}\n\n\t.rdr-previews {\n\t\tdisplay: none;\n\t}\n\n\t.rdr-page-selector {\n\t\tmin-width: unset;\n\t\tmargin-right: unset;\n\t\tposition: fixed;\n\t\twill-change: transform;\n\t\twidth: 100vw;\n\t\theight: 1px;\n\t\tmin-height: 3rem;\n\t\tbottom: 0;\n\t\tbackground: linear-gradient(0deg, rgba(0,0,0,1) 10%, rgba(0,0,0,0) 100%);\n\t\t\t\ttop: unset !important;\n\t}\n\n\t.selPinned-true .rdr-page-selector,\n\t.vis,\n\t.rdr-page-selector:hover {\n\t\t\n\t}\n\n\t.rdr-page-selector:hover .rdr-page-selector-keys,\n\t.rdr-page-selector.vis .rdr-page-selector-keys,\n\t.selPinned-true .rdr-page-selector-keys {\n\t\tleft: unset;\n\t\tbottom: 3px;\n\t}\n\n\t.rdr-page-selector-counter {\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\theight: 2.2rem;\n\t\tbottom: -3px;\n\t\tfont-size: 0.7rem;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: flex-start;\n\t\tcolor: white;\n\t\ttext-shadow: 1px 1px 1px black, -1px -1px 1px black, 1px -1px 1px black, -1px 1px 1px black, 1px 1px 6px black;\n\t\ttransition: all 0.3s ease;\n\t}\n\t.selPinned-true.selNum-false .rdr-page-selector-counter {\n\t\topacity: 0;\n\t}\n\n\t.direction-rtl .rdr-page-selector-keys {\n\t\ttransform: scaleX(-1);\n\t}\n\n\t.rdr-page-selector:hover .rdr-page-selector-counter,\n\t.rdr-page-selector.vis .rdr-page-selector-counter,\n\t.selPinned-true .rdr-page-selector-counter {\n\t\tbottom: 0px;\n\t}\n\n\t.rdr-page-selector-keys {\n\t\theight: unset;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tflex-direction: row;\n\t\tleft: unset;\n\t\tbottom: 0;\n\t}\n\n\t.rdr-page-selector-keys div {\n\t\tmargin-right: 1px;\n\t\tmargin-bottom: unset;\n\t\tborder-left: none;\n\t\tborder-bottom: 1px solid #555;\n\t\ttext-align: center;\n\t\tfont-size: 3vw;\n\t\tmin-width: 0px;\n\t\talign-items: flex-start;\n\t\tjustify-content: center;\n\t\tpadding-left: 0;\n\t\tfont-size: 0;\n\t\tpadding-bottom: 1em;\n\t}\n\n\t.rdr-page-selector-keys div:before {\n\t\tcontent: \"\";\n\t\tdisplay: block;\n\t\tposition: absolute;\n\t\tvertical-align: middle;\n\t\tmargin-right: 1.4ch;\n\t\theight: 3px;\n\t\twidth: 100%;\n\t\tleft: 0;\n\t\tbottom: -4px;\n\t}\n\t.rdr-page-selector-keys div:after {\n\t\tcontent: \"\";\n\t\tdisplay: block;\n\t\theight: 100%;\n\t\twidth: 102%;\n\t\tposition: absolute;\n\t}\n\n\t.rdr-page-selector-keys div:hover {\n\t\tborder-left: none;\n\t\tborder-bottom: 1px solid lightgray;\n\t\tbox-shadow: 0px -100px 20px -100px rgba(255,255,255,0.5) inset, 0px -100px 20px -100px black inset;\n\t\tleft: 0px;\n\t\tbottom: 2px;\n\t}\n\n\t.rdr-page-selector-keys div.shown {\n\t\tborder-left: none;\n\t\tborder-bottom: 1px solid white;\n\t\tbox-shadow:  0px -100px 20px -100px white inset;\n\t}\n\n\t.rdr-page-selector-keys div.shown:hover {\n\t\tbottom: 0 !important;\n\t}\n\t.rdr-page-selector .preloaded {\n\t\tborder-bottom-color: var(--accentCol);\n\t}\n\n\t.rdr-groups {\n\t\tmargin-top: 0rem;\n\t}\n\n\t.rdr-selector {\n\t\tpadding-bottom: 0.5rem;\n\t}\n\n\t.selPinned-true.direction-ttb .stick header {\n\t\twidth: 100%;\n\t\tposition: fixed;\n\t\twill-change: transform;\n\t\tz-index: 100;\n\t\tbackground: var(--sidebarCol);;\n\t\ttop: 0;\n\t}\n\n\t.selPinned-true.direction-ttb .stick .rdr-selector {\n\t\twidth: 100%;\n\t\tposition: fixed;\n\t\twill-change: transform;\n\t\tz-index: 100;\n\t\tbackground: var(--sidebarCol);;\n\t\ttop: 3rem;\n\t}\n\n\t.rdr-image-wrap {\n\t\theight: auto;\n\t\tmax-height: 100vh;\n\t\tmin-height: 100vh;\n\t}\n\n\t.direction-ttb .rdr-image-wrap {\n\t\tmax-height: unset;\n\t\toverflow-y: hidden;\n\t}\n\n\t.direction-ttb.fit-all_limit .ReaderImageWrapper img {\n\t\theight: unset;\n\t}\n\t.direction-ttb.fit-all .ReaderImageWrapper img {\n\t\theight: unset;\n\t}\n\n/*\n\t.fit-none .rdr-image-wrap .ReaderImageWrapper {\n\t\tjustify-content: center;\n\t}\n\n\t.fit-height .rdr-image-wrap .ReaderImageWrapper {\n\t\tjustify-content: center;\n\t\tmin-height: 100vh;\n\t\tmax-width: 100vw;\n\t}\n*/\n/*\t.fit-width .rdr-image-wrap .ReaderImageWrapper {\n\t\tmin-height: 100vh;\n\t\talign-items: center;\n\t}*/\n\n/*\n\t.direction-ttb.fit-all .rdr-image-wrap .ReaderImageWrapper {\n\t\tmin-height: auto;\n\t}\n\t*/\n\t.hide-side {\n\t\tdisplay: none !important;\n\t}\n\n\t.fit-width div.zoom-level {\n\t\tdisplay: none;\n\t}\n\n\t.fit-width .ReaderImageWrapper img {\n\t\tflex-grow: 1;\n\t}\n/*\n\t.ReaderImageWrapper {\n\t\toverflow: auto !important;\n\t}\n\n\t.selPinned-true.fit-width div.zoom-level {\n\t\tdisplay: block;\n\t\tbottom: 0;\n\t\ttop: unset;\n\t\tposition: fixed;\n\t\tpadding: \n\t}*/\n\n\t.Tooltippy {\n\t\tposition: fixed;\n\t\twill-change: transform;\n\t\ttop: 30vh;\n\t\tbottom: unset !important;\n\t\tfont-size: 0.9rem;\n\t\ttext-align: center;\n\t\tmax-width: 80vw;\n\t\tborder: 1px solid rgba(255,255,255,0.1);\n\t\tborder-radius: 3px;\n\t}\n\t.Tooltippy .Tooltippy-key {\n\t\tdisplay: none;\n\t}\n\n\n\t/*.rdr-image-wrap:before {\n\t\tcontent: \"\\e909\\00000A\\00000A\\00000A\\e909\\00000A\\00000A\\00000A\\e909\";\n\t\tfont-family: 'guya';\n\t\tjustify-content: flex-end;\n\t\tbox-sizing: border-box;\n\t\twhite-space: pre-wrap;\n\t\tdisplay: flex;\n\t\tposition: absolute;\n\t\theight: 100%;\n\t\talign-items: center;\n\t\tfont-size: 3em;\n\t\twidth: 50%;\n\t\tleft: -50%;\n\t\tpadding-right: 0.5em;\n\t\tcolor: #111;\n\t}*/\n/*\n\t.rdr-image-wrap div:last-child:after {\n\t\tcontent: \"\\e905\\00000A\\00000A\\00000A\\e905\\00000A\\00000A\\00000A\\e905\";\n\t\tfont-family: 'guya';\n\t\tjustify-content: flex-start;\n\t\tbox-sizing: border-box;\n\t\twhite-space: pre-wrap;\n\t\tdisplay: flex;\n\t\tposition: absolute;\n\t\theight: 100%;\n\t\talign-items: center;\n\t\tfont-size: 3em;\n\t\twidth: 50%;\n\t\tright: -50%;\n\t\tpadding-left: 0.5em;\n\t\tcolor: #111;\n\t}*/\n\t.Loda {\n\t\tmin-width: 96vw !important;\n\t\tmax-width: 96vw !important;\n\t}\n\t.rdr-image-wrap {\n/*\t\ttransition: transform 0.02s linear; */\n\t}\n\t.refresh-chapter {\n\t\tposition: fixed;\n\t\tbottom: unset;\n\t\ttop: 0em;\n\t\tright: 0.5rem;\n\t\tpadding: 0em;\n\t\talign-items: flex-start;\n\t\tz-index: 200;\n\n\t}\n\t.refresh-chapter .ico-btn {\n\t\tfont-size: 0.8em;\n\t\theight: 2em;\n\t\twidth: 2em;\n\t\tborder-top-left-radius: 0;\n\t\tborder-top-right-radius: 0;\n\t}\n\n\tmain > .zoom-level {\n\t\tdisplay: none !important;\n\t}\n\n\t.Loda_Settings {\n\t\twidth: 100%;\n\t\tmargin: 0 1rem;\n\t\theight: 57vh;\n\t\tflex-direction: column-reverse;\n\t}\n\t.Loda_Settings aside {\n\t\tdisplay: flex;\n\t\twidth: auto;\n\t\tpadding: 0;\n\t\tflex-shrink: 1;\n\t\tflex-grow: 0;\n\t}\n\t.Loda_Settings aside header {\n\t\tdisplay: none;\n\t}\n\t.Loda_Settings content {\n\t\tfont-size: 110%;\n\t\tmax-width: 100%;\n\t\tflex-grow: 1;\n\t\toverflow: auto;\n\t}\n\t.Loda_Settings content > div {\n\t\tpadding-bottom: 0.5rem;\n\t}\n\t.Loda_Settings .close {\n\t\tposition: static;\n\t\torder: 100;\n\t\tmargin-left: auto;\n\t}\n\t.Loda_Settings .settings-tabs {\n\t\tdisplay: flex;\n\t}\n\t\n\t.Loda_Settings .IconTab {\n\t\tpadding: 0 !important;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tfont-size: 16px;\n\t}\n\n\t.IconTab > span {\n\t\tdisplay: none;\n\t}\n\n\t.IconTab .ico-btn {\n\t\tdisplay: flex !important;\n\t}\n\t.IconTab[data-name=\"Reader\"] .ico-btn:before {\n\t\tcontent: \"\\e936\"\n\t}\n\t.IconTab[data-name=\"Behavior\"] .ico-btn:before {\n\t\tcontent: \"\\e934\"\n\t}\n\t.IconTab[data-name=\"Layout\"] .ico-btn:before {\n\t\tcontent: \"\\e908\"\n\t}\n\t.IconTab[data-name=\"Themes\"] .ico-btn:before {\n\t\tcontent: \"\\e937\"\n\t}\n\t.IconTab[data-name=\"Advanced\"] .ico-btn:before {\n\t\tcontent: \"\\e935\"\n\t}\n\t.IconTab[data-name=\"About\"] .ico-btn:before {\n\t\tcontent: \"\\e903\"\n\t}\n\t\n\t.nomobile {\n\t\tdisplay: none !important;\n\t}\n\t\t\n\t.Loda_Settings {\n\t\talign-self: flex-end;\n\t\torder: 100;\n\t\tmargin-bottom: 5vh;\n\t}\n}\n\n.preload-entity {\n\topacity: 0.0000000000001;\n\tz-index: -1;\n\tposition: absolute;\n\twidth: 100vw;\n\theight: 100vw;\n\toverflow: hidden;\n\ttop: 0;\n\tleft: 0;\n\tpointer-events: none;\n}\n.preload-entity img {\n\theight: 100%;\n\tposition: absolute;\n\tright: 0;\n\tdisplay: inline-block;\n}\n\n.disabled {\n\topacity: 0.2;\n\tpointer-events: none;\n}\n\n\n.nextCha {\n\topacity: 0.5;\n\tcolor: white;\n\tmin-height: 5rem;\n\tdisplay: flex;\n\tmin-width: 80%;\n\tmax-width: 80%;\n\tmargin: 0 auto;\n\tjustify-content: center;\n\talign-items: center;\n\tmargin-top: 2rem;\n\tmargin-bottom: 4rem;\n\tborder: 2px dashed rgba(255,255,255,0.4);\n\tbox-sizing: border-box;\n}\n\n.nextCha:hover {\n\topacity: 0.7;\n\tbackground: rgba(255,255,255,0.1)\n}\n\n.nextCha:before {\n\tcontent: \"Next chapter\";\n\n}\n\n.nextCha:after {\n\tcontent: \"\u2ba0\";\n\tfont-family: Guya;\n\tmargin-left: 1em;\n\tborder: 1px solid gray;\n\tborder-radius: 3px;\n\tpadding: 0.1rem 0.4rem;\n\tposition: relative;\n\ttop: 1px;\n}\n\n.last-chapter .nextCha {\n\tdisplay: none;\n}\n\n\n\ninput[type=range] {\n\t-webkit-appearance: none;\n\twidth: 100%;\n\theight: 2rem;\n\tbackground: none;\n\tborder-radius: 4px;\n\tmargin: 0;\n\tposition: relative;\n\tz-index: 1;\n}\ninput[type=range]:focus {\n\toutline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n\twidth: 100%;\n\tbackground: var(--blackLight);\n\tborder-radius: 1.3px;\n\tborder: 0.2px solid var(--borderColor);\n\theight: 0.2rem;\n}\ninput[type=range]::-webkit-slider-thumb {\n\tborder: 1px solid var(--borderColor);\n\theight: 1.4rem;\n\twidth: 0.6rem;\n\tmargin-top: -0.65rem;\n\tborder-radius: 3px;\n\tcursor: pointer;\n\tbackground: var(--accentCol);\n\t-webkit-appearance: none;\n}\ninput[type=range]:focus::-webkit-slider-runnable-track {\n\t\n}\ninput[type=range]::-moz-range-track {\n\twidth: 100%;\n\tbackground: var(--blackLight);\n\tborder-radius: 1.3px;\n\tborder: 0.2px solid var(--borderColor);\n}\ninput[type=range]::-moz-range-thumb {\n\tborder: 1px solid var(--borderColor);\n\theight: 1.4rem;\n\twidth: 0.6rem;\n\tborder-radius: 3px;\n\tcursor: pointer;\n\tbackground: var(--accentCol);\n}\ninput[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 8.4px;\n\tcursor: pointer;\n\tanimate: 0.2s;\n\tbackground: transparent;\n\tborder-color: transparent;\n\tborder-width: 16px 0;\n\tcolor: transparent;\n}\ninput[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 0.3rem;\n\tcursor: pointer;\n\tbackground: transparent;\n\tborder-color: transparent;\n\tborder-width: 1px 0;\n\tcolor: transparent;\n}\ninput[type=range]::-ms-fill-lower {\n\tbackground: var(--blackLight);\n\tborder: 0.2px solid var(--borderColor);\n\tborder-radius: 2.6px;\n}\ninput[type=range]::-ms-fill-upper {\n\tbackground: rgba(0,0,0,0.2);\n\tborder: 0.2px solid #010101;\n\tborder-radius: 2.6px;\n}\ninput[type=range]::-ms-thumb {\n\tborder: 1px solid var(--borderColor);\n\theight: 1.4rem;\n\twidth: 0.5rem;\n\tborder-radius: 3px;\n\tbackground: var(--accentCol);\n\tcursor: pointer;\n}\n.Slider input[type=text]::-webkit-inner-spin-button, \n.Slider input[type=text]::-webkit-outer-spin-button { \n  -webkit-appearance: none; \n  margin: 0; \n}\n.Slider input[type=text] {\n\t-moz-appearance: textfield;\n\tborder-radius: 3px;\n\tdisplay: inline-block;\n\tline-height: 1;\n\tfont-size: 0.7em;\n\tline-height: 1.2;\n\tborder: 1px solid var(--borderColor);\n\tbackground: rgba(0,0,0,0.1);\n\tmin-height: 1.1rem;\n\tmin-width: 0px;\n\tmax-width: 10rem;\n\tcolor: var(--textCol);\n\tpadding: 0em 0.5em;\n\ttext-align: center;\n\theight: 1.8rem;\n\tmargin-left: 0.5rem;\n}\n\n.Slider {\n\tdisplay: flex;\n}\n.Slider .slider-wrap {\n\tflex-grow: 1;\n}\n.Slider .ticks {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\tpadding: 0 0.4rem 0 0.3rem;\n}\n.Slider .ticks i {\n\twidth: 0;\n\tdisplay: inline-flex;\n\tjustify-content: center;\n\tflex-grow: 0;\n\tflex-shrink: 1;\n\tfont-style: normal;\n\tcolor: var(--textCol);\n\tfont-size: 0.6rem;\n\tposition: relative;\n\tmargin: 0 2ch;\n\topacity: 0.7;\n}\n.Slider .ticks i:last-child {\n\tmargin-right: 0;\n}\n.Slider .ticks i:first-child {\n\tmargin-left: 0;\n}\n.Slider .ticks i:before {\n\tcontent: \"\";\n\tdisplay: block;\n\theight: 0.9rem;\n\tmargin-top: -1.75rem;\n\tposition: absolute;\n\tborder-right: 1px solid var(--borderColor);\n\tz-index: 0;\n}\n.Slider .slider-value {\n\tflex-basis: 6ch;\n}\n\n.hidden, .is-hidden {\n\tdisplay: none !important;\n}\n\n\n/* Inline #1 | https://kagu.algoinde.ru/reader/series/Kaguya-Wants-To-Be-Confessed-To/60/1/ */\n\n.About {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tfont-size: 0.8em;\n}\n.About > * {\n\tmargin-left: auto;\n\tmargin-right: auto;\n}\n\n.About img {\n\theight: 3.3rem;\n\tpadding: 2rem 0 1rem;\n}\n\n.muted {\n\topacity: 0.5;\n\tfont-size: 0.8em;\n}\n\n.About hr {\n\tborder: none;\n\tborder-bottom: 1px solid rgba(0,0,0,0.3);\n\twidth: 100%;\n}\n\n.About p {\n\tpadding: 0.2rem;\n\tfont-size: 0.9em;\n}\n\n.About a {\n\tcolor: var(--accentCol);\n\ttext-decoration: none;\n\tpadding: 0.3em;\n}\n\n.cubari {\n\theight: 1em;\n\twidth: 100%;\n\tmargin-top: 0.5rem;\n\tposition: relative;\n\tfont-size: 6rem;\n}\n\n\n.cubari::after {\n\tcontent: \"\";\n\tbackground: url(/static/img/cubari.png);\n\theight: 1em;\n\twidth: 1em;\n\tbackground-size: contain;\n\tbackground-position: center;\n\tbackground-repeat: no-repeat;\n\tdisplay: block;\n\tposition: absolute;\n\ttop: 0;\n\tdisplay: inline-block;\n\tmargin: auto;\n\tleft: 50%;\n\ttransform: translateX(-50%);\n}\n\n.cubari > div {\n\tbackground: url(/static/img/cubare.png);\n\theight: 1em;\n\twidth: 1em;\n\tbackground-size: contain;\n\tbackground-position: 50% 50%;\n\tbackground-repeat: no-repeat;\n\tposition: relative;\n\tmargin: auto;\n}\n\n.ReaderNotice {\n  display: flex;\n  user-select: none;\n  object-fit: contain;\n\tmin-width: 100%;\n\tmin-height: 100%;\n\theight: 100%;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  padding: 1rem;\n  text-align: center;\n  box-sizing: border-box;\n}\n\n/* TOFIX: done too fast, check impl */\n\n.ReaderNotice h2 {\n  font-size: 1.5em;\n  margin-bottom: 1rem;\n}\n\n.ReaderNotice p {\n  color: #999;\n}\n\n.ReaderNotice .timer {\n  border-top: 1px solid rgba(255,255,255,0.3);\n  margin-top: 0.5rem;\n  padding-top: 0.5rem;\n  margin-bottom: 0.6rem;\n  text-align: center;\n}\n\n.ReaderNotice .timer:after {\n  content: unset;\n  display: block;\n  text-align: center;\n  font-size: 0.7rem;\n  color: #999;\n  margin-top: 0.4em;\n}\n\n.ReaderNotice a {\n\tcolor: var(--accentCol);\n\ttext-decoration: none;\n\tfont-size: 0.9em;\n\tmargin-top: 0.8em;\n\tdisplay: inline-block;\n\tborder: 1px solid var(--borderColor);\n\tborder-radius: 4px;\n\tpadding: 0.4em 1em;\n}\n\n.ReaderNotice a:hover {\n\tbackground: var(--accentCol);\n\tcolor: var(--accentSelected);\n}\n\n\n\n /* Fix for ugly spinners */\ninput::-webkit-outer-spin-button,\ninput::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\n/* Firefox fix for fixing number spinners*/\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.ColorPicker {\n\tdisplay: block;\n\twidth: 2em;\n\theight: 2em;\n\toutline: none !important;\n\tborder: 1px solid rgba(0,0,0,.3);\n\tborder-radius: 4px;\n\tcolor: transparent;\n\tbox-shadow: 0px 0px 0px 1px inset rgba(255,255,255,0.4);\n\tcursor: pointer;\n\tuser-select: none;\n}\n\nbody, button, button:before {\n\ttext-shadow: var(--rescueShade);\n}\n\n.ResetButton {\n\tmargin-top: 1em;\n\tfont-size: 12px;\n\ttext-align: center;\n\ttext-transform: uppercase;\n\tletter-spacing: 0.07em;\n\tfont-family: \"Open Sans\";\n\ttext-shadow: var(--rescueShade);\n\tborder: 1px solid var(--borderColor);\n\tborder-radius: 2px;\n\toverflow: hidden;\n\tbox-shadow: 0 2px 3px -1px rgba(0,0,0,0.3);\n\tcolor: var(--textCol);\n\tbackground-color: var(--sidebarColDark);\n\tpadding: 0.4rem 1.6rem;\n}\n\n/* pcr-overrides */\n\n.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser {\n    grid-area: 2/1/2/span 2 !important; \n}\n\n\n.pcr-app[data-theme=nano] .pcr-swatches {\n    display: none !important;\n}\n\n\n/* nano.min.css | https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css */\n\n.pcr-app {\n\tbackground: #33383d;\n}\n\n.pcr-app .pcr-interaction .pcr-save {\n\tbackground: #b2dffb;\n}\n\n.pcr-app .pcr-interaction .pcr-cancel, .pcr-app .pcr-interaction .pcr-clear, .pcr-app .pcr-interaction .pcr-save {\n\tcolor: black;\n\tfont-family: \"Open Sans\";\n}\n\n.pcr-app .pcr-interaction input {\n\tletter-spacing: unset; \n\tfont-size: 0.8rem;\n\tborder-radius: unset; \n\tpadding: unset; \n\tmargin-top: unset; \n\tpadding: .45em 1.1em;\n}\n\n.pcr-app .pcr-interaction > * {\n\tmargin: unset;\n}\n\n.pcr-app .pcr-interaction {\n\tmargin: unset;\n\talign-items: stretch;\n\toverflow: hidden;\n\tborder-bottom-right-radius: 4px;\n\tborder-bottom-left-radius: 4px;\n}\n\n.pcr-app[data-theme=\"nano\"] .pcr-interaction {\n\tpadding: unset;\n\theight: 2.1rem;\n\tmargin-bottom: -5px;\n}\n\n.pcr-app .pcr-interaction .pcr-result {\n\tborder-radius: unset;\n\tbackground: #292d31;\n\tcolor: #eee;\n\toutline: none !important;\n\tbox-shadow: none !important;\n}\n\n.pcr-app[data-theme=\"nano\"] .pcr-selection .pcr-color-palette .pcr-palette {\n\tborder-radius: unset;\n\tborder-top-left-radius: 4px;\n\tborder-top-right-radius: 4px;\n}\n\n.pcr-app[data-theme=\"nano\"] .pcr-selection .pcr-color-chooser, .pcr-app[data-theme=\"nano\"] .pcr-selection .pcr-color-opacity {\n\tmargin: .2em .8em;\n}\n\n/*Dropdown style start*/\n\n.dropbtn {\n    background-color: var(--blackLight);\n    color: var(--textCol);\n    height: 2.2em;\n    min-width: 165px;\n    font-family: \"Open Sans\";\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 11px;\n    border: 1px solid var(--borderColor);\n    border-radius: 4px;\n    cursor: initial;\n    outline: none !important;\n}\n\n.input-container {\n\tdisplay: flex;\n}\n\n.arrd {\n\theight: 4px;\n\twidth: 4px;\n}\n\n.arrd::after {\n\tposition: relative;\n    left: -25px;\n    bottom: -2px;\n    font-family: 'Guya';\n    font-size: 20px;\n    content: \"\\e902\";\n}\n\n.dropdown {\n  position: relative;\n  display: inline-block;\n}\n\n.dropdown-content {\n  margin-top: 0.5em;\n  position: absolute;\n  background-color: var(--sidebarCol);\n  min-width: 190px;\n  overflow-x: hidden;\n  overflow-y: auto; \n  box-shadow: 0px 8px 16px rgba(0,0,0,0.2);\n  border-radius: 4px;\n  z-index: 1;\n}\n\n.dropdown-content button {\n  color: var(--textCol);\n  padding: 0 11px;\n  min-width: 190px;\n  height: 35px;\n  display: flex;\n  font-size: 0.8em;\n  align-items: center;\n  text-decoration: none;\n}\n\n.dropdown-content button:not(:last-child) {\n\tborder-bottom: 1px solid var(--sidebarColDark);\n}\n\n.dropdown:hover .dropbtn {background-color: var(--sidebarColDark)}\n.dropdown-content button:hover {background-color: var(--sidebarColDark)}\n.dropdown:hover .dropdown-content {display: block;}\n.dd-s {\n\tbackground-color: var(--sidebarColDark)\n}\n\n/*Dropdown style end*/\n\n\n.Loda_Notice,\n.Loda_Webtoon {\n\tmax-width: 15em;\n}\n\n.Loda_Notice content,\n.Loda_Webtoon content {\n\tfont-size: 0.8em;\n\tpadding: 1em;\n\ttext-align: center;\n\tline-height: 1.5;\n}\n\n.Loda_Notice content ~ button,\n.Loda_Webtoon .buttons button {\n\tdisplay: inline-block;\n\tmargin: auto;\n\tborder: 1px solid var(--textCol);\n\tcolor: var(--textCol);\n\tpadding: 0.5em 2em;\n\tmargin-bottom: 1em;\n\tborder-radius: 4px;\n}\n\n.Loda_Notice content ~ button:before,\n.Loda_Webtoon button.yes:before {\n\tcontent: \"\ue939\";\n\tdisplay: inline-block;\n\tfont-family: Guya;\n\tfont-size: 1.7em;\n}\n\n.Loda_Webtoon .buttons {\n\ttext-align: center;\n\tpadding-bottom: 1rem;\n}\n\n.Loda_Webtoon .buttons button {\n\tmargin: 0 1em;\n}\n\n.Loda_Webtoon .buttons button.no:before {\n\tcontent: \"\ue907\";\n\tdisplay: inline-block;\n\tfont-family: Guya;\n\tfont-size: 1.7em;\n}\n\n\n";
    const combined_js = "/*!\n\nJSZip v3.1.5 - A JavaScript class for generating and reading zip files\n<http://stuartk.com/jszip>\n\n(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>\nDual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.\n\nJSZip uses the library pako released under the MIT license :\nhttps://github.com/nodeca/pako/blob/master/LICENSE\n*/\n!function(a){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=a();else if(\"function\"==typeof define&&define.amd)define([],a);else{var b;b=\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:this,b.JSZip=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i=\"function\"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error(\"Cannot find module '\"+g+\"'\");throw j.code=\"MODULE_NOT_FOUND\",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f=\"function\"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){\"use strict\";var d=a(\"./utils\"),e=a(\"./support\"),f=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";c.encode=function(a){for(var b,c,e,g,h,i,j,k=[],l=0,m=a.length,n=m,o=\"string\"!==d.getTypeOf(a);l<a.length;)n=m-l,o?(b=a[l++],c=l<m?a[l++]:0,e=l<m?a[l++]:0):(b=a.charCodeAt(l++),c=l<m?a.charCodeAt(l++):0,e=l<m?a.charCodeAt(l++):0),g=b>>2,h=(3&b)<<4|c>>4,i=n>1?(15&c)<<2|e>>6:64,j=n>2?63&e:64,k.push(f.charAt(g)+f.charAt(h)+f.charAt(i)+f.charAt(j));return k.join(\"\")},c.decode=function(a){var b,c,d,g,h,i,j,k=0,l=0,m=\"data:\";if(a.substr(0,m.length)===m)throw new Error(\"Invalid base64 input, it looks like a data url.\");a=a.replace(/[^A-Za-z0-9\\+\\/\\=]/g,\"\");var n=3*a.length/4;if(a.charAt(a.length-1)===f.charAt(64)&&n--,a.charAt(a.length-2)===f.charAt(64)&&n--,n%1!==0)throw new Error(\"Invalid base64 input, bad content length.\");var o;for(o=e.uint8array?new Uint8Array(0|n):new Array(0|n);k<a.length;)g=f.indexOf(a.charAt(k++)),h=f.indexOf(a.charAt(k++)),i=f.indexOf(a.charAt(k++)),j=f.indexOf(a.charAt(k++)),b=g<<2|h>>4,c=(15&h)<<4|i>>2,d=(3&i)<<6|j,o[l++]=b,64!==i&&(o[l++]=c),64!==j&&(o[l++]=d);return o}},{\"./support\":30,\"./utils\":32}],2:[function(a,b,c){\"use strict\";function d(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}var e=a(\"./external\"),f=a(\"./stream/DataWorker\"),g=a(\"./stream/DataLengthProbe\"),h=a(\"./stream/Crc32Probe\"),g=a(\"./stream/DataLengthProbe\");d.prototype={getContentWorker:function(){var a=new f(e.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g(\"data_length\")),b=this;return a.on(\"end\",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error(\"Bug : uncompressed data size mismatch\")}),a},getCompressedWorker:function(){return new f(e.Promise.resolve(this.compressedContent)).withStreamInfo(\"compressedSize\",this.compressedSize).withStreamInfo(\"uncompressedSize\",this.uncompressedSize).withStreamInfo(\"crc32\",this.crc32).withStreamInfo(\"compression\",this.compression)}},d.createWorkerFrom=function(a,b,c){return a.pipe(new h).pipe(new g(\"uncompressedSize\")).pipe(b.compressWorker(c)).pipe(new g(\"compressedSize\")).withStreamInfo(\"compression\",b)},b.exports=d},{\"./external\":6,\"./stream/Crc32Probe\":25,\"./stream/DataLengthProbe\":26,\"./stream/DataWorker\":27}],3:[function(a,b,c){\"use strict\";var d=a(\"./stream/GenericWorker\");c.STORE={magic:\"\\0\\0\",compressWorker:function(a){return new d(\"STORE compression\")},uncompressWorker:function(){return new d(\"STORE decompression\")}},c.DEFLATE=a(\"./flate\")},{\"./flate\":7,\"./stream/GenericWorker\":28}],4:[function(a,b,c){\"use strict\";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b[g])];return a^-1}function f(a,b,c,d){var e=h,f=d+c;a^=-1;for(var g=d;g<f;g++)a=a>>>8^e[255&(a^b.charCodeAt(g))];return a^-1}var g=a(\"./utils\"),h=d();b.exports=function(a,b){if(\"undefined\"==typeof a||!a.length)return 0;var c=\"string\"!==g.getTypeOf(a);return c?e(0|b,a,a.length,0):f(0|b,a,a.length,0)}},{\"./utils\":32}],5:[function(a,b,c){\"use strict\";c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(a,b,c){\"use strict\";var d=null;d=\"undefined\"!=typeof Promise?Promise:a(\"lie\"),b.exports={Promise:d}},{lie:58}],7:[function(a,b,c){\"use strict\";function d(a,b){h.call(this,\"FlateWorker/\"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}var e=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Uint32Array,f=a(\"pako\"),g=a(\"./utils\"),h=a(\"./stream/GenericWorker\"),i=e?\"uint8array\":\"array\";c.magic=\"\\b\\0\",g.inherits(d,h),d.prototype.processChunk=function(a){this.meta=a.meta,null===this._pako&&this._createPako(),this._pako.push(g.transformTo(i,a.data),!1)},d.prototype.flush=function(){h.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}},c.compressWorker=function(a){return new d(\"Deflate\",a)},c.uncompressWorker=function(){return new d(\"Inflate\",{})}},{\"./stream/GenericWorker\":28,\"./utils\":32,pako:59}],8:[function(a,b,c){\"use strict\";function d(a,b,c,d){f.call(this,\"ZipFileWorker\"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=c,this.encodeFileName=d,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var e=a(\"../utils\"),f=a(\"../stream/GenericWorker\"),g=a(\"../utf8\"),h=a(\"../crc32\"),i=a(\"../signature\"),j=function(a,b){var c,d=\"\";for(c=0;c<b;c++)d+=String.fromCharCode(255&a),a>>>=8;return d},k=function(a,b){var c=a;return a||(c=b?16893:33204),(65535&c)<<16},l=function(a,b){return 63&(a||0)},m=function(a,b,c,d,f,m){var n,o,p=a.file,q=a.compression,r=m!==g.utf8encode,s=e.transformTo(\"string\",m(p.name)),t=e.transformTo(\"string\",g.utf8encode(p.name)),u=p.comment,v=e.transformTo(\"string\",m(u)),w=e.transformTo(\"string\",g.utf8encode(u)),x=t.length!==p.name.length,y=w.length!==u.length,z=\"\",A=\"\",B=\"\",C=p.dir,D=p.date,E={crc32:0,compressedSize:0,uncompressedSize:0};b&&!c||(E.crc32=a.crc32,E.compressedSize=a.compressedSize,E.uncompressedSize=a.uncompressedSize);var F=0;b&&(F|=8),r||!x&&!y||(F|=2048);var G=0,H=0;C&&(G|=16),\"UNIX\"===f?(H=798,G|=k(p.unixPermissions,C)):(H=20,G|=l(p.dosPermissions,C)),n=D.getUTCHours(),n<<=6,n|=D.getUTCMinutes(),n<<=5,n|=D.getUTCSeconds()/2,o=D.getUTCFullYear()-1980,o<<=4,o|=D.getUTCMonth()+1,o<<=5,o|=D.getUTCDate(),x&&(A=j(1,1)+j(h(s),4)+t,z+=\"up\"+j(A.length,2)+A),y&&(B=j(1,1)+j(h(v),4)+w,z+=\"uc\"+j(B.length,2)+B);var I=\"\";I+=\"\\n\\0\",I+=j(F,2),I+=q.magic,I+=j(n,2),I+=j(o,2),I+=j(E.crc32,4),I+=j(E.compressedSize,4),I+=j(E.uncompressedSize,4),I+=j(s.length,2),I+=j(z.length,2);var J=i.LOCAL_FILE_HEADER+I+s+z,K=i.CENTRAL_FILE_HEADER+j(H,2)+I+j(v.length,2)+\"\\0\\0\\0\\0\"+j(G,4)+j(d,4)+s+z+v;return{fileRecord:J,dirRecord:K}},n=function(a,b,c,d,f){var g=\"\",h=e.transformTo(\"string\",f(d));return g=i.CENTRAL_DIRECTORY_END+\"\\0\\0\\0\\0\"+j(a,2)+j(a,2)+j(b,4)+j(c,4)+j(h.length,2)+h},o=function(a){var b=\"\";return b=i.DATA_DESCRIPTOR+j(a.crc32,4)+j(a.compressedSize,4)+j(a.uncompressedSize,4)};e.inherits(d,f),d.prototype.push=function(a){var b=a.meta.percent||0,c=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,f.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:c?(b+100*(c-d-1))/c:100}}))},d.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten,this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){var c=m(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=m(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),b)this.push({data:o(a),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var a=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var c=this.bytesWritten-a,d=n(this.dirRecords.length,c,a,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;return a.on(\"data\",function(a){b.processChunk(a)}),a.on(\"end\",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),a.on(\"error\",function(a){b.error(a)}),this},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(a){var b=this._sources;if(!f.prototype.error.call(this,a))return!1;for(var c=0;c<b.length;c++)try{b[c].error(a)}catch(a){}return!0},d.prototype.lock=function(){f.prototype.lock.call(this);for(var a=this._sources,b=0;b<a.length;b++)a[b].lock()},b.exports=d},{\"../crc32\":4,\"../signature\":23,\"../stream/GenericWorker\":28,\"../utf8\":31,\"../utils\":32}],9:[function(a,b,c){\"use strict\";var d=a(\"../compressions\"),e=a(\"./ZipFileWorker\"),f=function(a,b){var c=a||b,e=d[c];if(!e)throw new Error(c+\" is not a valid compression method !\");return e};c.generateWorker=function(a,b,c){var d=new e(b.streamFiles,c,b.platform,b.encodeFileName),g=0;try{a.forEach(function(a,c){g++;var e=f(c.options.compression,b.compression),h=c.options.compressionOptions||b.compressionOptions||{},i=c.dir,j=c.date;c._compressWorker(e,h).withStreamInfo(\"file\",{name:a,dir:i,date:j,comment:c.comment||\"\",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(d)}),d.entriesCount=g}catch(h){d.error(h)}return d}},{\"../compressions\":3,\"./ZipFileWorker\":8}],10:[function(a,b,c){\"use strict\";function d(){if(!(this instanceof d))return new d;if(arguments.length)throw new Error(\"The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.\");this.files={},this.comment=null,this.root=\"\",this.clone=function(){var a=new d;for(var b in this)\"function\"!=typeof this[b]&&(a[b]=this[b]);return a}}d.prototype=a(\"./object\"),d.prototype.loadAsync=a(\"./load\"),d.support=a(\"./support\"),d.defaults=a(\"./defaults\"),d.version=\"3.1.5\",d.loadAsync=function(a,b){return(new d).loadAsync(a,b)},d.external=a(\"./external\"),b.exports=d},{\"./defaults\":5,\"./external\":6,\"./load\":11,\"./object\":15,\"./support\":30}],11:[function(a,b,c){\"use strict\";function d(a){return new f.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new i);d.on(\"error\",function(a){c(a)}).on(\"end\",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error(\"Corrupted zip : CRC32 mismatch\")):b()}).resume()})}var e=a(\"./utils\"),f=a(\"./external\"),g=a(\"./utf8\"),e=a(\"./utils\"),h=a(\"./zipEntries\"),i=a(\"./stream/Crc32Probe\"),j=a(\"./nodejsUtils\");b.exports=function(a,b){var c=this;return b=e.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:g.utf8decode}),j.isNode&&j.isStream(a)?f.Promise.reject(new Error(\"JSZip can't accept a stream when loading a zip file.\")):e.prepareContent(\"the loaded zip file\",a,!0,b.optimizedBinaryString,b.base64).then(function(a){var c=new h(b);return c.load(a),c}).then(function(a){var c=[f.Promise.resolve(a)],e=a.files;if(b.checkCRC32)for(var g=0;g<e.length;g++)c.push(d(e[g]));return f.Promise.all(c)}).then(function(a){for(var d=a.shift(),e=d.files,f=0;f<e.length;f++){var g=e[f];c.file(g.fileNameStr,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:b.createFolders})}return d.zipComment.length&&(c.comment=d.zipComment),c})}},{\"./external\":6,\"./nodejsUtils\":14,\"./stream/Crc32Probe\":25,\"./utf8\":31,\"./utils\":32,\"./zipEntries\":33}],12:[function(a,b,c){\"use strict\";function d(a,b){f.call(this,\"Nodejs stream input adapter for \"+a),this._upstreamEnded=!1,this._bindStream(b)}var e=a(\"../utils\"),f=a(\"../stream/GenericWorker\");e.inherits(d,f),d.prototype._bindStream=function(a){var b=this;this._stream=a,a.pause(),a.on(\"data\",function(a){b.push({data:a,meta:{percent:0}})}).on(\"error\",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on(\"end\",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},d.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},b.exports=d},{\"../stream/GenericWorker\":28,\"../utils\":32}],13:[function(a,b,c){\"use strict\";function d(a,b,c){e.call(this,b),this._helper=a;var d=this;a.on(\"data\",function(a,b){d.push(a)||d._helper.pause(),c&&c(b)}).on(\"error\",function(a){d.emit(\"error\",a)}).on(\"end\",function(){d.push(null)})}var e=a(\"readable-stream\").Readable,f=a(\"../utils\");f.inherits(d,e),d.prototype._read=function(){this._helper.resume()},b.exports=d},{\"../utils\":32,\"readable-stream\":16}],14:[function(a,b,c){\"use strict\";b.exports={isNode:\"undefined\"!=typeof Buffer,newBufferFrom:function(a,b){return new Buffer(a,b)},allocBuffer:function(a){return Buffer.alloc?Buffer.alloc(a):new Buffer(a)},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&\"function\"==typeof a.on&&\"function\"==typeof a.pause&&\"function\"==typeof a.resume}}},{}],15:[function(a,b,c){\"use strict\";function d(a){return\"[object RegExp]\"===Object.prototype.toString.call(a)}var e=a(\"./utf8\"),f=a(\"./utils\"),g=a(\"./stream/GenericWorker\"),h=a(\"./stream/StreamHelper\"),i=a(\"./defaults\"),j=a(\"./compressedObject\"),k=a(\"./zipObject\"),l=a(\"./generate\"),m=a(\"./nodejsUtils\"),n=a(\"./nodejs/NodejsStreamInputAdapter\"),o=function(a,b,c){var d,e=f.getTypeOf(b),h=f.extend(c||{},i);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),\"string\"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(a=q(a)),h.createFolders&&(d=p(a))&&r.call(this,d,!0);var l=\"string\"===e&&h.binary===!1&&h.base64===!1;c&&\"undefined\"!=typeof c.binary||(h.binary=!l);var o=b instanceof j&&0===b.uncompressedSize;(o||h.dir||!b||0===b.length)&&(h.base64=!1,h.binary=!0,b=\"\",h.compression=\"STORE\",e=\"string\");var s=null;s=b instanceof j||b instanceof g?b:m.isNode&&m.isStream(b)?new n(a,b):f.prepareContent(a,b,h.binary,h.optimizedBinaryString,h.base64);var t=new k(a,s,h);this.files[a]=t},p=function(a){\"/\"===a.slice(-1)&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf(\"/\");return b>0?a.substring(0,b):\"\"},q=function(a){return\"/\"!==a.slice(-1)&&(a+=\"/\"),a},r=function(a,b){return b=\"undefined\"!=typeof b?b:i.createFolders,a=q(a),this.files[a]||o.call(this,a,null,{dir:!0,createFolders:b}),this.files[a]},s={load:function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},forEach:function(a){var b,c,d;for(b in this.files)this.files.hasOwnProperty(b)&&(d=this.files[b],c=b.slice(this.root.length,b.length),c&&b.slice(0,this.root.length)===this.root&&a(c,d))},filter:function(a){var b=[];return this.forEach(function(c,d){a(c,d)&&b.push(d)}),b},file:function(a,b,c){if(1===arguments.length){if(d(a)){var e=a;return this.filter(function(a,b){return!b.dir&&e.test(a)})}var f=this.files[this.root+a];return f&&!f.dir?f:null}return a=this.root+a,o.call(this,a,b,c),this},folder:function(a){if(!a)return this;if(d(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a,c=r.call(this,b),e=this.clone();return e.root=c.name,e},remove:function(a){a=this.root+a;var b=this.files[a];if(b||(\"/\"!==a.slice(-1)&&(a+=\"/\"),b=this.files[a]),b&&!b.dir)delete this.files[a];else for(var c=this.filter(function(b,c){return c.name.slice(0,a.length)===a}),d=0;d<c.length;d++)delete this.files[c[d].name];return this},generate:function(a){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},generateInternalStream:function(a){var b,c={};try{if(c=f.extend(a||{},{streamFiles:!1,compression:\"STORE\",compressionOptions:null,type:\"\",platform:\"DOS\",comment:null,mimeType:\"application/zip\",encodeFileName:e.utf8encode}),c.type=c.type.toLowerCase(),c.compression=c.compression.toUpperCase(),\"binarystring\"===c.type&&(c.type=\"string\"),!c.type)throw new Error(\"No output type specified.\");f.checkSupport(c.type),\"darwin\"!==c.platform&&\"freebsd\"!==c.platform&&\"linux\"!==c.platform&&\"sunos\"!==c.platform||(c.platform=\"UNIX\"),\"win32\"===c.platform&&(c.platform=\"DOS\");var d=c.comment||this.comment||\"\";b=l.generateWorker(this,c,d)}catch(i){b=new g(\"error\"),b.error(i)}return new h(b,c.type||\"string\",c.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){return a=a||{},a.type||(a.type=\"nodebuffer\"),this.generateInternalStream(a).toNodejsStream(b)}};b.exports=s},{\"./compressedObject\":2,\"./defaults\":5,\"./generate\":9,\"./nodejs/NodejsStreamInputAdapter\":12,\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31,\"./utils\":32,\"./zipObject\":35}],16:[function(a,b,c){b.exports=a(\"stream\")},{stream:void 0}],17:[function(a,b,c){\"use strict\";function d(a){e.call(this,a);for(var b=0;b<this.data.length;b++)a[b]=255&a[b]}var e=a(\"./DataReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data[this.zero+a]},d.prototype.lastIndexOfSignature=function(a){for(var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.length-4;f>=0;--f)if(this.data[f]===b&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===e)return f-this.zero;return-1},d.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=this.readData(4);return b===f[0]&&c===f[1]&&d===f[2]&&e===f[3]},d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./DataReader\":18}],18:[function(a,b,c){\"use strict\";function d(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}var e=a(\"../utils\");d.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error(\"End of data reached (data length = \"+this.length+\", asked index = \"+a+\"). Corrupted zip ?\")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b,c=0;for(this.checkOffset(a),b=this.index+a-1;b>=this.index;b--)c=(c<<8)+this.byteAt(b);return this.index+=a,c},readString:function(a){return e.transformTo(\"string\",this.readData(a))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},b.exports=d},{\"../utils\":32}],19:[function(a,b,c){\"use strict\";function d(a){e.call(this,a)}var e=a(\"./Uint8ArrayReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./Uint8ArrayReader\":21}],20:[function(a,b,c){\"use strict\";function d(a){e.call(this,a)}var e=a(\"./DataReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},d.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},d.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b},d.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./DataReader\":18}],21:[function(a,b,c){\"use strict\";function d(a){e.call(this,a)}var e=a(\"./ArrayReader\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.readData=function(a){if(this.checkOffset(a),0===a)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,b},b.exports=d},{\"../utils\":32,\"./ArrayReader\":17}],22:[function(a,b,c){\"use strict\";var d=a(\"../utils\"),e=a(\"../support\"),f=a(\"./ArrayReader\"),g=a(\"./StringReader\"),h=a(\"./NodeBufferReader\"),i=a(\"./Uint8ArrayReader\");b.exports=function(a){var b=d.getTypeOf(a);return d.checkSupport(b),\"string\"!==b||e.uint8array?\"nodebuffer\"===b?new h(a):e.uint8array?new i(d.transformTo(\"uint8array\",a)):new f(d.transformTo(\"array\",a)):new g(a)}},{\"../support\":30,\"../utils\":32,\"./ArrayReader\":17,\"./NodeBufferReader\":19,\"./StringReader\":20,\"./Uint8ArrayReader\":21}],23:[function(a,b,c){\"use strict\";c.LOCAL_FILE_HEADER=\"PK\u0003\u0004\",c.CENTRAL_FILE_HEADER=\"PK\u0001\u0002\",c.CENTRAL_DIRECTORY_END=\"PK\u0005\u0006\",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR=\"PK\u0006\u0007\",c.ZIP64_CENTRAL_DIRECTORY_END=\"PK\u0006\u0006\",c.DATA_DESCRIPTOR=\"PK\u0007\\b\"},{}],24:[function(a,b,c){\"use strict\";function d(a){e.call(this,\"ConvertWorker to \"+a),this.destType=a}var e=a(\"./GenericWorker\"),f=a(\"../utils\");f.inherits(d,e),d.prototype.processChunk=function(a){this.push({data:f.transformTo(this.destType,a.data),meta:a.meta})},b.exports=d},{\"../utils\":32,\"./GenericWorker\":28}],25:[function(a,b,c){\"use strict\";function d(){e.call(this,\"Crc32Probe\"),this.withStreamInfo(\"crc32\",0)}var e=a(\"./GenericWorker\"),f=a(\"../crc32\"),g=a(\"../utils\");g.inherits(d,e),d.prototype.processChunk=function(a){this.streamInfo.crc32=f(a.data,this.streamInfo.crc32||0),this.push(a)},b.exports=d},{\"../crc32\":4,\"../utils\":32,\"./GenericWorker\":28}],26:[function(a,b,c){\"use strict\";function d(a){f.call(this,\"DataLengthProbe for \"+a),this.propName=a,this.withStreamInfo(a,0)}var e=a(\"../utils\"),f=a(\"./GenericWorker\");e.inherits(d,f),d.prototype.processChunk=function(a){if(a){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+a.data.length}f.prototype.processChunk.call(this,a)},b.exports=d},{\"../utils\":32,\"./GenericWorker\":28}],27:[function(a,b,c){\"use strict\";function d(a){f.call(this,\"DataWorker\");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type=\"\",this._tickScheduled=!1,a.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=e.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}var e=a(\"../utils\"),f=a(\"./GenericWorker\"),g=16384;e.inherits(d,f),d.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,e.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(e.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=g,b=null,c=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case\"string\":b=this.data.substring(this.index,c);break;case\"uint8array\":b=this.data.subarray(this.index,c);break;case\"array\":case\"nodebuffer\":b=this.data.slice(this.index,c)}return this.index=c,this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})},b.exports=d},{\"../utils\":32,\"./GenericWorker\":28}],28:[function(a,b,c){\"use strict\";function d(a){this.name=a||\"default\",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}d.prototype={push:function(a){this.emit(\"data\",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit(\"end\"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit(\"error\",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit(\"error\",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,b){return this._listeners[a].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var b=this;return a.on(\"data\",function(a){b.processChunk(a)}),a.on(\"end\",function(){b.end()}),a.on(\"error\",function(a){b.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){return this.extraStreamInfo[a]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error(\"The stream '\"+this+\"' has already been used.\");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a=\"Worker \"+this.name;return this.previous?this.previous+\" -> \"+a:a}},b.exports=d},{}],29:[function(a,b,c){\"use strict\";function d(a,b,c){switch(a){case\"blob\":return h.newBlob(h.transformTo(\"arraybuffer\",b),c);case\"base64\":return k.encode(b);default:return h.transformTo(a,b)}}function e(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case\"string\":return b.join(\"\");case\"array\":return Array.prototype.concat.apply([],b);case\"uint8array\":for(e=new Uint8Array(f),c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case\"nodebuffer\":return Buffer.concat(b);default:throw new Error(\"concat : unsupported type '\"+a+\"'\")}}function f(a,b){return new m.Promise(function(c,f){var g=[],h=a._internalType,i=a._outputType,j=a._mimeType;a.on(\"data\",function(a,c){g.push(a),b&&b(c)}).on(\"error\",function(a){g=[],f(a)}).on(\"end\",function(){try{var a=d(i,e(h,g),j);c(a)}catch(b){f(b)}g=[]}).resume()})}function g(a,b,c){var d=b;switch(b){case\"blob\":case\"arraybuffer\":d=\"uint8array\";break;case\"base64\":d=\"string\"}try{this._internalType=d,this._outputType=b,this._mimeType=c,h.checkSupport(d),this._worker=a.pipe(new i(d)),a.lock()}catch(e){this._worker=new j(\"error\"),this._worker.error(e)}}var h=a(\"../utils\"),i=a(\"./ConvertWorker\"),j=a(\"./GenericWorker\"),k=a(\"../base64\"),l=a(\"../support\"),m=a(\"../external\"),n=null;if(l.nodestream)try{n=a(\"../nodejs/NodejsStreamOutputAdapter\")}catch(o){}g.prototype={accumulate:function(a){return f(this,a)},on:function(a,b){var c=this;return\"data\"===a?this._worker.on(a,function(a){b.call(c,a.data,a.meta)}):this._worker.on(a,function(){h.delay(b,arguments,c)}),this},resume:function(){return h.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(a){if(h.checkSupport(\"nodestream\"),\"nodebuffer\"!==this._outputType)throw new Error(this._outputType+\" is not supported by this method\");return new n(this,{objectMode:\"nodebuffer\"!==this._outputType},a)}},b.exports=g},{\"../base64\":1,\"../external\":6,\"../nodejs/NodejsStreamOutputAdapter\":13,\"../support\":30,\"../utils\":32,\"./ConvertWorker\":24,\"./GenericWorker\":28}],30:[function(a,b,c){\"use strict\";if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=\"undefined\"!=typeof ArrayBuffer&&\"undefined\"!=typeof Uint8Array,c.nodebuffer=\"undefined\"!=typeof Buffer,c.uint8array=\"undefined\"!=typeof Uint8Array,\"undefined\"==typeof ArrayBuffer)c.blob=!1;else{var d=new ArrayBuffer(0);try{c.blob=0===new Blob([d],{type:\"application/zip\"}).size}catch(e){try{var f=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,g=new f;g.append(d),c.blob=0===g.getBlob(\"application/zip\").size}catch(e){c.blob=!1}}}try{c.nodestream=!!a(\"readable-stream\").Readable}catch(e){c.nodestream=!1}},{\"readable-stream\":16}],31:[function(a,b,c){\"use strict\";function d(){i.call(this,\"utf-8 decode\"),this.leftOver=null}function e(){i.call(this,\"utf-8 encode\")}for(var f=a(\"./utils\"),g=a(\"./support\"),h=a(\"./nodejsUtils\"),i=a(\"./stream/GenericWorker\"),j=new Array(256),k=0;k<256;k++)j[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;j[254]=j[254]=1;var l=function(a){var b,c,d,e,f,h=a.length,i=0;for(e=0;e<h;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=g.uint8array?new Uint8Array(i):new Array(i),f=0,e=0;f<i;e++)c=a.charCodeAt(e),55296===(64512&c)&&e+1<h&&(d=a.charCodeAt(e+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),e++)),c<128?b[f++]=c:c<2048?(b[f++]=192|c>>>6,b[f++]=128|63&c):c<65536?(b[f++]=224|c>>>12,b[f++]=128|c>>>6&63,b[f++]=128|63&c):(b[f++]=240|c>>>18,b[f++]=128|c>>>12&63,b[f++]=128|c>>>6&63,b[f++]=128|63&c);return b},m=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+j[a[c]]>b?c:b},n=function(a){var b,c,d,e,g=a.length,h=new Array(2*g);for(c=0,b=0;b<g;)if(d=a[b++],d<128)h[c++]=d;else if(e=j[d],e>4)h[c++]=65533,b+=e-1;else{for(d&=2===e?31:3===e?15:7;e>1&&b<g;)d=d<<6|63&a[b++],e--;e>1?h[c++]=65533:d<65536?h[c++]=d:(d-=65536,h[c++]=55296|d>>10&1023,h[c++]=56320|1023&d)}return h.length!==c&&(h.subarray?h=h.subarray(0,c):h.length=c),f.applyFromCharCode(h)};c.utf8encode=function(a){return g.nodebuffer?h.newBufferFrom(a,\"utf-8\"):l(a)},c.utf8decode=function(a){return g.nodebuffer?f.transformTo(\"nodebuffer\",a).toString(\"utf-8\"):(a=f.transformTo(g.uint8array?\"uint8array\":\"array\",a),n(a))},f.inherits(d,i),d.prototype.processChunk=function(a){var b=f.transformTo(g.uint8array?\"uint8array\":\"array\",a.data);if(this.leftOver&&this.leftOver.length){if(g.uint8array){var d=b;b=new Uint8Array(d.length+this.leftOver.length),b.set(this.leftOver,0),b.set(d,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var e=m(b),h=b;e!==b.length&&(g.uint8array?(h=b.subarray(0,e),this.leftOver=b.subarray(e,b.length)):(h=b.slice(0,e),this.leftOver=b.slice(e,b.length))),this.push({data:c.utf8decode(h),meta:a.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=d,f.inherits(e,i),e.prototype.processChunk=function(a){this.push({data:c.utf8encode(a.data),meta:a.meta})},c.Utf8EncodeWorker=e},{\"./nodejsUtils\":14,\"./stream/GenericWorker\":28,\"./support\":30,\"./utils\":32}],32:[function(a,b,c){\"use strict\";function d(a){var b=null;return b=i.uint8array?new Uint8Array(a.length):new Array(a.length),f(a,b)}function e(a){return a}function f(a,b){for(var c=0;c<a.length;++c)b[c]=255&a.charCodeAt(c);return b}function g(a){var b=65536,d=c.getTypeOf(a),e=!0;if(\"uint8array\"===d?e=n.applyCanBeUsed.uint8array:\"nodebuffer\"===d&&(e=n.applyCanBeUsed.nodebuffer),e)for(;b>1;)try{return n.stringifyByChunk(a,d,b)}catch(f){b=Math.floor(b/2)}return n.stringifyByChar(a)}function h(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];\nreturn b}var i=a(\"./support\"),j=a(\"./base64\"),k=a(\"./nodejsUtils\"),l=a(\"core-js/library/fn/set-immediate\"),m=a(\"./external\");c.newBlob=function(a,b){c.checkSupport(\"blob\");try{return new Blob([a],{type:b})}catch(d){try{var e=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,f=new e;return f.append(a),f.getBlob(b)}catch(d){throw new Error(\"Bug : can't construct the Blob.\")}}};var n={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);for(;e<f;)\"array\"===b||\"nodebuffer\"===b?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join(\"\")},stringifyByChar:function(a){for(var b=\"\",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(a){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,k.allocBuffer(1)).length}catch(a){return!1}}()}};c.applyFromCharCode=g;var o={};o.string={string:e,array:function(a){return f(a,new Array(a.length))},arraybuffer:function(a){return o.string.uint8array(a).buffer},uint8array:function(a){return f(a,new Uint8Array(a.length))},nodebuffer:function(a){return f(a,k.allocBuffer(a.length))}},o.array={string:g,array:e,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(a)}},o.arraybuffer={string:function(a){return g(new Uint8Array(a))},array:function(a){return h(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:e,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return k.newBufferFrom(new Uint8Array(a))}},o.uint8array={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:e,nodebuffer:function(a){return k.newBufferFrom(a)}},o.nodebuffer={string:g,array:function(a){return h(a,new Array(a.length))},arraybuffer:function(a){return o.nodebuffer.uint8array(a).buffer},uint8array:function(a){return h(a,new Uint8Array(a.length))},nodebuffer:e},c.transformTo=function(a,b){if(b||(b=\"\"),!a)return b;c.checkSupport(a);var d=c.getTypeOf(b),e=o[d][a](b);return e},c.getTypeOf=function(a){return\"string\"==typeof a?\"string\":\"[object Array]\"===Object.prototype.toString.call(a)?\"array\":i.nodebuffer&&k.isBuffer(a)?\"nodebuffer\":i.uint8array&&a instanceof Uint8Array?\"uint8array\":i.arraybuffer&&a instanceof ArrayBuffer?\"arraybuffer\":void 0},c.checkSupport=function(a){var b=i[a.toLowerCase()];if(!b)throw new Error(a+\" is not supported by this platform\")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(a){var b,c,d=\"\";for(c=0;c<(a||\"\").length;c++)b=a.charCodeAt(c),d+=\"\\\\x\"+(b<16?\"0\":\"\")+b.toString(16).toUpperCase();return d},c.delay=function(a,b,c){l(function(){a.apply(c||null,b||[])})},c.inherits=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c},c.extend=function(){var a,b,c={};for(a=0;a<arguments.length;a++)for(b in arguments[a])arguments[a].hasOwnProperty(b)&&\"undefined\"==typeof c[b]&&(c[b]=arguments[a][b]);return c},c.prepareContent=function(a,b,e,f,g){var h=m.Promise.resolve(b).then(function(a){var b=i.blob&&(a instanceof Blob||[\"[object File]\",\"[object Blob]\"].indexOf(Object.prototype.toString.call(a))!==-1);return b&&\"undefined\"!=typeof FileReader?new m.Promise(function(b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onerror=function(a){c(a.target.error)},d.readAsArrayBuffer(a)}):a});return h.then(function(b){var h=c.getTypeOf(b);return h?(\"arraybuffer\"===h?b=c.transformTo(\"uint8array\",b):\"string\"===h&&(g?b=j.decode(b):e&&f!==!0&&(b=d(b))),b):m.Promise.reject(new Error(\"Can't read the data of '\"+a+\"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?\"))})}},{\"./base64\":1,\"./external\":6,\"./nodejsUtils\":14,\"./support\":30,\"core-js/library/fn/set-immediate\":36}],33:[function(a,b,c){\"use strict\";function d(a){this.files=[],this.loadOptions=a}var e=a(\"./reader/readerFor\"),f=a(\"./utils\"),g=a(\"./signature\"),h=a(\"./zipEntry\"),i=(a(\"./utf8\"),a(\"./support\"));d.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error(\"Corrupted zip or bug: unexpected signature (\"+f.pretty(b)+\", expected \"+f.pretty(a)+\")\")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);var d=this.reader.readString(4),e=d===b;return this.reader.setIndex(c),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),b=i.uint8array?\"uint8array\":\"array\",c=f.transformTo(b,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var a,b,c,d=this.zip64EndOfCentralSize-44,e=0;e<d;)a=this.reader.readInt(2),b=this.reader.readInt(4),c=this.reader.readData(b),this.zip64ExtensibleData[a]={id:a,length:b,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error(\"Multi-volumes zip are not supported\")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(g.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(g.CENTRAL_FILE_HEADER);)a=new h({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error(\"Corrupted zip or bug: expected \"+this.centralDirRecords+\" records in central dir, got \"+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(g.CENTRAL_DIRECTORY_END);if(a<0){var b=!this.isSignature(0,g.LOCAL_FILE_HEADER);throw b?new Error(\"Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html\"):new Error(\"Corrupted zip: can't find end of central directory\")}this.reader.setIndex(a);var c=a;if(this.checkSignature(g.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,a=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),a<0)throw new Error(\"Corrupted zip: can't find the ZIP64 end of central directory locator\");if(this.reader.setIndex(a),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,g.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error(\"Corrupted zip: can't find the ZIP64 end of central directory\");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(g.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var e=c-d;if(e>0)this.isSignature(c,g.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error(\"Corrupted zip: missing \"+Math.abs(e)+\" bytes.\")},prepareReader:function(a){this.reader=e(a)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},b.exports=d},{\"./reader/readerFor\":22,\"./signature\":23,\"./support\":30,\"./utf8\":31,\"./utils\":32,\"./zipEntry\":34}],34:[function(a,b,c){\"use strict\";function d(a,b){this.options=a,this.loadOptions=b}var e=a(\"./reader/readerFor\"),f=a(\"./utils\"),g=a(\"./compressedObject\"),h=a(\"./crc32\"),i=a(\"./utf8\"),j=a(\"./compressions\"),k=a(\"./support\"),l=0,m=3,n=function(a){for(var b in j)if(j.hasOwnProperty(b)&&j[b].magic===a)return j[b];return null};d.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(a){var b,c;if(a.skip(22),this.fileNameLength=a.readInt(2),c=a.readInt(2),this.fileName=a.readData(this.fileNameLength),a.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error(\"Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)\");if(b=n(this.compressionMethod),null===b)throw new Error(\"Corrupted zip : compression \"+f.pretty(this.compressionMethod)+\" unknown (inner file : \"+f.transformTo(\"string\",this.fileName)+\")\");this.decompressed=new g(this.compressedSize,this.uncompressedSize,this.crc32,b,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2),a.skip(2),this.bitFlag=a.readInt(2),this.compressionMethod=a.readString(2),this.date=a.readDate(),this.crc32=a.readInt(4),this.compressedSize=a.readInt(4),this.uncompressedSize=a.readInt(4);var b=a.readInt(2);if(this.extraFieldsLength=a.readInt(2),this.fileCommentLength=a.readInt(2),this.diskNumberStart=a.readInt(2),this.internalFileAttributes=a.readInt(2),this.externalFileAttributes=a.readInt(4),this.localHeaderOffset=a.readInt(4),this.isEncrypted())throw new Error(\"Encrypted zip are not supported\");a.skip(b),this.readExtraFields(a),this.parseZIP64ExtraField(a),this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),a===l&&(this.dosPermissions=63&this.externalFileAttributes),a===m&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||\"/\"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(a){if(this.extraFields[1]){var b=e(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(a){var b,c,d,e=a.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});a.index<e;)b=a.readInt(2),c=a.readInt(2),d=a.readData(c),this.extraFields[b]={id:b,length:c,value:d}},handleUTF8:function(){var a=k.uint8array?\"uint8array\":\"array\";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(null!==b)this.fileNameStr=b;else{var c=f.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var d=this.findExtraFieldUnicodeComment();if(null!==d)this.fileCommentStr=d;else{var e=f.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(e)}}},findExtraFieldUnicodePath:function(){var a=this.extraFields[28789];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileName)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null},findExtraFieldUnicodeComment:function(){var a=this.extraFields[25461];if(a){var b=e(a.value);return 1!==b.readInt(1)?null:h(this.fileComment)!==b.readInt(4)?null:i.utf8decode(b.readData(a.length-5))}return null}},b.exports=d},{\"./compressedObject\":2,\"./compressions\":3,\"./crc32\":4,\"./reader/readerFor\":22,\"./support\":30,\"./utf8\":31,\"./utils\":32}],35:[function(a,b,c){\"use strict\";var d=a(\"./stream/StreamHelper\"),e=a(\"./stream/DataWorker\"),f=a(\"./utf8\"),g=a(\"./compressedObject\"),h=a(\"./stream/GenericWorker\"),i=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};i.prototype={internalStream:function(a){var b=null,c=\"string\";try{if(!a)throw new Error(\"No output type specified.\");c=a.toLowerCase();var e=\"string\"===c||\"text\"===c;\"binarystring\"!==c&&\"text\"!==c||(c=\"string\"),b=this._decompressWorker();var g=!this._dataBinary;g&&!e&&(b=b.pipe(new f.Utf8EncodeWorker)),!g&&e&&(b=b.pipe(new f.Utf8DecodeWorker))}catch(i){b=new h(\"error\"),b.error(i)}return new d(b,c,\"\")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||\"nodebuffer\").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof g&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();var c=this._decompressWorker();return this._dataBinary||(c=c.pipe(new f.Utf8EncodeWorker)),g.createWorkerFrom(c,a,b)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof h?this._data:new e(this._data)}};for(var j=[\"asText\",\"asBinary\",\"asNodeBuffer\",\"asUint8Array\",\"asArrayBuffer\"],k=function(){throw new Error(\"This method has been removed in JSZip 3.0, please check the upgrade guide.\")},l=0;l<j.length;l++)i.prototype[j[l]]=k;b.exports=i},{\"./compressedObject\":2,\"./stream/DataWorker\":27,\"./stream/GenericWorker\":28,\"./stream/StreamHelper\":29,\"./utf8\":31}],36:[function(a,b,c){a(\"../modules/web.immediate\"),b.exports=a(\"../modules/_core\").setImmediate},{\"../modules/_core\":40,\"../modules/web.immediate\":56}],37:[function(a,b,c){b.exports=function(a){if(\"function\"!=typeof a)throw TypeError(a+\" is not a function!\");return a}},{}],38:[function(a,b,c){var d=a(\"./_is-object\");b.exports=function(a){if(!d(a))throw TypeError(a+\" is not an object!\");return a}},{\"./_is-object\":51}],39:[function(a,b,c){var d={}.toString;b.exports=function(a){return d.call(a).slice(8,-1)}},{}],40:[function(a,b,c){var d=b.exports={version:\"2.3.0\"};\"number\"==typeof __e&&(__e=d)},{}],41:[function(a,b,c){var d=a(\"./_a-function\");b.exports=function(a,b,c){if(d(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}}},{\"./_a-function\":37}],42:[function(a,b,c){b.exports=!a(\"./_fails\")(function(){return 7!=Object.defineProperty({},\"a\",{get:function(){return 7}}).a})},{\"./_fails\":45}],43:[function(a,b,c){var d=a(\"./_is-object\"),e=a(\"./_global\").document,f=d(e)&&d(e.createElement);b.exports=function(a){return f?e.createElement(a):{}}},{\"./_global\":46,\"./_is-object\":51}],44:[function(a,b,c){var d=a(\"./_global\"),e=a(\"./_core\"),f=a(\"./_ctx\"),g=a(\"./_hide\"),h=\"prototype\",i=function(a,b,c){var j,k,l,m=a&i.F,n=a&i.G,o=a&i.S,p=a&i.P,q=a&i.B,r=a&i.W,s=n?e:e[b]||(e[b]={}),t=s[h],u=n?d:o?d[b]:(d[b]||{})[h];n&&(c=b);for(j in c)k=!m&&u&&void 0!==u[j],k&&j in s||(l=k?u[j]:c[j],s[j]=n&&\"function\"!=typeof u[j]?c[j]:q&&k?f(l,d):r&&u[j]==l?function(a){var b=function(b,c,d){if(this instanceof a){switch(arguments.length){case 0:return new a;case 1:return new a(b);case 2:return new a(b,c)}return new a(b,c,d)}return a.apply(this,arguments)};return b[h]=a[h],b}(l):p&&\"function\"==typeof l?f(Function.call,l):l,p&&((s.virtual||(s.virtual={}))[j]=l,a&i.R&&t&&!t[j]&&g(t,j,l)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,b.exports=i},{\"./_core\":40,\"./_ctx\":41,\"./_global\":46,\"./_hide\":47}],45:[function(a,b,c){b.exports=function(a){try{return!!a()}catch(b){return!0}}},{}],46:[function(a,b,c){var d=b.exports=\"undefined\"!=typeof window&&window.Math==Math?window:\"undefined\"!=typeof self&&self.Math==Math?self:Function(\"return this\")();\"number\"==typeof __g&&(__g=d)},{}],47:[function(a,b,c){var d=a(\"./_object-dp\"),e=a(\"./_property-desc\");b.exports=a(\"./_descriptors\")?function(a,b,c){return d.f(a,b,e(1,c))}:function(a,b,c){return a[b]=c,a}},{\"./_descriptors\":42,\"./_object-dp\":52,\"./_property-desc\":53}],48:[function(a,b,c){b.exports=a(\"./_global\").document&&document.documentElement},{\"./_global\":46}],49:[function(a,b,c){b.exports=!a(\"./_descriptors\")&&!a(\"./_fails\")(function(){return 7!=Object.defineProperty(a(\"./_dom-create\")(\"div\"),\"a\",{get:function(){return 7}}).a})},{\"./_descriptors\":42,\"./_dom-create\":43,\"./_fails\":45}],50:[function(a,b,c){b.exports=function(a,b,c){var d=void 0===c;switch(b.length){case 0:return d?a():a.call(c);case 1:return d?a(b[0]):a.call(c,b[0]);case 2:return d?a(b[0],b[1]):a.call(c,b[0],b[1]);case 3:return d?a(b[0],b[1],b[2]):a.call(c,b[0],b[1],b[2]);case 4:return d?a(b[0],b[1],b[2],b[3]):a.call(c,b[0],b[1],b[2],b[3])}return a.apply(c,b)}},{}],51:[function(a,b,c){b.exports=function(a){return\"object\"==typeof a?null!==a:\"function\"==typeof a}},{}],52:[function(a,b,c){var d=a(\"./_an-object\"),e=a(\"./_ie8-dom-define\"),f=a(\"./_to-primitive\"),g=Object.defineProperty;c.f=a(\"./_descriptors\")?Object.defineProperty:function(a,b,c){if(d(a),b=f(b,!0),d(c),e)try{return g(a,b,c)}catch(h){}if(\"get\"in c||\"set\"in c)throw TypeError(\"Accessors not supported!\");return\"value\"in c&&(a[b]=c.value),a}},{\"./_an-object\":38,\"./_descriptors\":42,\"./_ie8-dom-define\":49,\"./_to-primitive\":55}],53:[function(a,b,c){b.exports=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}}},{}],54:[function(a,b,c){var d,e,f,g=a(\"./_ctx\"),h=a(\"./_invoke\"),i=a(\"./_html\"),j=a(\"./_dom-create\"),k=a(\"./_global\"),l=k.process,m=k.setImmediate,n=k.clearImmediate,o=k.MessageChannel,p=0,q={},r=\"onreadystatechange\",s=function(){var a=+this;if(q.hasOwnProperty(a)){var b=q[a];delete q[a],b()}},t=function(a){s.call(a.data)};m&&n||(m=function(a){for(var b=[],c=1;arguments.length>c;)b.push(arguments[c++]);return q[++p]=function(){h(\"function\"==typeof a?a:Function(a),b)},d(p),p},n=function(a){delete q[a]},\"process\"==a(\"./_cof\")(l)?d=function(a){l.nextTick(g(s,a,1))}:o?(e=new o,f=e.port2,e.port1.onmessage=t,d=g(f.postMessage,f,1)):k.addEventListener&&\"function\"==typeof postMessage&&!k.importScripts?(d=function(a){k.postMessage(a+\"\",\"*\")},k.addEventListener(\"message\",t,!1)):d=r in j(\"script\")?function(a){i.appendChild(j(\"script\"))[r]=function(){i.removeChild(this),s.call(a)}}:function(a){setTimeout(g(s,a,1),0)}),b.exports={set:m,clear:n}},{\"./_cof\":39,\"./_ctx\":41,\"./_dom-create\":43,\"./_global\":46,\"./_html\":48,\"./_invoke\":50}],55:[function(a,b,c){var d=a(\"./_is-object\");b.exports=function(a,b){if(!d(a))return a;var c,e;if(b&&\"function\"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;if(\"function\"==typeof(c=a.valueOf)&&!d(e=c.call(a)))return e;if(!b&&\"function\"==typeof(c=a.toString)&&!d(e=c.call(a)))return e;throw TypeError(\"Can't convert object to primitive value\")}},{\"./_is-object\":51}],56:[function(a,b,c){var d=a(\"./_export\"),e=a(\"./_task\");d(d.G+d.B,{setImmediate:e.set,clearImmediate:e.clear})},{\"./_export\":44,\"./_task\":54}],57:[function(a,b,c){(function(a){\"use strict\";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode(\"\");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||\"undefined\"==typeof a.MessageChannel)e=\"document\"in a&&\"onreadystatechange\"in a.document.createElement(\"script\")?function(){var b=a.document.createElement(\"script\");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{})},{}],58:[function(a,b,c){\"use strict\";function d(){}function e(a){if(\"function\"!=typeof a)throw new TypeError(\"resolver must be a function\");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,\"function\"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),\"function\"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(e){return p.reject(a,e)}d===a?p.reject(a,new TypeError(\"Cannot resolve promise with itself\")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&(\"object\"==typeof a||\"function\"==typeof a)&&\"function\"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);\"error\"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status=\"success\"}catch(d){c.status=\"error\",c.value=d}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if(\"[object Array]\"!==Object.prototype.toString.call(a))return this.reject(new TypeError(\"must be an array\"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if(\"[object Array]\"!==Object.prototype.toString.call(a))return this.reject(new TypeError(\"must be an array\"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(\"immediate\"),p={},q=[\"REJECTED\"],r=[\"FULFILLED\"],s=[\"PENDING\"];b.exports=e,e.prototype[\"catch\"]=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if(\"function\"!=typeof a&&this.state===r||\"function\"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if(\"error\"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{immediate:57}],59:[function(a,b,c){\"use strict\";var d=a(\"./lib/utils/common\").assign,e=a(\"./lib/deflate\"),f=a(\"./lib/inflate\"),g=a(\"./lib/zlib/constants\"),h={};d(h,e,f,g),b.exports=h},{\"./lib/deflate\":60,\"./lib/inflate\":61,\"./lib/utils/common\":62,\"./lib/zlib/constants\":65}],60:[function(a,b,c){\"use strict\";function d(a){if(!(this instanceof d))return new d(a);this.options=i.assign({level:s,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:t,to:\"\"},a||{});var b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=h.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(c!==p)throw new Error(k[c]);if(b.header&&h.deflateSetHeader(this.strm,b.header),b.dictionary){var e;if(e=\"string\"==typeof b.dictionary?j.string2buf(b.dictionary):\"[object ArrayBuffer]\"===m.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,c=h.deflateSetDictionary(this.strm,e),c!==p)throw new Error(k[c]);this._dict_set=!0}}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}function g(a,b){return b=b||{},b.gzip=!0,e(a,b)}var h=a(\"./zlib/deflate\"),i=a(\"./utils/common\"),j=a(\"./utils/strings\"),k=a(\"./zlib/messages\"),l=a(\"./zlib/zstream\"),m=Object.prototype.toString,n=0,o=4,p=0,q=1,r=2,s=-1,t=0,u=8;d.prototype.push=function(a,b){var c,d,e=this.strm,f=this.options.chunkSize;if(this.ended)return!1;d=b===~~b?b:b===!0?o:n,\"string\"==typeof a?e.input=j.string2buf(a):\"[object ArrayBuffer]\"===m.call(a)?e.input=new Uint8Array(a):e.input=a,e.next_in=0,e.avail_in=e.input.length;do{if(0===e.avail_out&&(e.output=new i.Buf8(f),e.next_out=0,e.avail_out=f),c=h.deflate(e,d),c!==q&&c!==p)return this.onEnd(c),this.ended=!0,!1;0!==e.avail_out&&(0!==e.avail_in||d!==o&&d!==r)||(\"string\"===this.options.to?this.onData(j.buf2binstring(i.shrinkBuf(e.output,e.next_out))):this.onData(i.shrinkBuf(e.output,e.next_out)))}while((e.avail_in>0||0===e.avail_out)&&c!==q);return d===o?(c=h.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===p):d!==r||(this.onEnd(p),e.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===p&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Deflate=d,c.deflate=e,c.deflateRaw=f,c.gzip=g},{\"./utils/common\":62,\"./utils/strings\":63,\"./zlib/deflate\":67,\"./zlib/messages\":72,\"./zlib/zstream\":74}],61:[function(a,b,c){\"use strict\";function d(a){if(!(this instanceof d))return new d(a);this.options=h.assign({chunkSize:16384,windowBits:0,to:\"\"},a||{});var b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||a&&a.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var c=g.inflateInit2(this.strm,b.windowBits);if(c!==j.Z_OK)throw new Error(k[c]);this.header=new m,g.inflateGetHeader(this.strm,this.header)}function e(a,b){var c=new d(b);if(c.push(a,!0),c.err)throw c.msg||k[c.err];return c.result}function f(a,b){return b=b||{},b.raw=!0,e(a,b)}var g=a(\"./zlib/inflate\"),h=a(\"./utils/common\"),i=a(\"./utils/strings\"),j=a(\"./zlib/constants\"),k=a(\"./zlib/messages\"),l=a(\"./zlib/zstream\"),m=a(\"./zlib/gzheader\"),n=Object.prototype.toString;d.prototype.push=function(a,b){var c,d,e,f,k,l,m=this.strm,o=this.options.chunkSize,p=this.options.dictionary,q=!1;if(this.ended)return!1;d=b===~~b?b:b===!0?j.Z_FINISH:j.Z_NO_FLUSH,\"string\"==typeof a?m.input=i.binstring2buf(a):\"[object ArrayBuffer]\"===n.call(a)?m.input=new Uint8Array(a):m.input=a,m.next_in=0,m.avail_in=m.input.length;do{if(0===m.avail_out&&(m.output=new h.Buf8(o),m.next_out=0,m.avail_out=o),c=g.inflate(m,j.Z_NO_FLUSH),c===j.Z_NEED_DICT&&p&&(l=\"string\"==typeof p?i.string2buf(p):\"[object ArrayBuffer]\"===n.call(p)?new Uint8Array(p):p,c=g.inflateSetDictionary(this.strm,l)),c===j.Z_BUF_ERROR&&q===!0&&(c=j.Z_OK,q=!1),c!==j.Z_STREAM_END&&c!==j.Z_OK)return this.onEnd(c),this.ended=!0,!1;m.next_out&&(0!==m.avail_out&&c!==j.Z_STREAM_END&&(0!==m.avail_in||d!==j.Z_FINISH&&d!==j.Z_SYNC_FLUSH)||(\"string\"===this.options.to?(e=i.utf8border(m.output,m.next_out),f=m.next_out-e,k=i.buf2string(m.output,e),m.next_out=f,m.avail_out=o-f,f&&h.arraySet(m.output,m.output,e,f,0),this.onData(k)):this.onData(h.shrinkBuf(m.output,m.next_out)))),0===m.avail_in&&0===m.avail_out&&(q=!0)}while((m.avail_in>0||0===m.avail_out)&&c!==j.Z_STREAM_END);return c===j.Z_STREAM_END&&(d=j.Z_FINISH),d===j.Z_FINISH?(c=g.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===j.Z_OK):d!==j.Z_SYNC_FLUSH||(this.onEnd(j.Z_OK),m.avail_out=0,!0)},d.prototype.onData=function(a){this.chunks.push(a)},d.prototype.onEnd=function(a){a===j.Z_OK&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=h.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},c.Inflate=d,c.inflate=e,c.inflateRaw=f,c.ungzip=e},{\"./utils/common\":62,\"./utils/strings\":63,\"./zlib/constants\":65,\"./zlib/gzheader\":68,\"./zlib/inflate\":70,\"./zlib/messages\":72,\"./zlib/zstream\":74}],62:[function(a,b,c){\"use strict\";var d=\"undefined\"!=typeof Uint8Array&&\"undefined\"!=typeof Uint16Array&&\"undefined\"!=typeof Int32Array;c.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if(\"object\"!=typeof c)throw new TypeError(c+\"must be non-object\");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},c.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var e={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},f={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};c.setTyped=function(a){a?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,e)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))},c.setTyped(d)},{}],63:[function(a,b,c){\"use strict\";function d(a,b){if(b<65537&&(a.subarray&&g||!a.subarray&&f))return String.fromCharCode.apply(null,e.shrinkBuf(a,b));for(var c=\"\",d=0;d<b;d++)c+=String.fromCharCode(a[d]);return c}var e=a(\"./common\"),f=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch(h){f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(h){g=!1}for(var i=new e.Buf8(256),j=0;j<256;j++)i[j]=j>=252?6:j>=248?5:j>=240?4:j>=224?3:j>=192?2:1;i[254]=i[254]=1,c.string2buf=function(a){var b,c,d,f,g,h=a.length,i=0;for(f=0;f<h;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),i+=c<128?1:c<2048?2:c<65536?3:4;for(b=new e.Buf8(i),g=0,f=0;g<i;f++)c=a.charCodeAt(f),55296===(64512&c)&&f+1<h&&(d=a.charCodeAt(f+1),56320===(64512&d)&&(c=65536+(c-55296<<10)+(d-56320),f++)),c<128?b[g++]=c:c<2048?(b[g++]=192|c>>>6,b[g++]=128|63&c):c<65536?(b[g++]=224|c>>>12,b[g++]=128|c>>>6&63,b[g++]=128|63&c):(b[g++]=240|c>>>18,b[g++]=128|c>>>12&63,b[g++]=128|c>>>6&63,b[g++]=128|63&c);return b},c.buf2binstring=function(a){return d(a,a.length)},c.binstring2buf=function(a){for(var b=new e.Buf8(a.length),c=0,d=b.length;c<d;c++)b[c]=a.charCodeAt(c);return b},c.buf2string=function(a,b){var c,e,f,g,h=b||a.length,j=new Array(2*h);for(e=0,c=0;c<h;)if(f=a[c++],f<128)j[e++]=f;else if(g=i[f],g>4)j[e++]=65533,c+=g-1;else{for(f&=2===g?31:3===g?15:7;g>1&&c<h;)f=f<<6|63&a[c++],g--;g>1?j[e++]=65533:f<65536?j[e++]=f:(f-=65536,j[e++]=55296|f>>10&1023,j[e++]=56320|1023&f)}return d(j,e)},c.utf8border=function(a,b){var c;for(b=b||a.length,b>a.length&&(b=a.length),c=b-1;c>=0&&128===(192&a[c]);)c--;return c<0?b:0===c?b:c+i[a[c]]>b?c:b}},{\"./common\":62}],64:[function(a,b,c){\"use strict\";function d(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do e=e+b[d++]|0,f=f+e|0;while(--g);e%=65521,f%=65521}return e|f<<16|0;\n}b.exports=d},{}],65:[function(a,b,c){\"use strict\";b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(a,b,c){\"use strict\";function d(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}function e(a,b,c,d){var e=f,g=d+c;a^=-1;for(var h=d;h<g;h++)a=a>>>8^e[255&(a^b[h])];return a^-1}var f=d();b.exports=e},{}],67:[function(a,b,c){\"use strict\";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-la?a.strstart-(a.w_size-la):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ka,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do;while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ka-(m-f),f=m-ka,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}while((b=l[b&k])>i&&0!==--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-la)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do d=a.head[--b],a.head[b]=d>=g?d-g:0;while(--c);c=g,b=c;do d=a.prev[--b],a.prev[b]=d>=g?d-g:0;while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ja)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ja-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ja)););}while(a.lookahead<la&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return ua;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return ua;if(a.strstart-a.block_start>=a.w_size-la&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.strstart>a.block_start&&(h(a,!1),0===a.strm.avail_out)?ua:ua}function o(a,b){for(var c,d;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c)),a.match_length>=ja)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ja),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ja){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!==--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function p(a,b){for(var c,d,e;;){if(a.lookahead<la){if(m(a),a.lookahead<la&&b===J)return ua;if(0===a.lookahead)break}if(c=0,a.lookahead>=ja&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ja-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-la&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ja&&a.strstart-a.match_start>4096)&&(a.match_length=ja-1)),a.prev_length>=ja&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ja,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ja),a.lookahead-=a.prev_length-1,a.prev_length-=2;do++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ja-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!==--a.prev_length);if(a.match_available=0,a.match_length=ja-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return ua}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return ua}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ja-1?a.strstart:ja-1,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ka){if(m(a),a.lookahead<=ka&&b===J)return ua;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ja&&a.strstart>0&&(e=a.strstart-1,d=g[e],d===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ka;do;while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ka-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ja?(c=F._tr_tally(a,1,a.match_length-ja),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return ua;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return ua}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?wa:xa):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?ua:va}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ja-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*ha),this.dyn_dtree=new E.Buf16(2*(2*fa+1)),this.bl_tree=new E.Buf16(2*(2*ga+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ia+1),this.heap=new E.Buf16(2*ea+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ea+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?na:sa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ja-1)/ja),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ta&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===na)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=oa):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,ya),h.status=sa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ma),m+=31-m%31,h.status=sa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===oa)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=pa)}else h.status=pa;if(h.status===pa)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=qa)}else h.status=qa;if(h.status===qa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=ra)}else h.status=ra;if(h.status===ra&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=sa)):h.status=sa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ta&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ta){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==wa&&o!==xa||(h.status=ta),o===ua||o===wa)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===va&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status,b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra&&b!==sa&&b!==ta?d(a,Q):(a.state=null,b===sa?d(a,R):O)):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,g=c.wrap,2===g||1===g&&c.status!==na||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ja;){d=c.strstart,e=c.lookahead-(ja-1);do c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ja-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++;while(--e);c.strstart=d,c.lookahead=ja-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ja-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=a(\"../utils/common\"),F=a(\"./trees\"),G=a(\"./adler32\"),H=a(\"./crc32\"),I=a(\"./messages\"),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=29,da=256,ea=da+1+ca,fa=30,ga=19,ha=2*ea+1,ia=15,ja=3,ka=258,la=ka+ja+1,ma=32,na=42,oa=69,pa=73,qa=91,ra=103,sa=113,ta=666,ua=1,va=2,wa=3,xa=4,ya=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],c.deflateInit=z,c.deflateInit2=y,c.deflateReset=w,c.deflateResetKeep=v,c.deflateSetHeader=x,c.deflate=A,c.deflateEnd=B,c.deflateSetDictionary=C,c.deflateInfo=\"pako deflate (from Nodeca project)\"},{\"../utils/common\":62,\"./adler32\":64,\"./crc32\":66,\"./messages\":72,\"./trees\":73}],68:[function(a,b,c){\"use strict\";function d(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1}b.exports=d},{}],69:[function(a,b,c){\"use strict\";var d=30,e=12;b.exports=function(a,b){var c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=a.state,f=a.next_in,B=a.input,g=f+(a.avail_in-5),h=a.next_out,C=a.output,i=h-(b-a.avail_out),j=h+(a.avail_out-257),k=c.dmax,l=c.wsize,m=c.whave,n=c.wnext,o=c.window,p=c.hold,q=c.bits,r=c.lencode,s=c.distcode,t=(1<<c.lenbits)-1,u=(1<<c.distbits)-1;a:do{q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=r[p&t];b:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,0===w)C[h++]=65535&v;else{if(!(16&w)){if(0===(64&w)){v=r[(65535&v)+(p&(1<<w)-1)];continue b}if(32&w){c.mode=e;break a}a.msg=\"invalid literal/length code\",c.mode=d;break a}x=65535&v,w&=15,w&&(q<w&&(p+=B[f++]<<q,q+=8),x+=p&(1<<w)-1,p>>>=w,q-=w),q<15&&(p+=B[f++]<<q,q+=8,p+=B[f++]<<q,q+=8),v=s[p&u];c:for(;;){if(w=v>>>24,p>>>=w,q-=w,w=v>>>16&255,!(16&w)){if(0===(64&w)){v=s[(65535&v)+(p&(1<<w)-1)];continue c}a.msg=\"invalid distance code\",c.mode=d;break a}if(y=65535&v,w&=15,q<w&&(p+=B[f++]<<q,q+=8,q<w&&(p+=B[f++]<<q,q+=8)),y+=p&(1<<w)-1,y>k){a.msg=\"invalid distance too far back\",c.mode=d;break a}if(p>>>=w,q-=w,w=h-i,y>w){if(w=y-w,w>m&&c.sane){a.msg=\"invalid distance too far back\",c.mode=d;break a}if(z=0,A=o,0===n){if(z+=l-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}else if(n<w){if(z+=l+n-w,w-=n,w<x){x-=w;do C[h++]=o[z++];while(--w);if(z=0,n<x){w=n,x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}}}else if(z+=n-w,w<x){x-=w;do C[h++]=o[z++];while(--w);z=h-y,A=C}for(;x>2;)C[h++]=A[z++],C[h++]=A[z++],C[h++]=A[z++],x-=3;x&&(C[h++]=A[z++],x>1&&(C[h++]=A[z++]))}else{z=h-y;do C[h++]=C[z++],C[h++]=C[z++],C[h++]=C[z++],x-=3;while(x>2);x&&(C[h++]=C[z++],x>1&&(C[h++]=C[z++]))}break}}break}}while(f<g&&h<j);x=q>>3,f-=x,q-=x<<3,p&=(1<<q)-1,a.next_in=f,a.next_out=h,a.avail_in=f<g?5+(g-f):5-(f-g),a.avail_out=h<j?257+(j-h):257-(h-j),c.hold=p,c.bits=q}},{}],70:[function(a,b,c){\"use strict\";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg=\"\",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,sa)}function k(a){if(ta){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),ta=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg=\"incorrect header check\",c.mode=ma;break}if((15&m)!==K){a.msg=\"unknown compression method\",c.mode=ma;break}if(m>>>=4,n-=4,wa=(15&m)+8,0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg=\"invalid window size\",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg=\"unknown compression method\",c.mode=ma;break}if(57344&c.flags){a.msg=\"unknown header flags set\",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa));while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg=\"header crc mismatch\",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg=\"invalid block type\",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!==(m>>>16^65535)){a.msg=\"invalid stored block lengths\",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=(31&m)+257,m>>>=5,n-=5,c.ndist=(31&m)+1,m>>>=5,n-=5,c.ncode=(15&m)+4,m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg=\"too many length or distance symbols\",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg=\"invalid code lengths set\",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg=\"invalid bit length repeat\",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg=\"invalid bit length repeat\",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg=\"invalid code -- missing end-of-block\",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg=\"invalid literal/lengths set\",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg=\"invalid distances set\",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg=\"invalid literal/length code\",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0===(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg=\"invalid distance code\",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg=\"invalid distance too far back\",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if(q=c.offset-q,q>c.whave&&c.sane){a.msg=\"invalid distance too far back\",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do f[h++]=pa[r++];while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg=\"incorrect data check\",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg=\"incorrect length check\",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0===(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e,f=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,d=t(d,b,f,0),d!==c.check)?H:(e=l(a,b,f,f))?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=a(\"../utils/common\"),t=a(\"./adler32\"),u=a(\"./crc32\"),v=a(\"./inffast\"),w=a(\"./inftrees\"),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=ra,ta=!0;c.inflateReset=g,c.inflateReset2=h,c.inflateResetKeep=f,c.inflateInit=j,c.inflateInit2=i,c.inflate=m,c.inflateEnd=n,c.inflateGetHeader=o,c.inflateSetDictionary=p,c.inflateInfo=\"pako inflate (from Nodeca project)\"},{\"../utils/common\":62,\"./adler32\":64,\"./crc32\":66,\"./inffast\":69,\"./inftrees\":71}],71:[function(a,b,c){\"use strict\";var d=a(\"../utils/common\"),e=15,f=852,g=592,h=0,i=1,j=2,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],n=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(a,b,c,o,p,q,r,s){var t,u,v,w,x,y,z,A,B,C=s.bits,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=null,O=0,P=new d.Buf16(e+1),Q=new d.Buf16(e+1),R=null,S=0;for(D=0;D<=e;D++)P[D]=0;for(E=0;E<o;E++)P[b[c+E]]++;for(H=C,G=e;G>=1&&0===P[G];G--);if(H>G&&(H=G),0===G)return p[q++]=20971520,p[q++]=20971520,s.bits=1,0;for(F=1;F<G&&0===P[F];F++);for(H<F&&(H=F),K=1,D=1;D<=e;D++)if(K<<=1,K-=P[D],K<0)return-1;if(K>0&&(a===h||1!==G))return-1;for(Q[1]=0,D=1;D<e;D++)Q[D+1]=Q[D]+P[D];for(E=0;E<o;E++)0!==b[c+E]&&(r[Q[b[c+E]]++]=E);if(a===h?(N=R=r,y=19):a===i?(N=k,O-=257,R=l,S-=257,y=256):(N=m,R=n,y=-1),M=0,E=0,D=F,x=q,I=H,J=0,v=-1,L=1<<H,w=L-1,a===i&&L>f||a===j&&L>g)return 1;for(;;){z=D-J,r[E]<y?(A=0,B=r[E]):r[E]>y?(A=R[S+r[E]],B=N[O+r[E]]):(A=96,B=0),t=1<<D-J,u=1<<I,F=u;do u-=t,p[x+(M>>J)+u]=z<<24|A<<16|B|0;while(0!==u);for(t=1<<D-1;M&t;)t>>=1;if(0!==t?(M&=t-1,M+=t):M=0,E++,0===--P[D]){if(D===G)break;D=b[c+r[E]]}if(D>H&&(M&w)!==v){for(0===J&&(J=H),x+=F,I=D-J,K=1<<I;I+J<G&&(K-=P[I+J],!(K<=0));)I++,K<<=1;if(L+=1<<I,a===i&&L>f||a===j&&L>g)return 1;v=M&w,p[v]=H<<24|I<<16|x-q|0}}return 0!==M&&(p[x+M]=D-J<<24|64<<16|0),s.bits=H,0}},{\"../utils/common\":62}],72:[function(a,b,c){\"use strict\";b.exports={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"}},{}],73:[function(a,b,c){\"use strict\";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?ia[a]:ia[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>X-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>X-a.bi_valid,a.bi_valid+=c-X):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do c|=1&a,a>>>=1,c<<=1;while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=W;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,\nc=a.heap_max+1;c<V;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)e=a.heap[--c],e>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(W+1),g=0;for(d=1;d<=W;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(W+1);for(c=0,d=0;d<Q-1;d++)for(ka[d]=c,a=0;a<1<<ba[d];a++)ja[c++]=d;for(ja[c-1]=d,f=0,d=0;d<16;d++)for(la[d]=f,a=0;a<1<<ca[d];a++)ia[f++]=d;for(f>>=7;d<T;d++)for(la[d]=f<<7,a=0;a<1<<ca[d]-7;a++)ia[256+f++]=d;for(b=0;b<=W;b++)g[b]=0;for(a=0;a<=143;)ga[2*a+1]=8,a++,g[8]++;for(;a<=255;)ga[2*a+1]=9,a++,g[9]++;for(;a<=279;)ga[2*a+1]=7,a++,g[7]++;for(;a<=287;)ga[2*a+1]=8,a++,g[8]++;for(n(ga,S+1,g),a=0;a<T;a++)ha[2*a+1]=5,ha[2*a]=k(a,5);ma=new e(ga,ba,R+1,S,W),na=new e(ha,ca,0,T,W),oa=new e(new Array(0),da,0,U,Y)}function p(a){var b;for(b=0;b<S;b++)a.dyn_ltree[2*b]=0;for(b=0;b<T;b++)a.dyn_dtree[2*b]=0;for(b=0;b<U;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*Z]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ja[e],j(a,f+R+1,b),h=ba[f],0!==h&&(e-=ka[f],i(a,e,h)),d--,f=g(d),j(a,f,c),h=ca[f],0!==h&&(d-=la[f],i(a,d,h)));while(k<a.last_lit);j(a,Z,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=V,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*$]++):h<=10?a.bl_tree[2*_]++:a.bl_tree[2*aa]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l){do j(a,e,a.bl_tree);while(0!==--h)}else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,$,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,_,a.bl_tree),i(a,h-3,3)):(j(a,aa,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=U-1;b>=3&&0===a.bl_tree[2*ea[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ea[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<R;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){pa||(o(),pa=!0),a.l_desc=new f(a.dyn_ltree,ma),a.d_desc=new f(a.dyn_dtree,na),a.bl_desc=new f(a.bl_tree,oa),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,Z,ga),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,f=a.static_len+3+7>>>3,f<=e&&(e=f)):e=f=c+5,c+4<=e&&b!==-1?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,ga,ha)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ja[c]+R+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=a(\"../utils/common\"),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=3,P=258,Q=29,R=256,S=R+1+Q,T=30,U=19,V=2*S+1,W=15,X=16,Y=7,Z=256,$=16,_=17,aa=18,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ca=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],da=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ea=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa=512,ga=new Array(2*(S+2));d(ga);var ha=new Array(2*T);d(ha);var ia=new Array(fa);d(ia);var ja=new Array(P-O+1);d(ja);var ka=new Array(Q);d(ka);var la=new Array(T);d(la);var ma,na,oa,pa=!1;c._tr_init=B,c._tr_stored_block=C,c._tr_flush_block=E,c._tr_tally=F,c._tr_align=D},{\"../utils/common\":62}],74:[function(a,b,c){\"use strict\";function d(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0}b.exports=d},{}]},{},[10])(10)});\n/*! Pickr 1.8.0 MIT | https://github.com/Simonwep/pickr */ ! function(t, e) {\n\t\"object\" == typeof exports && \"object\" == typeof module ? module.exports = e() : \"function\" == typeof define && define.amd ? define([], e) : \"object\" == typeof exports ? exports.Pickr = e() : t.Pickr = e()\n}(window, (function() {\n\treturn function(t) {\n\t\tvar e = {};\n\n\t\tfunction o(n) {\n\t\t\tif (e[n]) return e[n].exports;\n\t\t\tvar i = e[n] = {\n\t\t\t\ti: n,\n\t\t\t\tl: !1,\n\t\t\t\texports: {}\n\t\t\t};\n\t\t\treturn t[n].call(i.exports, i, i.exports, o), i.l = !0, i.exports\n\t\t}\n\t\treturn o.m = t, o.c = e, o.d = function(t, e, n) {\n\t\t\to.o(t, e) || Object.defineProperty(t, e, {\n\t\t\t\tenumerable: !0,\n\t\t\t\tget: n\n\t\t\t})\n\t\t}, o.r = function(t) {\n\t\t\t\"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {\n\t\t\t\tvalue: \"Module\"\n\t\t\t}), Object.defineProperty(t, \"__esModule\", {\n\t\t\t\tvalue: !0\n\t\t\t})\n\t\t}, o.t = function(t, e) {\n\t\t\tif (1 & e && (t = o(t)), 8 & e) return t;\n\t\t\tif (4 & e && \"object\" == typeof t && t && t.__esModule) return t;\n\t\t\tvar n = Object.create(null);\n\t\t\tif (o.r(n), Object.defineProperty(n, \"default\", {\n\t\t\t\t\tenumerable: !0,\n\t\t\t\t\tvalue: t\n\t\t\t\t}), 2 & e && \"string\" != typeof t)\n\t\t\t\tfor (var i in t) o.d(n, i, function(e) {\n\t\t\t\t\treturn t[e]\n\t\t\t\t}.bind(null, i));\n\t\t\treturn n\n\t\t}, o.n = function(t) {\n\t\t\tvar e = t && t.__esModule ? function() {\n\t\t\t\treturn t.default\n\t\t\t} : function() {\n\t\t\t\treturn t\n\t\t\t};\n\t\t\treturn o.d(e, \"a\", e), e\n\t\t}, o.o = function(t, e) {\n\t\t\treturn Object.prototype.hasOwnProperty.call(t, e)\n\t\t}, o.p = \"\", o(o.s = 0)\n\t}([function(t, e, o) {\n\t\t\"use strict\";\n\t\to.r(e);\n\t\tvar n = {};\n\n\t\tfunction i(t, e, o, n, i = {}) {\n\t\t\te instanceof HTMLCollection || e instanceof NodeList ? e = Array.from(e) : Array.isArray(e) || (e = [e]), Array.isArray(o) || (o = [o]);\n\t\t\tfor (const r of e)\n\t\t\t\tfor (const e of o) r[t](e, n, {\n\t\t\t\t\tcapture: !1,\n\t\t\t\t\t...i\n\t\t\t\t});\n\t\t\treturn Array.prototype.slice.call(arguments, 1)\n\t\t}\n\t\to.r(n), o.d(n, \"on\", (function() {\n\t\t\treturn r\n\t\t})), o.d(n, \"off\", (function() {\n\t\t\treturn s\n\t\t})), o.d(n, \"createElementFromString\", (function() {\n\t\t\treturn a\n\t\t})), o.d(n, \"createFromTemplate\", (function() {\n\t\t\treturn l\n\t\t})), o.d(n, \"eventPath\", (function() {\n\t\t\treturn c\n\t\t})), o.d(n, \"resolveElement\", (function() {\n\t\t\treturn p\n\t\t})), o.d(n, \"adjustableInputNumbers\", (function() {\n\t\t\treturn u\n\t\t}));\n\t\tconst r = i.bind(null, \"addEventListener\"),\n\t\t\ts = i.bind(null, \"removeEventListener\");\n\n\t\tfunction a(t) {\n\t\t\tconst e = document.createElement(\"div\");\n\t\t\treturn e.innerHTML = t.trim(), e.firstElementChild\n\t\t}\n\n\t\tfunction l(t) {\n\t\t\tconst e = (t, e) => {\n\t\t\t\t\tconst o = t.getAttribute(e);\n\t\t\t\t\treturn t.removeAttribute(e), o\n\t\t\t\t},\n\t\t\t\to = (t, n = {}) => {\n\t\t\t\t\tconst i = e(t, \":obj\"),\n\t\t\t\t\t\tr = e(t, \":ref\"),\n\t\t\t\t\t\ts = i ? n[i] = {} : n;\n\t\t\t\t\tr && (n[r] = t);\n\t\t\t\t\tfor (const n of Array.from(t.children)) {\n\t\t\t\t\t\tconst t = e(n, \":arr\"),\n\t\t\t\t\t\t\ti = o(n, t ? {} : s);\n\t\t\t\t\t\tt && (s[t] || (s[t] = [])).push(Object.keys(i).length ? i : n)\n\t\t\t\t\t}\n\t\t\t\t\treturn n\n\t\t\t\t};\n\t\t\treturn o(a(t))\n\t\t}\n\n\t\tfunction c(t) {\n\t\t\tlet e = t.path || t.composedPath && t.composedPath();\n\t\t\tif (e) return e;\n\t\t\tlet o = t.target.parentElement;\n\t\t\tfor (e = [t.target, o]; o = o.parentElement;) e.push(o);\n\t\t\treturn e.push(document, window), e\n\t\t}\n\n\t\tfunction p(t) {\n\t\t\treturn t instanceof Element ? t : \"string\" == typeof t ? t.split(/>>/g).reduce((t, e, o, n) => (t = t.querySelector(e), o < n.length - 1 ? t.shadowRoot : t), document) : null\n\t\t}\n\n\t\tfunction u(t, e = (t => t)) {\n\t\t\tfunction o(o) {\n\t\t\t\tconst n = [.001, .01, .1][Number(o.shiftKey || 2 * o.ctrlKey)] * (o.deltaY < 0 ? 1 : -1);\n\t\t\t\tlet i = 0,\n\t\t\t\t\tr = t.selectionStart;\n\t\t\t\tt.value = t.value.replace(/[\\d.]+/g, (t, o) => o <= r && o + t.length >= r ? (r = o, e(Number(t), n, i)) : (i++, t)), t.focus(), t.setSelectionRange(r, r), o.preventDefault(), t.dispatchEvent(new Event(\"input\"))\n\t\t\t}\n\t\t\tr(t, \"focus\", () => r(window, \"wheel\", o, {\n\t\t\t\tpassive: !1\n\t\t\t})), r(t, \"blur\", () => s(window, \"wheel\", o))\n\t\t}\n\t\tconst {\n\t\t\tmin: h,\n\t\t\tmax: d,\n\t\t\tfloor: f,\n\t\t\tround: m\n\t\t} = Math;\n\n\t\tfunction v(t, e, o) {\n\t\t\te /= 100, o /= 100;\n\t\t\tconst n = f(t = t / 360 * 6),\n\t\t\t\ti = t - n,\n\t\t\t\tr = o * (1 - e),\n\t\t\t\ts = o * (1 - i * e),\n\t\t\t\ta = o * (1 - (1 - i) * e),\n\t\t\t\tl = n % 6;\n\t\t\treturn [255 * [o, s, r, r, a, o][l], 255 * [a, o, o, s, r, r][l], 255 * [r, r, a, o, o, s][l]]\n\t\t}\n\n\t\tfunction b(t, e, o) {\n\t\t\tconst n = (2 - (e /= 100)) * (o /= 100) / 2;\n\t\t\treturn 0 !== n && (e = 1 === n ? 0 : n < .5 ? e * o / (2 * n) : e * o / (2 - 2 * n)), [t, 100 * e, 100 * n]\n\t\t}\n\n\t\tfunction g(t, e, o) {\n\t\t\tconst n = h(t /= 255, e /= 255, o /= 255),\n\t\t\t\ti = d(t, e, o),\n\t\t\t\tr = i - n;\n\t\t\tlet s, a;\n\t\t\tif (0 === r) s = a = 0;\n\t\t\telse {\n\t\t\t\ta = r / i;\n\t\t\t\tconst n = ((i - t) / 6 + r / 2) / r,\n\t\t\t\t\tl = ((i - e) / 6 + r / 2) / r,\n\t\t\t\t\tc = ((i - o) / 6 + r / 2) / r;\n\t\t\t\tt === i ? s = c - l : e === i ? s = 1 / 3 + n - c : o === i && (s = 2 / 3 + l - n), s < 0 ? s += 1 : s > 1 && (s -= 1)\n\t\t\t}\n\t\t\treturn [360 * s, 100 * a, 100 * i]\n\t\t}\n\n\t\tfunction y(t, e, o, n) {\n\t\t\te /= 100, o /= 100;\n\t\t\treturn [...g(255 * (1 - h(1, (t /= 100) * (1 - (n /= 100)) + n)), 255 * (1 - h(1, e * (1 - n) + n)), 255 * (1 - h(1, o * (1 - n) + n)))]\n\t\t}\n\n\t\tfunction _(t, e, o) {\n\t\t\te /= 100;\n\t\t\tconst n = 2 * (e *= (o /= 100) < .5 ? o : 1 - o) / (o + e) * 100,\n\t\t\t\ti = 100 * (o + e);\n\t\t\treturn [t, isNaN(n) ? 0 : n, i]\n\t\t}\n\n\t\tfunction w(t) {\n\t\t\treturn g(...t.match(/.{2}/g).map(t => parseInt(t, 16)))\n\t\t}\n\n\t\tfunction A(t) {\n\t\t\tt = t.match(/^[a-zA-Z]+$/) ? function(t) {\n\t\t\t\tif (\"black\" === t.toLowerCase()) return \"#000\";\n\t\t\t\tconst e = document.createElement(\"canvas\").getContext(\"2d\");\n\t\t\t\treturn e.fillStyle = t, \"#000\" === e.fillStyle ? null : e.fillStyle\n\t\t\t}(t) : t;\n\t\t\tconst e = {\n\t\t\t\t\tcmyk: /^cmyk[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)/i,\n\t\t\t\t\trgba: /^((rgba)|rgb)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]*?([\\d.]+|$)/i,\n\t\t\t\t\thsla: /^((hsla)|hsl)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]*?([\\d.]+|$)/i,\n\t\t\t\t\thsva: /^((hsva)|hsv)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]*?([\\d.]+|$)/i,\n\t\t\t\t\thexa: /^#?(([\\dA-Fa-f]{3,4})|([\\dA-Fa-f]{6})|([\\dA-Fa-f]{8}))$/i\n\t\t\t\t},\n\t\t\t\to = t => t.map(t => /^(|\\d+)\\.\\d+|\\d+$/.test(t) ? Number(t) : void 0);\n\t\t\tlet n;\n\t\t\tt: for (const i in e) {\n\t\t\t\tif (!(n = e[i].exec(t))) continue;\n\t\t\t\tconst r = t => !!n[2] == (\"number\" == typeof t);\n\t\t\t\tswitch (i) {\n\t\t\t\t\tcase \"cmyk\":\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst [, t, e, r, s] = o(n);\n\t\t\t\t\t\t\tif (t > 100 || e > 100 || r > 100 || s > 100) break t;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tvalues: y(t, e, r, s),\n\t\t\t\t\t\t\t\ttype: i\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tcase \"rgba\":\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst [, , , t, e, s, a] = o(n);\n\t\t\t\t\t\t\tif (t > 255 || e > 255 || s > 255 || a < 0 || a > 1 || !r(a)) break t;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tvalues: [...g(t, e, s), a],\n\t\t\t\t\t\t\t\ta: a,\n\t\t\t\t\t\t\t\ttype: i\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tcase \"hexa\":\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet [, t] = n;4 !== t.length && 3 !== t.length || (t = t.split(\"\").map(t => t + t).join(\"\"));\n\t\t\t\t\t\t\tconst e = t.substring(0, 6);\n\t\t\t\t\t\t\tlet o = t.substring(6);\n\t\t\t\t\t\t\treturn o = o ? parseInt(o, 16) / 255 : void 0,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalues: [...w(e), o],\n\t\t\t\t\t\t\t\ta: o,\n\t\t\t\t\t\t\t\ttype: i\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tcase \"hsla\":\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst [, , , t, e, s, a] = o(n);\n\t\t\t\t\t\t\tif (t > 360 || e > 100 || s > 100 || a < 0 || a > 1 || !r(a)) break t;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tvalues: [..._(t, e, s), a],\n\t\t\t\t\t\t\t\ta: a,\n\t\t\t\t\t\t\t\ttype: i\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\tcase \"hsva\":\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst [, , , t, e, s, a] = o(n);\n\t\t\t\t\t\t\tif (t > 360 || e > 100 || s > 100 || a < 0 || a > 1 || !r(a)) break t;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tvalues: [t, e, s, a],\n\t\t\t\t\t\t\t\ta: a,\n\t\t\t\t\t\t\t\ttype: i\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tvalues: null,\n\t\t\t\ttype: null\n\t\t\t}\n\t\t}\n\n\t\tfunction C(t = 0, e = 0, o = 0, n = 1) {\n\t\t\tconst i = (t, e) => (o = -1) => e(~o ? t.map(t => Number(t.toFixed(o))) : t),\n\t\t\t\tr = {\n\t\t\t\t\th: t,\n\t\t\t\t\ts: e,\n\t\t\t\t\tv: o,\n\t\t\t\t\ta: n,\n\t\t\t\t\ttoHSVA() {\n\t\t\t\t\t\tconst t = [r.h, r.s, r.v, r.a];\n\t\t\t\t\t\treturn t.toString = i(t, t => `hsva(${t[0]}, ${t[1]}%, ${t[2]}%, ${r.a})`), t\n\t\t\t\t\t},\n\t\t\t\t\ttoHSLA() {\n\t\t\t\t\t\tconst t = [...b(r.h, r.s, r.v), r.a];\n\t\t\t\t\t\treturn t.toString = i(t, t => `hsla(${t[0]}, ${t[1]}%, ${t[2]}%, ${r.a})`), t\n\t\t\t\t\t},\n\t\t\t\t\ttoRGBA() {\n\t\t\t\t\t\tconst t = [...v(r.h, r.s, r.v), r.a];\n\t\t\t\t\t\treturn t.toString = i(t, t => `rgba(${t[0]}, ${t[1]}, ${t[2]}, ${r.a})`), t\n\t\t\t\t\t},\n\t\t\t\t\ttoCMYK() {\n\t\t\t\t\t\tconst t = function(t, e, o) {\n\t\t\t\t\t\t\tconst n = v(t, e, o),\n\t\t\t\t\t\t\t\ti = n[0] / 255,\n\t\t\t\t\t\t\t\tr = n[1] / 255,\n\t\t\t\t\t\t\t\ts = n[2] / 255,\n\t\t\t\t\t\t\t\ta = h(1 - i, 1 - r, 1 - s);\n\t\t\t\t\t\t\treturn [100 * (1 === a ? 0 : (1 - i - a) / (1 - a)), 100 * (1 === a ? 0 : (1 - r - a) / (1 - a)), 100 * (1 === a ? 0 : (1 - s - a) / (1 - a)), 100 * a]\n\t\t\t\t\t\t}(r.h, r.s, r.v);\n\t\t\t\t\t\treturn t.toString = i(t, t => `cmyk(${t[0]}%, ${t[1]}%, ${t[2]}%, ${t[3]}%)`), t\n\t\t\t\t\t},\n\t\t\t\t\ttoHEXA() {\n\t\t\t\t\t\tconst t = function(t, e, o) {\n\t\t\t\t\t\t\t\treturn v(t, e, o).map(t => m(t).toString(16).padStart(2, \"0\"))\n\t\t\t\t\t\t\t}(r.h, r.s, r.v),\n\t\t\t\t\t\t\te = r.a >= 1 ? \"\" : Number((255 * r.a).toFixed(0)).toString(16).toUpperCase().padStart(2, \"0\");\n\t\t\t\t\t\treturn e && t.push(e), t.toString = () => \"#\" + t.join(\"\").toUpperCase(), t\n\t\t\t\t\t},\n\t\t\t\t\tclone: () => C(r.h, r.s, r.v, r.a)\n\t\t\t\t};\n\t\t\treturn r\n\t\t}\n\t\tconst k = t => Math.max(Math.min(t, 1), 0);\n\n\t\tfunction $(t) {\n\t\t\tconst e = {\n\t\t\t\t\toptions: Object.assign({\n\t\t\t\t\t\tlock: null,\n\t\t\t\t\t\tonchange: () => 0,\n\t\t\t\t\t\tonstop: () => 0\n\t\t\t\t\t}, t),\n\t\t\t\t\t_keyboard(t) {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\toptions: o\n\t\t\t\t\t\t} = e, {\n\t\t\t\t\t\t\ttype: n,\n\t\t\t\t\t\t\tkey: i\n\t\t\t\t\t\t} = t;\n\t\t\t\t\t\tif (document.activeElement === o.wrapper) {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\tlock: o\n\t\t\t\t\t\t\t} = e.options, r = \"ArrowUp\" === i, s = \"ArrowRight\" === i, a = \"ArrowDown\" === i, l = \"ArrowLeft\" === i;\n\t\t\t\t\t\t\tif (\"keydown\" === n && (r || s || a || l)) {\n\t\t\t\t\t\t\t\tlet n = 0,\n\t\t\t\t\t\t\t\t\ti = 0;\n\t\t\t\t\t\t\t\t\"v\" === o ? n = r || s ? 1 : -1 : \"h\" === o ? n = r || s ? -1 : 1 : (i = r ? -1 : a ? 1 : 0, n = l ? -1 : s ? 1 : 0), e.update(k(e.cache.x + .01 * n), k(e.cache.y + .01 * i)), t.preventDefault()\n\t\t\t\t\t\t\t} else i.startsWith(\"Arrow\") && (e.options.onstop(), t.preventDefault())\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t_tapstart(t) {\n\t\t\t\t\t\tr(document, [\"mouseup\", \"touchend\", \"touchcancel\"], e._tapstop), r(document, [\"mousemove\", \"touchmove\"], e._tapmove), t.cancelable && t.preventDefault(), e._tapmove(t)\n\t\t\t\t\t},\n\t\t\t\t\t_tapmove(t) {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\toptions: o,\n\t\t\t\t\t\t\tcache: n\n\t\t\t\t\t\t} = e, {\n\t\t\t\t\t\t\tlock: i,\n\t\t\t\t\t\t\telement: r,\n\t\t\t\t\t\t\twrapper: s\n\t\t\t\t\t\t} = o, a = s.getBoundingClientRect();\n\t\t\t\t\t\tlet l = 0,\n\t\t\t\t\t\t\tc = 0;\n\t\t\t\t\t\tif (t) {\n\t\t\t\t\t\t\tconst e = t && t.touches && t.touches[0];\n\t\t\t\t\t\t\tl = t ? (e || t).clientX : 0, c = t ? (e || t).clientY : 0, l < a.left ? l = a.left : l > a.left + a.width && (l = a.left + a.width), c < a.top ? c = a.top : c > a.top + a.height && (c = a.top + a.height), l -= a.left, c -= a.top\n\t\t\t\t\t\t} else n && (l = n.x * a.width, c = n.y * a.height);\n\t\t\t\t\t\t\"h\" !== i && (r.style.left = `calc(${l/a.width*100}% - ${r.offsetWidth/2}px)`), \"v\" !== i && (r.style.top = `calc(${c/a.height*100}% - ${r.offsetHeight/2}px)`), e.cache = {\n\t\t\t\t\t\t\tx: l / a.width,\n\t\t\t\t\t\t\ty: c / a.height\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst p = k(l / a.width),\n\t\t\t\t\t\t\tu = k(c / a.height);\n\t\t\t\t\t\tswitch (i) {\n\t\t\t\t\t\t\tcase \"v\":\n\t\t\t\t\t\t\t\treturn o.onchange(p);\n\t\t\t\t\t\t\tcase \"h\":\n\t\t\t\t\t\t\t\treturn o.onchange(u);\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn o.onchange(p, u)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t_tapstop() {\n\t\t\t\t\t\te.options.onstop(), s(document, [\"mouseup\", \"touchend\", \"touchcancel\"], e._tapstop), s(document, [\"mousemove\", \"touchmove\"], e._tapmove)\n\t\t\t\t\t},\n\t\t\t\t\ttrigger() {\n\t\t\t\t\t\te._tapmove()\n\t\t\t\t\t},\n\t\t\t\t\tupdate(t = 0, o = 0) {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tleft: n,\n\t\t\t\t\t\t\ttop: i,\n\t\t\t\t\t\t\twidth: r,\n\t\t\t\t\t\t\theight: s\n\t\t\t\t\t\t} = e.options.wrapper.getBoundingClientRect();\n\t\t\t\t\t\t\"h\" === e.options.lock && (o = t), e._tapmove({\n\t\t\t\t\t\t\tclientX: n + r * t,\n\t\t\t\t\t\t\tclientY: i + s * o\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tdestroy() {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\toptions: t,\n\t\t\t\t\t\t\t_tapstart: o,\n\t\t\t\t\t\t\t_keyboard: n\n\t\t\t\t\t\t} = e;\n\t\t\t\t\t\ts(document, [\"keydown\", \"keyup\"], n), s([t.wrapper, t.element], \"mousedown\", o), s([t.wrapper, t.element], \"touchstart\", o, {\n\t\t\t\t\t\t\tpassive: !1\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\toptions: o,\n\t\t\t\t\t_tapstart: n,\n\t\t\t\t\t_keyboard: i\n\t\t\t\t} = e;\n\t\t\treturn r([o.wrapper, o.element], \"mousedown\", n), r([o.wrapper, o.element], \"touchstart\", n, {\n\t\t\t\tpassive: !1\n\t\t\t}), r(document, [\"keydown\", \"keyup\"], i), e\n\t\t}\n\n\t\tfunction S(t = {}) {\n\t\t\tt = Object.assign({\n\t\t\t\tonchange: () => 0,\n\t\t\t\tclassName: \"\",\n\t\t\t\telements: []\n\t\t\t}, t);\n\t\t\tconst e = r(t.elements, \"click\", e => {\n\t\t\t\tt.elements.forEach(o => o.classList[e.target === o ? \"add\" : \"remove\"](t.className)), t.onchange(e), e.stopPropagation()\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tdestroy: () => s(...e)\n\t\t\t}\n\t\t}\n\t\t/*! NanoPop 2.1.0 MIT | https://github.com/Simonwep/nanopop */\n\t\tconst O = {\n\t\t\t\tvariantFlipOrder: {\n\t\t\t\t\tstart: \"sme\",\n\t\t\t\t\tmiddle: \"mse\",\n\t\t\t\t\tend: \"ems\"\n\t\t\t\t},\n\t\t\t\tpositionFlipOrder: {\n\t\t\t\t\ttop: \"tbrl\",\n\t\t\t\t\tright: \"rltb\",\n\t\t\t\t\tbottom: \"btrl\",\n\t\t\t\t\tleft: \"lrbt\"\n\t\t\t\t},\n\t\t\t\tposition: \"bottom\",\n\t\t\t\tmargin: 8\n\t\t\t},\n\t\t\tE = (t, e, o) => {\n\t\t\t\tconst n = \"object\" != typeof t || t instanceof HTMLElement ? {\n\t\t\t\t\treference: t,\n\t\t\t\t\tpopper: e,\n\t\t\t\t\t...o\n\t\t\t\t} : t;\n\t\t\t\treturn {\n\t\t\t\t\tupdate(t = n) {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\treference: e,\n\t\t\t\t\t\t\tpopper: o\n\t\t\t\t\t\t} = Object.assign(n, t);\n\t\t\t\t\t\tif (!o || !e) throw new Error(\"Popper- or reference-element missing.\");\n\t\t\t\t\t\treturn ((t, e, o) => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\tcontainer: n,\n\t\t\t\t\t\t\t\tmargin: i,\n\t\t\t\t\t\t\t\tposition: r,\n\t\t\t\t\t\t\t\tvariantFlipOrder: s,\n\t\t\t\t\t\t\t\tpositionFlipOrder: a\n\t\t\t\t\t\t\t} = {\n\t\t\t\t\t\t\t\tcontainer: document.documentElement.getBoundingClientRect(),\n\t\t\t\t\t\t\t\t...O,\n\t\t\t\t\t\t\t\t...o\n\t\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t\tleft: l,\n\t\t\t\t\t\t\t\ttop: c\n\t\t\t\t\t\t\t} = e.style;\n\t\t\t\t\t\t\te.style.left = \"0\", e.style.top = \"0\";\n\t\t\t\t\t\t\tconst p = t.getBoundingClientRect(),\n\t\t\t\t\t\t\t\tu = e.getBoundingClientRect(),\n\t\t\t\t\t\t\t\th = {\n\t\t\t\t\t\t\t\t\tt: p.top - u.height - i,\n\t\t\t\t\t\t\t\t\tb: p.bottom + i,\n\t\t\t\t\t\t\t\t\tr: p.right + i,\n\t\t\t\t\t\t\t\t\tl: p.left - u.width - i\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\td = {\n\t\t\t\t\t\t\t\t\tvs: p.left,\n\t\t\t\t\t\t\t\t\tvm: p.left + p.width / 2 + -u.width / 2,\n\t\t\t\t\t\t\t\t\tve: p.left + p.width - u.width,\n\t\t\t\t\t\t\t\t\ths: p.top,\n\t\t\t\t\t\t\t\t\thm: p.bottom - p.height / 2 - u.height / 2,\n\t\t\t\t\t\t\t\t\the: p.bottom - u.height\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t[f, m = \"middle\"] = r.split(\"-\"),\n\t\t\t\t\t\t\t\tv = a[f],\n\t\t\t\t\t\t\t\tb = s[m],\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttop: g,\n\t\t\t\t\t\t\t\t\tleft: y,\n\t\t\t\t\t\t\t\t\tbottom: _,\n\t\t\t\t\t\t\t\t\tright: w\n\t\t\t\t\t\t\t\t} = n;\n\t\t\t\t\t\t\tfor (const t of v) {\n\t\t\t\t\t\t\t\tconst o = \"t\" === t || \"b\" === t,\n\t\t\t\t\t\t\t\t\tn = h[t],\n\t\t\t\t\t\t\t\t\t[i, r] = o ? [\"top\", \"left\"] : [\"left\", \"top\"],\n\t\t\t\t\t\t\t\t\t[s, a] = o ? [u.height, u.width] : [u.width, u.height],\n\t\t\t\t\t\t\t\t\t[l, c] = o ? [_, w] : [w, _],\n\t\t\t\t\t\t\t\t\t[p, f] = o ? [g, y] : [y, g];\n\t\t\t\t\t\t\t\tif (!(n < p || n + s > l))\n\t\t\t\t\t\t\t\t\tfor (const s of b) {\n\t\t\t\t\t\t\t\t\t\tconst l = d[(o ? \"v\" : \"h\") + s];\n\t\t\t\t\t\t\t\t\t\tif (!(l < f || l + a > c)) return e.style[r] = l - u[r] + \"px\", e.style[i] = n - u[i] + \"px\", t + s\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn e.style.left = l, e.style.top = c, null\n\t\t\t\t\t\t})(e, o, n)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\tfunction L(t, e, o) {\n\t\t\treturn e in t ? Object.defineProperty(t, e, {\n\t\t\t\tvalue: o,\n\t\t\t\tenumerable: !0,\n\t\t\t\tconfigurable: !0,\n\t\t\t\twritable: !0\n\t\t\t}) : t[e] = o, t\n\t\t}\n\t\tclass x {\n\t\t\tconstructor(t) {\n\t\t\t\tL(this, \"_initializingActive\", !0), L(this, \"_recalc\", !0), L(this, \"_nanopop\", null), L(this, \"_root\", null), L(this, \"_color\", C()), L(this, \"_lastColor\", C()), L(this, \"_swatchColors\", []), L(this, \"_setupAnimationFrame\", null), L(this, \"_eventListener\", {\n\t\t\t\t\tinit: [],\n\t\t\t\t\tsave: [],\n\t\t\t\t\thide: [],\n\t\t\t\t\tshow: [],\n\t\t\t\t\tclear: [],\n\t\t\t\t\tchange: [],\n\t\t\t\t\tchangestop: [],\n\t\t\t\t\tcancel: [],\n\t\t\t\t\tswatchselect: []\n\t\t\t\t}), this.options = t = Object.assign({ ...x.DEFAULT_OPTIONS\n\t\t\t\t}, t);\n\t\t\t\tconst {\n\t\t\t\t\tswatches: e,\n\t\t\t\t\tcomponents: o,\n\t\t\t\t\ttheme: n,\n\t\t\t\t\tsliders: i,\n\t\t\t\t\tlockOpacity: r,\n\t\t\t\t\tpadding: s\n\t\t\t\t} = t;\n\t\t\t\t[\"nano\", \"monolith\"].includes(n) && !i && (t.sliders = \"h\"), o.interaction || (o.interaction = {});\n\t\t\t\tconst {\n\t\t\t\t\tpreview: a,\n\t\t\t\t\topacity: l,\n\t\t\t\t\thue: c,\n\t\t\t\t\tpalette: p\n\t\t\t\t} = o;\n\t\t\t\to.opacity = !r && l, o.palette = p || a || l || c, this._preBuild(), this._buildComponents(), this._bindEvents(), this._finalBuild(), e && e.length && e.forEach(t => this.addSwatch(t));\n\t\t\t\tconst {\n\t\t\t\t\tbutton: u,\n\t\t\t\t\tapp: h\n\t\t\t\t} = this._root;\n\t\t\t\tthis._nanopop = E(u, h, {\n\t\t\t\t\tmargin: s\n\t\t\t\t}), u.setAttribute(\"role\", \"button\"), u.setAttribute(\"aria-label\", this._t(\"btn:toggle\"));\n\t\t\t\tconst d = this;\n\t\t\t\tthis._setupAnimationFrame = requestAnimationFrame((function e() {\n\t\t\t\t\tif (!h.offsetWidth) return requestAnimationFrame(e);\n\t\t\t\t\td.setColor(t.default), d._rePositioningPicker(), t.defaultRepresentation && (d._representation = t.defaultRepresentation, d.setColorRepresentation(d._representation)), t.showAlways && d.show(), d._initializingActive = !1, d._emit(\"init\")\n\t\t\t\t}))\n\t\t\t}\n\t\t\t_preBuild() {\n\t\t\t\tconst {\n\t\t\t\t\toptions: t\n\t\t\t\t} = this;\n\t\t\t\tfor (const e of [\"el\", \"container\"]) t[e] = p(t[e]);\n\t\t\t\tthis._root = (t => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tcomponents: e,\n\t\t\t\t\t\tuseAsButton: o,\n\t\t\t\t\t\tinline: n,\n\t\t\t\t\t\tappClass: i,\n\t\t\t\t\t\ttheme: r,\n\t\t\t\t\t\tlockOpacity: s\n\t\t\t\t\t} = t.options, a = t => t ? \"\" : 'style=\"display:none\" hidden', c = e => t._t(e), p = l(`\\n      <div :ref=\"root\" class=\"pickr\">\\n\\n        ${o?\"\":'<button type=\"button\" :ref=\"button\" class=\"pcr-button\"></button>'}\\n\\n        <div :ref=\"app\" class=\"pcr-app ${i||\"\"}\" data-theme=\"${r}\" ${n?'style=\"position: unset\"':\"\"} aria-label=\"${c(\"ui:dialog\")}\" role=\"window\">\\n          <div class=\"pcr-selection\" ${a(e.palette)}>\\n            <div :obj=\"preview\" class=\"pcr-color-preview\" ${a(e.preview)}>\\n              <button type=\"button\" :ref=\"lastColor\" class=\"pcr-last-color\" aria-label=\"${c(\"btn:last-color\")}\"></button>\\n              <div :ref=\"currentColor\" class=\"pcr-current-color\"></div>\\n            </div>\\n\\n            <div :obj=\"palette\" class=\"pcr-color-palette\">\\n              <div :ref=\"picker\" class=\"pcr-picker\"></div>\\n              <div :ref=\"palette\" class=\"pcr-palette\" tabindex=\"0\" aria-label=\"${c(\"aria:palette\")}\" role=\"listbox\"></div>\\n            </div>\\n\\n            <div :obj=\"hue\" class=\"pcr-color-chooser\" ${a(e.hue)}>\\n              <div :ref=\"picker\" class=\"pcr-picker\"></div>\\n              <div :ref=\"slider\" class=\"pcr-hue pcr-slider\" tabindex=\"0\" aria-label=\"${c(\"aria:hue\")}\" role=\"slider\"></div>\\n            </div>\\n\\n            <div :obj=\"opacity\" class=\"pcr-color-opacity\" ${a(e.opacity)}>\\n              <div :ref=\"picker\" class=\"pcr-picker\"></div>\\n              <div :ref=\"slider\" class=\"pcr-opacity pcr-slider\" tabindex=\"0\" aria-label=\"${c(\"aria:opacity\")}\" role=\"slider\"></div>\\n            </div>\\n          </div>\\n\\n          <div class=\"pcr-swatches ${e.palette?\"\":\"pcr-last\"}\" :ref=\"swatches\"></div>\\n\\n          <div :obj=\"interaction\" class=\"pcr-interaction\" ${a(Object.keys(e.interaction).length)}>\\n            <input :ref=\"result\" class=\"pcr-result\" type=\"text\" spellcheck=\"false\" ${a(e.interaction.input)} aria-label=\"${c(\"aria:input\")}\">\\n\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"HEXA\" value=\"${s?\"HEX\":\"HEXA\"}\" type=\"button\" ${a(e.interaction.hex)}>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"RGBA\" value=\"${s?\"RGB\":\"RGBA\"}\" type=\"button\" ${a(e.interaction.rgba)}>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"HSLA\" value=\"${s?\"HSL\":\"HSLA\"}\" type=\"button\" ${a(e.interaction.hsla)}>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"HSVA\" value=\"${s?\"HSV\":\"HSVA\"}\" type=\"button\" ${a(e.interaction.hsva)}>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"CMYK\" value=\"CMYK\" type=\"button\" ${a(e.interaction.cmyk)}>\\n\\n            <input :ref=\"save\" class=\"pcr-save\" value=\"${c(\"btn:save\")}\" type=\"button\" ${a(e.interaction.save)} aria-label=\"${c(\"aria:btn:save\")}\">\\n            <input :ref=\"cancel\" class=\"pcr-cancel\" value=\"${c(\"btn:cancel\")}\" type=\"button\" ${a(e.interaction.cancel)} aria-label=\"${c(\"aria:btn:cancel\")}\">\\n            <input :ref=\"clear\" class=\"pcr-clear\" value=\"${c(\"btn:clear\")}\" type=\"button\" ${a(e.interaction.clear)} aria-label=\"${c(\"aria:btn:clear\")}\">\\n          </div>\\n        </div>\\n      </div>\\n    `), u = p.interaction;\n\t\t\t\t\treturn u.options.find(t => !t.hidden && !t.classList.add(\"active\")), u.type = () => u.options.find(t => t.classList.contains(\"active\")), p\n\t\t\t\t})(this), t.useAsButton && (this._root.button = t.el), t.container.appendChild(this._root.root)\n\t\t\t}\n\t\t\t_finalBuild() {\n\t\t\t\tconst t = this.options,\n\t\t\t\t\te = this._root;\n\t\t\t\tif (t.container.removeChild(e.root), t.inline) {\n\t\t\t\t\tconst o = t.el.parentElement;\n\t\t\t\t\tt.el.nextSibling ? o.insertBefore(e.app, t.el.nextSibling) : o.appendChild(e.app)\n\t\t\t\t} else t.container.appendChild(e.app);\n\t\t\t\tt.useAsButton ? t.inline && t.el.remove() : t.el.parentNode.replaceChild(e.root, t.el), t.disabled && this.disable(), t.comparison || (e.button.style.transition = \"none\", t.useAsButton || (e.preview.lastColor.style.transition = \"none\")), this.hide()\n\t\t\t}\n\t\t\t_buildComponents() {\n\t\t\t\tconst t = this,\n\t\t\t\t\te = this.options.components,\n\t\t\t\t\to = (t.options.sliders || \"v\").repeat(2),\n\t\t\t\t\t[n, i] = o.match(/^[vh]+$/g) ? o : [],\n\t\t\t\t\tr = () => this._color || (this._color = this._lastColor.clone()),\n\t\t\t\t\ts = {\n\t\t\t\t\t\tpalette: $({\n\t\t\t\t\t\t\telement: t._root.palette.picker,\n\t\t\t\t\t\t\twrapper: t._root.palette.palette,\n\t\t\t\t\t\t\tonstop: () => t._emit(\"changestop\", \"slider\", t),\n\t\t\t\t\t\t\tonchange(o, n) {\n\t\t\t\t\t\t\t\tif (!e.palette) return;\n\t\t\t\t\t\t\t\tconst i = r(),\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t_root: s,\n\t\t\t\t\t\t\t\t\t\toptions: a\n\t\t\t\t\t\t\t\t\t} = t,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlastColor: l,\n\t\t\t\t\t\t\t\t\t\tcurrentColor: c\n\t\t\t\t\t\t\t\t\t} = s.preview;\n\t\t\t\t\t\t\t\tt._recalc && (i.s = 100 * o, i.v = 100 - 100 * n, i.v < 0 && (i.v = 0), t._updateOutput(\"slider\"));\n\t\t\t\t\t\t\t\tconst p = i.toRGBA().toString(0);\n\t\t\t\t\t\t\t\tthis.element.style.background = p, this.wrapper.style.background = `\\n                        linear-gradient(to top, rgba(0, 0, 0, ${i.a}), transparent),\\n                        linear-gradient(to left, hsla(${i.h}, 100%, 50%, ${i.a}), rgba(255, 255, 255, ${i.a}))\\n                    `, a.comparison ? a.useAsButton || t._lastColor || (l.style.color = p) : (s.button.style.color = p, s.button.classList.remove(\"clear\"));\n\t\t\t\t\t\t\t\tconst u = i.toHEXA().toString();\n\t\t\t\t\t\t\t\tfor (const {\n\t\t\t\t\t\t\t\t\t\tel: e,\n\t\t\t\t\t\t\t\t\t\tcolor: o\n\t\t\t\t\t\t\t\t\t} of t._swatchColors) e.classList[u === o.toHEXA().toString() ? \"add\" : \"remove\"](\"pcr-active\");\n\t\t\t\t\t\t\t\tc.style.color = p\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\thue: $({\n\t\t\t\t\t\t\tlock: \"v\" === i ? \"h\" : \"v\",\n\t\t\t\t\t\t\telement: t._root.hue.picker,\n\t\t\t\t\t\t\twrapper: t._root.hue.slider,\n\t\t\t\t\t\t\tonstop: () => t._emit(\"changestop\", \"slider\", t),\n\t\t\t\t\t\t\tonchange(o) {\n\t\t\t\t\t\t\t\tif (!e.hue || !e.palette) return;\n\t\t\t\t\t\t\t\tconst n = r();\n\t\t\t\t\t\t\t\tt._recalc && (n.h = 360 * o), this.element.style.backgroundColor = `hsl(${n.h}, 100%, 50%)`, s.palette.trigger()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\topacity: $({\n\t\t\t\t\t\t\tlock: \"v\" === n ? \"h\" : \"v\",\n\t\t\t\t\t\t\telement: t._root.opacity.picker,\n\t\t\t\t\t\t\twrapper: t._root.opacity.slider,\n\t\t\t\t\t\t\tonstop: () => t._emit(\"changestop\", \"slider\", t),\n\t\t\t\t\t\t\tonchange(o) {\n\t\t\t\t\t\t\t\tif (!e.opacity || !e.palette) return;\n\t\t\t\t\t\t\t\tconst n = r();\n\t\t\t\t\t\t\t\tt._recalc && (n.a = Math.round(100 * o) / 100), this.element.style.background = `rgba(0, 0, 0, ${n.a})`, s.palette.trigger()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tselectable: S({\n\t\t\t\t\t\t\telements: t._root.interaction.options,\n\t\t\t\t\t\t\tclassName: \"active\",\n\t\t\t\t\t\t\tonchange(e) {\n\t\t\t\t\t\t\t\tt._representation = e.target.getAttribute(\"data-type\").toUpperCase(), t._recalc && t._updateOutput(\"swatch\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t};\n\t\t\t\tthis._components = s\n\t\t\t}\n\t\t\t_bindEvents() {\n\t\t\t\tconst {\n\t\t\t\t\t_root: t,\n\t\t\t\t\toptions: e\n\t\t\t\t} = this, o = [r(t.interaction.clear, \"click\", () => this._clearColor()), r([t.interaction.cancel, t.preview.lastColor], \"click\", () => {\n\t\t\t\t\tthis._emit(\"cancel\"), this.setHSVA(...(this._lastColor || this._color).toHSVA(), !0)\n\t\t\t\t}), r(t.interaction.save, \"click\", () => {\n\t\t\t\t\t!this.applyColor() && !e.showAlways && this.hide()\n\t\t\t\t}), r(t.interaction.result, [\"keyup\", \"input\"], t => {\n\t\t\t\t\tthis.setColor(t.target.value, !0) && !this._initializingActive && (this._emit(\"change\", this._color, \"input\", this), this._emit(\"changestop\", \"input\", this)), t.stopImmediatePropagation()\n\t\t\t\t}), r(t.interaction.result, [\"focus\", \"blur\"], t => {\n\t\t\t\t\tthis._recalc = \"blur\" === t.type, this._recalc && this._updateOutput(null)\n\t\t\t\t}), r([t.palette.palette, t.palette.picker, t.hue.slider, t.hue.picker, t.opacity.slider, t.opacity.picker], [\"mousedown\", \"touchstart\"], () => this._recalc = !0, {\n\t\t\t\t\tpassive: !0\n\t\t\t\t})];\n\t\t\t\tif (!e.showAlways) {\n\t\t\t\t\tconst n = e.closeWithKey;\n\t\t\t\t\to.push(r(t.button, \"click\", () => this.isOpen() ? this.hide() : this.show()), r(document, \"keyup\", t => this.isOpen() && (t.key === n || t.code === n) && this.hide()), r(document, [\"touchstart\", \"mousedown\"], e => {\n\t\t\t\t\t\tthis.isOpen() && !c(e).some(e => e === t.app || e === t.button) && this.hide()\n\t\t\t\t\t}, {\n\t\t\t\t\t\tcapture: !0\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t\tif (e.adjustableNumbers) {\n\t\t\t\t\tconst e = {\n\t\t\t\t\t\trgba: [255, 255, 255, 1],\n\t\t\t\t\t\thsva: [360, 100, 100, 1],\n\t\t\t\t\t\thsla: [360, 100, 100, 1],\n\t\t\t\t\t\tcmyk: [100, 100, 100, 100]\n\t\t\t\t\t};\n\t\t\t\t\tu(t.interaction.result, (t, o, n) => {\n\t\t\t\t\t\tconst i = e[this.getColorRepresentation().toLowerCase()];\n\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\tconst e = i[n],\n\t\t\t\t\t\t\t\tr = t + (e >= 100 ? 1e3 * o : o);\n\t\t\t\t\t\t\treturn r <= 0 ? 0 : Number((r < e ? r : e).toPrecision(3))\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn t\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (e.autoReposition && !e.inline) {\n\t\t\t\t\tlet t = null;\n\t\t\t\t\tconst n = this;\n\t\t\t\t\to.push(r(window, [\"scroll\", \"resize\"], () => {\n\t\t\t\t\t\tn.isOpen() && (e.closeOnScroll && n.hide(), null === t ? (t = setTimeout(() => t = null, 100), requestAnimationFrame((function e() {\n\t\t\t\t\t\t\tn._rePositioningPicker(), null !== t && requestAnimationFrame(e)\n\t\t\t\t\t\t}))) : (clearTimeout(t), t = setTimeout(() => t = null, 100)))\n\t\t\t\t\t}, {\n\t\t\t\t\t\tcapture: !0\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t\tthis._eventBindings = o\n\t\t\t}\n\t\t\t_rePositioningPicker() {\n\t\t\t\tconst {\n\t\t\t\t\toptions: t\n\t\t\t\t} = this;\n\t\t\t\tif (!t.inline) {\n\t\t\t\t\tif (!this._nanopop.update({\n\t\t\t\t\t\t\tcontainer: document.body.getBoundingClientRect(),\n\t\t\t\t\t\t\tposition: t.position\n\t\t\t\t\t\t})) {\n\t\t\t\t\t\tconst t = this._root.app,\n\t\t\t\t\t\t\te = t.getBoundingClientRect();\n\t\t\t\t\t\tt.style.top = (window.innerHeight - e.height) / 2 + \"px\", t.style.left = (window.innerWidth - e.width) / 2 + \"px\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t_updateOutput(t) {\n\t\t\t\tconst {\n\t\t\t\t\t_root: e,\n\t\t\t\t\t_color: o,\n\t\t\t\t\toptions: n\n\t\t\t\t} = this;\n\t\t\t\tif (e.interaction.type()) {\n\t\t\t\t\tconst t = \"to\" + e.interaction.type().getAttribute(\"data-type\");\n\t\t\t\t\te.interaction.result.value = \"function\" == typeof o[t] ? o[t]().toString(n.outputPrecision) : \"\"\n\t\t\t\t}!this._initializingActive && this._recalc && this._emit(\"change\", o, t, this)\n\t\t\t}\n\t\t\t_clearColor(t = !1) {\n\t\t\t\tconst {\n\t\t\t\t\t_root: e,\n\t\t\t\t\toptions: o\n\t\t\t\t} = this;\n\t\t\t\to.useAsButton || (e.button.style.color = \"rgba(0, 0, 0, 0.15)\"), e.button.classList.add(\"clear\"), o.showAlways || this.hide(), this._lastColor = null, this._initializingActive || t || (this._emit(\"save\", null), this._emit(\"clear\"))\n\t\t\t}\n\t\t\t_parseLocalColor(t) {\n\t\t\t\tconst {\n\t\t\t\t\tvalues: e,\n\t\t\t\t\ttype: o,\n\t\t\t\t\ta: n\n\t\t\t\t} = A(t), {\n\t\t\t\t\tlockOpacity: i\n\t\t\t\t} = this.options, r = void 0 !== n && 1 !== n;\n\t\t\t\treturn e && 3 === e.length && (e[3] = void 0), {\n\t\t\t\t\tvalues: !e || i && r ? null : e,\n\t\t\t\t\ttype: o\n\t\t\t\t}\n\t\t\t}\n\t\t\t_t(t) {\n\t\t\t\treturn this.options.i18n[t] || x.I18N_DEFAULTS[t]\n\t\t\t}\n\t\t\t_emit(t, ...e) {\n\t\t\t\tthis._eventListener[t].forEach(t => t(...e, this))\n\t\t\t}\n\t\t\ton(t, e) {\n\t\t\t\treturn this._eventListener[t].push(e), this\n\t\t\t}\n\t\t\toff(t, e) {\n\t\t\t\tconst o = this._eventListener[t] || [],\n\t\t\t\t\tn = o.indexOf(e);\n\t\t\t\treturn ~n && o.splice(n, 1), this\n\t\t\t}\n\t\t\taddSwatch(t) {\n\t\t\t\tconst {\n\t\t\t\t\tvalues: e\n\t\t\t\t} = this._parseLocalColor(t);\n\t\t\t\tif (e) {\n\t\t\t\t\tconst {\n\t\t\t\t\t\t_swatchColors: t,\n\t\t\t\t\t\t_root: o\n\t\t\t\t\t} = this, n = C(...e), i = a(`<button type=\"button\" style=\"color: ${n.toRGBA().toString(0)}\" aria-label=\"${this._t(\"btn:swatch\")}\"/>`);\n\t\t\t\t\treturn o.swatches.appendChild(i), t.push({\n\t\t\t\t\t\tel: i,\n\t\t\t\t\t\tcolor: n\n\t\t\t\t\t}), this._eventBindings.push(r(i, \"click\", () => {\n\t\t\t\t\t\tthis.setHSVA(...n.toHSVA(), !0), this._emit(\"swatchselect\", n), this._emit(\"change\", n, \"swatch\", this)\n\t\t\t\t\t})), !0\n\t\t\t\t}\n\t\t\t\treturn !1\n\t\t\t}\n\t\t\tremoveSwatch(t) {\n\t\t\t\tconst e = this._swatchColors[t];\n\t\t\t\tif (e) {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tel: o\n\t\t\t\t\t} = e;\n\t\t\t\t\treturn this._root.swatches.removeChild(o), this._swatchColors.splice(t, 1), !0\n\t\t\t\t}\n\t\t\t\treturn !1\n\t\t\t}\n\t\t\tapplyColor(t = !1) {\n\t\t\t\tconst {\n\t\t\t\t\tpreview: e,\n\t\t\t\t\tbutton: o\n\t\t\t\t} = this._root, n = this._color.toRGBA().toString(0);\n\t\t\t\treturn e.lastColor.style.color = n, this.options.useAsButton || (o.style.color = n), o.classList.remove(\"clear\"), this._lastColor = this._color.clone(), this._initializingActive || t || this._emit(\"save\", this._color), this\n\t\t\t}\n\t\t\tdestroy() {\n\t\t\t\tcancelAnimationFrame(this._setupAnimationFrame), this._eventBindings.forEach(t => s(...t)), Object.keys(this._components).forEach(t => this._components[t].destroy())\n\t\t\t}\n\t\t\tdestroyAndRemove() {\n\t\t\t\tthis.destroy();\n\t\t\t\tconst {\n\t\t\t\t\troot: t,\n\t\t\t\t\tapp: e\n\t\t\t\t} = this._root;\n\t\t\t\tt.parentElement && t.parentElement.removeChild(t), e.parentElement.removeChild(e), Object.keys(this).forEach(t => this[t] = null)\n\t\t\t}\n\t\t\thide() {\n\t\t\t\treturn this._root.app.classList.remove(\"visible\"), this._emit(\"hide\"), this\n\t\t\t}\n\t\t\tshow() {\n\t\t\t\treturn this.options.disabled || (this._root.app.classList.add(\"visible\"), this._rePositioningPicker(), this._emit(\"show\", this._color)), this\n\t\t\t}\n\t\t\tisOpen() {\n\t\t\t\treturn this._root.app.classList.contains(\"visible\")\n\t\t\t}\n\t\t\tsetHSVA(t = 360, e = 0, o = 0, n = 1, i = !1) {\n\t\t\t\tconst r = this._recalc;\n\t\t\t\tif (this._recalc = !1, t < 0 || t > 360 || e < 0 || e > 100 || o < 0 || o > 100 || n < 0 || n > 1) return !1;\n\t\t\t\tthis._color = C(t, e, o, n);\n\t\t\t\tconst {\n\t\t\t\t\thue: s,\n\t\t\t\t\topacity: a,\n\t\t\t\t\tpalette: l\n\t\t\t\t} = this._components;\n\t\t\t\treturn s.update(t / 360), a.update(n), l.update(e / 100, 1 - o / 100), i || this.applyColor(), r && this._updateOutput(), this._recalc = r, !0\n\t\t\t}\n\t\t\tsetColor(t, e = !1) {\n\t\t\t\tif (null === t) return this._clearColor(e), !0;\n\t\t\t\tconst {\n\t\t\t\t\tvalues: o,\n\t\t\t\t\ttype: n\n\t\t\t\t} = this._parseLocalColor(t);\n\t\t\t\tif (o) {\n\t\t\t\t\tconst t = n.toUpperCase(),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions: i\n\t\t\t\t\t\t} = this._root.interaction,\n\t\t\t\t\t\tr = i.find(e => e.getAttribute(\"data-type\") === t);\n\t\t\t\t\tif (r && !r.hidden)\n\t\t\t\t\t\tfor (const t of i) t.classList[t === r ? \"add\" : \"remove\"](\"active\");\n\t\t\t\t\treturn !!this.setHSVA(...o, e) && this.setColorRepresentation(t)\n\t\t\t\t}\n\t\t\t\treturn !1\n\t\t\t}\n\t\t\tsetColorRepresentation(t) {\n\t\t\t\treturn t = t.toUpperCase(), !!this._root.interaction.options.find(e => e.getAttribute(\"data-type\").startsWith(t) && !e.click())\n\t\t\t}\n\t\t\tgetColorRepresentation() {\n\t\t\t\treturn this._representation\n\t\t\t}\n\t\t\tgetColor() {\n\t\t\t\treturn this._color\n\t\t\t}\n\t\t\tgetSelectedColor() {\n\t\t\t\treturn this._lastColor\n\t\t\t}\n\t\t\tgetRoot() {\n\t\t\t\treturn this._root\n\t\t\t}\n\t\t\tdisable() {\n\t\t\t\treturn this.hide(), this.options.disabled = !0, this._root.button.classList.add(\"disabled\"), this\n\t\t\t}\n\t\t\tenable() {\n\t\t\t\treturn this.options.disabled = !1, this._root.button.classList.remove(\"disabled\"), this\n\t\t\t}\n\t\t}\n\t\tL(x, \"utils\", n), L(x, \"version\", \"1.8.0\"), L(x, \"I18N_DEFAULTS\", {\n\t\t\t\"ui:dialog\": \"color picker dialog\",\n\t\t\t\"btn:toggle\": \"toggle color picker dialog\",\n\t\t\t\"btn:swatch\": \"color swatch\",\n\t\t\t\"btn:last-color\": \"use previous color\",\n\t\t\t\"btn:save\": \"Save\",\n\t\t\t\"btn:cancel\": \"Cancel\",\n\t\t\t\"btn:clear\": \"Clear\",\n\t\t\t\"aria:btn:save\": \"save and close\",\n\t\t\t\"aria:btn:cancel\": \"cancel and close\",\n\t\t\t\"aria:btn:clear\": \"clear and close\",\n\t\t\t\"aria:input\": \"color input field\",\n\t\t\t\"aria:palette\": \"color selection area\",\n\t\t\t\"aria:hue\": \"hue selection slider\",\n\t\t\t\"aria:opacity\": \"selection slider\"\n\t\t}), L(x, \"DEFAULT_OPTIONS\", {\n\t\t\tappClass: null,\n\t\t\ttheme: \"classic\",\n\t\t\tuseAsButton: !1,\n\t\t\tpadding: 8,\n\t\t\tdisabled: !1,\n\t\t\tcomparison: !0,\n\t\t\tcloseOnScroll: !1,\n\t\t\toutputPrecision: 0,\n\t\t\tlockOpacity: !1,\n\t\t\tautoReposition: !0,\n\t\t\tcontainer: \"body\",\n\t\t\tcomponents: {\n\t\t\t\tinteraction: {}\n\t\t\t},\n\t\t\ti18n: {},\n\t\t\tswatches: null,\n\t\t\tinline: !1,\n\t\t\tsliders: null,\n\t\t\tdefault: \"#42445a\",\n\t\t\tdefaultRepresentation: null,\n\t\t\tposition: \"bottom-middle\",\n\t\t\tadjustableNumbers: !0,\n\t\t\tshowAlways: !1,\n\t\t\tcloseWithKey: \"Escape\"\n\t\t}), L(x, \"create\", t => new x(t));\n\t\te.default = x\n\t}]).default\n}));\n//# sourceMappingURL=pickr.min.js.map\n'use strict';\n\n/**\n * Copyright Marc J. Schmidt. See the LICENSE file at the top-level\n * directory of this distribution and at\n * https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n */\n(function (root, factory) {\n    if (typeof define === \"function\" && define.amd) {\n        define(factory);\n    } else if (typeof exports === \"object\") {\n        module.exports = factory();\n    } else {\n        root.ResizeSensor = factory();\n    }\n}(typeof window !== 'undefined' ? window : this, function () {\n\n    // Make sure it does not throw in a SSR (Server Side Rendering) situation\n    if (typeof window === \"undefined\") {\n        return null;\n    }\n    // https://github.com/Semantic-Org/Semantic-UI/issues/3855\n    // https://github.com/marcj/css-element-queries/issues/257\n    var globalWindow = typeof window != 'undefined' && window.Math == Math\n        ? window\n        : typeof self != 'undefined' && self.Math == Math\n            ? self\n            : Function('return this')();\n    // Only used for the dirty checking, so the event callback count is limited to max 1 call per fps per sensor.\n    // In combination with the event based resize sensor this saves cpu time, because the sensor is too fast and\n    // would generate too many unnecessary events.\n    var requestAnimationFrame = globalWindow.requestAnimationFrame ||\n        globalWindow.mozRequestAnimationFrame ||\n        globalWindow.webkitRequestAnimationFrame ||\n        function (fn) {\n            return globalWindow.setTimeout(fn, 20);\n        };\n\n    /**\n     * Iterate over each of the provided element(s).\n     *\n     * @param {HTMLElement|HTMLElement[]} elements\n     * @param {Function}                  callback\n     */\n    function forEachElement(elements, callback){\n        var elementsType = Object.prototype.toString.call(elements);\n        var isCollectionTyped = ('[object Array]' === elementsType\n            || ('[object NodeList]' === elementsType)\n            || ('[object HTMLCollection]' === elementsType)\n            || ('[object Object]' === elementsType)\n            || ('undefined' !== typeof jQuery && elements instanceof jQuery) //jquery\n            || ('undefined' !== typeof Elements && elements instanceof Elements) //mootools\n        );\n        var i = 0, j = elements.length;\n        if (isCollectionTyped) {\n            for (; i < j; i++) {\n                callback(elements[i]);\n            }\n        } else {\n            callback(elements);\n        }\n    }\n\n    /**\n    * Get element size\n    * @param {HTMLElement} element\n    * @returns {Object} {width, height}\n    */\n    function getElementSize(element) {\n        if (!element.getBoundingClientRect) {\n            return {\n                width: element.offsetWidth,\n                height: element.offsetHeight\n            }\n        }\n\n        var rect = element.getBoundingClientRect();\n        return {\n            width: Math.round(rect.width),\n            height: Math.round(rect.height)\n        }\n    }\n\n    /**\n     * Apply CSS styles to element.\n     *\n     * @param {HTMLElement} element\n     * @param {Object} style\n     */\n    function setStyle(element, style) {\n        Object.keys(style).forEach(function(key) {\n            element.style[key] = style[key];\n        });\n    }\n\n    /**\n     * Class for dimension change detection.\n     *\n     * @param {Element|Element[]|Elements|jQuery} element\n     * @param {Function} callback\n     *\n     * @constructor\n     */\n    var ResizeSensor = function(element, callback) {\n        var lastAnimationFrame = 0;\n        \n        /**\n         *\n         * @constructor\n         */\n        function EventQueue() {\n            var q = [];\n            this.add = function(ev) {\n                q.push(ev);\n            };\n\n            var i, j;\n            this.call = function(sizeInfo) {\n                for (i = 0, j = q.length; i < j; i++) {\n                    q[i].call(this, sizeInfo);\n                }\n            };\n\n            this.remove = function(ev) {\n                var newQueue = [];\n                for(i = 0, j = q.length; i < j; i++) {\n                    if(q[i] !== ev) newQueue.push(q[i]);\n                }\n                q = newQueue;\n            };\n\n            this.length = function() {\n                return q.length;\n            }\n        }\n\n        /**\n         *\n         * @param {HTMLElement} element\n         * @param {Function}    resized\n         */\n        function attachResizeEvent(element, resized) {\n            if (!element) return;\n            if (element.resizedAttached) {\n                element.resizedAttached.add(resized);\n                return;\n            }\n\n            element.resizedAttached = new EventQueue();\n            element.resizedAttached.add(resized);\n\n            element.resizeSensor = document.createElement('div');\n            element.resizeSensor.dir = 'ltr';\n            element.resizeSensor.className = 'resize-sensor';\n\n            var style = {\n                pointerEvents: 'none',\n                position: 'absolute',\n                left: '0px',\n                top: '0px',\n                right: '0px',\n                bottom: '0px',\n                overflow: 'hidden',\n                zIndex: '-1',\n                visibility: 'hidden',\n                maxWidth: '100%'\n            };\n            var styleChild = {\n                position: 'absolute',\n                left: '0px',\n                top: '0px',\n                transition: '0s',\n            };\n\n            setStyle(element.resizeSensor, style);\n\n            var expand = document.createElement('div');\n            expand.className = 'resize-sensor-expand';\n            setStyle(expand, style);\n\n            var expandChild = document.createElement('div');\n            setStyle(expandChild, styleChild);\n            expand.appendChild(expandChild);\n\n            var shrink = document.createElement('div');\n            shrink.className = 'resize-sensor-shrink';\n            setStyle(shrink, style);\n\n            var shrinkChild = document.createElement('div');\n            setStyle(shrinkChild, styleChild);\n            setStyle(shrinkChild, { width: '200%', height: '200%' });\n            shrink.appendChild(shrinkChild);\n\n            element.resizeSensor.appendChild(expand);\n            element.resizeSensor.appendChild(shrink);\n            element.appendChild(element.resizeSensor);\n\n            var computedStyle = window.getComputedStyle(element);\n            var position = computedStyle ? computedStyle.getPropertyValue('position') : null;\n            if ('absolute' !== position && 'relative' !== position && 'fixed' !== position && 'sticky' !== position) {\n                element.style.position = 'relative';\n            }\n\n            var dirty, rafId;\n            var size = getElementSize(element);\n            var lastWidth = 0;\n            var lastHeight = 0;\n            var initialHiddenCheck = true;\n            lastAnimationFrame = 0;\n\n            var resetExpandShrink = function () {\n                var width = element.offsetWidth;\n                var height = element.offsetHeight;\n\n                expandChild.style.width = (width + 10) + 'px';\n                expandChild.style.height = (height + 10) + 'px';\n\n                expand.scrollLeft = width + 10;\n                expand.scrollTop = height + 10;\n\n                shrink.scrollLeft = width + 10;\n                shrink.scrollTop = height + 10;\n            };\n\n            var reset = function() {\n                // Check if element is hidden\n                if (initialHiddenCheck) {\n                    var invisible = element.offsetWidth === 0 && element.offsetHeight === 0;\n                    if (invisible) {\n                        // Check in next frame\n                        if (!lastAnimationFrame){\n                            lastAnimationFrame = requestAnimationFrame(function(){\n                                lastAnimationFrame = 0;\n\n                                reset();\n                            });\n                        }\n\n                        return;\n                    } else {\n                        // Stop checking\n                        initialHiddenCheck = false;\n                    }\n                }\n\n                resetExpandShrink();\n            };\n            element.resizeSensor.resetSensor = reset;\n\n            var onResized = function() {\n                rafId = 0;\n\n                if (!dirty) return;\n\n                lastWidth = size.width;\n                lastHeight = size.height;\n\n                if (element.resizedAttached) {\n                    element.resizedAttached.call(size);\n                }\n            };\n\n            var onScroll = function() {\n                size = getElementSize(element);\n                dirty = size.width !== lastWidth || size.height !== lastHeight;\n\n                if (dirty && !rafId) {\n                    onResized();\n                    rafId = requestAnimationFrame(onResized);\n                }\n\n                reset();\n            };\n\n            var addEvent = function(el, name, cb) {\n                if (el.attachEvent) {\n                    el.attachEvent('on' + name, cb);\n                } else {\n                    el.addEventListener(name, cb);\n                }\n            };\n\n            addEvent(expand, 'scroll', onScroll);\n            addEvent(shrink, 'scroll', onScroll);\n\n            // Fix for custom Elements\n            lastAnimationFrame = requestAnimationFrame(reset);\n        }\n\n        forEachElement(element, function(elem){\n            attachResizeEvent(elem, callback);\n        });\n\n        this.detach = function(ev) {\n            // clean up the unfinished animation frame to prevent a potential endless requestAnimationFrame of reset\n            if (!lastAnimationFrame) {\n                window.cancelAnimationFrame(lastAnimationFrame);\n                lastAnimationFrame = 0;\n            }\n            ResizeSensor.detach(element, ev);\n        };\n\n        this.reset = function() {\n            element.resizeSensor.resetSensor();\n        };\n    };\n\n    ResizeSensor.reset = function(element) {\n        forEachElement(element, function(elem){\n            elem.resizeSensor.resetSensor();\n        });\n    };\n\n    ResizeSensor.detach = function(element, ev) {\n        forEachElement(element, function(elem){\n            if (!elem) return;\n            if(elem.resizedAttached && typeof ev === \"function\"){\n                elem.resizedAttached.remove(ev);\n                if(elem.resizedAttached.length()) return;\n            }\n            if (elem.resizeSensor) {\n                if (elem.contains(elem.resizeSensor)) {\n                    elem.removeChild(elem.resizeSensor);\n                }\n                delete elem.resizeSensor;\n                delete elem.resizedAttached;\n            }\n        });\n    };\n\n    if (typeof MutationObserver !== \"undefined\") {\n        var observer = new MutationObserver(function (mutations) {\n            for (var i in mutations) {\n                if (mutations.hasOwnProperty(i)) {\n                    var items = mutations[i].addedNodes;\n                    for (var j = 0; j < items.length; j++) {\n                        if (items[j].resizeSensor) {\n                            ResizeSensor.reset(items[j]);\n                        }\n                    }\n                }\n            }\n        });\n\n        document.addEventListener(\"DOMContentLoaded\", function (event) {\n            observer.observe(document.body, {\n                childList: true,\n                subtree: true,\n            });\n        });\n    }\n\n    return ResizeSensor;\n\n}));\n\n// alg_lib.0.3\n\n/* Array Augmentation. Sorry! */\nArray.prototype.clear = function() {\n\tthis.splice(0, this.length);\n\treturn this;\n}\nArray.prototype.next = function(anchor) {\nvar index;\n\tif(typeof anchor === 'number' && anchor > -1 && anchor < this.length)\n\t\tindex = anchor;\n\telse\n\t\tindex = this.indexOf(anchor);\n\tif(index > -1 && index+1 < this.length)\n\t\treturn this[index+1];\n\telse\n\t\treturn null;\n}\nArray.prototype.prev = function(anchor) {\nvar index;\n\tif(typeof anchor === 'number' && anchor > -1 && anchor < this.length)\n\t\tindex = anchor;\n\telse\n\t\tindex = this.indexOf(anchor);\n\tif(index-1 > -1)\n\t\treturn this[index-1];\n\telse\n\t\treturn null;\n}\nObject.filter = (obj, predicate) => \n    Object.keys(obj)\n          .filter( key => predicate(obj[key]) )\n          .reduce( (res, key) => (res[key] = obj[key], res), {} );\n\nObject.byString = function(o, s) {\n    s = s.replace(/\\[(\\w+)\\]/g, '.$1'); // convert indexes to properties\n    s = s.replace(/^\\./, '');           // strip a leading dot\n    var a = s.split('.');\n    for (var i = 0, n = a.length; i < n; ++i) {\n        var k = a[i];\n        if (o !== undefined && k in o) {\n            o = o[k];\n        } else {\n            return;\n        }\n    }\n    return o;\n}\n\nDOMTokenList.prototype.cycle = function(array) {\nvar classesArray = Array.prototype.slice.call(this);\n\tfor(var i=0; i<array.length; i++) {\n\tvar index = classesArray.indexOf(array[i]);\n\tvar classIndex = i;  \n\t\tif(index > -1) {\n\t\t\tbreak;\n\t\t}\n\t}\n\tif(index > -1) {\n\t\tthis.remove(classesArray[index]);\n\tvar classToAdd = (i >= array.length - 1)?array[0]:array[i+1];\n\t\tthis.add(classToAdd);\n\t\treturn classToAdd;\n\t}\n};\n\n\n\n\n\n/* ------------------------------------------------- */\n\n/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/\n\t\tif(\"document\"in self&&!(\"classList\"in document.createElement(\"_\"))){(function(e){\"use strict\";if(!(\"Element\"in e))return;var t=\"classList\",n=\"prototype\",r=e.Element[n],i=Object,s=String[n].trim||function(){return this.replace(/^\\s+|\\s+$/g,\"\")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++){if(t in this&&this[t]===e){return t}}return-1},u=function(e,t){this.name=e;this.code=DOMException[e];this.message=t},a=function(e,t){if(t===\"\"){throw new u(\"SYNTAX_ERR\",\"An invalid or illegal string was specified\")}if(/\\s/.test(t)){throw new u(\"INVALID_CHARACTER_ERR\",\"String contains an invalid character\")}return o.call(e,t)},f=function(e){var t=s.call(e.getAttribute(\"class\")||\"\"),n=t?t.split(/\\s+/):[],r=0,i=n.length;for(;r<i;r++){this.push(n[r])}this._updateClassName=function(){e.setAttribute(\"class\",this.toString())}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n];l.item=function(e){return this[e]||null};l.contains=function(e){e+=\"\";return a(this,e)!==-1};l.add=function(){var e=arguments,t=0,n=e.length,r,i=false;do{r=e[t]+\"\";if(a(this,r)===-1){this.push(r);i=true}}while(++t<n);if(i){this._updateClassName()}};l.remove=function(){var e=arguments,t=0,n=e.length,r,i=false;do{r=e[t]+\"\";var s=a(this,r);if(s!==-1){this.splice(s,1);i=true}}while(++t<n);if(i){this._updateClassName()}};l.toggle=function(e,t){e+=\"\";var n=this.contains(e),r=n?t!==true&&\"remove\":t!==false&&\"add\";if(r){this[r](e)}return!n};l.toString=function(){return this.join(\" \")};if(i.defineProperty){var h={get:c,enumerable:true,configurable:true};try{i.defineProperty(r,t,h)}catch(p){if(p.number===-2146823252){h.enumerable=false;i.defineProperty(r,t,h)}}}else if(i[n].__defineGetter__){r.__defineGetter__(t,c)}})(self)}\n// From https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys\n\t\tif (!Object.keys) {  Object.keys = (function() {'use strict';var hasOwnProperty = Object.prototype.hasOwnProperty,hasDontEnumBug = !({ toString: null }).propertyIsEnumerable('toString'),dontEnums = [  'toString',  'toLocaleString',  'valueOf',  'hasOwnProperty',  'isPrototypeOf',  'propertyIsEnumerable',  'constructor'],dontEnumsLength = dontEnums.length;return function(obj) {  if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {throw new TypeError('Object.keys called on non-object');  }  var result = [], prop, i;  for (prop in obj) {if (hasOwnProperty.call(obj, prop)) {  result.push(prop);}  }  if (hasDontEnumBug) {for (i = 0; i < dontEnumsLength; i++) {  if (hasOwnProperty.call(obj, dontEnums[i])) {result.push(dontEnums[i]);  }}  }  return result;};  }());}\n/* ------------------------------------------------------------------------------*/\n(function() {\n  /**\n   * Decimal adjustment of a number.\n   *\n   * @param {String}  type  The type of adjustment.\n   * @param {Number}  value The number.\n   * @param {Integer} exp   The exponent (the 10 logarithm of the adjustment base).\n   * @returns {Number} The adjusted value.\n   */\n  function decimalAdjust(type, value, exp) {\n\t// If the exp is undefined or zero...\n\tif (typeof exp === 'undefined' || +exp === 0) {\n\t  return Math[type](value);\n\t}\n\tvalue = +value;\n\texp = +exp;\n\t// If the value is not a number or the exp is not an integer...\n\tif (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {\n\t  return NaN;\n\t}\n\t// Shift\n\tvalue = value.toString().split('e');\n\tvalue = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));\n\t// Shift back\n\tvalue = value.toString().split('e');\n\treturn +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));\n  }\n\n  // Decimal round\n  if (!Math.round10) {\n\tMath.round10 = function(value, exp) {\n\t  return decimalAdjust('round', value, exp);\n\t};\n  }\n  // Decimal floor\n  if (!Math.floor10) {\n\tMath.floor10 = function(value, exp) {\n\t  return decimalAdjust('floor', value, exp);\n\t};\n  }\n  // Decimal ceil\n  if (!Math.ceil10) {\n\tMath.ceil10 = function(value, exp) {\n\t  return decimalAdjust('ceil', value, exp);\n\t};\n  }\n})();\n\n/* ------------------------ */\n\n(function() {\n\n\tDate.shortMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\tDate.longMonths = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n\tDate.shortDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\tDate.longDays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\n\n\t// defining patterns\n\tvar replaceChars = {\n\t\t// Day\n\t\td: function() { return (this.getDate() < 10 ? '0' : '') + this.getDate(); },\n\t\tD: function() { return Date.shortDays[this.getDay()]; },\n\t\tj: function() { return this.getDate(); },\n\t\tl: function() { return Date.longDays[this.getDay()]; },\n\t\tN: function() { return (this.getDay() == 0 ? 7 : this.getDay()); },\n\t\tS: function() { return (this.getDate() % 10 == 1 && this.getDate() != 11 ? 'st' : (this.getDate() % 10 == 2 && this.getDate() != 12 ? 'nd' : (this.getDate() % 10 == 3 && this.getDate() != 13 ? 'rd' : 'th'))); },\n\t\tw: function() { return this.getDay(); },\n\t\tz: function() { var d = new Date(this.getFullYear(),0,1); return Math.ceil((this - d) / 86400000); }, // Fixed now\n\t\t// Week\n\t\tW: function() {\n\t\t\tvar target = new Date(this.valueOf());\n\t\t\tvar dayNr = (this.getDay() + 6) % 7;\n\t\t\ttarget.setDate(target.getDate() - dayNr + 3);\n\t\t\tvar firstThursday = target.valueOf();\n\t\t\ttarget.setMonth(0, 1);\n\t\t\tif (target.getDay() !== 4) {\n\t\t\t\ttarget.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);\n\t\t\t}\n\t\t\treturn 1 + Math.ceil((firstThursday - target) / 604800000);\n\t\t},\n\t\t// Month\n\t\tF: function() { return Date.longMonths[this.getMonth()]; },\n\t\tm: function() { return (this.getMonth() < 9 ? '0' : '') + (this.getMonth() + 1); },\n\t\tM: function() { return Date.shortMonths[this.getMonth()]; },\n\t\tn: function() { return this.getMonth() + 1; },\n\t\tt: function() {\n\t\t\tvar year = this.getFullYear(), nextMonth = this.getMonth() + 1;\n\t\t\tif (nextMonth === 12) {\n\t\t\t\tyear = year++;\n\t\t\t\tnextMonth = 0;\n\t\t\t}\n\t\t\treturn new Date(year, nextMonth, 0).getDate();\n\t\t},\n\t\t// Year\n\t\tL: function() { var year = this.getFullYear(); return (year % 400 == 0 || (year % 100 != 0 && year % 4 == 0)); },   // Fixed now\n\t\to: function() { var d  = new Date(this.valueOf());  d.setDate(d.getDate() - ((this.getDay() + 6) % 7) + 3); return d.getFullYear();}, //Fixed now\n\t\tY: function() { return this.getFullYear(); },\n\t\ty: function() { return ('' + this.getFullYear()).substr(2); },\n\t\t// Time\n\t\ta: function() { return this.getHours() < 12 ? 'am' : 'pm'; },\n\t\tA: function() { return this.getHours() < 12 ? 'AM' : 'PM'; },\n\t\tB: function() { return Math.floor((((this.getUTCHours() + 1) % 24) + this.getUTCMinutes() / 60 + this.getUTCSeconds() / 3600) * 1000 / 24); }, // Fixed now\n\t\tg: function() { return this.getHours() % 12 || 12; },\n\t\tG: function() { return this.getHours(); },\n\t\th: function() { return ((this.getHours() % 12 || 12) < 10 ? '0' : '') + (this.getHours() % 12 || 12); },\n\t\tH: function() { return (this.getHours() < 10 ? '0' : '') + this.getHours(); },\n\t\ti: function() { return (this.getMinutes() < 10 ? '0' : '') + this.getMinutes(); },\n\t\ts: function() { return (this.getSeconds() < 10 ? '0' : '') + this.getSeconds(); },\n\t\tu: function() { var m = this.getMilliseconds(); return (m < 10 ? '00' : (m < 100 ?\n\t'0' : '')) + m; },\n\t\t// Timezone\n\t\te: function() { return /\\((.*)\\)/.exec(new Date().toString())[1]; },\n\t\tI: function() {\n\t\t\tvar DST = null;\n\t\t\t\tfor (var i = 0; i < 12; ++i) {\n\t\t\t\t\t\tvar d = new Date(this.getFullYear(), i, 1);\n\t\t\t\t\t\tvar offset = d.getTimezoneOffset();\n\n\t\t\t\t\t\tif (DST === null) DST = offset;\n\t\t\t\t\t\telse if (offset < DST) { DST = offset; break; }\t\t\t\t\t else if (offset > DST) break;\n\t\t\t\t}\n\t\t\t\treturn (this.getTimezoneOffset() == DST) | 0;\n\t\t\t},\n\t\tO: function() { return (-this.getTimezoneOffset() < 0 ? '-' : '+') + (Math.abs(this.getTimezoneOffset() / 60) < 10 ? '0' : '') + (Math.abs(this.getTimezoneOffset() / 60)) + '00'; },\n\t\tP: function() { return (-this.getTimezoneOffset() < 0 ? '-' : '+') + (Math.abs(this.getTimezoneOffset() / 60) < 10 ? '0' : '') + (Math.abs(this.getTimezoneOffset() / 60)) + ':00'; }, // Fixed now\n\t\tT: function() { return this.toTimeString().replace(/^.+ \\(?([^\\)]+)\\)?$/, '$1'); },\n\t\tZ: function() { return -this.getTimezoneOffset() * 60; },\n\t\t// Full Date/Time\n\t\tc: function() { return this.format(\"Y-m-d\\\\TH:i:sP\"); }, // Fixed now\n\t\tr: function() { return this.toString(); },\n\t\tU: function() { return this.getTime() / 1000; }\n\t};\n\n\t// Simulates PHP's date function\n\tDate.prototype.format = function(format) {\n\t\tvar date = this;\n\t\treturn format.replace(/(\\\\?)(.)/g, function(_, esc, chr) {\n\t\t\treturn (esc === '' && replaceChars[chr]) ? replaceChars[chr].call(date) : chr;\n\t\t});\n\t};\n\n}).call(this);\n\n/* ------------------------------------------------------------------------------*/\n// doT.js\n// 2011, Laura Doktorova, https://github.com/olado/doT\n// Licensed under the MIT license.\n!function(){\"use strict\";var u,d={name:\"doT\",version:\"1.1.1\",templateSettings:{evaluate:/\\(\\(([\\s\\S]+?(\\)\\)?)+)\\)\\)/g,interpolate:/\\(\\(=([\\s\\S]+?)\\)\\)/g,encode:/\\(\\(!([\\s\\S]+?)\\)\\)/g,use:/\\(\\(#([\\s\\S]+?)\\)\\)/g,useParams:/(^|[^\\w$])def(?:\\.|\\[[\\'\\\"])([\\w$\\.]+)(?:[\\'\\\"]\\])?\\s*\\:\\s*([\\w$\\.]+|\\\"[^\\\"]+\\\"|\\'[^\\']+\\'|\\{[^\\)\\)]+\\)\\))/g,define:/\\(\\(##\\s*([\\w\\.$]+)\\s*(\\:|=)([\\s\\S]+?)#\\)\\)/g,defineParams:/^\\s*([\\w$]+):([\\s\\S]+)/,conditional:/\\(\\(\\?(\\?)?\\s*([\\s\\S]*?)\\s*\\)\\)/g,iterate:/\\(\\(~\\s*(?:\\)\\)|([\\s\\S]+?)\\s*\\:\\s*([\\w$]+)\\s*(?:\\:\\s*([\\w$]+))?\\s*\\)\\))/g,varname:\"it\",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,log:!0};d.encodeHTMLSource=function(e){var n={\"&\":\"&#38;\",\"<\":\"&#60;\",\">\":\"&#62;\",'\"':\"&#34;\",\"'\":\"&#39;\",\"/\":\"&#47;\"},t=e?/[&<>\"'\\/]/g:/&(?!#?\\w+;)|<|>|\"|'|\\//g;return function(e){return e?e.toString().replace(t,function(e){return n[e]||e}):\"\"}},u=function(){return this||(0,eval)(\"this\")}(),\"undefined\"!=typeof module&&module.exports?module.exports=d:\"function\"==typeof define&&define.amd?define(function(){return d}):u.doT=d;var s={append:{start:\"'+(\",end:\")+'\",startencode:\"'+encodeHTML(\"},split:{start:\"';out+=(\",end:\");out+='\",startencode:\"';out+=encodeHTML(\"}},p=/$^/;function l(e){return e.replace(/\\\\('|\\\\)/g,\"$1\").replace(/[\\r\\t\\n]/g,\" \")}d.template=function(e,n,t){var r,o,a=(n=n||d.templateSettings).append?s.append:s.split,c=0,i=n.use||n.define?function r(o,e,a){return(\"string\"==typeof e?e:e.toString()).replace(o.define||p,function(e,r,n,t){return 0===r.indexOf(\"def.\")&&(r=r.substring(4)),r in a||(\":\"===n?(o.defineParams&&t.replace(o.defineParams,function(e,n,t){a[r]={arg:n,text:t}}),r in a||(a[r]=t)):new Function(\"def\",\"def['\"+r+\"']=\"+t)(a)),\"\"}).replace(o.use||p,function(e,n){o.useParams&&(n=n.replace(o.useParams,function(e,n,t,r){if(a[t]&&a[t].arg&&r){var o=(t+\":\"+r).replace(/'|\\\\/g,\"_\");return a.__exp=a.__exp||{},a.__exp[o]=a[t].text.replace(new RegExp(\"(^|[^\\\\w$])\"+a[t].arg+\"([^\\\\w$])\",\"g\"),\"$1\"+r+\"$2\"),n+\"def.__exp['\"+o+\"']\"}}));var t=new Function(\"def\",\"return \"+n)(a);return t?r(o,t,a):t})}(n,e,t||{}):e;i=(\"var out='\"+(n.strip?i.replace(/(^|\\r|\\n)\\t* +| +\\t*(\\r|\\n|$)/g,\" \").replace(/\\r|\\n|\\t|\\/\\*[\\s\\S]*?\\*\\//g,\"\"):i).replace(/'|\\\\/g,\"\\\\$&\").replace(n.interpolate||p,function(e,n){return a.start+l(n)+a.end}).replace(n.encode||p,function(e,n){return r=!0,a.startencode+l(n)+a.end}).replace(n.conditional||p,function(e,n,t){return n?t?\"';}else if(\"+l(t)+\"){out+='\":\"';}else{out+='\":t?\"';if(\"+l(t)+\"){out+='\":\"';}out+='\"}).replace(n.iterate||p,function(e,n,t,r){return n?(c+=1,o=r||\"i\"+c,n=l(n),\"';var arr\"+c+\"=\"+n+\";if(arr\"+c+\"){var \"+t+\",\"+o+\"=-1,l\"+c+\"=arr\"+c+\".length-1;while(\"+o+\"<l\"+c+\"){\"+t+\"=arr\"+c+\"[\"+o+\"+=1];out+='\"):\"';} } out+='\"}).replace(n.evaluate||p,function(e,n){return\"';\"+l(n)+\"out+='\"})+\"';return out;\").replace(/\\n/g,\"\\\\n\").replace(/\\t/g,\"\\\\t\").replace(/\\r/g,\"\\\\r\").replace(/(\\s|;|\\)\\)|^|\\{)out\\+='';/g,\"$1\").replace(/\\+''/g,\"\"),r&&(n.selfcontained||!u||u._encodeHTML||(u._encodeHTML=d.encodeHTMLSource(n.doNotSkipEncoded)),i=\"var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : (\"+d.encodeHTMLSource.toString()+\"(\"+(n.doNotSkipEncoded||\"\")+\"));\"+i);try{return new Function(n.varname,i)}catch(e){throw\"undefined\"!=typeof console&&console.log(\"Could not create a template function: \"+i),e}},d.compile=function(e,n){return d.template(e,null,n)}}();\n/* ------------------------------------------------------------------------------*/\nvar get = document.getElementById.bind(document);\nvar crelm = function(name) {\n\tif(!name) name = 'div';\n\treturn document.createElement.call(document,name);\n}\nvar qs = document.querySelector.bind(document); \nvar qsa = document.querySelectorAll.bind(document); \n\nfunction utfBtoa(str) {\n\treturn window.btoa(unescape(encodeURIComponent(str)));\n}\n\nfunction utfAtob(str) {\n\treturn decodeURIComponent(escape(window.atob(str)));\n}\n\n/* -------------- FOREACH for NodeArrays -------------- */\n\n['forEach', 'map', 'filter', 'reduce', 'reduceRight', 'every', 'some', 'indexOf', 'slice'].forEach(\n\tfunction(p) {\n\tNodeList.prototype[p] = HTMLCollection.prototype[p] = Array.prototype[p];\n});\n\nHTMLElement.prototype.reverseChildren = function reverseChildren() {\nvar elements = this.children.slice();\n\tfor(var i = elements.length-1; i >= 0; i--) {\n\t\tthis.appendChild(elements[i]);\n\t}\n}\n\nNodeList.prototype.getStructs = HTMLCollection.prototype.getStructs = function getStructs(){\n\treturn this.reduce((keep, item) => item._struct?keep.concat(item._struct):keep, []);\n}\n\n/* -------------- -------------------- -------------- */\n\n\n/**\n*** Object.appendChain(@object, @prototype)\n*\n* Appends the first non-native prototype of a chain to a new prototype.\n* Returns @object (if it was a primitive value it will transformed into an object).\n*\n*** Object.appendChain(@object [, \"@arg_name_1\", \"@arg_name_2\", \"@arg_name_3\", \"...\"], \"@function_body\")\n*** Object.appendChain(@object [, \"@arg_name_1, @arg_name_2, @arg_name_3, ...\"], \"@function_body\")\n*\n* Appends the first non-native prototype of a chain to the native Function.prototype object, then appends a\n* new Function([\"@arg\"(s)], \"@function_body\") to that chain.\n* Returns the function.\n*\n**/\n\nObject.appendChain = function(oChain, oProto) {\n  if (arguments.length < 2) { \n    throw new TypeError('Object.appendChain - Not enough arguments');\n  }\n  if (typeof oProto !== 'object' && typeof oProto !== 'string') {\n    throw new TypeError('second argument to Object.appendChain must be an object or a string');\n  }\n\n  var oNewProto = oProto,\n      oReturn = o2nd = oLast = oChain instanceof this ? oChain : new oChain.constructor(oChain);\n\n  for (var o1st = this.getPrototypeOf(o2nd);\n    o1st !== Object.prototype && o1st !== Function.prototype;\n    o1st = this.getPrototypeOf(o2nd)\n  ) {\n    o2nd = o1st;\n  }\n\n  if (oProto.constructor === String) {\n    oNewProto = Function.prototype;\n    oReturn = Function.apply(null, Array.prototype.slice.call(arguments, 1));\n    this.setPrototypeOf(oReturn, oLast);\n  }\n\n  this.setPrototypeOf(o2nd, oNewProto);\n  return oReturn;\n}\n\n\nvar alg = {};\n\nalg._deboogs = [];\n\nalg.deboog = function(type){\n\nvar elem;\nvar html = '';\n\tfor(var i=1;i<arguments.length;i++) {\n\t\tif(typeof arguments[i] != 'undefined') {\n\t\t\tif(arguments[i].constructor === Object) {\n\t\t\t\tfor(var key in arguments[i]) {\n\t\t\t\t\thtml += '<div>' + key + ': ' + arguments[i][key] + '</div>';\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\thtml += '<div>' + arguments[i].toString() + '</div>';\n\t\t\t}\n\t\t}else{\n\t\t\thtml += '<div>undefined</div>';\n\t\t}\n\t}\n\telem = document.createElement('div');\n\telem.innerHTML = html;\n\telem.className = type+' deboog-unit';\nvar dboog = document.getElementById('deboog');\n\tdboog.insertBefore(elem,dboog.firstElementChild);\n\talg._deboogs.push(setTimeout(function(){\n\tvar elm = elem;\n\t\telm.classList.add('fade');\n\t\tsetTimeout(function(){\n\t\t\tdiscardElement(elm);\n\t\t},600)\n\t},7000));\nvar deboogid = alg._deboogs.length-1;\n\telem.onmousedown = function(event){\n\tvar dbgid = deboogid;\n\tvar elm = elem;\n\t\tif(elm.classList.contains('pin') == false) {\n\t\t\tclearTimeout(alg._deboogs[dbgid]);\n\t\t\telm.classList.add('pin');\n\t\t}else{\n\t\t\telm.classList.add('fade');\n\t\t\telm.classList.remove('pin');\n\t\t\tsetTimeout(function(){\n\t\t\t\tdiscardElement(elm);\n\t\t\t},600)\n\t\t}\n\t}\n}\n\nalg.sizeToText = function(fileSizeInBytes) {\n\tif(isNaN(fileSizeInBytes)) return '<...>'\n\tif(fileSizeInBytes < 1024) return fileSizeInBytes + ' bytes';\n\tvar i = -1;\n\tvar byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];\n\tdo {\n\t\tfileSizeInBytes = fileSizeInBytes / 1024;\n\t\ti++;\n\t} while (fileSizeInBytes > 1024);\n\n\treturn Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];\n}\n\t\nalg.createBin = function() {\n\tif (typeof(alg._garbageBin) === 'undefined'){\n\t\talg._garbageBin = document.createElement('div');\n\t\talg._garbageBin.style.display = 'none';\n\t\tdocument.body.appendChild(alg._garbageBin);\n\t}\n}\n\nalg.discardElement = function(element) {\n\talg._garbageBin.appendChild(element);\n\talg._garbageBin.innerHTML = \"\";\n}\n\nalg.locompare = function(a, b) {\n\treturn a['name'].localeCompare(b['name']);\n}\n\nalg.contentSort = function(property, sortOrder, sub) {\n\treturn function (a,b) {\n\t\tif(sub){\n\t\t\ta = a[sub];\n\t\t\tb = b[sub];\n\t\t}\n\t\tif(typeof a[property] == 'string' && typeof b[property] == 'string') {\n\t\tvar result = a[property].localeCompare(b[property]);\n\t\t\treturn result * sortOrder;\n\t\t}else{\n\t\t\tif(!isNaN(a[property]) && !isNaN(b[property])) {\n\t\t\tvar result = (a[property] > b[property])? 1 : (a[property] == b[property])? 0 : -1 ;\n\t\t\t\treturn result * sortOrder;\n\t\t\t}\n\t\t}\n\t}\n}\n\nalg.selectAll = function(element) {\n\tvar text = element, range, selection;\t\n\tif (document.body.createTextRange) {\n\t\trange = document.body.createTextRange();\n\t\trange.moveToElementText(text);\n\t\trange.select();\n\t} else if (window.getSelection) {\n\t\tselection = window.getSelection();\t\t\n\t\trange = document.createRange();\n\t\trange.selectNodeContents(text);\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\t}\n}\n\n/* ------------------------------------------------------------------------------*/\nalg.traverseUp = function(elem,classname,max,exclude){\nvar i;\n\tif(typeof max == 'undefined') max = 10;\n\texclude === undefined?'lelell':exclude;\n\tif(typeof elem === 'string') {\n\t\telem = document.getElementById(elem);\n\t}\n\tfor(i=0;i<max;i++){\n\t\tif(elem.classList.contains(exclude) || elem.tagName == 'HTML') return null;\n\t\tif(elem.classList.contains(classname)){\n\t\t\treturn elem;\n\t\t}else{\n\t\t\ttry{\n\t\t\t\telem = elem.parentNode;\n\t\t\t\tif(typeof elem === undefined || elem == null) return null;\n\t\t\t}catch(e){\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t}\n\treturn null;\n}\n\nalg.textToElement = function(string) {\nvar elem = document.createElement('div');\n\telem.innerHTML = string;\n\telem = elem.firstElementChild;\n\treturn elem;\n}\n\n\n/* ------------------------------------------------------------------------------*/\nObject.deepExtend = function(dst, src) {\n  for (var prop in src) {\n\tif (src[prop] && src[prop].constructor && src[prop].constructor === Object) {\n\t  dst[prop] = dst[prop] || {};\n\t  arguments.callee(dst[prop], src[prop]);\n\t} else {\n\t\tif(src[prop] == null) {\n\t\t\tdelete dst[prop];\n\t\t}else{\n\t\t\tdst[prop] = src[prop];\n\t\t}\n\t}\n  }\n  return dst;\n/*  \tvar key;\n\t//for(key in src) if(src.hasOwnProperty(key)) dst[key] = src[key];\n\tfor(key in src) if(src.hasOwnProperty(key)){\n\t\tif(typeof src[key] === 'object') dst[key] = arguments.callee({}, src[key]);\n\t\telse dst[key] = src[key];\n\t}\n\treturn dst;*/\n};\n/* ------------------------------------------------------------------------------*/\n\nfunction Sorter(searchbox,datapairs,template,selected){\n\tthis.searchbox = searchbox;\n\tthis.datapairs = datapairs;\n\tthis.template = template;\n\tthis.selected = selected;\n\tthis.searchbox.oninput = this.sort.bind(this);\n\tthis.searchbox.onkeyup = this.clearHandler.bind(this);\nvar i;\n\tfor(i=0;i<this.datapairs.length;i++){\n\t\tthis.datapairs[i].data = CP.dat.sort(this.datapairs[i].data);\n\t\tthis.datapairs[i].elem = (typeof(this.datapairs[i].elem) == 'string')?$(this.datapairs[i].elem):this.datapairs[i].elem;\n\t}\n}\n\nSorter.prototype.sort = function(){\nvar i, j, key;\nvar outlist = [];\nvar html = '';\nvar value = this.searchbox.value.toLowerCase();\n\tfor(i=0;i<this.datapairs.length;i++){\n\t\toutlist = [];\n\t\tfor(j=0;j<this.datapairs[i].data.length;j++){\n\t\t\tif(this.datapairs[i].data[j].name.toLowerCase().indexOf(value) > -1) {\n\t\t\t\toutlist.push(this.datapairs[i].data[j]);\n\t\t\t}\n\t\t}\n\t\thtml = this.template({data:outlist,selected:this.selected});\n\t\tthis.datapairs[i].elem.innerHTML = html;\n\t}\n}\n\nSorter.prototype.clearHandler = function(event){\n\tif(event.keyCode == 27 && event.target.value.length > 0) {\n\t\tthis.clear();\n\t\tthis.sort();\n\t}\n}\n\nSorter.prototype.clear = function(){\n\tthis.searchbox.value = '';\n\tthis.sort();\n}\n\nfunction Loader(){\nvar elem = document.createElement('div');\n\telem.className = 'loader';\n\tthis.elem = elem;\n}\n\nLoader.prototype.destroy = function(){\n\tdiscardElement(this.elem);\n}\n\nLoader.prototype.responded = function(){\n\tthis.elem.classList.add('loader-back');\nvar self = this;\n\tsetTimeout(function(){\n\t\tself.destroy();\n\t},1000)\n}\n\nLoader.prototype.insert = function(elem,type){\n\tif(type){\n\t\t$(elem).appendChild(this.elem);\n\t}else{\n\t\t$(elem).insertBefore(this.elem,$(elem).firstElementChild);\n\t}\n}\n\nalg.tabSwitch = function(elems,idx,classname,inverted){\n\t\tinverted = inverted === undefined?false:inverted;\n\t\tfor(var i=0;i<elems.length;i++) {\n\t\t\tif(inverted) {\n\t\t\t\telems[i].classList.add(classname);\n\t\t\t}else{\n\t\t\t\telems[i].classList.remove(classname);\n\t\t\t}\n\t\t}\n\t\tif(idx == -1) {\n\t\t\treturn;\n\t\t}else{\n\t\t\tif(inverted){\n\t\t\t\tif(isNaN(idx)) {\n\t\t\t\t\tidx.classList.remove(classname); //consider idx is a node\n\t\t\t\t}else{\n\t\t\t\t\tif(idx > elems.length - 1) return false;\n\t\t\t\t\telems[idx].classList.remove(classname); \n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif(isNaN(idx)) {\n\t\t\t\t\tidx.classList.add(classname); //consider idx is a node\n\t\t\t\t}else{\n\t\t\t\t\tif(idx > elems.length - 1) return false;\n\t\t\t\t\telems[idx].classList.add(classname); \n\t\t\t\t}\n\t\t\t}\n\t\t}\n}\n\nvar ajax = {\n\tcreateRequest: function(){\n\t\tvar request = false;\n\t\tif (window.XMLHttpRequest){\n\t\t\trequest = new XMLHttpRequest();\n\t\t}else\n\t\tif (window.ActiveXObject){\n\t\t\ttry{\n\t\t\t\t request = new ActiveXObject(\"Microsoft.XMLHTTP\");\n\t\t\t}\n\t\t\tcatch (CatchException){\n\t\t\t\t request = new ActiveXObject(\"Msxml2.XMLHTTP\");\n\t\t\t}\n\t\t}\n\t\tif (!request) alert(\"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f. \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u0441\u0435\u0440\u0432\u0435\u0440 \u043d\u0435 \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u0438\u043b\u0438 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0418\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u043e\u043c \u043f\u0440\u0435\u0440\u0432\u0430\u043d\u043e.\");\n\t\treturn request;\n\t},\n\tsend: function(endpoint, args, callbacks){\n\t\tvar r_method = 'post';\n\t\tvar r_path = endpoint;\n\t\t/*var r_args = '?';\n\t\tfor (var key in args) {\n\t\t\tr_args += '&'+key+'='+(typeof args[key] == 'object')?JSON.stringify(args[key]):args[key];\n\t\t}*/\n\t\tvar r_args = JSON.stringify(args);\n\t\tvar Request = ajax.createRequest();\n\t\tif (!Request) return;\n\t\t\n\n\t\tRequest.onreadystatechange = function(){\n\t\t\tif (Request.readyState == 4){\n\t\t\t\tif (Request.status == 200){\n\t\t\t\t\tvar parsed;\n\t\t\t\t\tif(parsed = isJSON(Request.response))\n\t\t\t\t\t\tvar result = parsed;\n\t\t\t\t\telse\n\t\t\t\t\t\tresult = {\n\t\t\t\t\t\t\terrno: -1,\n\t\t\t\t\t\t\tmessage: Request.response\n\t\t\t\t\t\t}\n\t\t\t\t\tif(isList(callbacks)) {\n\t\t\t\t\t\tfor(var i=0; i < callbacks.length; i++) {\n\t\t\t\t\t\t\tcallbacks[i](result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\tcallbacks(result);\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (r_method.toLowerCase() == \"get\" && r_args.length > 0) r_path += r_args;\n\t\t\n\t\tRequest.open(r_method, r_path, true);\n\t\t\n\t\tif (r_method.toLowerCase() == \"post\"){\n\t\t\tRequest.setRequestHeader(\"Content-Type\",\"application/json; charset=utf-8\");\n\t\t\tRequest.send(r_args);\n\t\t\t/*alg.deboog('out','rS:', args);\n\t\t\tRequest.loader = new Loader();\n\t\t\tRequest.loader.insert('loader-cont');*/\n\t\t}\n\t\telse{\n\t\t\tRequest.send(null);\n\t\t}\n\t}\n}\n\n/* AJAX 2.0. WITH PROMEEZEZ */\n\nfunction Request(opts) {\n  return new Promise(function (resolve, reject) {\n\t\t\t\t\topts.method = 'POST';\n\tvar xhr = new XMLHttpRequest();\n\txhr.onload = function () {\n\t  if (this.status >= 200 && this.status < 300) {\n\t\tif(opts.method == 'POST') {\n\t\t\tresolve(JSON.parse(xhr.response));\n\t\t} else {\n\t\t\tresolve(xhr.response);\n\t\t}\n\t\treject(xhr.response);\n\t  }else{\n\t\tif(xhr.response.indexOf('nginx') > -1)\n\t\t\treject({code:0});\n\t\telse \n\t\t\treject(JSON.parse(xhr.response));\n\t  }\n\t};\n\txhr.onerror = function () {\n\t  reject(xhr.response);\n\t};\n\txhr.open(opts.method, opts.url);\n\tif (opts.headers) {\n\t  Object.keys(opts.headers).forEach(function (key) {\n\t\txhr.setRequestHeader(key, opts.headers[key]);\n\t  });\n\t}\n\tvar data = opts.data;\n\t// We'll need to stringify if we've been given an object\n\t// If we have a string, this is skipped.\n\tif(opts.method == 'POST'){\n\t\txhr.setRequestHeader('Content-Type', 'application/json; charset=utf-8');\n\t\txhr.send(JSON.stringify(data));\n\t\treturn;\n\t} \n\tif (data && typeof data === 'object') {\n\t  data = Object.keys(data).map(function (key) {\n\t\treturn encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\n\t  }).join('&');\n\t}\n\txhr.send(data);\n  });\n}\n\n\n\nfunction inherit(Child, Parent) {\n\tChild.prototype = Object.create(Parent.prototype);\n\tChild.prototype.constructor = Parent;\n}\nfunction extend(Child, Parent) {\n\tfor(var prop in Parent.prototype) {\n\t\tChild.prototype[prop] = Parent.prototype[prop];\n\t}\n\tChild.prototype.constructor = Parent;\n}\nfunction proto(Child, newProto) {\n\tfor(var prop in newProto) {\n\t\tif(newProto.hasOwnProperty(prop)) {\n\t\t\tChild.prototype[prop] = newProto[prop];\n\t\t}\n\t}\n}\n\nfunction inheprot(Child, Parent, newProto) {\n\tinherit(Child, Parent);\n\tproto(Child, newProto);\n}\n\nfunction exteprot(Child, Parent, newProto) {\n\textend(Child, Parent);\n\tproto(Child, newProto);\n}\n\nfunction is(what) {\n\treturn !(what === undefined || what === null);\n}\nfunction be(who, what) {\n\treturn is(who)?who:(what)?what:{};\n}\n\nfunction merge(obj1, obj2) {\n\tObject.assign(be(obj1), obj2)\n}\n\nfunction mixin(mixin, self, ) {\n\n}\n\nfunction insertAfter(newNode, referenceNode) {\n    return referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\n\nfunction isList(what) {\n\treturn (what instanceof Array || what instanceof NodeList || what instanceof HTMLCollection);\n}\n\nfunction isJSON(str) {\n\ttry {\n\tvar parsed = JSON.parse(str);\n\t} catch (e) {\n\t\treturn false;\n\t}\n\treturn parsed;\n}\n\nvar Path = {\n\tjoin(base, item) {\n\t\treturn base + '/' + item;\n\t},\n\textname(str) {\n\t\tif(!is(str)) return '';\n\t\tif(str.indexOf('.') > 0)\n\t\t\treturn str.split('.').pop().toLowerCase();\n\t\telse\n\t\t\treturn '';\n\t},\n\tbasename(path) {\n\t\treturn path.split('/').pop();\n\t},\n\tdirname(path) {\n\t\tpath = path.split('/');\n\t\tpath.pop();\n\t\treturn path.join(\"/\");\n\t}\n}\n\nfunction getCaret(element) {\n\tvar caretOffset = 0;\n\tvar doc = element.ownerDocument || element.document;\n\tvar win = doc.defaultView || doc.parentWindow;\n\tvar sel;\n\tif (typeof win.getSelection != \"undefined\") {\n\t\tsel = win.getSelection();\n\t\tif (sel.rangeCount > 0) {\n\t\t\tvar range = win.getSelection().getRangeAt(0);\n\t\t\tvar preCaretRange = range.cloneRange();\n\t\t\tpreCaretRange.selectNodeContents(element);\n\t\t\tpreCaretRange.setEnd(range.endContainer, range.endOffset);\n\t\t\tcaretOffset = preCaretRange.toString().length;\n\t\t}\n\t} else if ( (sel = doc.selection) && sel.type != \"Control\") {\n\t\tvar textRange = sel.createRange();\n\t\tvar preCaretTextRange = doc.body.createTextRange();\n\t\tpreCaretTextRange.moveToElementText(element);\n\t\tpreCaretTextRange.setEndPoint(\"EndToEnd\", textRange);\n\t\tcaretOffset = preCaretTextRange.text.length;\n\t}\n\treturn caretOffset;\n}\n\nfunction setCaret(el, pos) {\n\tvar range = document.createRange();\n\tvar sel = window.getSelection();\n\trange.setStart(el.childNodes[0], pos);\n\trange.collapse(true);\n\tsel.removeAllRanges();\n\tsel.addRange(range);\n}\n\nvar cumulativeOffset = function(element) {\n\tvar top = 0, left = 0;\n\tdo {\n\t\ttop += element.offsetTop  || 0;\n\t\tleft += element.offsetLeft || 0;\n\t\telement = element.offsetParent;\n\t} while(element);\n\n\treturn {\n\t\ttop: top,\n\t\tleft: left\n\t};\n};\n\n// first add raf shim\n// http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\nwindow.requestAnimFrame = (function(){\n  return  window.requestAnimationFrame       ||\n          window.webkitRequestAnimationFrame ||\n          window.mozRequestAnimationFrame    ||\n          function( callback ){\n            window.setTimeout(callback, 1000 / 60);\n          };\n})();\n\n// main function\nfunction scrollToY(element, scrollTargetY, time, easing) {\n    // scrollTargetY: the target scrollY property of the window\n    // speed: time in pixels per second\n    // easing: easing equation to use\n\n    var scrollY = element.scrollTop || window.scrollY || document.documentElement.scrollTop,\n        scrollTargetY = scrollTargetY || 0,\n        speed = speed || 2000,\n        easing = easing || 'easeOutSine',\n        currentTime = 0;\n\n    // min time .1, max time .8 seconds\n\n    // easing equations from https://github.com/danro/easing-js/blob/master/easing.js\n    var easingEquations = {\n            easeOutSine: function (pos) {\n                return Math.sin(pos * (Math.PI / 2));\n            },\n            easeInOutSine: function (pos) {\n                return (-0.5 * (Math.cos(Math.PI * pos) - 1));\n            },\n            easeInOutQuint: function (pos) {\n                if ((pos /= 0.5) < 1) {\n                    return 0.5 * Math.pow(pos, 5);\n                }\n                return 0.5 * (Math.pow((pos - 2), 5) + 2);\n            }\n        };\n\n    // add animation loop\n    function tick() {\n        currentTime += 1 / 60;\n\n        var p = currentTime / time;\n        var t = easingEquations[easing](p);\n\n        if (p < 1) {\n            requestAnimFrame(tick);\n\n            element.scrollTo(0, scrollY + ((scrollTargetY - scrollY) * t));\n        } else {\n            console.log('scroll done');\n            element.scrollTo(0, scrollTargetY);\n        }\n    }\n\n    // call it once to get started\n    tick();\n}\n\n// scroll it!\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['exports'], factory);\n    } else if (typeof exports !== 'undefined') {\n        factory(exports);\n    } else {\n        factory((root.dragscroll = {}));\n    }\n}(this, function (exports) {\n    var _window = window;\n    var _document = document;\n    var mousemove = 'mousemove';\n    var mouseup = 'mouseup';\n    var mousedown = 'mousedown';\n    var EventListener = 'EventListener';\n    var addEventListener = 'add'+EventListener;\n    var removeEventListener = 'remove'+EventListener;\n    var newScrollX, newScrollY;\n\n    var dragged = [];\n    var reset = function(dragged) {\n        dragged = dragged || [];\n        // for (i = 0; i < dragged.length;) {\n        //     el = dragged[i++];\n        //     el = el.container || el;\n        //     el[removeEventListener](mousedown, el.md, 0);\n        //     _window[removeEventListener](mouseup, el.mu, 0);\n        //     _window[removeEventListener](mousemove, el.mm, 0);\n        // }\n\n        // cloning into array since HTMLCollection is updated dynamically\n        for (i = 0; i < dragged.length;) {\n        \tel = dragged[i];\n            (function(el, lastClientX, lastClientY, pushed, scroller, cont){\n                (cont = el.container || el)[addEventListener](\n                    mousedown,\n                    cont.md = function(e) {\n                        // Return if the target (of the mousedown event) or any of it's ancestors cannot be dragged.\n                        // Ideally composedPath() would be used here but it's not supported by IE.\n                        // https://stackoverflow.com/a/39245638\n                        var element = e.target;\n                        var elements = [];\n                        while (element) {\n                            elements.push(element);\n                            element = element.parentNode;\n                        }\n                        for (j = 0; j < elements.length; j++) {\n                          if (typeof elements[j].hasAttribute === 'function' && elements[j].hasAttribute('nodrag')) {\n                            return true;\n                          }\n                        }\n\n                        if (!el.hasAttribute('nochilddrag') || _document.elementFromPoint(e.pageX, e.pageY) == cont) {\n                            pushed = 1;\n                            lastClientX = e.clientX;\n                            lastClientY = e.clientY;\n\n                            e.preventDefault();\n\n\t\t\t                var lst1 = _window[addEventListener](\n\t\t\t                    mousemove,\n\t\t\t                    cont.mm = function(e) {\n\t\t\t                        if (pushed) {\n\t\t\t                            (scroller = el.scroller||el).scrollLeft -=\n\t\t\t                                newScrollX = (- lastClientX + (lastClientX=e.clientX));\n\t\t\t                            scroller.scrollTop -=\n\t\t\t                                newScrollY = (- lastClientY + (lastClientY=e.clientY));\n\t\t\t                            if (el == _document.body) {\n\t\t\t                                (scroller = _document.documentElement).scrollLeft -= newScrollX;\n\t\t\t                                scroller.scrollTop -= newScrollY;\n\t\t\t                            }\n\t\t\t                        }\n\t\t\t                    }, 0\n\t\t\t                );\n\n                            var lst2 = _window[addEventListener](\n\t\t\t                    mouseup, cont.mu = function(e) {\n\t\t\t                        pushed = 0;\n\t\t\t                        _window['removeEventListener']('mousemove',lst1);\n\t\t\t                        _window['removeEventListener']('mouseup',lst2);\n\t\t\t                    }, 0\n\t\t\t                );\n                        }\n                    }, 0\n                );\n\n               \n             })(dragged[i++]);\n        }\n    }\n\n    if (_document.readyState == 'complete') {\n        reset();\n    } else {\n        _window[addEventListener]('load', reset, 0);\n    }\n\n    exports.reset = reset;\n}));\n\nfunction nonEnum(ctx, name, value) {\n\tObject.defineProperty(ctx, name, {\n\t\tenumerable: false,\n\t\twritable: true,\n\t\tvalue: value\n\t})\n}\n\nfunction promiseTimeout(ms, value) {\n\tvar res, rej;\n\tvar p = new Promise(function(resolve, reject) {\n\t\tres = resolve;\n\t\trej = reject;\n\t}).catch(() => {});\n\tp._timeout = setTimeout(function() {\n\t\tres(value);\n\t}, ms);\n\tp.cancel = function(err) {\n\t\tclearTimeout(p._timeout);\n\t\trej(err);\n\t\treturn false;\n\t};\n\treturn p;\n}\n\n/* Hex to RGB pls */\nconst hexToRgb = hex =>\n  hex.replace(/^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i\n             ,(m, r, g, b) => '#' + r + r + g + g + b + b)\n    .substring(1).match(/.{2}/g)\n    .map(x => parseInt(x, 16))\n\nconst colManipulate = (color, amount) => '#' + color.replace(/^#/, '').replace(/../g, color => ('0'+Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));\n\n//Depends on:\n//\talg_lib.0.3\n\nvar DEBUG = false;\nconst OFF = 0;\nconst ON = 1;\nconst TOGGLE = 2;\n\n\nfunction KeyListener(target, mode) {\n\tthis.target = target || document;\n\tthis.listeners = {};\n\tthis.pres = [];\n\tthis.conditions = [];\n\tthis.exclusions = [];\n\tthis.mode = mode || 'keydown';\n\tthis.held = false;\n\tthis.exclusiveness = false;\n\tthis.stopper = false;\n\tthis.passing = false;\n\tif(!this.target._keyListener) {\n\t\tthis.target._keyListener = {};\n\t\tthis.target._keyListener.list = [];\n\t\tthis.target._keyListener.hold = function(forwhat) {\n\t\t\tif(forwhat instanceof Array) {\n\t\t\t\tfor(var i=0;i < this.list.length;i++) {\n\t\t\t\t\tif(forwhat.indexOf(this.list[i]) > -1) continue;\n\t\t\t\t\tthis.list[i].hold();\n\t\t\t\t}\t\n\t\t\t}else{\n\t\t\t\tfor(var i=0;i < this.list.length;i++) {\n\t\t\t\t\tif(this.list[i] == forwhat) continue;\n\t\t\t\t\tthis.list[i].hold();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t}\n\t\tthis.target._keyListener.release = function() {\n\t\t\tfor(var i=0;i < this.list.length;i++) {\n\t\t\t\tthis.list[i].release();\n\t\t\t}\n\t\t}\n\t}\n\tthis.target._keyListener.list.push(this);\n\tthis.handler = e => {\n\tvar keyCode = e.code || e.key;\n\t\tif(this.held) return;\n\t\tif(this.stopper) e.stopPropagation();\n\t\tif(this.conditions.length > 0) {\n\t\t\tfor(var i=0; i<this.conditions.length;i++) {\n\t\t\t\tif(this.conditions[i](e) === false) return;\n\t\t\t}\n\t\t}\n\t\tif(this.pres.length > 0) {\n\t\t\tthis.pres.forEach(item => item(e))\n\t\t}\n\t\tif(this.exclusions.length > 0) {\n\t\t\tif(this.exclusions.indexOf(keyCode) > -1) return;\n\t\t}\n\t\tfor(var id in this.listeners) {\n\t\tvar listener = this.listeners[id];\n\t\tvar listenerKeys = listener.keys.map(key => key.split('+')[1] || key.split('+')[0])\n\t\t\tif(!listener.held\n\t\t\t&& listenerKeys.indexOf(keyCode) > -1) {\n\t\t\tvar keyIndex = listenerKeys.indexOf(keyCode);\n\t\t\t\tif(listener.keys[keyIndex].indexOf('Ctrl') < 0) {\n\t\t\t\t\tif(e.ctrlKey || e.metaKey) continue;\n\t\t\t\t}else{\n\t\t\t\t\tif(!e.ctrlKey && !e.metaKey) continue;\n\t\t\t\t}\n\t\t\t\tif(listener.keys[keyIndex].indexOf('Shift') < 0) {\n\t\t\t\t\tif(e.shiftKey) continue;\n\t\t\t\t}else{\n\t\t\t\t\tif(!e.ctrlKey) continue;\n\t\t\t\t}\n\t\t\t\tif(listener.keys[keyIndex].indexOf('Alt') < 0) {\n\t\t\t\t\tif(e.altKey) continue;\n\t\t\t\t}else{\n\t\t\t\t\tif(!e.altKey) continue;\n\t\t\t\t}\n\t\t\t\tfor(var i=0; i<listener.conditions.length;i++) {\n\t\t\t\t\tif(listener.conditions[i](e) === false) return;\n\t\t\t\t}\n\t\t\t\tif(!this.passing)\n\t\t\t\t\te.preventDefault();\n\t\t\t\tif(this.mode == 'hold') {\n\t\t\t\t\tif(e.type == 'keydown') {\n\t\t\t\t\t\tif(!listener.rafer) {\n\t\t\t\t\t\t\tlistener.rafer = (function() {\n\t\t\t\t\t\t\tthis.RAF = requestAnimationFrame(this.rafer);\n\t\t\t\t\t\t\tthis.callback(e, this.frameCounter);\n\t\t\t\t\t\t\tthis.frameCounter++;\n\t\t\t\t\t\t\t}).bind(listener);\n\t\t\t\t\t\t\tlistener.frameCounter = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(!listener.RAF) listener.RAF = requestAnimationFrame(listener.rafer);\n\t\t\t\t\t}else if(e.type == 'keyup'){\n\t\t\t\t\t\tif(listener.RAF) {\n\t\t\t\t\t\t\tcancelAnimationFrame(listener.RAF);\n\t\t\t\t\t\t\tlistener.RAF = 0;\n\t\t\t\t\t\t\tlistener.frameCounter = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\tif(listener.callback) listener.callback(e);\n\t\t\t\t}\n\t\t\t\tif(listener.exclusiveness) e.stopImmediatePropagation();\n\t\t\t}\n\t\t}\n\t\tif(this.exclusiveness) e.stopImmediatePropagation();\n\t}\n\n\tif(this.mode == 'hold') {\n\t\tthis.target.addEventListener('keydown', this.handler, false);\n\t\tthis.target.addEventListener('keyup', this.handler, false);\n\t}else{\n\t\tthis.target.addEventListener(this.mode, this.handler, false);\n\t}\n}\nKeyListener.prototype = {\n\tpre(f) {\n\t\tif(f) {\n\t\t\tthis.pres.push(f);\n\t\t}\n\t\treturn this;\n\t},\n\tnoPropagation(st) {\n\t\tthis.stopper = st;\n\t\treturn this;\n\t},\n\tcondition(f, listenerID) {\n\t\tif(listenerID) {\n\t\t\tthis.listeners[listenerID].conditions.push(f);\n\t\t\treturn this;\n\t\t}\n\t\tif(f) {\n\t\t\tthis.conditions.push(f);\n\t\t}\n\t\treturn this;\n\t},\n\texclude(f){\n\t\tif(f) {\n\t\t\tif(f instanceof KeyListener) {\n\t\t\t\tfor(var id in f.listeners) {\n\t\t\t\tvar extLst = f.listeners[id];\n\t\t\t\t\tthis.exclude(extLst.keys)\n\t\t\t\t}\n\t\t\t}else if(f instanceof Array){\n\t\t\t\tthis.exclusions.push.apply(this.exclusions, f);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\tsolo(state, listenerIDs) {\n\t\tif(listenerIDs) {\n\t\t\tif(typeof listenerIDs == 'string')\n\t\t\t\tlistenerIDs = [listenerIDs];\n\t\t\tlistenerIDs.forEach(listenerID => {\n\t\t\t\tswitch(state) {\n\t\t\t\t\tcase true:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthis.listeners[listenerID].exclusiveness = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase false:\n\t\t\t\t\t\tthis.listeners[listenerID].exclusiveness = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t}else{\n\t\t\tswitch(state) {\n\t\t\t\tcase true:\n\t\t\t\tdefault:\n\t\t\t\t\tthis.exclusiveness = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tthis.exclusiveness = false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\tattach(id, keys, callback) {\n\t\tthis.listeners[id] = {\n\t\t\tkeys: keys,\n\t\t\tcallback: callback,\n\t\t\tconditions: [],\n\t\t\theld: false\n\t\t};\n\t\treturn this;\n\t},\n\tmirror(source, id) {\n\t\tif(id === true) {\n\t\t\tfor(var id in source.listeners) {\n\t\t\tvar extLst = source.listeners[id];\n\t\t\t\tthis.attach(id, extLst.keys, extLst.callback)\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\tvar extLst = source.listeners[id];\n\t\tif(extLst) {\n\t\t\tthis.attach(id, extLst.keys, extLst.callback);\n\t\t}\n\t\treturn this;\n\t},\n\thold(listenerID) {\n\t\tif(listenerID)\n\t\t\tthis.listeners[listenerID].held = true;\n\t\telse\n\t\t\tthis.held = true;\n\t\treturn this;\n\t},\n\trelease(listenerID) {\n\t\tif(listenerID)\n\t\t\tthis.listeners[listenerID].held = false;\n\t\telse\n\t\t\tthis.held = false;\n\t\treturn this;\n\t},\n\tdetach(id) {\n\tvar listener = this.listeners[id];\n\t\tthis.target.removeEventListener(this.mode, listener.handler);\n\t\tdelete this.listeners[id];\n\t\treturn this;\n\t},\n\tdetachAll() {\n\t\tfor(var id in this.listeners) {\n\t\tvar listener = this.listeners[id];\n\t\t\tthis.target.removeEventListener(this.mode, listener.handler);\n\t\t\tdelete this.listeners[id];\n\t\t}\n\t\treturn this;\n\t},\n\tpass(state) {\n\t\tif(state === undefined) state = true;\n\t\tthis.passing = state;\n\t\treturn this;\n\t}\n};\n\n\n\nfunction UI(o) {\n\t\n\t/*\n\tInitialises an UI element. Creates or inherits a DOM node if specified.\n\to {\n\t\tnode: target dom element or wrapper\n\t\tcallback: callback to execute (typically used on change, returns val)\n\t}\n\t*/\n\n\n\tthis.consume = function consume() {\n\t\tthis._ = {};\n\tvar binds = this.$.querySelectorAll('[data-bind]');\n\t\tbinds.forEach(item => {\n\t\t\tthis._[item.getAttribute('data-bind')] = item;\n\t\t})\n\t\tif(DEBUG)\n\t\t\tif(binds.length > 0)\n\t\t\t\tconsole.log('Binds added: ', Object.keys(this._), ': ', this);\n\t}\n\n\tthis.init = function init(o) {\n\t\to=be(o);\n\t\tthis.me = {\n\t\t\tkind: ['UI'].concat(o.kind || []),\n\t\t\tnode: o.node,\n\t\t\thtml: o.html\n\t\t}\n\t\tif(DEBUG) console.debug('Instancing UI_', this.me.kind, ': ', this);\n\n\t\tthis.$ = this.me.node?this.me.node:this.conjure();\n\t\tthis.$._struct = this;\n\t\tthis.$.classList.add.apply(this.$.classList, this.me.kind);\n\t\tthis.consume();\n\t\treturn o;\n\t}\n\t// Creates an element out of html template.\n\tthis.conjure = function conjure() {\n\t\tif(!this.me.html) {\n\t\t\tthrow 'CANNOT CONJURE: node and HTML is missing.'\n\t\t\treturn false;\n\t\t}\n\t\tif(DEBUG) console.debug('Node was not found. Creating an instance using embedded HTML tempate.')\n\tvar holder = crelm();\n\t\tholder.innerHTML = this.me.html;\n\t\treturn holder.firstElementChild;\n\t}\n\n\tthis.destroy = () => {\n\t\talg.createBin();\n\t\talg.discardElement(this.$);\n\t\tfor(var key in this._) {\n\t\t\tif(this._[key]._struct) this._[key]._struct.destroy();\n\t\t}\n\t\tif(this.S) this.S.destroy();\n\t}\n\n\n\tthis.init(o);\n\n\t//what?\n\tthis.markers = {};\n}\n\nfunction dpraw(fn){\n\tfn._raw = true;\n\treturn fn;\n}\n\nfunction DataPacket(stream, payload, sourceStructure) {\n\tthis.stream = stream;\n\tthis.payload = payload;\n\tthis.source = sourceStructure;\n}\n\nfunction Linkable(o) {\n\to=be(o);\n\tthis.S = {};\n\tthis.S.targets = [];\n\tthis.S.inStreams = {};\n\n\tthis.S.deadEnd = function(data) {console.log('Arrived at the dead end: ', data); return false};\n\n\n\t//Declare allowed input streams and their mappings to internal functions.\n\t//streams: {string: function}\n\tthis.S.mapIn = streams => {\n\t\tfor(let id in streams) {\n\t\t\tthis.S.addIn(id, streams[id], streams[id]._raw);\n\t\t}\n\t\treturn this;\n\t}\n\t/* Example:\n\tthis.S.mapIn({\n\t\tindex: this.logger,\n\t\tnumber: this.adder\n\t})\n\t*/\n\n\tthis.S.addIn = (streamID, func, raw) => {\n\t\tthis.S.inStreams[streamID] = func.bind(this) || this.S.deadEnd;\n\t\tif(raw) this.S.inStreams[streamID]._raw = true;\n\t}\n\n\tthis.S.delIn = streamID => {\n\t\tdelete this.S.inStreams[streamID];\n\t}\n\n\tthis.S.link = targetStructure => {\n\t\tif(!targetStructure.S) {\n\t\t\tthrow 'AlgEx: Target does not have stream support';\n\t\t}\n\t\tthis.S.targets.push(targetStructure);\n\t\treturn this;\n\t}\n\n\tthis.S.biLink = targetStructure => {\n\t\tthis.S.link(targetStructure);\n\t\ttargetStructure.S.link(this);\n\t\treturn this;\n\t}\n\n\tthis.S.linkAnonymous = (streamID, callback) => {\n\t\tif(!streamID)\n\t\t\tthrow('AlgEx: must specify a stream for anonymous mapping.')\n\tvar inObj = {}\n\t\tinObj[streamID] = callback;\n\t\tthis.S.link(new Linkable().S.mapIn(inObj));\n\t\treturn this;\n\t}\n\n\t//{'source_stream_id': 'target_stream_id'}\n\n\t// this.S.linkMapped =  (targetStructure, mapping) => {\n\t// \tif(!targetStructure.S) {\n\t// \t\tthrow 'AlgEx: Target does not have stream support';\n\t// \t}\n\t// \tif(!mapping)\n\t// \t\tthrow 'AlgEx: No mapping supplied for mapped linking: ',this,'->',targetStructure;\n\n\t// \tfor (var sourceStream in mapping) {\n\t// \tvar targetStream = mapping[sourceStream];\n\t// \t\tif(!targetStructure.S.inStreams[targetStream])\n\t// \t\t\tif(DEBUG) console.info('Target structure does not have input stream '+targetStream+' at the moment.')\n\t// \t\tthis.S.outStreams[sourceStream].push(targetStructure);\n\t// \t\tthis.S.outMappings[sourceStream].push(mapping);\n\t// \t}\n\t// \treturn this;\n\t// }\n\n\tthis.S.in = (dataPacket) => {\n\t\tif(!this.S.inStreams[dataPacket.stream]) {\n\t\t\tif(DEBUG) console.debug(dataPacket.stream,'does not exist in',this);\n\t\t\treturn;\n\t\t}\n\t\tif(DEBUG) console.debug(this,': Received',dataPacket,'from',dataPacket.sourceStructure,'on',dataPacket.stream);\n\t\tif(this.S.inStreams[dataPacket.stream]._raw) {\n\t\t\tthis.S.inStreams[dataPacket.stream](dataPacket);\n\t\t}else{\n\t\t\tthis.S.inStreams[dataPacket.stream](dataPacket.payload);\n\t\t}\n\t}\n\n\tthis.S.out = (streamID, data) => {\n\tvar dataPacket = new DataPacket(streamID, data, this)\n\t\tif(DEBUG) console.debug('Sending',dataPacket, 'using stream '+streamID, '...');\n\t\tfor (var i = 0; i < this.S.targets.length; i++) {\n\t\t\tif(!(streamID in this.S.targets[i].S.inStreams)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.S.targets[i].S.in(dataPacket);\n\t\t}\n\t\treturn this.S;\n\t}\n\n\tthis.S.call = (streamID, data, targetStructure) => {\n\t\t//might be inefficient, redo to preserve the dummy\n\t\ttargetStructure = targetStructure || new UI_Dummy();\n\t\tthis.S.in(new DataPacket(streamID, data, targetStructure));\n\t}\n\n\tthis.S.outAsync = (streamID, dataPacket) => {\n\t\tsetTimeout((function() { this.S.out(streamID, dataPacket) }).bind(this), 1);\n\t\treturn this.S;\n\t}\n\n\tthis.S.proxyOut = (streamID, targetStructure) => {\n\t\tthis.S.addIn(streamID, dataPacket => this.S.out(streamID, dataPacket));\n\t\tif(targetStructure) {\n\t\t\ttargetStructure.S.link(this);\n\t\t}\n\t}\n\tthis.S.destroy = () => {\n\t\tthis.S.targets = [];\n\t\tthis.S.inStreams = {};\n\t}\n\n\t//Returns an input function for use in other objects by the stream index or alias.\n\t//This function is a map to an internal function of 'this' object.\n\t/*this.S.in = streamID => {\n\t\treturn this.S.inStreams[streamID].bind(this);\n\t}*/\n\n\t//returns list of all input streams.\n\t/*this.S.getInputs = function(isNamed) {\n\tvar numericalStreams = {};\n\tvar namedStreams = {};\n\t\tfor(var key in this.S.inStreams) {\n\t\t\tif(parseInt(key) > -1)\n\t\t\t\tnumericalStreams[key] = this.S.inStreams[key];\n\t\t\telse\n\t\t\t\tnamedStreams[key] = this.S.inStreams[key];\n\t\t}\n\t\tif(isNamed)\n\t\t\treturn namedStreams;\n\t\telse\n\t\t\treturn numericalStreams;\n\t}*/\n\n\t/*\n\tfor(var key in this.S) {\n\tvar declaration = this.S[key]\n\t\tif(typeof declaration == 'function') {\n\t\t\tthis.S[key] = declaration.bind(this);\n\t\t}\n\t}*/\n}\n\n\nfunction SettingsInterface(setting, setter, getter) {\n\tif(!this.S) Linkable.call(this);\n\tthis.SeI = {};\n\tthis.SeI.setting = setting;\n\tthis.SeI._setter = setter || this.set;\n\tthis.SeI._getter = getter || this.get;\n\n\tthis.SeI.send = (value) => {\n\t\tthis.S.out('settingsPacket',\n\t\t\tnew SettingsPacket(\n\t\t\t\t'set',\n\t\t\t\tthis.SeI.setting.addr,\n\t\t\t\tis(value)?value:this.SeI._getter.call(this),\n\t\t\t\tthis\n\t\t\t)\n\t\t)\n\t}\n\n\tthis.SeI.settingsPacketHandler = settingsPacket => {\n\t\tif(settingsPacket.source == this) return; //reject self-originated settings packets by default\n\t\tif(settingsPacket.setting == this.SeI.setting.addr\n\t\t&& settingsPacket.type == 'change')\n\t\t\tthis.SeI._setter.call(this, settingsPacket.value);\n\t}\n\n\tthis.S.addIn('settingsPacket', this.SeI.settingsPacketHandler);\n}\n\n\nfunction Loadable(o) {\n\tthis.L = {};\n\tthis.$.classList.add('Loadable');\n\n\n\tthis.L.loading = function() {\n\t\tthis.$.classList.add('loading');\n\t};\n\n\tthis.L.loaded = function() {\n\t\tthis.$.classList.remove('loading');\n\t}\n\n\tthis.L.error = function(o) {\n\t\tthis.classList.add('l-'+o.type)\n\t\tif(o.persist) {\n\t\t\tthis.$.classList.add('load-error');\n\t\t}else{\n\t\t\tthis.$.classList.add('load-error');\n\t\t\tsetTimeout(e => {\n\t\t\t\t\tthis.classList.remove('load-error');\n\t\t\t\t\tthis.classList.remove('l-'+o.type);\n\t\t\t\t},\n\t\t\t\to.ms || 500\n\t\t\t)\n\t\t}\n\t}\n}\n\nfunction UI_List(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['List'].concat(o.kind || []),\n\t\thtml: o.html || '<ul></ul>',\n\t});\n\tLinkable.call(this);\n\tthis.childrenConstructor =  o.childrenConstructor || UI_Dummy;\n\tthis.lastAdded = [];\n\n\tfor (var i = 0; i < this.$.children.length; i++) {\n\t\tif(!this.$.children[i]._struct) new this.childrenConstructor({node: this.$.children[i]})\n\t\tthis.S.out('count', this.$.children.length);\n\t}\n\n\tthis.get = function(index) {\n\t\tif (is(index))//errhandle\n\t\t\tif(is(this.$.children[index]))\n\t\t\t\treturn this.$.children[index]._struct\n\t\t\telse {\n\t\t\t\tif(DEBUG) console.warn('Index did not reference an item.')\n\t\t\t\treturn null;\n\t\t\t}\n\t\telse\n\t\t\treturn this.$.children.reduce((keep, item) => keep.concat(item._struct), []);\n\t}\n\n\tthis.add = function(uiInstance) {\n\t\tthis.lastAdded = [];\n\t\tif(!isList(uiInstance)){\n\t\t\tuiInstance = [uiInstance];\n\t\t}\n\t\tuiInstance.forEach(item => {\n\t\t\tthis.$.appendChild(item.$);\n\t\t\tthis.lastAdded.push(item);\n\t\t});\n\t\tthis.S.out('count', this.$.children.length);\n\t\treturn this;\n\t}\n\n\tthis.addMapped = function(map) {\n\t\tthis.lastAdded = [];\n\t\tfor(var id in map) {\n\t\tvar item = map[id];\n\t\t\titem.$.setAttribute('data-list-id', id);\n\t\t\tthis.$.appendChild(item.$);\n\t\t\tthis.lastAdded.push(item);\n\t\t}\n\t\tthis.S.out('count', this.$.children.length);\n\t\treturn this;\n\t}\n\n\tthis.insertAt = function(uiInstance, referenceInstance) {\n\t\t//TD if child of $\n\t\tif(referenceInstance) {\n\t\tvar re = insertAfter(uiInstance.$, referenceInstance.$);\n\t\t\tthis.S.out('count', this.$.children.length);\n\t\t\treturn re;\n\t\t} else {\n\t\t\treturn;\n\t\t} //errhandle\n\t}\n\n\tthis.clear = function() {\n\t\tthis.$.children.slice().map(item => item._struct).forEach(item => {\n\t\t\tif(item) item.destroy();\n\t\t})\n\n\t\tthis.lastAdded = [];\n\t\tthis.S.out('count', this.$.children.length);\n\t\treturn this;\n\t}\n\n\tthis.renderAll = function() {\n\t\tthis.$.children.slice().forEach(item => item._struct.render());\n\t\treturn this;\n\t}\n\n\tthis.consumeAll = function() {\n\t\tthis.add(this.$.children.map(item => item._struct));\n\t\treturn this;\n\t}\n\n\tthis.reverse = function() {\n\t\tthis.$.reverseChildren();\n\t\treturn this;\n\t}\n\n}\n\n\nfunction UI_Dummy(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Dummy'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>'\n\t});\n\tthis.text = o.text;\n\tif(this.$.innerHTML.length < 1) this.$.innerHTML = o.text || '';\n}\n\nfunction UI_Separator(o) {\n\to=be(o);\n\tUI_Dummy.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Separator'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t\ttext: o.text\n\t});\n}\n\n\nfunction UI_Selector(o) {\n\to=be(o);\n\tUI_List.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Selector'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t\tchildrenConstructor: o.childrenConstructor || UI_Dummy\n\t});\n\tthis.singular = o.singular?true:false;\n\tthis.persistent = o.persistent?true:false;\n\tthis.toggleClass = o.toggleClass || 's';\n\tthis.selectedItems = [];\n\tthis.held = o.held || false;\n\tthis.inverse = o.inverse || false;\n\tthis.refire = o.refire || false;\n\tthis.dynamicHide = o.dynamicHide || false;;\n\n\tthis.updateSelected = function()\t{\n\t\tif(this.inverse)\n\t\t\tthis.selectedItems = this.get().reduce((keep, item) => (item && !item.$.classList.contains(this.toggleClass))?keep.concat(item):keep, [])\n\t\telse\n\t\t\tthis.selectedItems = this.get().reduce((keep, item) => (item && item.$.classList.contains(this.toggleClass))?keep.concat(item):keep, [])\n\t\treturn this;\n\t}\n\n\tthis.addOverload = this.add;\n\tthis.add = function(items) {\n\t\tthis.addOverload.apply(this, arguments);\n\t\tif(this.inverse) {\n\t\t\tfor (var i = 0; i < this.lastAdded.length; i++) {\n\t\t\t\tthis.lastAdded[i].$.classList.add(this.toggleClass);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tthis.select = function(what, state, force, silent) {\n\tvar result = this.selectAbstract(what, state, force, silent);\n\t\treturn result;\n\t}\n\n\tthis.selectAbstract = function(what, state, force, silent) {\n\tvar uiInstance;\n\t\tstate = state || true;\n\t\tforce = force || false;\n\t\tsilent = silent || false;\n\t\tif(typeof what == 'number') {\n\t\t\tuiInstance = this.get(what)\n\t\t}else{\n\t\t\tuiInstance = what;\n\t\t}\n\n\t\tif((what == null || what < 0) && this.dynamicHide) {\n\t\t\tthis.$.classList.add('hidden')\n\t\t}else{\n\t\t\tthis.$.classList.remove('hidden')\n\t\t}\n\n\t\tif(uiInstance == undefined) return;\n\n\t\tif(this.inverse) {\n\t\t\tif(this.singular) {\n\t\t\t\tswitch(state) {\n\t\t\t\t\tcase ON:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif(!uiInstance.$.classList.contains(this.toggleClass) && force !== true)\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tthis.selectedItems.forEach(item => item.$.classList.add(this.toggleClass));\n\t\t\t\t\t\tuiInstance.$.classList.remove(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase OFF:\n\t\t\t\t\t\tif(this.selectedItems.length < this.$.children.length && !uiInstance.$.classList.contains(this.toggleClass))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tuiInstance.$.classList.add(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase TOGGLE:\n\t\t\t\t\t\tif(this.selectedItems.length < this.$.children.length && !uiInstance.$.classList.contains(this.toggleClass))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tthis.selectedItems.forEach(item => item.$.classList.add(this.toggleClass));\n\t\t\t\t\t\tuiInstance.$.classList.toggle(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tswitch(state) {\n\t\t\t\t\tcase ON:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tuiInstance.$.classList.remove(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase OFF:\n\t\t\t\t\t\tuiInstance.$.classList.add(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase TOGGLE:\n\t\t\t\t\t\tuiInstance.$.classList.toggle(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.updateSelected()\n\t\t}else{\n\t\t\tif(this.singular) {\n\t\t\t\tswitch(state) {\n\t\t\t\t\tcase ON:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif(uiInstance.$.classList.contains(this.toggleClass) && force !== true)\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tthis.selectedItems.forEach(item => item.$.classList.remove(this.toggleClass));\n\t\t\t\t\t\tuiInstance.$.classList.add(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase OFF:\n\t\t\t\t\t\tif(this.selectedItems.length < 2 && uiInstance.$.classList.contains(this.toggleClass))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tuiInstance.$.classList.remove(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase TOGGLE:\n\t\t\t\t\t\tif(this.selectedItems.length < 2 && uiInstance.$.classList.contains(this.toggleClass))\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\tthis.selectedItems.forEach(item => item.$.classList.remove(this.toggleClass));\n\t\t\t\t\t\tuiInstance.$.classList.toggle(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tswitch(state) {\n\t\t\t\t\tcase ON:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tuiInstance.$.classList.add(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase OFF:\n\t\t\t\t\t\tuiInstance.$.classList.remove(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase TOGGLE:\n\t\t\t\t\t\tuiInstance.$.classList.toggle(this.toggleClass);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.updateSelected()\n\t\t}\n\t\tif(!silent) {\n\t\tthis.S.out('elements', this.selectedItems)\n\t\t\t.out('number', this.$.children.indexOf(uiInstance.$))\n\t\t\t.out('id', uiInstance.$.getAttribute('data-list-id'));\n\t\t}\n\t\treturn this.selectedItems;\n\t}\n\t\n\tthis.handler = (event) => {\n\tvar element;\n\t\tif(this.held) return;\n\t\tif(event.target !== this.$ && this.$.contains(event.target)) {\n\t\t\telement = event.target;\n\t\t\tdo { \n\t\t\t\tif (element.parentNode == this.$) break;\n\t\t\t} while (element = element.parentNode);\n\t\t\t//errhandle if not a struct\n\t\t\tthis.select(element._struct, TOGGLE);\n\t\t}\n\t}\n\t\n\tthis.hold = function(state) {\n\t\tswitch(state) {\n\t\t\tcase ON:\n\t\t\tdefault:\n\t\t\t\tthis.held = true;\n\t\t\t\tbreak;\n\t\t\tcase OFF:\n\t\t\t\tthis.held = false;\n\t\t\t\tbreak;\n\t\t\tcase TOGGLE:\n\t\t\t\tthis.held = !this.held;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tthis.updateSelected();\n\n\tif(this.inverse) {\n\t\tfor(var i=0;i < this.$.children.length;i++){\n\t\t\tif(!this.$.children[i].classList.contains(this.toggleClass)) {\n\t\t\t\tthis.select(this.$.children[i]._struct, ON, true, true);\n\t\t\t\tif(this.singular) break;\n\t\t\t}else{\n\t\t\t\tthis.select(this.$.children[i]._struct, OFF, true, true);\n\t\t\t}\n\t\t}\n\t}else{\n\t\tfor(var i=0;i < this.$.children.length;i++){\n\t\t\tif(this.$.children[i].classList.contains(this.toggleClass)) {\n\t\t\t\tthis.select(this.$.children[i]._struct, ON, true, true);\n\t\t\t\tif(this.singular) break;\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.$.onmousedown = e => this.handler(e);\n\n\treturn this;\n}\n\nfunction UI_ContainerList(o) {\n\to=be(o);\n\tUI_Selector.call(this, Object.assign(o, {\n\t\tkind: ['ContainerList'].concat(o.kind || []),\n\t\ttoggleClass: 'is-hidden',\n\t\theld: true,\n\t\tpersistent: true,\n\t\tsingular: true,\n\t\tinverse: true,\n\t}));\n\t\n\tthis.S.mapIn({\n\t\tnumber: (number) => this.select(number, undefined, true) ,\n\t})\n}\nfunction UI_WindowedContainerList(o) {\n\to=be(o);\n\tUI_ContainerList.call(this, Object.assign(o, {\n\t\tkind: ['WindowedContainerList'].concat(o.kind || []),\n\t}));\n\n\tthis.select(-1);\n\n\tthis.$.onclick = (event) => {\n\t\tif(event.target == this.$) {\n\t\t\tthis.select(-1);\n\t\t}\n\t}\n}\n\nfunction UI_ScrolledContainerList(o) {\n\to=be(o);\n\tUI_ContainerList.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ScrolledContainerList'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t\trefire: true\n\t});\n\n\tthis.scrollSelect = function() {\n\t\twindow.scrollTo({\n\t\t\ttop: this.$.getBoundingClientRect().top + window.scrollY - 200,\n\t\t\tleft: 0,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t\tthis.select.apply(this, arguments);\n\t}\n\n\tthis.S.mapIn({\n\t\tnumber: this.scrollSelect,\n\t})\n}\n\n\nfunction UI_Tabs(o){\n\to=be(o);\n\tUI_Selector.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Tabs'].concat(o.kind || []),\n\t\thtml: o.html || '<i></i>',\n\t\tsingular: true,\n\t\tpersistent: true,\n\t\trefire: true,\n\t\ttoggleClass: 'is-active',\n\t\theld: o.held || false,\n\t\tchildrenConstructor: o.childrenConstructor || UI_Dummy\n\t});\n\n\treturn this;\n}\n\nfunction UI_IndicatorTabs(o) {\n\to=be(o);\n\tUI_Tabs.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['IndicatorTabs'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t\tchildrenConstructor: UI_Tab\n\t})\n}\n\nfunction UI_Tab(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Tab'].concat(o.kind || []),\n\t\thtml: o.html || '<div><span data-bind=\"text\"></span><i data-bind=\"counter\"></i></div>'\n\t})\n\tLinkable.call(this)\n\n\tthis.counter = o.counter;\n\tif(this.counter) {\n\t\tthis._.counter.classList.remove('hidden');\n\t}\n\tthis.counterText = o.counterText || '';\n\n\tthis._.text.innerHTML = o.text;\n\tthis._.counter.innerHTML = this.counterText;\n\n\tthis.update = function(value) {\n\t\tthis._.counter.innerHTML = value;\n\t}\n\n\tthis.S.addIn('count', this.update);\n}\n\nfunction UI_IconTab(o) {\n\to=be(o);\n\tUI_Tab.call(this, Object.assign(o, {\n\t\tkind: ['IconTab'].concat(o.kind || []),\n\t\thtml: o.html || '<div><i class=\"ico-btn\" data-bind=\"icon\"></i><span data-bind=\"text\"></span><i data-bind=\"counter\"></i></div>'\n\t}))\n\tthis.$.setAttribute('data-name', o.text);\n}\n\nfunction UI_Input(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Input'].concat(o.kind || []),\n\t\thtml: o.html || '<input type=\"text\" />',\n\t});\n\n\tif(o.placeholder) this.$.placeholder = o.placeholder;\n\tif(o.type) this.$.type = o.type;\n\n\tthis.handler = function (e) {\n\t\tthis.value = this.$.value;\n\t\tthis.S.out('text', this.value);\n\t}\n\tthis.quickHandler = function (e) {\n\t\tthis.value = this.$.value;\n\t\tthis.S.out('quickText', this.value);\n\t}\n\tthis.clear = function () {\n\t\tthis.set('');\n\t\tthis.S.out('text', this.value);\n\t}\n\tthis.get = () => this.value;\n\tthis.set = function(value) {\n\t\tthis.value = this.$.value = value;\n\t\tif(!silent) this.S.out('text', this.value);\n\t}\n\tSettingsInterface.call(this, o.setting);\n\n\tthis.$.oninput = this.quickHandler.bind(this);\n\n\tthis.keyl = new KeyListener(this.$, 'keypress')\n\t\t\t.attach('submit', ['Enter'], e => this.handler(e))\n\t//\t\t.attach('cancel', ['Escape'], e => this.clear(), );\n}\n\n\nfunction UI_Dropdown(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['InputDropdown'].concat(o.kind || []),\n\t\thtml: o.html || `<div class=\"dropdown\">\n\t\t\t\t\t\t <div class = \"input-container\">\n  \t\t\t\t\t\t <input type=\"text\" placeholder=\"\" class=\"dropbtn\"/><span class=\"arrd\"></span>\n  \t\t\t\t\t\t </div>\n\t\t\t\t\t\t <div class=\"hidden dropdown-content\"></div>\n\t\t\t\t\t\t </div>`,\n\t});\n\n\tif(o.type) this.$.type = o.type;\n\tthis.options=o.options; //All options\n\tthis.dropdown = this.$.childNodes[3]; //Dropdown container \n\tthis.input =  this.$.childNodes[1].childNodes[1]; //Input\n\tthis.input.value = o.setting.get(); //Setting input value during initialisation\n\tthis.disabled = o.disabled; //set to true if you want to disable inputting\n\tthis.el = -1; //keeps the track for scrolling through element\n\tif(this.disabled) this.input.setAttribute('readonly', ''); //set to disable\n\n\tthis.init = (crr) => { \n\t\tthis.dropdown.innerHTML = '';\n\t\tthis.dropdown.style.height = \"unset\";\n\t\tfor(let i=0; i < crr.length; i++) {\n\t\t\tthis.dropdown.insertAdjacentHTML('beforeend', `<button class=\"opts\">${crr[i]}</button>`)\n\t\t}\n\t\tthis.dropdown.classList.remove('hidden');\n\t\tif (window.innerHeight - this.dropdown.getBoundingClientRect().bottom < 0) this.dropdown.style.height = 35*this.options.length + (window.innerHeight - this.dropdown.getBoundingClientRect().bottom) - 8 + \"px\";\n\t}\n\n\tthis.get = () => this.value;\n\n\tthis.set = function(value) {\n\t\tthis.value = this.input.value = value;\n\t\tthis.SeI.send();\n\t}\n\n\tthis.reset = function(full) {\n\t\tthis.dropdown.classList.add('hidden');\n\t\tthis.input.blur();\n\t\tthis.el = -1;\n\t\tif (full) this.input.value = o.setting.get();\n\t}\n\n\tSettingsInterface.call(this, o.setting);\n\n\tthis.input.oninput = () => {\n\t\t\tthis.init(this.options.filter(el => el.toLowerCase().includes(this.input.value.toLowerCase())));\n\t}\n\n\tnew KeyListener(this.input, 'keydown')\n\t\t.attach('submit', ['Enter'], e => {\n\t\t\tif (this.input.value && (this.options.includes(this.input.value) || this.dropdown.childNodes.length)) this.set(this.dropdown.childNodes[0].textContent);\n\t\t\telse this.set(this.input.placeholder);\n\t\t\tthis.reset(false);\n\t\t})\n\t\t.attach('traverseUp', ['ArrowUp'], e => {\n\t\t\tif (this.el === 0) {\n\t\t\t\tthis.el = this.dropdown.childNodes.length;\n\t\t\t\tthis.dropdown.childNodes[0].classList.remove('dd-s');\n\t\t\t} else if (this.el === -1) {\n\t\t\t\tthis.el = this.dropdown.childNodes.length;\n\t\t\t} else {\n\t\t\t\tthis.dropdown.childNodes[this.el].classList.remove('dd-s');\n\t\t\t}\n\t\t\tthis.el -= 1;\n\t\t\tthis.dropdown.childNodes[this.el].classList.add('dd-s');\n\t\t\tthis.input.value = ''\n\t\t\tthis.input.placeholder = this.dropdown.childNodes[this.el].textContent;\n\t\t\tthis.dropdown.scrollTop = this.dropdown.childNodes[this.el].offsetTop;\n\t\t})\n\t\t.attach('traverseDown', ['ArrowDown'], e => {\n\t\t\tif (this.el === this.dropdown.childNodes.length - 1) {\n\t\t\t\tthis.el = -1;\n\t\t\t\tthis.dropdown.childNodes[this.dropdown.childNodes.length - 1].classList.remove('dd-s');\n\t\t\t} else if (this.el !== -1) {\n\t\t\t\tthis.dropdown.childNodes[this.el].classList.remove('dd-s');\n\t\t\t}\n\t\t\tthis.el += 1;\n\t\t\tthis.dropdown.childNodes[this.el].classList.add('dd-s');\n\t\t\tthis.input.value = ''\n\t\t\tthis.input.placeholder = this.dropdown.childNodes[this.el].textContent;\n\t\t\tthis.dropdown.scrollTop = this.dropdown.childNodes[this.el].offsetTop;\n\t\t})\n\t\t.noPropagation(true)\n\n\tthis.input.onfocus = (e) => {\n\t\tthis.init(this.options);\n\t\tthis.input.placeholder = this.input.value;\n\t\tif(!this.disabled) this.input.value = '';\n\t}\n\n\tthis.input.onblur = (e) => {\n\t\tif(e.relatedTarget && e.relatedTarget.className === 'opts') this.set(e.relatedTarget.textContent);\n\t\tthis.reset(true);\n\t};\n\n\tthis.dropdown.setAttribute(\"tabindex\", \"-1\");\n}\n\nfunction UI_ColorPicker(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ColorPicker'].concat(o.kind || []),\n\t\thtml: o.html || `<button type=\"button\" />`\n\t});\n\tif(o.type) this.$.type = o.type;\n\n\tthis.get = () => this.value;\n\tthis.set = (value, local) => {\n\t\tif(this.value && value.toLowerCase() == this.value.toLowerCase()) return;\n\t\tthis.value = value;\n\t\tthis.$.style.backgroundColor = value;\n\t\tif(!local) this.pickr.setColor(value, true);\n\t};\n\tSettingsInterface.call(this, o.setting);\n\n\tthis.pickr = new Pickr({\n\t\tel: this.$,\n\t\tuseAsButton: true,\n\t\tdefault: this.value,\n\t\ttheme: 'nano',\n\t\tdefault: '#ffffff',\n\t\tautoReposition: true,\n\t\tcomponents: {\n\t\t\tpreview: true,\n\t\t\topacity: false,\n\t\t\thue: true,\n\t\t\tpreview: false, \n\t\t\tinteraction: {\n\t\t\t\thex: false,\n\t\t\t\trgba: false,\n\t\t\t\thsva: false,\n\t\t\t\tinput: true,\n\t\t\t\tsave: true\n\t\t\t}\n\t\t}\n\t})\n\t.on('save', color => {\n\t\tthis.colorBackup = color.toHEXA().toString(0);\n\t\tthis.pickr.hide();\n\t})\n\t.on('change', (color, instance) => {\n\t\tthis.set(color.toHEXA().toString(0), true);\n\t\tthis.SeI.send();\n\t})\n\t.on('show', (color, instance) => {\n\t\tthis.colorBackup = this.value;\n\t\tthis.pickr.getRoot().app.focus();\n\t})\n\t.on('hide', instance => {\n\t\tthis.set(this.colorBackup);\n\t\tthis.SeI.send();\n\t})\n\tnew KeyListener(this.pickr.getRoot().app, 'keydown').noPropagation(true);\n\tthis.pickr.getRoot().app.setAttribute(\"tabindex\", \"-1\");\n}\n\nfunction UI_Button(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Button'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t});\n\tLinkable.call(this);\n\tthis.method = o.method || 'mousedown';\n\tthis.data = o.data;\n\n\tif(this.$.innerHTML.length < 1) this.$.innerHTML = o.text || '';\n\n\tthis.trigger = function trigger(event) {\n\t\tthis.S.out('click', this.data);\n\t\treturn this;\n\t}\n\n\tthis.$['on'+this.method] = event => this.trigger(event);\n}\n\nfunction UI_ResetButton(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ResetButton'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t});\n\tLinkable.call(this);\n\tthis.method = o.method || 'mousedown';\n\n\tif(this.$.innerHTML.length < 1) this.$.innerHTML = o.text || '';\n\tthis.get = () => true;\n\tthis.set = () => {};\n\tSettingsInterface.call(this, o.setting);\n\n\tthis.$['on'+this.method] = () => this.SeI.send();\n}\n\nfunction UI_ToggleButton(o) {\n\to=be(o);\n\tUI_Button.call(this, Object.assign(o, {\n\t\tkind: ['ToggleButton'].concat(o.kind || []),\n\t\thtml: o.html || `<div class=\"ToggleButton UI Button\" data-bind=\"${o.option}\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span data-bind=\"name\">${o.text}</span></div>`\n\t}));\n\tLinkable.call(this);\n\tthis.state = o.state || false;\n\tthis.option = o.option;\n\tthis._.icon.setAttribute('data-'+o.setting, o.option);\n\n\tthis.on = function() {\n\t\tthis.$.classList.add('s');\n\t\tthis.state = true;\n\t\tthis.S.out('on',this.data);\n\t}\n\n\tthis.off = function() {\n\t\tthis.$.classList.remove('s');\n\t\tthis.state = false;\n\t\tthis.S.out('off',this.data);\n\t}\n\n\tthis.toggle = function() {\n\t\tif(this.state) {\n\t\t\tthis.off();\n\t\t}else{\n\t\t\tthis.on();\n\t\t}\n\t}\n}\n\nfunction UI_ButtonGroup(o) {\n\to=be(o);\nvar customHTML = o.html;\n\tUI.call(this, Object.assign(o, {\n\t\tkind: ['ButtonGroup'].concat(o.kind || []),\n\t\thtml: o.html || `\n\t\t\t<div class=\"t-row\">\n\t\t\t\t<div class=\"t-1\" data-bind=\"buttons\">\n\t\t\t\t</div>\n\t\t\t</div>`\n\t}));\n\tLinkable.call(this);\n\n\tthis.get = () => this.value;\n\tthis.select = function(button, silent) {\n\t\tif(Object.keys(this.buttonsMapping).length < 1) return;\n\t\tif(!(button instanceof UI_ToggleButton)) {\n\t\t\tbutton = this.buttonsMapping[button];\n\t\t}\n\t\tfor (var i = 0; i < this.buttons.length; i++) {\n\t\t\tif(this.buttons[i] == button)\n\t\t\t\tthis.buttons[i].on();\n\t\t\telse\n\t\t\t\tthis.buttons[i].off();\n\t\t}\n\t\tthis.value = button.option;\n\t\tthis.S.out('id', this.value);\n\t}\n\tSettingsInterface.call(this, o.setting, this.select);\n\n\tif(!customHTML) {\n\t\tthis.SeI.setting.options().forEach(option => {\n\t\tlet button = new UI_ToggleButton({\n\t\t\t\tsetting: this.SeI.setting.addr,\n\t\t\t\ttext: this.SeI.setting.strings[option],\n\t\t\t\toption: option\n\t\t\t});\n\t\t\tbutton.S.link(this)\n\t\t\tthis._.buttons.appendChild(button.$);\n\t\t})\n\t}\n\n\tthis.refresh = () => {\n\t\tthis.buttons = this.$.getElementsByClassName('ToggleButton');\n\t\tif(this.buttons.length == 4)\n\t\t\tthis.$.classList.add('b4');\n\t\telse\n\t\t\tthis.$.classList.remove('b4');\n\t\tthis.buttons = this.buttons.map(b => {\n\t\t\tif(b._struct == undefined)\n\t\t\t\treturn new UI_ToggleButton({\n\t\t\t\t\tnode: b,\n\t\t\t\t\tsetting: this.SeI.setting.addr,\n\t\t\t\t\toption: b.getAttribute('data-bind')\n\t\t\t\t}).S.link(this);\n\t\t\telse\n\t\t\t\treturn b._struct;\n\t\t});\n\t\tthis.buttonsMapping = {};\n\t\tthis.buttons.forEach(b => {\n\t\t\tthis.buttonsMapping[b.$.getAttribute('data-bind')] = b;\n\t\t\tTooltippy.attach(b.$, this.SeI.setting.getHelp(b.$.getAttribute('data-bind')), undefined, 10)\n\t\t});\n\t\treturn this;\n\t}\n\n\tthis.buttonPacketHandler = rawPacket => {\n\t\tthis.select(rawPacket.source);\n\t\tthis.SeI.send();\n\t}\n\n\tthis.S.mapIn({\n\t\tclick: dpraw(this.buttonPacketHandler)\n\t})\n\n\tthis.refresh();\n}\n\n\nfunction UI_MultiStateButton(o) {\n\to=be(o);\n\tUI_Button.call(this, Object.assign(o, {\n\t\tkind: ['MultiStateButton'].concat(o.kind || [])\n\t}));\n\tthis.setting = Settings.getByAddr(o.setting);\n\tthis.options = o.options || this.setting.options();\n\n\tthis.get = () => this.state;\n\tthis.set = (state) => {\n\t\tif(!this.options.includes(state)) return;\n\t\tthis.$.setAttribute('data-'+this.setting.addr, state);\n\t\tthis.state = state;\n\t}\n\tSettingsInterface.call(this, this.setting);\n\n\n\tthis.trigger = function(event) {\n\tvar idx = this.options.indexOf(this.state) + 1;\n\t\tif(idx >= this.options.length) idx = 0;\n\t\tthis.set(this.options[idx]);\n\t\tthis.SeI.send();\n\t}\n}\n\nfunction UI_Slider(o) {\n\to=be(o);\n\tUI.call(this, Object.assign(o, {\n\t\tkind: ['Slider'].concat(o.kind || []),\n\t\thtml: o.html || `<div>\n\t\t\t<div class=\"slider-wrap\">\n\t\t\t\t<input data-bind=\"slider\" class=\"slider-control\" type=\"range\" />\n\t\t\t\t<div class=\"ticks\" data-bind=\"ticks\"></div>\n\t\t\t</div>\n\t\t\t<input data-bind=\"number\" class=\"slider-value\" type=\"text\" />\n\t\t</div>`\n\t}));\n\tLinkable.call(this);\n\tthis.setting = o.setting;\n\tthis.disabled = o.disabled || false;\n\n\tthis.draw = (value) => {\n\t\tthis._.slider.min = 0;\n\t\tthis._.slider.max = this.setting.options().length - 1;\n\t\tthis._.ticks.innerHTML = '';\n\t\tthis.setting.options().forEach(option => {\n\t\tlet tick = crelm('i');\n\t\t\tif(this.setting.options().length < 14)\n\t\t\t\ttick.innerHTML = this.setting.getFormatted(option);\n\t\t\tthis._.ticks.appendChild(tick);\n\t\t})\n\t\tthis.set(value);\n\t}\n\n\tthis.get = () => this.state;\n\tthis.set = function(state) {\n\t\tif(!this.setting.options().includes(state)) return;\n\t\tthis._.slider.setAttribute('data-'+this.setting.addr, state);\n\t\tthis.state = state;\n\tlet val = this.setting.options().indexOf(state);\n\t\tif(this._.slider.value != val)\n\t\t\tthis._.slider.value = val;\n\t\tthis._.number.value = this.setting.getFormatted(state);\n\t}\n\tSettingsInterface.call(this, o.setting, this.draw);\n\n\tthis.setByIndex = function(idx) {\n\t\tif(+idx > this.setting.options().length - 1 || +idx < 0) return;\n\t\tthis.set(this.setting.options()[idx]);\n\t}\n\t\n\tthis._.slider.oninput = (e) => {\n\t\tthis.setByIndex(this._.slider.value);\n\t\tthis.SeI.send();\n\t}\n\tthis._.number.onblur = (e) => {\n\tlet val = parseInt(this._.number.value);\t\n\t\tthis.set(this.setting.options().reduce((p, c) => (\n\t\t\tMath.abs(c - val) < Math.abs(p - val) ? c : p)\n\t\t));\n\t\tthis.SeI.send();\n\t}\n\tnew KeyListener(this._.number)\n\t\t.attach('esc', ['Escape'], (e) => e.target.blur())\n\t\t.attach('enter', ['Enter'], (e) => this._.number.onblur())\n\t\t.noPropagation(true)\n\tTooltippy.attach(this._.slider, this.setting.getHelp(), undefined, 10);\n}\n\nfunction DataElement(o) {\n\to=be(o);\n\n\tthis.setData = function(data) {\n\t\tthis.data = data;\n\t}\n\tthis.getData = function() {\n\t\treturn this.data;\n\t}\n\n\tthis.setData(be(o.data));\n}\n\n\nfunction UI_Editable(o) {\n\to=be(o);\n\tObject.assign(o,{\n\t\tnode: o.node,\n\t\tkind: ['Editable'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t\tfunctions: o.functions\n\t});\n\tUI_Button.call(this, o)\n\tUI_Waitable.call(this);\n\n\tthis.$.onkeydown = (e) => this.filterNewlines(e);\n\tthis.$.oninput = (e) => this.filterTags(e);\n\tthis.keyl = new KeyListener(this.$)\n\t\t\t.condition(e => {\n\t\t\t\treturn this.renaming;\n\t\t\t})\n\t\t\t.pre(e => this.filterNewlines(e))\n\t\t\t.attach('submit', ['Enter'], e => this.confirm(e))\n\t\t\t.attach('cancel', ['Escape'], e => this.exit());\n\n\n\tthis.filterNewlines = function filterNewlines(e) {\n\t\tif(e.which == 13) {\n\t\t\te.preventDefault();\n\t\t\treturn false;\n\t\t}\n\t\tthis.filterTags();\n\t}\n\tthis.filterTags = function filterTags(e) {\n\t\tfor(var i=0; i<this.$.children.length; i++) {\n\t\t\tthis.$.children[0].parentNode.removeChild(this.$.children[0]);\n\t\t};\n\t\tif(this.$.innerHTML.length < 1)\n\t\t\tthis.$.innerHTML='<br>';\n\t}\n\n\tthis.edit = function edit(state) {\n\t\tswitch(state) {\n\t\t\tcase ON:\n\t\t\tdefault:\n\t\t\t\tthis.editing = true;\n\t\t\t\tbreak;\n\t\t\tcase OFF:\n\t\t\t\tthis.editing = false;\n\t\t\t\tbreak;\n\t\t\tcase TOGGLE:\n\t\t\t\tthis.editing = !this.editing;\n\t\t\t\tbreak;\n\t\t}\n\t\tif(this.editing) {\n\t\t\tthis.$.classList.add('edit');\n\t\t\tthis.$.contentEditable = true;\n\t\t}else{\n\t\t\tthis.$.classList.remove('edit');\n\t\t\tthis.$.contentEditable = false;\n\t\t}\n\t}\n\n\tthis.getText = function getText() {\n\t\treturn this.$.innerHTML.replace(/\\<br\\>/g, '');\n\t}\n\n\tthis.confirm = function confirm(e) {\n\t\tthis.edit(false);\n\t\tthis.trigger({struct:this, action:'confirm', text: this.getText()}, e)\n\t}\n\n\tthis.cancel = function cancel(e) {\n\t\tthis.edit(false);\n\t\tthis.trigger({struct:this, action:'cancel'}, e)\n\t}\n}\n\nfunction UI_Waitable(o) {\n\to=be(o);\n\tthis.startWait = function startWait() {\n\t\tthis.$.classList.add('w');\n\t}\n\tthis.endWait = function endWait() {\n\t\tthis.$.classList.remove('w');\n\t}\n}\n\nfunction UI_Gallery(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Gallery'].concat(o.kind || []),\n\t\thtml: o.html || '<div><div class=\"prev\"></div><div class=\"wrapper\"></div><div class=\"next\"></div></div>',\n\t});\n\tLinkable.call(this, {});\n\n\tthis._ = {\n\t\titems: this.$.querySelector('.wrapper'),\n\t\tprev: this.$.querySelector('.prev'),\n\t\tnext: this.$.querySelector('.next')\n\t}\n\n\tthis.items = new UI_Selector({node: this._.items, singular: true, persistent: true, toggleClass: 's', held: true});\n\n\tthis.move = function move(direction) {\n\t\tif(direction == 'left') {\n\t\t\tthis._.items.insertBefore(this._.items.lastElementChild, this._.items.firstElementChild);\n\t\t\tthis.items.select(this._.items.children.indexOf(this.items.selectedItems[0].$)-1);\n\t\t}else if(direction == 'right') {\n\t\t\tthis._.items.appendChild(this._.items.firstElementChild);\n\t\t\tthis.items.select(this._.items.children.indexOf(this.items.selectedItems[0].$)+1);\n\t\t}\n\t}\n\n\tthis._.prev.onclick = () => this.move('left');\n\tthis._.next.onclick = () => this.move('right');\n}\n\nvar UIs = document.querySelectorAll('*[data-ui]');\nvar toUI = [];\nUIs.forEach(node => {\n\ttoUI.push({node: node, depth: alg.getDepth(node)})\n});\ntoUI.sort((a,b) => {\n\treturn a.depth>b.depth?1:-1;\n})\ntoUI.forEach(item => {\n\tnew window[item.node.getAttribute('data-ui')]({node: item.node})\n});\n\n\n\nlet mediaMatcher = window.matchMedia(\"(max-width: 700px)\");\nlet IS_MOBILE = mediaMatcher.matches;\nlet HAS_LOCALSTORAGE = localStorage !== undefined;\n\nwindow.addEventListener('resize', () =>{\n\tIS_MOBILE = mediaMatcher.matches;\n});\n\n//  {\n// \t(function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4)))return true; else return false})(navigator.userAgent||navigator.vendor||window.opera);\n// }\n\nlet PROGRAMMATIC_SCROLL = false;\nlet SCROLL_TIMER = null;\nlet DBG_VAL = NaN;\n\nfunction shadowScroll() {\n\tPROGRAMMATIC_SCROLL = true;\n\tif(SCROLL_TIMER) clearTimeout(SCROLL_TIMER);\n\tSCROLL_TIMER = setTimeout(() => {\n\t\tPROGRAMMATIC_SCROLL = false;\n\t}, 50)\n} \n\nfunction scroll(element, x, y, noshadow) {\n\t//if(x == DBG_VAL || y == DBG_VAL || element == DBG_VAL || (isNaN(DBG_VAL) && (isNaN(x) || isNaN(y)))) debugger;\n\tif(!noshadow) shadowScroll();\n\t//console.log(element, 'scrolled to', x, y)\n\tif(element.scroll)\n\t\telement.scroll(x, y)\n\telse\n\t\telement.scrollTop = y;\n\t\telement.scrollLeft = x;\n\n}\n\nfunction LoadHandler(o) {\n\to=be(o);\n\tLinkable.call(this);\n\n\tthis.parseSCP = function() {\n\tlet url = document.location.pathname.split('/');\n\tlet group = (document.location.hash.match(/#(\\d+)/) || [null, null])[1];\n\t\treturn {\n\t\t\tseries: url[url.length - 4],\n\t\t\tchapter: url[url.length - 3].replace('-','.'),\n\t\t\tpage: parseInt(url[url.length - 2] - 1),\n\t\t\tgroup: group\n\t\t}\n\t}\n\n\tthis.onload = () => {\n\tvar SCP = this.parseSCP();\n\t\tAPI.requestSeries(SCP.series)\n\t\t\t.then(data => {\n\t\t\t\tReader.setSCP(SCP);\n\t\t\t\tReader.displaySCP(SCP);\n\t\t\t})\n\t}\n\n\tdocument.addEventListener(\"DOMContentLoaded\", e => this.onload());\n\n}\n\nfunction ReaderAPI(o) {\n\to=be(o);\n\tLinkable.call(this);\n\t\n\tthis.url = o.url || '/api/';\n\t\n\tthis.firstParty = IS_FIRST_PARTY;\n\n\tthis.seriesUrl = BASE_API_PATH;\n\n\tthis.mediaURL = o.mediaURL || '/media/manga/';\n\n\tthis.data = {};\n\tthis.indexData = {};\n\n\tthis.infuseSeriesData = function(data) {\n\t\tfor(var num in data.chapters) {\n\t\tlet chapter = data.chapters[num];\n\t\t\tchapter.images = {};\n\t\t\tchapter.descriptions = {};\n\t\t\tchapter.loaded = {};\n\t\t\tchapter.blurs = {};\n\t\t\tchapter.previews = {};\n\t\t\tchapter.hasWide = {};\n\t\t\tchapter.wides = {};\n\n\t\t\tchapter.id = num;\n\t\t\tfor(let group in chapter.groups) {\n\t\t\t\tchapter.images[group] = [];\n\t\t\t\tchapter.descriptions[group] = [];\n\t\t\t\tchapter.blurs[group] = [];\n\t\t\t\tchapter.previews[group] = [];\n\t\t\t\tchapter.wides[group] = [];\n\t\t\t\tif (this.firstParty) {\n\t\t\t\t\tfirstPartySeriesHandler(this.mediaURL, chapter, group, data.slug);\n\t\t\t\t} else {\n\t\t\t\t\tthirdPartySeriesHandler(this.seriesUrl, chapter, group);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(data.next_release_page) {\n\t\t\tdata.countdown = true;\n\t\t\tvar lastChapter = Object.keys(data.chapters).sort((a,b) => b - a)[0];\n\n\t\t\tdata.chapters[+lastChapter+1] = Object.assign({}, data.chapters[lastChapter]);\n\t\t\tdata.chapters[+lastChapter+1].notice = true;\n\t\t\tdata.chapters[+lastChapter+1].title = '[Not yet released]';\n\t\t}\n\t\treturn data;\n\t}\n\n\tthis.requestSeries = function(slug) {\n\t\tthis.seriesRequest = fetch(this.seriesUrl + slug + '/')\n\t\t\t.then(response => response.json())\n\t\t\t.then(seriesData => {\n\t\t\t\tseriesData = this.infuseSeriesData(seriesData);\n\t\t\t\tseriesData.chaptersIndex =\n\t\t\t\t\tObject.keys(\n\t\t\t\t\t\tseriesData.chapters\n\t\t\t\t\t).sort((a,b) => parseFloat(a) - parseFloat(b));\n\t\t\t\tseriesData.volMap = {};\n\t\t\t\tfor (var i = 0; i < seriesData.chaptersIndex.length; i++) {\n\t\t\t\t\tif(!seriesData.volMap[seriesData.chapters[seriesData.chaptersIndex[i]].volume])\n\t\t\t\t\t\tseriesData.volMap[seriesData.chapters[seriesData.chaptersIndex[i]].volume] = seriesData.chaptersIndex[i];\n\t\t\t\t}\n\t\t\t\tthis.data[slug] = seriesData;\n\t\t\t\tthis.S.out('seriesUpdated', this.data[slug]);\n\t\t\t\tthis.S.out('isFirstParty', this.firstParty);\n\t\t\t})\n\t\treturn this.seriesRequest;\n\t}\n\n\tthis.requestIndex = function(o){\n\t\tvar formData = new FormData();\n\t\tformData.append(\"searchQuery\", o.query)\n\t\t//formData.append(\"csrfmiddlewaretoken\", CSRF_TOKEN)\n\t\treturn fetch('/api/search_index/'+ o.slug + '/', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: formData\n\t\t\t})\n\t\t\t.then(response => response.json())\n\t\t\t.then(searchData => {\n\t\t\t\tthis.S.out('indexUpdated', searchData);\n\t\t\t\treturn {result:searchData, query: o.query};\n\t\t\t})\n\t}\n\n\tthis.S.mapIn({\n\t\t'loadSeries': this.requestSeries,\n\t\t'loadIndex': this.requestIndex\n\t})\n}\n\n\nfunction themeHandler() {\n\tLinkable.call(this);\n\tthis.themeUpdated = () => {\n\t\tlet reset = Settings.get('thm.reset');\n\t\tlet theme = Settings.get('thm.theme');\n\t\tif(theme === 'Custom')\tthis.setTheme(Settings.get('thm.primaryCol'), Settings.get('thm.readerBg'), Settings.get('thm.accentCol'), Settings.get('thm.textCol'));\n\t\telse if (theme === 'Cubari') this.setTheme('#28292B', '#000000', '#B73636','#EEEEEE');\n\t\telse if (theme === 'Classic') this.setTheme('#3a3f44', '#272b30', '#b2dffb','#eeeeee');\n\t\telse if (theme === 'Reaper') this.setTheme('#272836', '#121223', '#487DE4', '#EEEEEE');\n\t\telse if (theme === 'Zaibatsu') this.setTheme('#1D1D1D', '#000000', '#BA1F1F', '#EEEEEE');\n\t\telse if (theme === 'Light') this.setTheme('#F1F4FF', '#FFFFFF', '#5889F0','#2B2B2B');\n\t\tif(reset === true) this.resetCustom();\n\t}\n\tthis.setTheme = (sidebar, reader, accent, text) => {\n\t\tdocument.documentElement.style.setProperty(\"--readerBg\", reader);\n\t\tdocument.documentElement.style.setProperty(\"--sidebarCol\", sidebar);\n\t\tdocument.documentElement.style.setProperty(\"--accentCol\", accent);\n\t\tdocument.documentElement.style.setProperty(\"--textCol\", text);\n\t\tdocument.documentElement.style.setProperty(\"--icoCol\", text);\n\t\tdocument.documentElement.style.setProperty(\"--sidebarColDark\", colManipulate(sidebar, -15));\n\t\tdocument.documentElement.style.setProperty(\"--sidebarColDarkA\", colManipulate(sidebar, -15) + '00');\n\t\tdocument.documentElement.style.setProperty(\"--prevCol\", colManipulate(sidebar, -7));\n\n\t\tlet [r, g, b] = hexToRgb(accent);\n\t\tvar\tluma = ((r*299)+(g*587)+(b*114))/1000;\n\n\t\tdocument.documentElement.style.setProperty(\"--accentSelected\", (luma > 160?'#111111':'#ffffff'));\n\t\t\n\t\t[r, g, b] = hexToRgb(sidebar);\n\t\tluma = ((r*299)+(g*587)+(b*114))/1000;\n\n\t\tdocument.documentElement.style.setProperty(\"--accentSelectedInvert\", (luma < 160?'#444444':'#cccccc')); // Play with 160 there if you want.\n\t\tif(luma > 100) { //Tweaks if theme is light\n\t\t\tdocument.documentElement.style.setProperty(\"--borderColor\", \"rgba(0,0,0,0.2)\");\n\t\t\tdocument.documentElement.style.setProperty(\"--blackLight\", \"rgba(0,0,0,0.05)\");\n\t\t\tdocument.documentElement.style.setProperty(\"--sidebarColFocus\", colManipulate(sidebar, -24));\n\t\t} else {\n\t\t\tdocument.documentElement.style.setProperty(\"--borderColor\", \"rgba(0,0,0,0.7)\");\n\t\t\tdocument.documentElement.style.setProperty(\"--blackLight\", \"rgba(0,0,0,0.2)\");\n\t\t\tdocument.documentElement.style.setProperty(\"--sidebarColFocus\", colManipulate(sidebar, -27));\n\t\t}\n\t\t[r, g, b] = hexToRgb(sidebar)\n\t\tlet [rt, gt, bt] = hexToRgb(text)\n\t\tif(Math.abs(r-rt) < 50\n\t\t&& Math.abs(g-gt) < 50\n\t\t&& Math.abs(b-bt) < 50) {\n\t\t\tif(luma > 200) {\n\t\t\t\tdocument.documentElement.style.setProperty(\"--rescueShade\", '0px 1px 1px rgba(0,0,0,0.6),0px -1px 1px rgba(0,0,0,0.6),-1px 0px 1px rgba(0,0,0,0.6),1px 0px 1px rgba(0,0,0,0.6)');\n\t\t\t}else{\n\t\t\t\tdocument.documentElement.style.setProperty(\"--rescueShade\", '0px 1px 1px rgba(255,255,255,0.6),0px -1px 1px rgba(255,255,255,0.6),-1px 0px 1px rgba(255,255,255,0.6),1px 0px 1px rgba(255,255,255,0.6)');\n\t\t\t}\n\t\t\tTooltippy.set('Contrast ratio too low, safety outline enabled.')\n\t\t}else{\n\t\t\tdocument.documentElement.style.setProperty(\"--rescueShade\", 'unset');\n\t\t\tTooltippy.reset();\n\t\t}\n\n\t\t[r, g, b] = hexToRgb(reader);\n\t\tluma = ((r*299)+(g*587)+(b*114))/1000;\n\t\t\n\t\tif(luma > 100) {\n\t\t\tdocument.documentElement.style.setProperty(\"--rdrBorderL\", \"3px\");\n\t\t\tdocument.documentElement.style.setProperty(\"--rdr-wb\", \"1px\");\n\t\t\tdocument.documentElement.style.setProperty(\"--blackFlag\", \"rgba(0,0,0,0.3)\");\n\t\t\tdocument.documentElement.style.setProperty(\"--rdrAncBottomWhite\", \"rgba(255,255,255,0.6)\");\n\t\t} else {\n\t\t\tdocument.documentElement.style.setProperty(\"--rdrBorderL\", \"1px\");\n\t\t\tdocument.documentElement.style.setProperty(\"--rdr-wb\", \"2px\");\n\t\t\tdocument.documentElement.style.setProperty(\"--blackFlag\", \"rgba(0,0,0,0.7)\");\n\t\t\tdocument.documentElement.style.setProperty(\"--rdrAncBottomWhite\", \"rgba(255,255,255,0.35)\");\n\t\t}\n\t}\n\n\tthis.resetCustom = () => {\n\t\tSettings.set('thm.reset', false);\n\t\tif(Settings.get('thm.theme') === 'Custom') {\n\t\t\tSettings.set('thm.primaryCol', '#28292B');\n\t\t\tSettings.set('thm.readerBg', '#000000');\n\t\t\tSettings.set('thm.accentCol', '#B73636');\n\t\t\tSettings.set('thm.textCol', '#EEEEEE');\n\t\t}\n\t}\n\t\n\tthis.S.mapIn({\n\t\tsettingsPacket: this.themeUpdated,\n\t})\n}\n\nconst SETTING_HIDDEN = -1;\nconst SETTING_CUSTOM = 1;\nconst SETTING_BOOLEAN = 10;\nconst SETTING_MULTI = 20;\nconst SETTING_COLOR = 11;\nconst SETTING_BUTTON = 12;\nconst SETTING_MULTI_DROPDOWN = 21;\nconst SETTING_VALUE = 30;\nconst SETTING_VALUE_STEPPED = 31;\n\t\nfunction Setting(o) {\n\tLinkable.call(this);\n\tthis.name = o.name;\n\tthis.addr = o.addr;\n\tthis.prettyName = o.prettyName;\n\tthis.setting = this.default = o.default;\n\tthis.type = o.type || SETTING_HIDDEN;\n\tif(o.options !== undefined) {\n\t\tif(o.options instanceof Function)\n\t\t\tthis.options = o.options;\n\t\telse{\n\t\t\tif(o.options instanceof Array){\n\t\t\t\tthis.optionsPrimitive = o.options.slice(0);\n\t\t\t\tthis.options = function() {return this.optionsPrimitive};\n\t\t\t}else\n\t\t\t\tthis.optionsPrimitive = o.options;\n\t\t}\n\t}else if(this.type == SETTING_BOOLEAN){\n\t\tthis.options = function() {return [true, false]};\n\t}\n\tthis.strings = o.strings;\n\tthis.postUpdate = o.postUpdate;\n\tthis.html = o.html;\n\tthis.global = (o.global===undefined)?true:o.global;\n\tthis.manual = o.manual; //if true, the setting needs an external .setClass call to update the class. This can be used where class update needs to be in the middle of something.\n\tthis.hidden = o.hidden;\n\tthis.condition = o.condition;\n\tthis.nomobile = o.nomobile;\n\tthis.compact = o.compact;\n\tthis.help = o.help;\n\tthis.disabled = o.disabled || false;\n\n\tthis.checkOptionValidity = function(value) {\n\t\tif(this.options == undefined)\n\t\t\treturn true;\n\t\t\n\t\tif(this.options() instanceof Array)\n\t\t\treturn this.options().includes(value);\n\t\t\n\t\treturn this.options() == value;\n\t}\n\n\tthis.refresh = function() {\n\t\tif(!this.checkOptionValidity(this.get()))\n\t\t\tthis.set(this.default);\n\t}\n\n\tthis.update = function() {\n\t\tthis.set(this.get());\n\t}\n\tthis.get = function() {\n\t\treturn this.setting;\n\t}\n\tthis.set = function(value, silent, notip) {\n\t\tif(!this.checkOptionValidity(value)) return null;\n\t\tthis.setting = value;\n\t\tif(this.global && !this.manual)\n\t\t\tthis.setClass();\n\t\tthis.S.out('settingEvent', {\n\t\t\ttype: 'change',\n\t\t\tsetting: this\n\t\t})\n\t\treturn this.setting;\n\t}\n\tthis.cycle = function(options, silent, notip) {\n\t\tswitch(this.type){\n\t\t\tcase SETTING_BOOLEAN:\n\t\t\tcase SETTING_MULTI:\n\t\t\tcase SETTING_MULTI_DROPDOWN:\n\t\t\tcase SETTING_VALUE:\n\t\t\tcase SETTING_VALUE_STEPPED:\n\t\t\t\tif(options === undefined)\n\t\t\t\t\toptions = this.options();\n\t\t\tvar index = options.indexOf(this.get());\n\t\t\t\treturn this.set(\n\t\t\t\t\t(index+1 > options.length - 1)?options[0]:options[index+1],\n\t\t\t\t\tsilent\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t}\n\t\treturn null;\n\t}\n\tthis.next = function(silent, notip) {\n\t\tif(!this.options() instanceof Array) return;\n\t\tif(this.options().includes(this.setting)) {\n\t\tvar targetIndex = this.options().indexOf(this.setting) + 1;\n\t\t\tif(targetIndex > this.options().length - 1) return;\n\t\t\treturn this.set(this.options()[targetIndex], silent, notip)\n\t\t}\n\t\treturn null;\n\t}\n\tthis.prev = function(silent, notip) {\n\t\tif(!this.options() instanceof Array) return;\n\t\tif(this.options().includes(this.setting)) {\n\t\tvar targetIndex = this.options().indexOf(this.setting) - 1;\n\t\t\tif(targetIndex < 0) return;\n\t\t\treturn this.set(this.options()[targetIndex], silent, notip)\n\t\t}\n\t\treturn null;\n\t}\n\tthis.getFormatted = function(option) {\n\t\toption = option===undefined?this.get():option;\n\t\tif(this.strings) {\n\t\t\tif(this.strings instanceof Function) {\n\t\t\t\treturn this.strings(option);\n\t\t\t}\n\t\t\treturn this.strings[option];\n\t\t}else{\n\t\t\treturn option;\n\t\t}\n\t}\n\tthis.getHelp = function(option) {\n\t\toption = option===undefined?this.get():option;\n\t\tif(this.help) {\n\t\t\tif(typeof this.help == 'string') {\n\t\t\t\treturn this.help;\n\t\t\t}\n\t\t\treturn this.help[option];\n\t\t}else{\n\t\t\treturn '';\n\t\t}\n\t}\n\tthis.classString = function(option) {\n\t\tif(option !== undefined) {\n\t\t\treturn this.name + '-' + option;\n\t\t}else{\n\t\t\treturn this.name + '-' + this.get();\n\t\t}\n\t}\n\tthis.setClass = function() {\n\tvar classList = document.body.classList;\n\t\tswitch(this.type){\n\t\t\tcase SETTING_BOOLEAN:\n\t\t\t\tclassList.remove(this.classString(!this.get()));\n\t\t\t\tclassList.add(this.classString());\n\t\t\t\tbreak;\n\t\t\tcase SETTING_MULTI:\n\t\t\tcase SETTING_MULTI_DROPDOWN:\n\t\t\tcase SETTING_VALUE:\n\t\t\tcase SETTING_COLOR:\n\t\t\tcase SETTING_BUTTON:\n\t\t\tcase SETTING_VALUE_STEPPED:\n\t\t\t\tclassList.remove.apply(classList, [].filter.call(classList, cl => cl.indexOf(this.name) == 0));\n\t\t\t\tclassList.add(this.classString());\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tthis.disable = () => {\n\t\tthis.disabled = true;\n\n\t}\n\tthis.enable = () => {\n\t\tthis.disabled = false;\n\t}\n}\n\nfunction SettingsCategory(name, hidden, icon) {\n\tnonEnum(this, \"name\", name);\n\tnonEnum(this, \"hidden\", hidden);\n\tnonEnum(this, \"icon\", hidden);\n}\n\n\nfunction SettingsHandler(){\n\tLinkable.call(this);\n\n\tthis.settings = {\n\t\tlyt: new SettingsCategory('Reader', false),\n\t\tbhv: new SettingsCategory('Behavior', false),\n\t\tapr: new SettingsCategory('Layout', false),\n\t\tthm: new SettingsCategory('Themes', false),\n\t\tadv: new SettingsCategory('Advanced', false),\n\t\tmisc: new SettingsCategory('Miscellaneous', true),\n\t};\n\tthis.all = {};\n\n\tthis.newSetting = function(o) {\n\tlet obj = Object.byString(this.settings, o.addr.split('.').slice(0, -1).join('.'));\n\t\to.name = o.addr.split('.').pop();\n\t\tthis.all[o.addr] = obj[o.name] = new Setting(o);\n\t\tthis.all[o.addr].S.link(this);\n\t\treturn this;\n\t}\n\n\tthis.deserialize = function() {\n\t\tif(!localStorage) return;\n\tvar settings = localStorage.getItem('settings');\n\t\ttry{\n\t\t\tif(!settings) throw 'No settings';\n\t\t\tsettings = JSON.parse(settings);\n\t\t\tif(settings.VER && settings.VER != this.ver) {\n\t\t\t\tthrow 'Settings ver changed';\n\t\t\t}\n\t\t\tfor(var setting in settings) {\n\t\t\t\tif(setting == 'VER') continue;\n\t\t\t\tthis.set(setting, settings[setting], true);\n\t\t\t}\n\t\t}catch (e){\n\t\t\tlocalStorage.setItem('settings','');\n\t\t\tconsole.warn('Settings were found to be corrupted and so were reset.');\n\t\t\tfor (var setting in this.all) {\n\t\t\t\tthis.all[setting].set(this.all[setting].get());\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.sendInit = function() {\n\t\tfor(var setting in this.all) {\n\t\t\tthis.S.out('settingsPacket', new SettingsPacket('change', setting, this.get(setting)))\n\t\t}\n\t}\n\n\tthis.serialize = function() {\n\tvar settings = {};\n\t\tfor(var setting in this.all) {\n\t\t\tsettings[setting] = this.all[setting].get();\n\t\t}\n\t\t// delete groupPreference from localstorage so it does not load preferred group even on better quality release\n\t\tdelete settings['misc.groupPreference'];\n\t\tsettings.VER = this.ver;\n\t\treturn JSON.stringify(settings);\n\t}\n\n\tthis.query = function(qu, or) {\n\t\tif(or) {\n\t\t\tfor(var key in qu) {\n\t\t\tvar setting = this.getByAddr(key);\n\t\t\t\tif(qu[key][0] == '!') {\n\t\t\t\t\tif(qu[key].substr(1) != setting.get()) return true;\n\t\t\t\t}else{\n\t\t\t\t\tif(qu[key] == setting.get()) return true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}else{\n\t\t\tfor(var key in qu) {\n\t\t\tvar setting = this.getByAddr(key);\n\t\t\t\tif(qu[key] instanceof Array) {\n\t\t\t\t\tif(qu[key][0][0] == '!') {\n\t\t\t\t\t\tif(qu[key][0].substr(1) == setting.get()){\n\t\t\t\t\t\t\ttry { if(qu[key][1] === 'or') continue } catch(err) {};\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttry { if(qu[key][1] === 'or') return true } catch(err) {};\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(qu[key].includes(setting.get())) continue;\n\t\t\t\t}\n\t\t\t\tif(qu[key][0] == '!') {\n\t\t\t\t\tif(qu[key].substr(1) == setting.get()) return false;\n\t\t\t\t}else{\n\t\t\t\t\tif(qu[key] != setting.get()) return false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\ttry { if(qu[key][1] === 'or') return false } catch(err) {};\n\t\treturn true;\n\t}\n\n\tthis.getByAddr = function(addr) {\n\t\treturn this.all[addr];\n\t}\n\tthis.get = function(setting){\n\t\treturn this.getByAddr(setting).get();\n\t}\n\tthis.set = function(setting, value, packet){\n\t\tif(is(this.getByAddr(setting).set(value))){\n\t\t\tthis.update(setting, packet);\n\t\t}\n\t}\n\tthis.cycle = function(setting, options, packet){\n\t\tif(is(this.getByAddr(setting).cycle(options))){\n\t\t\tthis.update(setting, packet);\n\t\t}\n\t}\n\tthis.setClass = function(setting){\n\t\tthis.getByAddr(setting).setClass();\n\t}\n\tthis.next = function(setting, silent){\n\t\tif(is(this.getByAddr(setting).next(silent))) {\n\t\t\tthis.update(setting);\n\t\t}\n\t}\n\tthis.prev = function(setting, silent){\n\t\tif(is(this.getByAddr(setting).prev(silent))) {\n\t\t\tthis.update(setting);\n\t\t}\n\t}\n\tthis.disable = (setting) => {\n\t\tsetting.disable();\n\t\tthis.update(setting.addr, new SettingsPacket(\n\t\t\t'disable',\n\t\t\tsetting.addr\n\t\t));\n\t}\n\tthis.enable = (setting) => {\n\t\tsetting.enable();\n\t\tthis.update(setting.addr, new SettingsPacket(\n\t\t\t'enable',\n\t\t\tsetting.addr\n\t\t));\n\t}\n\tthis.update = function(setting, packet){\n\t\tif(!packet) {\n\t\t\tpacket = new SettingsPacket(\n\t\t\t\t'change',\n\t\t\t\tsetting,\n\t\t\t\tthis.getByAddr(setting).get()\n\t\t\t);\n\t\t}\n\t\tif(packet.type == 'set') packet.type = 'change';\n\t\tpacket.handled = true;\n\t\tthis.S.out('settingsPacket', packet);\n\t}\n\n\tthis.refreshAll = function() {\n\t\tvar settings = Object.keys(this.all).map(setting => this.all[setting]);\n\t\tsettings.forEach(setting => setting.refresh());\n\t\tsettings.forEach(setting => {\n\t\t\tif(setting.condition) {\n\t\t\tvar result = this.query(setting.condition);\n\t\t\t\tif(result) {\n\t\t\t\t\tif(!setting.disabled) return;\n\t\t\t\t\tthis.enable(setting);\n\t\t\t\t}else{\n\t\t\t\t\tif(setting.disabled) return;\n\t\t\t\t\tthis.disable(setting);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tthis.settingUpdated = function(e) {\n\t\tif(e.type == 'change') {\n\t\t\tif(e.setting.postUpdate) e.setting.postUpdate(e.setting.get());\n\t\t\tthis.refreshAll(); //opt - update only linked setting\n\t\t\tif(localStorage)\n\t\t\t\tlocalStorage.setItem('settings', this.serialize())\n\t\t\t\tthis.S.out('message', e.setting.getHelp());\n\t\t}\n\t\t// if(e.silent != true) {\n\t\t// \tif(!e.notip)\n\t\t// \t\tif(e.type == 'change')\n\t\t// }\n\t}\n\n\tthis.packetHandler = (packet) => {\n\t\tswitch(packet.type) {\n\t\t\tcase 'set':\n\t\t\t\tthis.set(packet.setting, packet.value, packet);\n\t\t\t\tbreak;\n\t\t\tcase 'cycle':\n\t\t\t\tthis.cycle(packet.setting, packet.value, packet);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\n\tthis.S.mapIn({\n\t\tsettingsPacket: this.packetHandler,\n\t\tinit: this.sendInit,\n\t\tsettingEvent: this.settingUpdated\n\t})\n\n\tthis.ver = '0.79';\n\n\tthis.newSetting({\n\t\taddr: 'lyt.fit',\n\t\tprettyName: 'Page fit',\n\t\toptions: [\n\t\t\t'none',\n\t\t\t'all_limit',\n\t\t\t'width_limit',\n\t\t\t'height_limit',\n\t\t\t'all',\n\t\t\t'width',\n\t\t\t'height'\n\t\t],\n\t\tdefault: (IS_MOBILE)?'all_limit':'width_limit',\n\t\tstrings: {\n\t\t\t'none': 'Images are displayed in natural resolution.',\n\t\t\t'all_limit': 'Natural image size that does not exceed max width or height.',\n\t\t\t'width_limit': 'Natural image size that does not exceed max width.',\n\t\t\t'height_limit': 'Natural image size that does not exceed max height.',\n\t\t\t'all': 'Images expand to width or height.',\n\t\t\t'width': 'Images expand to max width.',\n\t\t\t'height': 'Images expand to max height.',\n\t\t},\n\t\thelp: {\n\t\t\t'none': 'Images are displayed in natural resolution.',\n\t\t\t'all_limit': 'Natural image size that does not exceed max width or height.',\n\t\t\t'width_limit': 'Natural image size that does not exceed max width.',\n\t\t\t'height_limit': 'Natural image size that does not exceed max height.',\n\t\t\t'all': 'Images expand to width or height.',\n\t\t\t'width': 'Images expand to max width.',\n\t\t\t'height': 'Images expand to max height.',\n\t\t},\n\t\ttype: SETTING_MULTI,\n\t\thtml: `<div><div class=\"t-row\">\n\t\t\t\t<div class=\"t-1\">\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"none\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>Original size</span></div>\n\t\t\t\t</div>\n\t\t\t</div><div class=\"t-row\">\n\t\t\t\t<div class=\"t-tooltip\">\n\t\t\t\t\tLimit\n\t\t\t\t</div>\n\t\t\t\t<div class=\"t-1\">\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"all_limit\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>All</span></div>\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"width_limit\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>Width</span></div>\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"height_limit\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>Height</span></div>\n\t\t\t\t</div>\n\t\t\t</div><div class=\"t-row\">\n\t\t\t\t<div class=\"t-tooltip\">\n\t\t\t\t\tStretch\n\t\t\t\t</div>\n\t\t\t\t<div class=\"t-1\">\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"all\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>All</span></div>\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"width\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>Width</span></div>\n\t\t\t\t\t<div class=\"ToggleButton\" data-bind=\"height\"><div data-bind=\"icon\" class=\"ico-btn\"></div><span>Height</span></div>\n\t\t\t\t</div>\n\t\t\t</div></div>`\n\t})\n\t.newSetting({\n\t\taddr: 'lyt.zoom',\n\t\tprettyName: 'Maximum page width',\n\t\toptions: ['10', '20', '30', '40', '50', '60', '70', '80', '90', '100'],\n\t\tdefault: '100',\n\t\tstrings: (i) => `${i}%`,\n\t\thelp: 'Maximum width the page expands to. Works only in width modes of page fit.',\n\t\ttype: SETTING_VALUE_STEPPED,\n\t\tcondition: {'lyt.fit': ['width_limit', 'width']},\n\t\tnomobile: true\n\t})\n\t.newSetting({\n\t\taddr: 'lyt.direction',\n\t\tprettyName: 'Reader layout',\n\t\toptions: ['ltr', 'ttb', 'rtl'],\n\t\tdefault: 'ltr',\n\t\tstrings: {\n\t\t\tltr: 'Left-to-right',\n\t\t\tttb: 'Top-to-bottom',\n\t\t\trtl: 'Right-to-left'\n\t\t},\n\t\thelp: {\n\t\t\tltr: 'Left-to-right reading mode.',\n\t\t\tttb: 'Vertical view.',\n\t\t\trtl: 'Right-to-left reading mode.'\n\t\t},\n\t\ttype: SETTING_MULTI\n\t})\n\t.newSetting({\n\t\taddr: 'lyt.gap',\n\t\tprettyName: 'Remove gaps in vertical view',\n\t\tdefault: false,\n\t\tstrings: {\n\t\t\ttrue: 'Gaps removed',\n\t\t\tfalse: 'Gaps applied'\n\t\t},\n\t\tcompact: true,\n\t\tcondition: {'lyt.direction': ['ttb']},\n\t\ttype: SETTING_BOOLEAN,\n\t\tglobal: true\n\t})\n\t.newSetting({\n\t\taddr: 'thm.theme',\n\t\tprettyName: 'Reader Theme',\n\t\toptions: ['Cubari', 'Classic', 'Reaper', 'Zaibatsu', 'Light', 'Custom'],\n\t\tdefault: 'Cubari',\n\t\tstrings: {\n\t\t\tCubari: 'Cubari',\n\t\t\tClassic: 'Classic',\n\t\t\tReaper: 'Reaper',\n\t\t\tLight: 'Light',\n\t\t\tZaibatsu: 'Zaibatsu',\n\t\t\tCustom: 'Custom...'\n\t\t},\n\t\ttype: SETTING_MULTI_DROPDOWN\n\t})\n\t.newSetting({\n\t\taddr: 'thm.primaryCol',\n\t\tprettyName: 'Interface Color',\n\t\tdefault: '#3A3F44',\n\t\tcondition: {'thm.theme': ['Custom']},\n\t\tcompact: true,\n\t\tglobal: false,\n\t\ttype: SETTING_COLOR\n\t})\n\t.newSetting({\n\t\taddr: 'thm.textCol',\n\t\tprettyName: 'Text Color',\n\t\tdefault: '#EEEEEE',\n\t\tcondition: {'thm.theme': ['Custom']},\n\t\tcompact: true,\n\t\tglobal: false,\n\t\ttype: SETTING_COLOR\n\t})\n\t.newSetting({\n\t\taddr: 'thm.accentCol',\n\t\tprettyName: 'Accent Color',\n\t\tdefault: '#B2DFFB',\n\t\tcondition: {'thm.theme': ['Custom']},\n\t\tcompact: true,\n\t\tglobal: false,\n\t\ttype: SETTING_COLOR\n\t})\n\t.newSetting({\n\t\taddr: 'thm.readerBg',\n\t\tprettyName: 'Reader Background',\n\t\tdefault: '#272B30',\n\t\tcondition: {'thm.theme': ['Custom']},\n\t\tcompact: true,\n\t\tglobal: false,\n\t\ttype: SETTING_COLOR\n\t})\n\t.newSetting({\n\t\taddr: 'thm.reset',\n\t\tprettyName: '',\n\t\toptions: [true,false],\n\t\tdefault: false,\n\t\tcompact: true,\n\t\tcondition: {'thm.theme': ['Custom'], 'thm.primaryCol': ['!#3A3F44', 'or'], 'thm.readerBg': ['!#272B30', 'or'], 'thm.accentCol': ['!#B2DFFB', 'or'], 'thm.textCol': ['!#EEEEEE', 'or']},\n\t\ttype: SETTING_BUTTON\n\t})\n\t.newSetting({\n\t\taddr: 'lyt.spread',\n\t\tprettyName: '2-page spread',\n\t\toptions: ['1', '2', '2-odd'],\n\t\tdefault: '1',\n\t\tstrings: {\n\t\t\t'1': '1-page layout',\n\t\t\t'2': '2-page layout',\n\t\t\t'2-odd': '2-page layout, odd'\n\t\t},\n\t\thelp: {\n\t\t\t'1': 'Single page displayed.',\n\t\t\t'2': 'Two pages at once.',\n\t\t\t'2-odd': 'Two pages at once, odd numbering.'\n\t\t},\n\t\ttype: SETTING_MULTI,\n\t\tpostUpdate: value => {\n\t\t\t({\n\t\t\t\t'1': v => {\n\t\t\t\t\tthis.set('adv.spreadCount', 1)\n\t\t\t\t\tthis.set('adv.spreadOffset', 0)\n\t\t\t\t},\n\t\t\t\t'2': v => {\n\t\t\t\t\tthis.set('adv.spreadCount', 2)\n\t\t\t\t\tthis.set('adv.spreadOffset', 0)\n\t\t\t\t},\n\t\t\t\t'2-odd': v => {\n\t\t\t\t\tthis.set('adv.spreadCount', 2)\n\t\t\t\t\tthis.set('adv.spreadOffset', 1)\n\t\t\t\t}\n\t\t\t})[value]()\n\t\t}\n\t})\n\t.newSetting({\n\t\taddr: 'adv.spreadCount',\n\t\tprettyName: 'Spread mode custom page count',\n\t\toptions: [1,2,3,4,5,6,7,8,9,10],\n\t\tdefault: 1,\n\t\tstrings: i => {\n\t\t\treturn '%ip'.replace('%i', i)\n\t\t},\n\t\tpostUpdate: () => this.update('adv.spreadOffset'),\n\t\ttype: SETTING_VALUE,\n\t\t// hidden: true\n\t})\n\t.newSetting({\n\t\taddr: 'adv.spreadOffset',\n\t\tprettyName: 'Spread mode custom page offset',\n\t\toptions: () => {\n\t\t\treturn [...Array(this.get('adv.spreadCount')).keys()]\n\t\t},\n\t\tdefault: 0,\n\t\tstrings: i => {\n\t\t\treturn '%ip'.replace('%i', i)\n\t\t},\n\t\tcondition: {'adv.spreadCount': ['!1']},\n\t\ttype: SETTING_VALUE,\n\t\t// hidden: true\n\t})\n\t.newSetting({\n\t\taddr: 'apr.selectorAnchor',\n\t\tprettyName: 'Page selector position',\n\t\toptions: ['left', 'bottom'],\n\t\tdefault: 'left',\n\t\tstrings: {\n\t\t\t'left': 'Left',\n\t\t\t'bottom': 'Bottom'\n\t\t},\n\t\thelp: {\n\t\t\t'left': 'Page selector is shown near the sidebar.',\n\t\t\t'bottom': 'Page selector is at the bottom of the page.'\t\n\t\t},\n\t\ttype: SETTING_MULTI,\n\t\tnomobile: true\n\t})\n\t.newSetting({\n\t\taddr: 'apr.selPinned',\n\t\tprettyName: 'Pin page selector',\n\t\tdefault: false,\n\t\tstrings: {\n\t\t\ttrue: 'Pinned',\n\t\t\tfalse: `Shown on ${IS_MOBILE?'tap':'hover'}`\n\t\t},\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t})\n\t.newSetting({\n\t\taddr: 'apr.selNum',\n\t\tprettyName: 'Page selector: show page number',\n\t\tdefault: true,\n\t\tstrings: {\n\t\t\ttrue: 'Show page number',\n\t\t\tfalse: 'Hide page number'\n\t\t},\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t})\n\t.newSetting({\n\t\taddr: 'apr.hoverinos',\n\t\tprettyName: 'Mouseover reader hints (next, prev)',\n\t\tdefault: true,\n\t\tstrings: {\n\t\t\ttrue: 'Visible',\n\t\t\tfalse: 'Hidden'\n\t\t},\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t\tnomobile: true\n\t})\n\t.newSetting({\n\t\taddr: 'apr.sidebar',\n\t\tprettyName: 'Show sidebar',\n\t\tdefault: true,\n\t\tstrings: {\n\t\t\ttrue: 'Show sidebar',\n\t\t\tfalse: 'Hide sidebar',\n\t\t},\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t\tnomobile: true\n\t})\n\t.newSetting({\n\t\taddr: 'apr.previews',\n\t\tprettyName: 'Show previews',\n\t\tdefault: false,\n\t\tstrings: {\n\t\t\ttrue: 'Show previews',\n\t\t\tfalse: 'Hide previews',\n\t\t},\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t\tnomobile: true\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.preload',\n\t\tprettyName: 'Page preload',\n\t\toptions: [1,2,3,4,5,6,7,8,9,100],\n\t\tdefault: (IS_MOBILE)?2:3,\n\t\tstrings: i => `${i}`.replace('100', '\u221e'),\n\t\ttype: SETTING_VALUE_STEPPED,\n\t\tglobal: false\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.scrollYDelta',\n\t\tprettyName: 'Vertical scroll speed using keyboard arrows',\n\t\toptions: [5, 10, 15, 20, 25, 30, 35, 40, 45, 50],\n\t\tdefault: 25,\n\t\tstrings: i => `${i}px`,\n\t\ttype: SETTING_VALUE,\n\t\tglobal: false,\n\t\tnomobile: true\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.resetScroll',\n\t\tprettyName: 'Reset page scroll after page flip',\n\t\tdefault: false,\n\t\tstrings: {\n\t\t\ttrue: 'Reset',\n\t\t\tfalse: 'Leave it be',\n\t\t},\n\t\thelp: {\n\t\t\ttrue: 'On page switch, resets vertical scroll of the previous page.',\n\t\t\tfalse: 'Vertical scroll on pages is saved.',\n\t\t},\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t\tglobal: false\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.clickTurnPage',\n\t\tprettyName: `Turn pages by ${IS_MOBILE ? 'tapping' : 'clicking'}`,\n\t\tstrings: {\n\t\t\ttrue: 'Turn page',\n\t\t\tfalse: 'Disabled',\n\t\t},\n\t\thelp: {\n\t\t\ttrue: `When ${IS_MOBILE ? 'tapping' : 'clicking'}, the page turns depending on the direction.`,\n\t\t\tfalse: `${IS_MOBILE ? 'Tapping' : 'Clicking'} on the page does not turn it.`,\n\t\t},\n\t\tdefault: true,\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.arrowTurnPage',\n\t\tprettyName: 'Turn pages with arrow keys in vertical view',\n\t\tstrings: {\n\t\t\ttrue: 'Turn page',\n\t\t\tfalse: 'Disabled',\n\t\t},\n\t\thelp: {\n\t\t\ttrue: 'Left and right arrow keys turn pages.',\n\t\t\tfalse: 'Left and right arrow keys do nothing.',\n\t\t},\n\t\tdefault: false,\n\t\tcompact: true,\n\t\ttype: SETTING_BOOLEAN,\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.swipeGestures',\n\t\tprettyName: `Enable swipe gestures`,\n\t\tstrings: {\n\t\t\ttrue: 'Swipe enabled',\n\t\t\tfalse: 'Swipe disabled',\n\t\t},\n\t\thelp: {\n\t\t\ttrue: `Allow using finger drag to turn the pages smoothly.`,\n\t\t\tfalse: `Finger drag will do nothing. Tap on the pages or use your keyboard to advance pages.`,\n\t\t},\n\t\tdefault: true,\n\t\tcompact: true,\n\t\tpostUpdate: (state) => {\n\t\t\tif(typeof Reader !== \"undefined\") {\n\t\t\t\tReader.imageView.setTouchHandlers(state);\n\t\t\t}\n\t\t},\n\t\ttype: SETTING_BOOLEAN,\n\t})\n\t.newSetting({\n\t\taddr: 'bhv.historyUpdate',\n\t\tprettyName: 'Browser history/back button behavior',\n\t\toptions: ['none','replace','chap','jump', 'all'],\n\t\tdefault: 'replace',\n\t\tstrings: {\n\t\t\t'none': \"Don't touch browser history\",\n\t\t\t'replace': \"Just change the page title\",\n\t\t\t'chap': \"Add every chapter to history\",\n\t\t\t'jump': \"Add every chapter and page&nbsp;skips\",\n\t\t\t'all': \"Add every move to history\"\n\t\t},\n\t\thelp: {\n\t\t\t'none': \"Page URL and title won't update at all.\",\n\t\t\t'replace': \"When you go to next chapter, page title and URL changes.\",\n\t\t\t'chap': \"Remembers chapters in browser history so you can go back with browser buttons.\",\n\t\t\t'jump': \"Also adds out-of-order page skips to history in addition to chapters.\",\n\t\t\t'all': \"Add every page flip to browser history.\"\n\t\t},\n\t\ttype: SETTING_MULTI,\n\t\tglobal: false\n\t})\n\t.newSetting({\n\t\taddr: 'misc.groupPreference',\n\t\tprettyName: 'Group preference',\n\t\ttype: SETTING_VALUE,\n\t\thidden: true,\n\t\tglobal: false\n\t})\n\t.newSetting({\n\t\taddr: \"adv.parallelDownloads\",\n\t\tprettyName: \"Number of parallel image downloads\",\n\t\toptions: [5, 10, 15, 20, 25, 30, 35, 40, 45, 50],\n\t\tdefault: 5,\n\t\ttype: SETTING_VALUE,\n\t\thidden: false,\n\t});\n\tthis.deserialize();\n\tthis.sendInit();\n}\n\nfunction SettingsPacket(type, settingAddr, value, source) {\n\tthis.type = type;\n\tthis.setting = settingAddr;\n\tthis.value = value;\n\tthis.source = source;\n\treturn this;\n}\n\nfunction UI_Tooltippy(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Tooltippy'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t});\n\t\n\tthis.attached = false;\n\n\tthis.handler = e => {\n\tvar tip = e.target.getAttribute('data-tip');\n\t\tif(tip) {\n\t\t\tthis.attached = true;\n\t\tvar rect = e.target.getBoundingClientRect()\n\t\tvar bodyRect = document.body.getBoundingClientRect();\n\t\tvar align = e.target.getAttribute('data-tip-align')\n\t\tvar offset = e.target._ttOffset || 2;\n\t\t\tthis.set(tip);\n\t\t\tthis.$.style.display = 'block';\n\t\t\tif(IS_MOBILE) return;\n\t\t\tif(align == 'right')\n\t\t\t\tthis.$.style.bottom = document.body.offsetHeight - (rect.top - bodyRect.top) - rect.height + this.$.offsetHeight + 2 + 'px';\n\t\t\telse\n\t\t\t\tthis.$.style.bottom = document.body.offsetHeight - (rect.top - bodyRect.top) + offset + 'px';\n\t\t\tif(e.pageX > window.innerWidth / 2) {\n\t\t\t\tthis.$.style.left = 'unset';\n\t\t\t\tthis.$.style.right = window.innerWidth - rect.left - rect.width + 'px';\n\t\t\t}else{\n\t\t\t\tthis.$.style.right = 'unset';\n\t\t\t\tif(align == 'right')\n\t\t\t\t\tthis.$.style.left = rect.left + rect.width + 4 + 'px';\n\t\t\t\telse\n\t\t\t\t\tthis.$.style.left = rect.left + 'px';\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.set = function(text) {\n\t\tif(text.length < 1) return;\n\t\ttext = text.replace(/\\[(.|Ctrl|Shift|Meta|Alt)\\]/g, '<span class=\"Tooltippy-key\">$1</span>');\n\t\tthis.$.innerHTML = text;\n\t\tif(!this.attached || IS_MOBILE) {\n\t\t\tthis.$.style.display = 'block';\n\t\t\tif(IS_MOBILE) {\n\t\t\t\tthis.$.style.bottom = window.innerHeight * 0.20 + 'px';\n\t\t\t}else{\n\t\t\t\tthis.$.style.bottom = window.innerHeight * 0.90 + 'px';\n\t\t\t}\n\t\t\tthis.$.style.left = 'unset';\n\t\t\tthis.$.style.right = Reader.imageView.$.offsetWidth / 2 - this.$.offsetWidth / 2 + 'px'; // TODO: REMOVE HARDCODE\n\t\t}\n\t\tthis.$.classList.remove('fadeOut');\n\t\tclearTimeout(this.fader);\n\t\tthis.fader = setTimeout(() => this.$.classList.add('fadeOut'), 3000);\n\n\t}\n\n\tthis.reset = function (e) { \n\t\tthis.attached = false;\n\t\tthis.$.style.display = 'none';\n\t}\n\n\tthis.attach = function(element, text, align, offset) {\n\t\telement.onmouseover = e => this.handler(e);\n\t\telement.onmouseleave = e => this.reset(e)\n\t\telement.setAttribute('data-tip', text);\n\t\tif(align) element.setAttribute('data-tip-align', align);\n\t\telement._ttOffset = offset;\n\t\treturn this;\n\t}\n\n}\n\nfunction UI_Reader(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Reader'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>',\n\t});\n\tLinkable.call(this);\n\n\tthis.SCP = {\n\t\tchapter: 1,\n\t\tpage: 0,\n\t};\n\n\tthis.loadingChapter = false;\n\n\tnew KeyListener(document.body)\n\t\t.attach('prevCh', ['BracketLeft'], e => this.prevChapter())\n\t\t.attach('nextCh', ['BracketRight'], e => this.nextChapter())\n\t\t.attach('prevVo', ['Comma'], e => this.prevVolume())\n\t\t.attach('nextVo', ['Period'], e => this.nextVolume())\n\t\t.attach('fit', ['KeyF'], e => Settings.cycle('lyt.fit'))\n\t\t.attach('layout', ['KeyD'], e => Settings.cycle('lyt.direction'))\n\t\t.attach('hide', ['KeyH'], e => this.$.classList.toggle('o'))\n\t\t.attach('sidebar', ['KeyS'], s => Settings.cycle('apr.sidebar'))\n\t\t.attach('pageSelector', ['KeyN'], s => Settings.cycle('apr.selPinned'))\n\t\t.attach('preload', ['KeyL'], s => Settings.cycle('bhv.preload'))\n\t\t.attach('spread', ['KeyQ'], s => Settings.cycle('lyt.spread'))\n\t\t.attach('spreadCount', ['KeyU'], s => Settings.cycle('adv.spreadCount'))\n\t\t.attach('spreadOffset', ['KeyI'], s => Settings.cycle('adv.spreadOffset'))\n\t\t.attach('share', ['KeyR'], s => this.copyShortLink(s))\n\t\t.attach('enter', ['Enter'], s => {\n\t\t\tif(this.SCP.page == this.SCP.lastPage)\n\t\t\t\tthis.nextChapter();\n\t\t})\n\t\t.attach('options', ['KeyO'], e => Loda.display('settings'))\n\t\t.attach('jump', ['KeyJ'], e => Loda.display('jump'))\n\n\t\t\n\tnew KeyListener(document.body)\n\t\t.condition(() => ['width','width_limit'].includes(Settings.get('lyt.fit')))\n\t\t.attach('minus', ['Minus'], s => Settings.prev('lyt.zoom', undefined, true))\n\t\t.attach('plus', ['Equal'], s => Settings.next('lyt.zoom', undefined, true))\n\t\t\n\tnew KeyListener(document.body)\n\t\t.condition(() => Settings.get('lyt.direction') == 'ltr')\n\t\t.attach('prev', ['ArrowLeft'], e => this.prevPage())\n\t\t.attach('next', ['ArrowRight'], e => this.nextPage());\n\t\t\n\tnew KeyListener(document.body)\n\t\t.condition(() => Settings.get('lyt.direction') == 'rtl')\n\t\t.attach('prev', ['ArrowRight'], e => this.prevPage())\n\t\t.attach('next', ['ArrowLeft'], e => this.nextPage());\n\n\tnew KeyListener(document.body)\n\t\t.condition(() => Settings.get('bhv.arrowTurnPage') && Settings.get('lyt.direction') == 'ttb')\n\t\t.attach('prev', ['ArrowLeft'], e => this.prevPage())\n\t\t.attach('next', ['ArrowRight'], e => this.nextPage());\n\n\tlet refocus = (e) => {\n\t\tif(this.imageView.getScrollElement()) this.imageView.getScrollElement().focus();\n\t}\n\n\tnew KeyListener(document.body)\n\t\t.pass()\n\t\t.attach('pgdn', ['PageDown'], refocus)\n\t\t.attach('pgup', ['PageUp'], refocus)\n\t\t.attach('home', ['Home'], refocus)\n\t\t.attach('end', ['End'], refocus)\n\t\t.attach('space', ['Space'], refocus)\n\n\n\tthis.selector_chap = new UI_FauxDrop({\n\t\tnode: this._.selector_chap\n\t})\n\tthis.selector_chap.S.linkAnonymous('value', value => {\n\t\tthis.initChapter(value, 0);\n\t});\n\n\tthis.selector_vol = new UI_FauxDrop({\n\t\tnode: this._.selector_vol\n\t})\n\tthis.selector_vol.S.linkAnonymous('value', value => this.selectVolume(value));\n\n\tthis.imageView = new UI_ReaderImageView({\n\t\tnode: this._.image_viewer\n\t}).S.link(this);\n\n\tthis.groupList = new UI_Tabs({\n\t\tnode: this._.groups\n\t}).S.linkAnonymous('id', id => this.drawGroup(id));\n\n\tthis.selector_page = new UI_PageSelector({\n\t\tnode: this._.page_selector\n\t})\n\tthis.selector_page.S.linkAnonymous('page', id => this.displayPage(id));\n\n\tthis.messageBox = new UI_MessageBox({\n\t\tnode: this._.message\n\t})\n\tthis.previews = new UI_Tabs({\n\t\tnode: this._.previews\n\t}).S.linkAnonymous('number', id => this.displayPage(id));\n\n\tthis.asideViews = new UI_WindowedContainerList({\n\t\tnode: this._.aside_views,\n\t\tdynamicHide: true\n\t})\n\t//views: fit\n\t// this.fitView = new UI_ButtonGroup({\n\t// \tnode: this._.aside_views_fit,\n\t// \tlinkedSetting: 'lyt.fit'\n\t// }).S.biLink(Settings);\n\n\tthis.updateData = function(data) {\n\t\tthis.current = data;\n\t}\n\n\tthis.controlFeatures = function(isFirstParty) {\n\t\tif (isFirstParty) {\n\t\t\tnew KeyListener(document.body)\n\t\t\t\t.attach('search', ['Ctrl+KeyF'], s => {\n\t\t\t\t\tLoda.display('search')\n\t\t\t\t})\n\t\t\t\t.attach('previews', ['KeyP'], s => Settings.cycle('apr.previews'))\n\t\t} else {\n\t\t\tdocument.querySelector(\"[data-bind='search']\").style.display = 'none';\n\t\t\tdocument.querySelector(\".rdr-previews\").style.display = 'none';\n\t\t\tthis.plusOne = () => {};\n\t\t}\n\t}\n\n\tthis.setSCP = function(SCP) {\n\t\tif(SCP.series) this.SCP.series = SCP.series;\n\t\tif(SCP.chapter) this.SCP.chapter = SCP.chapter;\n\t\tif(SCP.page) this.SCP.page = SCP.page;\n\t}\n\tthis.displaySCP = function(SCP) {\n\t\tthis.drawReader(SCP.series);\n\t\tthis.initChapter(SCP.chapter, SCP.page, SCP.group);\n\t\tthis.S.out('init');\n\t}\n\n\tthis.drawReader = function(slug) {\n\t\tif(slug) this.SCP.series = slug;\n\t\tthis.SCP.lastChapter = this.current.chaptersIndex[this.current.chaptersIndex.length - 1];\n\t\tthis.SCP.firstChapter = this.current.chaptersIndex[0];\n\t\tlet path = window.location.pathname.split(\"/\").map(e => decodeURIComponent(e));\n\t\tthis._.title.innerHTML = \"\";\n\t\tlet seriesPageLink = document.createElement(\"a\");\n\t\tseriesPageLink.textContent = this.current.title || \"No title\";\n\t\tseriesPageLink.href = `${path.splice(0, path.indexOf(decodeURIComponent(this.current.slug))).join(\"/\")}/${this.current.slug}/`;\n\t\tthis._.title.appendChild(seriesPageLink);\n\t\tthis.$.querySelector('aside').classList.remove('unload');\n\t\tvar chapterElements = [];\n\t\tvar volElements = {};\n\t\tfor (var i = this.current.chaptersIndex.length - 1; i >= 0; i--) {\n\t\t\tvar chapterId = this.current.chaptersIndex[i];\n\t\t\tvar chapter = this.current.chapters[chapterId];\n\t\t\tvar chapterNumber = parseFloat(chapter.chapter) || chapterId;\n\t\t\tchapterElements.push({\n\t\t\t\ttext: chapterNumber + ' - ' + chapter.title,\n\t\t\t\tvalue: chapterId\n\t\t\t});\n\n\t\t}\n\t\tvolElements = Object.keys(this.current.volMap).sort((a,b) => parseFloat(b) - parseFloat(a)).map(item => {\n\t\t\treturn {\n\t\t\t\tvalue: item,\n\t\t\t}\n\t\t});\n\n\t\tthis.selector_chap.clear().add(chapterElements);\n\t\tthis.selector_vol.clear().add(volElements);\n\n\t\tsetTimeout(() => {\n\t\t\tthis._.page_selector.classList.remove('vis')\n\t\t\tthis._.zoom_level.classList.remove('vis')\n\t\t}, 3000);\n\t\t// this._.close.href = `/read/${window.location.pathname.split('/')[2]}/${this.SCP.series}`;\n\t}\n\n\tthis.drawGroup = function(group) {\n\t\tSettings.set('misc.groupPreference', group);\t\n\t\tthis.initChapter();\n\t}\n\n\tthis.fetchChapter = function(chapter, group) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!chapter) {\n\t\t\t\treject(\"Chapter is a required parameter.\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.loadingChapter = true;\n\t\t\tlet targetChapter = this.current.chapters[chapter];\n\t\t\t// In case group is 0.\n\t\t\tif (group === undefined || group === null) {\n\t\t\t\tgroup = this.getGroup(chapter);\n\t\t\t}\n\t\t\t// TODO there's a possible race condition here\n\t\t\tif (!targetChapter.loaded[group]\n\t\t\t\t&& targetChapter.pageRequest[group]) {\n\t\t\t\ttargetChapter.pageRequest[group]().then(() => {\n\t\t\t\t\tdelete targetChapter.pageRequest[group];\n\t\t\t\t\ttargetChapter.loaded[group] = true;\n\t\t\t\t\tthis.loadingChapter = false;\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.loadingChapter = false;\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tthis.initChapter = function(chapter, page, group) {\n\t\tif (chapter) this.SCP.chapter = chapter;\n\t\tthis.loadingChapter = true;\n\t\tthis.SCP.chapterObject = this.current.chapters[this.SCP.chapter];\n\t\tthis.SCP.volume = this.SCP.chapterObject.volume;\n\t\tthis.SCP.chapterName = this.SCP.chapterObject.title;\n\t\tif(group !== undefined && group !== null && this.SCP.chapterObject.groups[group])\n\t\t\tthis.SCP.group = group;\n\t\telse\n\t\t\tthis.SCP.group = this.getGroup(chapter);\n\n\t\tif (!this.SCP.chapterObject.loaded[this.SCP.group] && this.SCP.chapterObject.images[this.SCP.group].length === 0) {\n\t\t\t// TODO This code is now redundant, it should be part of a bigger refactor\n\t\t\tthis.SCP.chapterObject.pageRequest[this.SCP.group]().then((count) => {\n\t\t\t\tdelete this.SCP.chapterObject.pageRequest[this.SCP.group]; // Save some memory, :kaguyaSmug:\n\t\t\t\tthis.SCP.chapterObject.loaded[this.SCP.group] = true;\n\t\t\t\tthis.SCP.pageCount = count;\n\t\t\t\tthis.SCP.lastPage = count - 1;\n\t\t\t\tthis.loadingChapter = false;\n\t\t\t\tthis.bootstrapChapter(page);\n\t\t\t});\n\t\t} else if (this.SCP.chapterObject.loaded[this.SCP.group]) {\n\t\t\tif(this.SCP.chapterObject.notice) {\n\t\t\t\tthis.SCP.pageCount = 1;\n\t\t\t\tthis.SCP.lastPage = 0;\t\t\t\t\n\t\t\t}else{\n\t\t\t\tthis.SCP.pageCount = this.SCP.chapterObject.images[this.SCP.group].length;\n\t\t\t\tthis.SCP.lastPage = this.SCP.pageCount - 1;\n\t\t\t}\n\t\t\tthis.loadingChapter = false;\n\t\t\tthis.bootstrapChapter(page);\n\t\t}\n\t}\n\n\tthis.getGroup = function(chapter, getDefault) {\n\t\tlet chapterObj = this.current.chapters[chapter || this.SCP.chapter];\n\n\t\tif(!getDefault) {\n\t\t\tif(Settings.get('misc.groupPreference') !== undefined\n\t\t\t&& chapterObj.groups[Settings.get('misc.groupPreference')] !== undefined)\n\t\t\t\treturn Settings.get('misc.groupPreference');\n\t\t}\n\n\t\tif(chapterObj.preferred_sort){\n\t\t  for(var i=0;i<chapterObj.preferred_sort.length;i++){\n\t\t\tif(chapterObj.groups[chapterObj.preferred_sort[i]])\n\t\t\t  return chapterObj.preferred_sort[i]\n\t\t  }\n\t\t}\n\n\t\tif(this.current.preferred_sort){\n\t\t  for(var i=0;i<this.current.preferred_sort.length;i++){\n\t\t\tif(chapterObj.groups[this.current.preferred_sort[i]])\n\t\t\t  return this.current.preferred_sort[i];\n\t\t  }\n\t\t}\n\n\t\treturn Object.keys(chapterObj.groups)[0];\n\t}\n\n\tthis.boostrapChapterInterface = function(page) {\n\t\tif(this.SCP.chapter == this.SCP.lastChapter) {\n\t\t\tthis._.chap_next.classList.add('disabled');\n\t\t\tthis.$.classList.add('last-chapter');\n\t\t}else{\n\t\t\tthis._.chap_next.classList.remove('disabled');\n\t\t\tthis.$.classList.remove('last-chapter');\n\t\t}\n\t\tif(this.SCP.chapter == this.SCP.firstChapter) {\n\t\t\tthis._.chap_prev.classList.add('disabled');\n\t\t}else{\n\t\t\tthis._.chap_prev.classList.remove('disabled');\n\t\t}\n\t\tif(this.SCP.volume >= Math.max.apply(null, Object.keys(this.current.volMap))) {\n\t\t\tthis._.vol_next.classList.add('disabled');\n\t\t}else{\n\t\t\tthis._.vol_next.classList.remove('disabled');\n\t\t}\n\t\tif(this.SCP.volume <= Math.min.apply(null, Object.keys(this.current.volMap))) {\n\t\t\tthis._.vol_prev.classList.add('disabled');\n\t\t}else{\n\t\t\tthis._.vol_prev.classList.remove('disabled');\n\t\t}\n\n\t\tthis._.page_selector.classList.add('vis')\n\t\tsetTimeout(() => this._.page_selector.classList.remove('vis'), 3000);\n\t}\n\n\tthis.bootstrapChapter = function(page) {\n\t\tthis.shuffleRandomChapter();\n\t\tif(this.SCP.chapterObject.notice) {\n\t\t\tthis.imageView.displayNotice();\n\t\t\tthis.selector_chap.set(this.SCP.chapter, true);\n\t\t\tthis.selector_vol.set(this.SCP.volume, true);\n\t\t\tthis.boostrapChapterInterface();\n\t\t\tthis.selector_page.clearPreload();\n\t\t\tthis.displayPage(0);\n\t\t\tthis.drawGroups(true);\n\t\t\tthis.drawPreviews(false);\n\t\t\treturn this;\n\t\t}\n\t\tthis.drawGroups();\n\t\tthis.drawPreviews();\n\n\t\tthis.imageView.drawImages(this.SCP.chapterObject.images[this.SCP.group], this.SCP.chapterObject.wides[this.SCP.group]);\n\n\t\tthis.selector_chap.set(this.SCP.chapter, true);\n\t\tthis.selector_vol.set(this.SCP.volume, true);\n\n\t\tthis.boostrapChapterInterface();\n\n\t\tthis.selector_page.clearPreload();\n\t\tthis.imageView.updateScrollPosition();\n\t\tthis.displayPage(page);\n\t\t// this._.comment_button.href = '/reader/series/' + this.SCP.series + '/' + this.SCP.chapter + '/comments'\n\t\tthis.plusOne();\n\t\treturn this;\n\t}\n\n\tthis.drawGroups = (clear) => {\n\t\tthis.groupList.clear();\n\t\tif(clear) return; \n\tlet groupElements = {};\n\t\tfor(let grp in this.SCP.chapterObject.groups) {\n\t\t\tgroupElements[grp] = new UI_SimpleListItem({\n\t\t\t\thtml: '<div' + ((grp==this.SCP.group)?' class=\"is-active\"':'') + '></div>',\n\t\t\t\ttext: this.current.groups[grp]\n\t\t\t})\n\t\t}\n\t\tthis.groupList.addMapped(groupElements);\n\t}\n\n\tthis.displayPage = (page, dry) => {\n\t\tif(page == 'last')\n\t\t\tthis.SCP.page = this.SCP.lastPage;\n\t\telse\n\t\t\tif(page !== undefined) this.SCP.page = page;\n\t\ttry {\n\t\t\tthis.SCP.page = this.imageView.imageWrappersMask[this.imageView.imageWrappersMap[this.SCP.page]][0]\n\t\t} catch (e) {\n\t\t\tthis.SCP.page = this.SCP.page;\n\t\t}\n\t\tthis.imageView.selectPage(this.SCP.page, dry);\n\t\tthis.SCP.visiblePages = this.imageView.visiblePages;\n\n\t\t//if last page\n\t\tif(HAS_LOCALSTORAGE\n\t\t&& this.imageView.visiblePages\n\t\t&& this.imageView.visiblePages.includes(this.SCP.lastPage)\n\t\t&& !this.SCP.chapterObject.notice){\n\t\t\tlet source = window.location.pathname.split(\"/\");\n\t\t\tsource = source[source.indexOf(this.SCP.series) - 1];\n\t\t\tglobalHistoryHandler.addChapter(decodeURIComponent(this.SCP.series), source, this.SCP.chapter.toString());\n\t\t}\n\t\tthis.S.out('SCP', this.SCP);\n\t}\n\n\tthis.drawPreviews = (state) => {\n\t\tstate = state==undefined?Settings.get('apr.previews'):state;\n\t\tthis.previews.clear();\n\t\tif(state == true) {\n\t\t\tthis.current.chapters[this.SCP.chapter].previews[this.SCP.group].forEach(\n\t\t\t\tpreview => {\n\t\t\t\t\tthis.previews.add(new UI_Dummy({\n\t\t\t\t\t\thtml: \"<img src='\"+preview+\"' />\"\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t)\n\t\t\tthis.previews.select(this.SCP.page, undefined, undefined, true);\n\t\t}\n\t}\n\n\tthis.selectVolume = function(vol) {\n\t\tif(this.current.volMap[vol])\n\t\t\tthis.initChapter(this.current.volMap[vol]);\n\t}\n\n\tthis.plusOne = function() {\n\t\tclearTimeout(this.plusOneTimer);\n\t\tthis.plusOneTimer = setTimeout(i => {\n\t\tvar formData = new FormData();\n\t\t\tformData.append(\"series\", this.SCP.series)\n\t\t\tformData.append(\"group\", this.SCP.group)\n\t\t\tformData.append(\"chapter\", this.SCP.chapter)\n\t\t\tfetch('/read/update_view_count/', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: formData\n\t\t\t})\n\t\t}, 20*1000)\n\t}\n\n\n\tthis.nextChapter = function(){\n\t\tif (this.loadingChapter) return;\n\t\tif(this.SCP.chapter != this.SCP.lastChapter) {\n\t\tvar index = this.current.chaptersIndex.indexOf(''+this.SCP.chapter);\n\t\t\tif(index < 0) throw new Error('Chapter advance failed: invalid base index.')\n\t\t\tthis.initChapter(\n\t\t\t\tthis.current.chaptersIndex[index + 1],\n\t\t\t\t0\n\t\t\t)\n\t\t}\n\t}\n\tthis.prevChapter = function(page) {\n\t\tif (this.loadingChapter) return;\n\t\tif(this.SCP.chapter != this.SCP.firstChapter) {\n\t\tvar index = this.current.chaptersIndex.indexOf(''+this.SCP.chapter);\n\t\t\tif(index < 0) throw new Error('Chapter stepback failed: invalid base index.')\n\t\t\tthis.initChapter(\n\t\t\t\tthis.current.chaptersIndex[index - 1],\n\t\t\t\tpage || 0\n\t\t\t)\n\t\t}\n\t}\n\n\tthis.nextPage = function() {\n\t\tif (this.loadingChapter) return;\n\tlet nextWrapperIndex = this.imageView.imageWrappersMap[this.SCP.page] + 1;\n\t\t\n\t\tif(nextWrapperIndex >= this.imageView.imageWrappersMask.length) {\n\t\t\tthis.nextChapter();\n\t\t} else {\n\t\t\tthis.displayPage(this.imageView.imageWrappersMask[nextWrapperIndex][0])\n\t\t}\n\t}\n\n\tthis.prevPage = function(){\n\t\tif (this.loadingChapter) return;\n\t\tif(this.SCP.page > 0) \n\t\t\tthis.displayPage(this.SCP.page - 1)\n\t\telse {\n\t\t\tthis.prevChapter('last');\n\t\t}\n\t}\n\tthis.nextVolume = function(){\n\t\tif (this.loadingChapter) return;\n\t\tthis.selectVolume(+this.SCP.volume+1);\n\t}\n\tthis.prevVolume = function(){\n\t\tif (this.loadingChapter) return;\n\t\tthis.selectVolume(+this.SCP.volume-1)\n\t}\n\n\tthis.copyShortLink = function() { \n\t\t// TODO: hard-coded values is meh\n\t\tlet url = document.location.href + document.location.hash;\n\tvar chapter = '' + (this.SCP.chapterObject.notice? +this.SCP.chapter-1 : this.SCP.chapter);\n\t\tif (document.location.pathname.includes(\"Kaguya-Wants-To-Be-Confessed-To/\")) {\n\t\t\turl = document.location.origin + '/' + chapter.replace('.', '-') + '/'+ (this.SCP.page+1) + document.location.hash;\n\t\t}\n\t\tnavigator.clipboard.writeText(url)\n\t\t.then(function() {\n\t\t  Tooltippy.set('Link copied to clipboard!');\n\t\t}, function(err) {\n\t\t  Tooltippy.set('Link copy failed ('+url+')');\n\t\t});\n\t}\n\n\tthis.openComments = function() {\n\t\tif(this.SCP.series && this.SCP.chapter !== undefined)\n\t\t\twindow.location.href = '/read/manga/' + this.SCP.series + '/' + this.SCP.chapter + '/comments';\n\t}\n\n\tthis.setLayout = (layout, silent) => {\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.recalculateBuffer();\n\t\t\tthis.stickHeader();\n\t\t})\n\t\tdocument.documentElement.style.overflow = \"auto\";\n\n\t\tif(!silent) {\n\t\t\tthis.imageView.drawImages(this.current.chapters[this.SCP.chapter].images[this.SCP.group], this.current.chapters[this.SCP.chapter].wides[this.SCP.group]);\n\t\t\tthis.imageView.selectPage(this.SCP.page);\n\t\t\tif(Settings.get('bhv.swipeGestures') && Settings.get('lyt.direction') != 'ttb'){\n\t\t\t\tthis.imageView.setTouchHandlers(true);\n\t\t\t}else{\n\t\t\t\tthis.imageView.setTouchHandlers(false);\n\t\t\t}\n\n\t\t}\n\t}\t\n\n\tthis.recalculateBuffer = () => {\n\t\tif (IS_MOBILE) {\n\t\t\tthis.headerScroll = this.imageView.getScrollElement().scrollTop;\n\t\t\tif (Settings.get('lyt.direction') === 'ttb' && Settings.get('apr.selPinned')) {\n\t\t\tvar tOH = this._.title.offsetHeight;\n\t\t\tvar sOH = this._.rdr_selector.offsetHeight;\n\t\t\t\t// Order of these statements seem to matter for Chrome's scroll shifting behaviour; if height is\n\t\t\t\t// set before top, the scroll bug occurs. Thus, it might break in future updates.\n\t\t\t\tthis._.rdr_selector.style.top = tOH + 'px';\n\t\t\t\tthis._.rdr_aside_buffer.style.height = tOH + sOH + 'px';\n\t\t\t\t// console.log(window.scrollY); // This statement also reintroduces the scroll bug regardless of order\n\t\t\t} else {\n\t\t\t\tthis._.rdr_aside_buffer.style.height = '0px';\n\t\t\t}\n\t\t}\n\t}\n\tthis.stickHeader = () => {\n\t\tif(IS_MOBILE) {\n\t\t\tif(Settings.get('lyt.direction') == 'ttb' && Settings.get('apr.selPinned')) {\n\t\t\t\tthis.$.classList.add('stick');\n\t\t\t}else{\n\t\t\t\tthis.$.classList.remove('stick');\n\t\t\t}\n\t\t\tif(this.headerScroll && this.imageView.getScrollElement().scrollTop != this.headerScroll) {\n\t\t\t\tthis.imageView.getScrollElement().scrollTo({top: this.headerScroll});\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis.imageView.getScrollElement().scrollTo({top: this.headerScroll});\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tthis.imageView.getScrollElement().scrollTo({top: this.headerScroll});\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.setZoom = function(zoom) {\n\t\tSettings.setClass('lyt.zoom');\n\t\tthis.imageView.updateWides();\n\t}\n\n\tthis.toggleSidebar = function(state) {\n\t\tthis.imageView.updateScrollPosition();\n\t\tSettings.setClass('apr.sidebar');\n\t\tthis.imageView.updateWides();\n\t}\n\n\tthis.enqueuePreload = images => {\n\t\timages.filter(item => item !== undefined)\n\t\t\t.slice(0,4)\n\t\t\t.forEach((img, i) => this._.preload_entity.children[i].src = img.url);\n\t}\n\n\tthis.eventRouter = function(event){\n\t\t({\n\t\t\t'nextPage': () => this.nextPage(),\n\t\t\t'prevPage': () => this.prevPage(),\n\t\t\t'newPageIndex': (page) => {\n\t\t\t\tthis._.image_description.textContent = this.current.chapters[this.SCP.chapter].descriptions[this.SCP.group][page];\n\t\t\t}\n\t\t})[event.type](event.data)\n\t}\n\n\tthis.settingsRouter = function(o) {\n\t\tif(o.type != 'change') return;\n\tvar settings = {\n\t\t\t'lyt.fit': o => {\n\t\t\t\tthis.imageView.updateWides();\n\t\t\t},\n\t\t\t'lyt.direction': o => this.setLayout(o),\n\t\t\t'lyt.zoom': o => this.setZoom(o),\n\t\t\t'adv.spreadCount': o => this.bootstrapChapter(),\n\t\t\t'adv.spreadOffset': o => this.bootstrapChapter(),\n\t\t\t'bhv.preload': number => {\n\t\t\t\tthis.$.setAttribute('data-preload', number);\n\t\t\t},\n\t\t\t'apr.sidebar': o => this.toggleSidebar(o),\n\t\t\t'apr.selPinned': o => this.setLayout(o, true),\n\t\t\t'apr.previews': o => this.drawPreviews(o),\n\t\t\t'thm.reset' : o => {\n\t\t\t\tThemeManager.themeUpdated()\n\t\t\t},\n\t\t\t'thm.theme' : o => ThemeManager.themeUpdated(),\n\t\t\t'thm.primaryCol' : o => ThemeManager.themeUpdated(),\n\t\t\t'thm.readerBg' : o => ThemeManager.themeUpdated(),\n\t\t\t'thm.accentCol' : o => ThemeManager.themeUpdated(),\n\t\t\t'thm.textCol' : o => ThemeManager.themeUpdated(),\n\t\t\t'misc.groupPreference': o => {},\n\t\t};\n\t\tif(settings[o.setting]) settings[o.setting](o.value);\n\t}\n\n\tthis.shuffleRandomChapter = function() {\n\t\tif(this.SCP.chapter == '46.5' && this.SCP.series == 'Kaguya-Wants-To-Be-Confessed-To') {\n\t\t\tthis._.random_chapter.classList.remove('is-hidden');\n\t\t} else {\n\t\t\tthis._.random_chapter.classList.add('is-hidden');\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.current.chapters[this.SCP.chapter].previewsBackup)\n\t\t\tthis.current.chapters[this.SCP.chapter].previewsBackup = this.current.chapters[this.SCP.chapter].previews[this.SCP.group].slice();\n\t\tvar previews = this.current.chapters[this.SCP.chapter].previewsBackup;\n\t\tvar pages = this.current.chapters[this.SCP.chapter].images[this.SCP.group];\n\t\tfunction shuffle(array) {\n\t\t\tvar currentIndex = array.length, temporaryValue, randomIndex;\n\t\t\twhile (0 !== currentIndex) {\n\t\t\t\trandomIndex = Math.floor(Math.random() * currentIndex);\n\t\t\t\tcurrentIndex -= 1;\n\t\t\t\ttemporaryValue = array[currentIndex];\n\t\t\t\tarray[currentIndex] = array[randomIndex];\n\t\t\t\tarray[randomIndex] = temporaryValue;\n\t\t\t}\n\t\t\treturn array;\n\t\t}\n\tvar subarr = previews.slice(4,16);\n\t\tsubarr.unshift(subarr.pop());\n\tvar uarr = [];\n\t\tfor(var i=0; i<subarr.length; i=i+2) {\n\t\t\tuarr.push([subarr[i], subarr[i+1]])\n\t\t\tshuffle(uarr[uarr.length-1]);\n\t\t}\n\t\tuarr = shuffle(uarr);\n\t\tuarr = uarr.reduce((acc, val) => acc.concat(val), []);\n\n\t\tthis.current.chapters[this.SCP.chapter].previews[this.SCP.group] = previews.slice(0, 4).concat(uarr,previews.slice(-1));\n\t\tthis.current.chapters[this.SCP.chapter].images[this.SCP.group] = this.current.chapters[this.SCP.chapter].previews[this.SCP.group].map(p => p.replace('_shrunk',''))\n\t}\n\n\tthis._.chap_prev.onmousedown = e => this.prevChapter();\n\tthis._.chap_next.onmousedown = e => this.nextChapter();\n\tthis._.vol_prev.onmousedown = e => this.prevVolume();\n\tthis._.vol_next.onmousedown = e => this.nextVolume();\n\tthis._.settings_button.onmousedown = e => Loda.display('settings');\n\tnew UI_MultiStateButton({node: this._.preload_button, setting: 'bhv.preload'}).S.biLink(Settings);\n\tnew UI_MultiStateButton({node: this._.layout_button, setting: 'lyt.direction'}).S.biLink(Settings);\n\tnew UI_MultiStateButton({node: this._.fit_button, setting: 'lyt.fit'}).S.biLink(Settings);\n\tnew UI_MultiStateButton({node: this._.sel_pin_button, setting: 'apr.selPinned'}).S.biLink(Settings);\n\tnew UI_MultiStateButton({node: this._.sidebar_button, setting: 'apr.sidebar'}).S.biLink(Settings);\n\tnew UI_MultiStateButton({node: this._.previews_button, setting: 'apr.previews'}).S.biLink(Settings);\n\tnew UI_MultiStateButton({node: this._.spread_button, setting: 'lyt.spread'}).S.biLink(Settings);\n\t// this._.fit_button.onmousedown = e => {\n\t// \tthis.asideViews.S.call('number', 0);\n\t// }\n\tthis._.zoom_level_plus.onmousedown = e => {\n\t\tthis.imageView.updateScrollPosition();\n\t\tSettings.next('lyt.zoom', undefined, true);\n\t}\n\tthis._.zoom_level_minus.onmousedown = e => {\n\t\tthis.imageView.updateScrollPosition();\n\t\tSettings.prev('lyt.zoom', undefined, true);\n\t}\n\tthis._.share_button.onmousedown = e => this.copyShortLink(e);\n\tthis._.search.onclick = e => Loda.display('search');\n\tthis._.jump.onclick = e => Loda.display('jump');\n\tthis._.download_chapter.onclick = () => DownloadManagerObj.downloadChapter();\n\tthis._.download_cancel.onclick = () => DownloadManagerObj.cancelDownload();\n\tthis._.random_chapter_button.addEventListener('mousedown', e => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tthis.initChapter(this.SCP.chapter, 2);\n\t\treturn false;\n\t}, false)\n\n\tTooltippy\n\t\t.attach(this._.chap_prev, 'Previous chapter [[]')\n\t\t.attach(this._.chap_next, 'Next chapter []]')\n\t\t.attach(this._.vol_prev, 'Previous volume [,]')\n\t\t.attach(this._.vol_next, 'Next volume [.]')\n\t\t.attach(this._.preload_button, 'Change preload [L]')\n\t\t.attach(this._.layout_button, 'Change layout direction [D]')\n\t\t.attach(this._.fit_button, 'Change fit mode [F]')\n\t\t.attach(this._.sel_pin_button, 'Pin page selector [N]')\n\t\t.attach(this._.sidebar_button, 'Show/hide sidebar [S]', 'right')\n\t\t.attach(this._.previews_button.querySelector('.expander'), 'Show previews [P]')\n\t\t.attach(this._.share_button, 'Copy short link [R]')\n\t\t.attach(this._.search, 'Search the manga... [Ctrl]+[F]')\n\t\t.attach(this._.jump, 'Jump to chapter... [J]')\n\t\t.attach(this._.spread_button, 'Change two-page mode [Q]')\n\t\t.attach(this._.settings_button, 'Advanced settings... [O]')\n\t\t.attach(this._.download_chapter, 'Download chapter in the background')\n\t\t//.attach(this._.comment_button, 'Go to comments [C]')\n\t\t// .attach(this._.fit_none, 'Images are displayed in natural resolution.')\n\t\t// .attach(this._.fit_all, 'Images expand to width or height.')\n\t\t// .attach(this._.fit_width, 'Images expand to max width.')\n\t\t// .attach(this._.fit_height, 'Images expand to max height.')\n\t\t// .attach(this._.fit_all_limit, 'Natural image size that does not exceed max width or height.')\n\t\t// .attach(this._.fit_width_limit, 'Natural image size that does not exceed max width.')\n\t\t// .attach(this._.fit_height_limit, 'Natural image size that does not exceed max height.')\n\t\t// .attach(this._.zoom_level_plus, 'Increase zoom level')\n\t\t// .attach(this._.zoom_level_minus, 'Decrease zoom level')\n\n\tthis.S.mapIn({\n\t\tseriesUpdated: this.updateData,\n\t\tisFirstParty: this.controlFeatures,\n\t\tevent: this.eventRouter,\n\t\tsettingsPacket: this.settingsRouter,\n\t\tmessage: message => {\n\t\t\tTooltippy.set(message);\n\t\t},\n\t})\n\n\tthis.S.link(this.selector_page);\n\tthis.S.linkAnonymous('SCP', SCP => this.previews.select(SCP.page, undefined, undefined, true));\n}\n\nfunction UI_ReaderImageView(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ReaderImageView'].concat(o.kind || []),\n\t});\n\tLinkable.call(this);\n\tthis.firstDraw = true;\n\tthis.imageContainer = new UI_Tabs({\n\t\tnode: this._.image_container,\n\t\theld: true\n\t})\n\tthis.wrappers = {};\n\t\n\tthis.getScrollElement = function() {\n\t\tif(Loda.open) return {\n\t\t\tfocus: () => {},\n\t\t\tscroll: () => {}\n\t\t};\n\t\tif(Settings.get('lyt.direction') == 'ttb') {\n\t\t\tif(IS_MOBILE) {\n\t\t\t\treturn document.documentElement;\n\t\t\t}else{\n\t\t\t\treturn this._.image_container;\n\t\t\t}\n\t\t}else{\n\t\t\treturn this.wrappers.current.$;\n\t\t}\n\t}\n\n\tnew KeyListener(document.body, 'hold')\n\t\t.attach('slideDown', ['ArrowDown'], (e, frame) => {\n\t\tvar scr = this.getScrollElement();\n\t\t\tscroll(scr, scr.scrollLeft,scr.scrollTop + Settings.get('bhv.scrollYDelta')*Math.min((frame+1)*2/20,1), true)\n\t\t})\n\t\t.attach('slideUp', ['ArrowUp'], (e, frame) => {\n\t\tvar scr = this.getScrollElement();\n\t\t\tscroll(scr, scr.scrollLeft,scr.scrollTop - Settings.get('bhv.scrollYDelta')*Math.min((frame+1)*2/20,1), true)\n\t\t});\n\n\tthis.scroll = {\n\t\tprevY: 0,\n\t\tdirection: null,\n\t\tanchorObject: null,\n\t\tanchorOffset: 0,\n\t\tanchorRAF: 0,\n\t\tanchorTimeout: 0\n\t}\n\n\tdocument.onscroll = this._.image_container.onscroll = e => {\n\t\tif(PROGRAMMATIC_SCROLL) return true;\n\t\tif(!this.imageList) return true;\n\t\tif(Settings.get('lyt.direction') != 'ttb') return true;\n\n\t\t// Reader.stickHeader();\n\tvar scrollTop = (e.target.scrollingElement)?\n\t\t\t\te.target.scrollingElement.scrollTop:\n\t\t\t\tundefined\n\t\t\t|| e.target.scrollTop;\n\t\t// console.log('wideUpdate fire')\n\t\tif(!this.scroll.anchorRAF) {\n\t\t\tthis.updateScrollPosition();\n\t\t}\n\tthis.scroll.direction = scrollTop > this.scroll.prevY?1:-1;\n\tvar st = scrollTop + document.documentElement.clientHeight * (this.scroll.direction > 0?0.70:0.30);\n\tif(window.test_element) window.test_element.style.top = st + 'px'; \n\tthis.scroll.prevY = scrollTop;\n\tvar offsets = this.imageList.map(item => item.$.offsetTop + item.$.parentNode.offsetTop);\n\t\toffsets.push(st);\n\t\toffsets = offsets.sort((a, b) => a - b);\n\tvar index = offsets.indexOf(st) - 1;\n\t\tif(index + 1 == offsets.length) return true;\n\t\tif(Reader.SCP.page == index) return true;\n\t\tfor(var i=0; i<index; i++) {\n\t\t\tthis.imageList[i].load();\n\t\t}\n\t\tsetTimeout(() => Reader.displayPage(index, true), 1);\n\t\treturn true;\n\t}\n\n\tthis.$.onscroll = () => {\n\t\tscroll(this.$, 0, 0, true);\n\t}\n\n\tthis.scrollAnchor = () => {\n\t\tthis.scroll.anchorRAF = requestAnimationFrame(this.scrollAnchor);\n\t\tscroll(this.imageContainer.$, 0, this.scroll.anchorObject.offsetTop + (this.scroll.anchorOffset>0?this.scroll.anchorOffset*-1:this.scroll.anchorObject.offsetHeight * this.scroll.anchorPoint))\n\t}\n\n\tthis.updateScrollPosition = () => {\n\t\tif(!this.wrappers.current) return;\n\t\tthis.scroll.anchorObject = this.wrappers.current.$;\n\t\tthis.scroll.anchorOffset = this.wrappers.current.$.getBoundingClientRect().top;\n\t\tthis.scroll.anchorPoint = (this.imageContainer.$.scrollTop - this.wrappers.current.$.offsetTop) / this.wrappers.current.$.offsetHeight;\n\t}\n\n\tthis.updateWides = () => {\n\t\tif(Settings.get('lyt.direction') == 'ttb' && this.wrappers.current ) {\n\t\t\t// console.log('wideUpdate fire')\n\t\t\tif(!this.scroll.anchorRAF && this.scroll.anchorObject) {\n\t\t\t\tthis.scrollAnchor();\n\t\t\t}\n\n\t\t\tif(this.scroll.anchorTimeout) clearTimeout(this.scroll.anchorTimeout);\n\t\t\tthis.scroll.anchorTimeout = setTimeout(() => {\n\t\t\t\tcancelAnimationFrame(this.scroll.anchorRAF);\n\t\t\t\tthis.scroll.anchorRAF = 0;\n\t\t\t\tthis.updateScrollPosition();\n\t\t\t}, 60)\n\t\t}\n\t\tif(!this.imageWrappers) return;\n\t\tfor(var i=0; i < this.imageWrappers.length; i++) {\n\t\t\tif(this.imageWrappers[i].$.scrollWidth > this.imageWrappers[i].$.clientWidth) {\n\t\t\t\tthis.imageWrappers[i].$.classList.add('too-wide');\n\t\t\t}else{\n\t\t\t\tthis.imageWrappers[i].$.classList.remove('too-wide');\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.drawImages = function(images, wides) {\n\t\tthis.imageContainer.clear();\n\t\tthis.imageWrappers = [];\n\t\tthis.imageWrappersMask = [];\n\t\tthis.imageWrappersMap = {};\n\tvar spreadCount = Settings.get('adv.spreadCount');\n\tvar\tspreadOffset = Settings.get('adv.spreadOffset');\n\tvar imageIndices = [];\n\t\tfor(var i=0; i < images.length; i++) {\n\t\t\timageIndices.push(i);\n\t\t\tthis.imageWrappersMap[i] = this.imageWrappersMask.length;\n\t\t\tif(wides.indexOf(i) > -1 || wides.indexOf(i+1) > -1){\n\t\t\t\tspreadOffset++;\n\t\t\t}\n\t\t\tif(spreadOffset >= spreadCount - 1 || i >= images.length - 1) {\n\t\t\t\t// if(wides.indexOf(i) > -1)\n\t\t\t\t// \tspreadOffset = Settings.get('adv.spreadOffset');\n\t\t\t\t// else\n\t\t\t\t\tspreadOffset = 0;\n\t\t\t\tthis.imageWrappersMask.push(imageIndices);\n\t\t\t\timageIndices = [];\n\t\t\t}else{\n\t\t\t\tspreadOffset++;\n\t\t\t}\n\t\t}\n\n\t\tthis.imageWrappers = this.imageWrappersMask.map(wrapper => \n\t\t\tnew UI_ReaderImageWrapper({\n\t\t\t\timageObjects: wrapper.map(index => ({\n\t\t\t\t\turl: images[index],\n\t\t\t\t\tindex: index,\n\t\t\t\t}))\n\t\t\t}).S.link(this)\n\t\t);\n\n\t\tthis.imageList = [];\n\n\t\tthis.imageWrappers.forEach(wrapper => {\n\t\t\twrapper.S.link(Reader.selector_page);\n\t\t\tthis.imageList = this.imageList.concat(wrapper.get());\n\t\t})\n\t\tif(Settings.get('lyt.direction') == 'rtl') {\n\t\t\tthis.imageWrappers.reverse();\n\t\t\tthis.imageWrappers.forEach(i => i.reverse());\n\t\t}\n\t\tthis.imageContainer.add(this.imageWrappers);\n\n\t\tscroll(this.imageContainer.$, 0,0);\n\t\t\n\t\t\n\t\tif(Settings.get('lyt.direction') == 'ttb') {\n\t\tvar butt = new UI_Dummy();\n\t\t\tbutt.$.classList.add('nextCha');\n\t\t\tbutt.$.onmousedown = e => {\n\t\t\t\te.preventDefault();\n\t\t\t\tReader.nextChapter(0);\n\t\t\t}\n\t\t\tthis.imageContainer.add(butt);\n\t\t}\n\n\t\tif(this.corpses) {\n\t\t\tthis.corpses = [];\n\t\t}\n\t}\n\n\tthis.selectPage = function(index, dry) {\n\t\tif(index < 0 || index >= this.imageList.length)\n\t\t\treturn;\n\n\t\tthis.selectedPage = this.imageList[index];\n\t\tthis.wrappers.current = this.selectedPage.parentWrapper;\n\tvar wrapperIndex = this.imageWrappers.indexOf(this.wrappers.current);\n\t\tthis.wrappers.left = this.imageWrappers[wrapperIndex - 1] || null;\n\t\tthis.wrappers.right = this.imageWrappers[wrapperIndex + 1] || null;\n\t\tthis.visiblePages = this.wrappers.current.getIndices();\n\t\tif(Settings.get('lyt.direction') == 'ttb') {\n\t\t\tif (!dry){\t\n\t\t\t\tsetTimeout(this.getScrollElement().focus(), 1);\n\t\t\t\tif(IS_MOBILE) {\n\t\t\t\t\tscroll(this.getScrollElement(), 0, this.wrappers.current.$.getBoundingClientRect().top + this.getScrollElement().scrollTop);\n\t\t\t\t}else{\n\t\t\t\t\tscroll(this.getScrollElement(), 0,this.wrappers.current.$.offsetTop);\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\tif(this.touch.transitionTimer) {\n\t\t\t\tthis.touch.transitionTimer.then(() => {\n\t\t\t\t\tthis.moveContainer(wrapperIndex);\n\t\t\t\t})\n\t\t\t}else{\n\t\t\t\tthis.moveContainer(wrapperIndex);\n\t\t\t}\n\t\t\t//this.getScrollElement().focus();\n\t\t\tif(Settings.get('bhv.resetScroll')) scroll(this.getScrollElement(), 0, 0);\n\t\t}\n\tvar spreadCount = Settings.get('adv.spreadCount');\n\tvar toPreload = Settings.get('bhv.preload');\n\t\tif(toPreload == 100) {\n\t\t\ttoPreload = this.imageList.length;\n\t\t}\n\t\ttoPreload = toPreload * spreadCount;\n\t\tfor (var i = index - 3; i < index + Math.max(toPreload, Settings.get('adv.spreadCount')); i++) {\n\t\t\tif(this.imageList[i]) {\n\t\t\t\tthis.imageList[i].load();\n\t\t\t}else if(this.imageList.length < i)\n\t\t\t\tbreak;\n\t\t}\n\t\tif(spreadCount == 2) {\n\t\t\tReader.enqueuePreload([\n\t\t\t\tthis.imageList[index-2],\n\t\t\t\tthis.imageList[index-1],\n\t\t\t\tthis.imageList[index+2],\n\t\t\t\tthis.imageList[index+3]\n\t\t\t]);\n\t\t}else{\n\t\t\tReader.enqueuePreload([\n\t\t\t\tthis.imageList[index-1],\n\t\t\t\tthis.imageList[index+1]\n\t\t\t]);\n\t\t}\n\t\tthis.S.out('event', {type: 'newPageIndex', data: index})\n\t}\n\n\tthis.prev = () => {\n\t\tthis.S.out('event', {type: 'prevPage'});\n\n\t}\n\tthis.next = () => {\n\t\tthis.S.out('event', {type: 'nextPage'})\n\t}\n\n\tthis.moveContainer = (index) => {\n\t\tthis.containerOffset = ( -100 * index);\n\t\t// this.imageContainer.$.style.transform = 'translateX(' + this.containerOffset + '%)';\n\t\tthis.imageContainer.$.style.marginLeft = this.containerOffset + '%';\n\t}\n\n\tthis.moveWrappers = (offset, snap) => {\n\t\tif(!this.touch.affectedWrappers) {\n\t\t\tthis.touch.affectedWrappers = [];\n\t\t\tif(this.wrappers.left) this.touch.affectedWrappers.push(this.wrappers.left);\n\t\t\tthis.touch.affectedWrappers.push(this.wrappers.current);\n\t\t\tif(this.wrappers.right) this.touch.affectedWrappers.push(this.wrappers.right);\n\t\t}\n\t\tif(snap) {\n\t\t\tthis.touch.affectedWrappers.forEach(wrapper => wrapper.$.style.transition = `opacity 0.3s ease, transform ${this.touch.transitionTime}s cubic-bezier(${this.touch.transitionTime},.55,.4,1)`);\n\t\t\tthis.touch.transitionTimer = promiseTimeout(Math.round(this.touch.transitionTime*1000), true);\n\t\t\tthis.touch.transitionTimer.then(() => {\n\t\t\t\t\tthis.touch.affectedWrappers.forEach(wrapper => wrapper.$.style = '');\n\t\t\t\t\tthis.touch.affectedWrappers = null;\n\t\t\t\t\tdelete this.touch.transitionTimer;\n\t\t\t\t}).catch(() => {delete this.touch.transitionTimer;})\t\n\t\t}else{\n\t\t\t//for regrab\n\t\t\tif(this.touch.transitionTimer) {\n\t\t\t\tthis.touch.transitionTimer.cancel();\n\t\t\t\tthis.touch.transitionTimer = false;\n\t\t\t\tthis.touch.affectedWrappers = null;\n\t\t\t}\n\t\t}\n\t\tif(this.wrappers.left) this.wrappers.left.$.style.transform = `translateX(${offset * 100}%)`;\n\t\tthis.wrappers.current.$.style.transform = `translateX(${offset * 100}%)`;\n\t\tif(this.wrappers.right) this.wrappers.right.$.style.transform = `translateX(${offset * 100}%)`;\n\t}\n\nconst SCROLL = 1;\nconst SWIPE = 2;\nconst SCROLL_X = 3;\n\n\tthis.setTouchHandlers = (state) => {\n\t\tif(state) {\n\t\t\tthis._.image_container.ontouchstart = this.touch.startHandler;\n\t\t\tthis._.image_container.addEventListener('touchmove', this.touch.moveHandler, {passive: false});\n\t\t\tthis._.image_container.ontouchend = this.touch.endHandler;\n\t\t\tthis._.image_container.ontouchcancel = this.touch.endHandler;\n\t\t}else{\n\t\t\tthis._.image_container.ontouchstart = undefined;\n\t\t\tthis._.image_container.removeEventListener('touchmove', this.touch.moveHandler);\n\t\t\tthis._.image_container.ontouchend = undefined;\n\t\t\tthis._.image_container.ontouchcancel = undefined;\n\t\t}\n\t}\n\n\tthis.touch = {\n\t\tstart: 0,\n\t\tstartY: 0,\n\t\tinitialX: 0,\n\t\tscrollY: 0,\n\t\ttransitionTimer: null,\n\t\tdelta: 0,\n\t\tdeltaY: 0,\n\t\tem: parseFloat(getComputedStyle(document.body).fontSize),\n\t\tgesture: null,\n\t\ttime: null,\n\t\tescapeVelocity: 0.07,\n\t\tescapeDelta: 0.40,\n\t\timagePosition: 0,\n\t\ta: null\n\t};\n\t\n\tthis.touch.startHandler = e => {\n\t\tif(this.touch.transitionTimer) return;\n\t\tif(e.touches.length > 1) return;\n\t\tthis.touch.initialX = 0;\n\t\tthis.touch.x = e.touches[0].pageX;\n\t\tthis.touch.y = e.touches[0].pageY;\n\t\tthis.touch.containerWidth = this._.image_container.offsetWidth;\n\t\tthis.touch.startX = this.touch.x;\n\t\tthis.touch.startY = this.touch.y;\n\t\tthis._.image_container.style.transition = '';\n\t\tthis.touch.gesture = null;\n\t\tthis.touch.delta = 0;\n\t\tthis.touch.deltaY = 0;\n\t\tthis.touch.scrollY = window.scrollY;\n\t\tthis.touch.measures = [];\n\t\tthis.touch.times = [];\n\t\tif(this.touch.affectedWrappers) this.touch.affectedWrappers.forEach(wrapper => wrapper.$.style = '');\n\t\tthis.touch.affectedWrappers = null;\n\tvar maxScroll = this.wrappers.current.get().map(img => img.$.offsetWidth).reduce((i, k) => i + k) - this.wrappers.current.$.offsetWidth;\n\t\tif(maxScroll <= 0){\n\t\t\tthis.touch.imagePosition = null;\n\t\t}else if(Math.abs(this.wrappers.current.$.scrollLeft) >= maxScroll-2) {\n\t\t\tthis.touch.imagePosition = 1;\n\t\t}else if(Math.abs(this.wrappers.current.$.scrollLeft) == 0) {\n\t\t\tthis.touch.imagePosition = -1;\n\t\t}else{\n\t\t\tthis.touch.imagePosition = 0;\n\t\t}\n\t}\n\t\n\tthis.touch.moveHandler = e => {\n\t\tif(this.touch.transitionTimer) return;\n\t\tthis.touch.x = e.touches[0].pageX;\n\t\tthis.touch.y = e.touches[0].pageY;\n\t\t// this.touch.a = requestAnimationFrame(this.touch.anim);\n\t\tif(this.touch.gesture == SCROLL) return;\n\t\tif(Settings.get('lyt.direction') == 'ttb') return;\n\n\t\tthis.touch.delta = (this.touch.x - this.touch.startX) / this.touch.containerWidth;\n\t\tif(this.touch.imagePosition == 0\n\t\t|| this.touch.imagePosition == 1 && this.touch.delta > 0\n\t\t|| this.touch.imagePosition == -1 && this.touch.delta < 0) {\n\t\t\tthis.touch.gesture = SCROLL_X;\n\t\t\treturn;\n\t\t}\n\t\tthis.touch.deltaY = this.touch.y - this.touch.startY;\n\n\t\tif(Settings.get('lyt.direction') == 'rtl'){\n\t\t\tif((Reader.SCP.page == Reader.SCP.lastPage && this.touch.delta > 0)\n\t\t\t|| (Reader.SCP.page == 0 && this.touch.delta < 0)) {\n\t\t\t\tthis.wrappers.current.$.style.opacity = (0.6-Math.abs(this.touch.delta))/0.6;\n\t\t\t}\n\t\t}else{\n\t\t\tif((Reader.SCP.page == Reader.SCP.lastPage && this.touch.delta < 0)\n\t\t\t|| (Reader.SCP.page == 0 && this.touch.delta > 0)) {\n\t\t\t\tthis.wrappers.current.$.style.opacity = (0.6-Math.abs(this.touch.delta))/0.6;\n\t\t\t}\n\t\t}\n\n\t\tthis.touch.measures.push(this.touch.x);\n\t\tthis.touch.times.push(Date.now());\n\t\tthis.moveWrappers(this.touch.delta);\n\n\n\t\tif(Math.abs(this.touch.delta) > 0.030 || this.touch.gesture == SWIPE) {\n\t\t\tthis.touch.gesture = SWIPE;\n\t\t\te.preventDefault();\n\t\t\tif(this.touch.scrollLocked == true) return;\n\t\t\tdocument.documentElement.style.overflow = \"hidden\";\n\t\t\tthis.touch.scrollLocked = true;\n\t\t\treturn;\n\t\t}\n\t\tif(Math.abs(this.touch.deltaY) > this.touch.em) {\n\t\t\tthis.touch.gesture = SCROLL;\n\t\t\tthis.moveWrappers(0);\n\t\t\tif(this.touch.scrollLocked == false) return;\n\t\t\tdocument.documentElement.style.overflow = \"auto\";\n\t\t\tthis.touch.scrollLocked = false;\n\t\t\treturn;\n\t\t}\n\t}\n\n\tthis.touch.endHandler = e => {\n\t\tif(this.touch.gesture == SCROLL_X || this.touch.gesture == SCROLL) return;\n\t\tif(this.touch.transitionTimer) return;\n\t\t//cancelAnimationFrame(this.touch.a);\n\t\t//this._.image_container.style.touchAction = 'unset';\n\tvar times = this.touch.times.slice(-4);\n\tvar measures = this.touch.measures.slice(-4);\n\tvar ms = times[times.length-1] - times[0];\n\tvar delta = measures[measures.length-1] - measures[0];\n\tvar velocity = (delta / ms) * this.touch.em / 100;\n\t\tthis.touch.times = [];\n\t\tthis.touch.measures = [];\n\t\tthis.touch.transitionTime = Math.max(0, 0.30 - Math.abs(velocity)/2.5);\n\t\tif(isNaN(this.touch.transitionTime)) this.touch.transitionTime = 0;\n\t\tif((velocity < this.touch.escapeVelocity * -1\n\t\t|| this.touch.delta < this.touch.escapeDelta * -1)\n\t\t&& !(Reader.SCP.chapter == Reader.SCP.lastChapter\n\t\t\t&& Reader.SCP.page == Reader.SCP.lastPage\n\t\t\t&& Settings.get('lyt.direction') == 'rtl')) {\n\t\t\tthis.moveWrappers(-1, true);\n\t\t\tswitch(Settings.get('lyt.direction')){\n\t\t\t\tcase 'ltr':\n\t\t\t\t\tif(this.touch.transitionTimer)\n\t\t\t\t\t\tthis.touch.transitionTimer.then(this.next)\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.next();\n\t\t\t\t\tbreak; \n\t\t\t\tcase 'rtl': \n\t\t\t\t\tif(this.touch.transitionTimer)\n\t\t\t\t\t\tthis.touch.transitionTimer.then(this.prev)\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.prev();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}else\n\t\tif((velocity > this.touch.escapeVelocity\n\t\t|| this.touch.delta > this.touch.escapeDelta)\n\t\t&& !(Reader.SCP.chapter == Reader.SCP.firstChapter\n\t\t\t&& Reader.SCP.page == 0\n\t\t\t&& Settings.get('lyt.direction') == 'ltr')) {\n\t\t\tthis.moveWrappers(1, true);\n\t\t\tswitch(Settings.get('lyt.direction')){\n\t\t\t\tcase 'ltr':\n\t\t\t\t\tif(this.touch.transitionTimer)\n\t\t\t\t\t\tthis.touch.transitionTimer.then(this.prev)\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.prev();\n\t\t\t\t\tbreak; \n\t\t\t\tcase 'rtl': \n\t\t\t\t\tif(this.touch.transitionTimer)\n\t\t\t\t\t\tthis.touch.transitionTimer.then(this.next)\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.next();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}else{\n\t\t\tthis.moveWrappers(0, true);\n\t\t}\n\t}\n\n\tthis.mouseHandler = function(e) {\n\t\tif(e.type == 'mousedown') {\n\t\t\tthis.mouseHandler.dead = false;\n\t\t\tthis.mouseHandler.active = true;\n\t\t\tthis.mouseHandler.initPos = {x: e.pageX, y: e.pageY};\n\t\t\treturn;\n\t\t}\n\t\tif(e.type == 'mousemove') {\n\t\t\tif(this.mouseHandler.dead || !this.mouseHandler.active) {\n\t\t\t\tthis.mouseHandler.justHover = true;\n\t\t\t}else{\n\t\t\t\tif(Math.abs(this.mouseHandler.initPos.x - e.pageX) > 20 ||\n\t\t\t\tMath.abs(this.mouseHandler.initPos.y - e.pageY) > 20) {\n\t\t\t\t\tthis.mouseHandler.dead = true;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif(e.type == 'click') {\n\t\t\tthis.mouseHandler.active = false;\n\t\t\tif(this.mouseHandler.dead) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif(e.type == 'mouseleave') {\n\t\t\tthis._.hover_prev.classList.add('nodelay');\n\t\t\tthis._.hover_next.classList.add('nodelay');\n\t\t\tthis._.hover_prev.classList.remove('viz');\n\t\t\tthis._.hover_next.classList.remove('viz');\n\t\t\tsetTimeout(t => {\n\t\t\t\tthis._.hover_prev.classList.remove('nodelay');\n\t\t\t\tthis._.hover_next.classList.remove('nodelay');\n\t\t\t}, 1)\n\t\t\tthis.mouseHandler.previousArea = null;\n\t\t\tclearTimeout(this.mouseHandler.arrowTimeout);\n\t\t\treturn;\n\t\t}\n\t\tif(e.button != 0) return;\n\t\tif(Settings.get('bhv.clickTurnPage') === false) return;\n\tvar box = this.$.getBoundingClientRect();\n\tvar areas = [\n\t\t\t0,\n\t\t\tbox.width * 0.35 + box.left,\n\t\t\tbox.width * 0.5 + box.left,\n\t\t\tbox.width * 0.65 + box.left,\n\t\t\tbox.width + box.left\n\t\t];\n\t\tareas.push(e.pageX);\n\t\tareas.sort((a,b) => a - b);\n\t\tif(e.type == 'click') {\n\t\t\tswitch (areas.indexOf(e.pageX)) {\n\t\t\t\tcase 1:\n\t\t\t\t\tif(Settings.get('lyt.direction') == 'ttb') break;\n\t\t\t\t\t(Settings.get('lyt.direction') == 'rtl')?\n\t\t\t\t\t\tthis.next(e):\n\t\t\t\t\t\tthis.prev(e);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\tcase 3:\n\t\t\t\t\tif(IS_MOBILE)\n\t\t\t\t\t\tSettings.cycle('apr.selPinned', undefined, undefined, true); //RMD: notip\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tif(Settings.get('lyt.direction') == 'ttb') break;\n\t\t\t\t\t(Settings.get('lyt.direction') == 'rtl')?\n\t\t\t\t\t\tthis.prev(e):\n\t\t\t\t\t\tthis.next(e);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}else{\n\t\t\tif(this.mouseHandler.previousArea == areas.indexOf(e.pageX))\n\t\t\t\treturn;\n\t\t\tthis.mouseHandler.previousArea = areas.indexOf(e.pageX);\n\t\t\tclearTimeout(this.mouseHandler.arrowTimeout);\n\t\t\tswitch (this.mouseHandler.previousArea) {\n\t\t\t\tcase 1:\n\t\t\t\t\tif(!IS_MOBILE) {\n\t\t\t\t\t\tthis._.hover_prev.classList.add('viz');\n\t\t\t\t\t\tthis._.hover_next.classList.remove('viz');\n\t\t\t\t\t\tthis.mouseHandler.arrowTimeout = setTimeout(t => {\n\t\t\t\t\t\t\tthis._.hover_prev.classList.remove('viz');\n\t\t\t\t\t\t\tthis.mouseHandler.previousArea = null;\n\t\t\t\t\t\t}, 1000) //MAGICNUM\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\tcase 3:\n\t\t\t\t\t\tthis._.hover_prev.classList.remove('viz');\n\t\t\t\t\t\tthis._.hover_next.classList.remove('viz');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tif(!IS_MOBILE) {\n\t\t\t\t\t\tthis._.hover_next.classList.add('viz');\n\t\t\t\t\t\tthis._.hover_prev.classList.remove('viz');\n\t\t\t\t\t\tthis.mouseHandler.arrowTimeout = setTimeout(t => {\n\t\t\t\t\t\t\tthis._.hover_next.classList.remove('viz');\n\t\t\t\t\t\t\tthis.mouseHandler.previousArea = null;\n\t\t\t\t\t\t}, 1000) //MAGICNUM\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.displayNotice = function() {\n\t\tthis.imageContainer.clear();\n\t\tthis.imageWrappersMask = [[0]];\n\t\tthis.imageWrappersMap = {0: 0};\n\n\tvar notice = new UI_ReaderNoticeWrapper({});\n\t\tthis.wrappers = []\n\t\tthis.imageWrappers = [notice];\n\t\tthis.imageList = notice.get();\n\t\tthis.imageContainer.add(this.imageWrappers);\n\t}\n\n\tthis.$.onmousedown = e => this.mouseHandler(e);\n\tthis.$.onmousemove = e => this.mouseHandler(e);\n\tthis.$.onclick = e => this.mouseHandler(e);\n\tthis.$.onmouseleave = e => this.mouseHandler(e);\n\n\tthis.resizeSensor = new ResizeSensor(this.$, this.updateWides);\n\n\tthis.corpses = []\n\n\tthis.resurrect = () => {\n\t\tif(this.corpses.length > 0) {\n\t\t\tthis.corpses[0].load();\n\t\t\tthis.corpses.shift();\n\t\t}\n\t}\n\n\tthis.S.mapIn({\n\t\timageDimensions: (a,b) => {\n\t\t\tif(a.h/a.w > 3 && !this.webtoonPrompt) {\n\t\t\t\tthis.webtoonPrompt = true;\n\t\t\t\tif(Settings.get('lyt.direction') == 'ttb') return;\n\t\t\t\tLoda.display('webtoon');\n\t\t\t}\n\t\t},\n\t\tdead: (image) => {\n\t\t\tif(Reader.SCP.page == image.index) {\n\t\t\t\tthis.corpses.unshift(image)\n\t\t\t}else{\n\t\t\t\tthis.corpses.push(image);\n\t\t\t}\n\t\t\tif(!this.necromancer) {\n\t\t\t\tthis.necromancer = setInterval(this.resurrect, 2000)\n\t\t\t}\n\t\t},\n\t})\n}\n\n\nfunction UI_ReaderImageWrapper(o) {\n\to=be(o);\n\tUI_List.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ReaderImageWrapper'].concat(o.kind || []),\n\t\thtml: o.html || '<div tabindex=\"-1\"></div>'\n\t});\n\tLinkable.call(this);\n\n\tthis.imageInstances = [];\n\tthis.totalWidth = 0;\n\t//imageObject = {url, index}\n\tif(o.imageObjects) {\n\t\to.imageObjects.forEach(img => {\n\t\tlet image = new UI_ReaderImage({\n\t\t\t\turl: img.url,\n\t\t\t\tindex: img.index,\n\t\t\t\tparentWrapper: this\n\t\t\t})\n\t\t\timage.S.link(this);\n\t\t\tthis.imageInstances.push(image);\n\t\t})\n\t}else{\n\t\tconsole.error(this, 'No images supplied!')\n\t}\n\tthis.add(this.imageInstances);\n\n\tif(this.imageInstances.length > 1) {\n\t\tthis.$.classList.add('two-page');\n\t}\n\n\tthis.load = function() {\n\t\tthis.imageInstances.forEach(img => img.load());\n\t}\n\tthis.getIndices = function() {\n\t\treturn this.get().map(img => img.index)\n\t}\n\tthis.checkTooWide = width => {\n\t\tthis.totalWidth += width;\n\t\tif(this.totalWidth > this.$.clientWidth) {\n\t\t\tthis.$.classList.add('too-wide');\n\t\t}\n\t\tif(Settings.get('lyt.direction') == 'rtl') {\n\t\t\tscroll(this.$, this.totalWidth,0)\n\t\t}\n\t}\n\n\tthis.destroy = () => {\n\t\tvar children = this.$.children.slice()\n\t\tfor(var i=0; i<children.length; i++) {\n\t\t\tif(children[i]._struct) children[i]._struct.destroy();\n\t\t}\n\t\talg.discardElement(this.$);\n\t\tif(this.S) this.S.destroy();\n\t}\n\n\tthis.S.mapIn({\n\t\t'imageWidth': this.checkTooWide\n\t})\n\tthis.S.proxyOut('loaded');\n\tthis.S.proxyOut('dead');\n\tthis.S.proxyOut('imageDimensions');\n}\n\n\nfunction UI_ReaderNoticeWrapper(o) {\n\to=be(o);\n\tUI_List.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ReaderImageWrapper'].concat(o.kind || []),\n\t\thtml: o.html || '<div tabindex=\"-1\"></div>'\n\t});\n\tLinkable.call(this);\n\n\tthis.imageInstances = [];\n\tthis.totalWidth = 0;\n\n\tfunction countdown(time) {\n\t\ttime = new Date(time * 1000);\n\t\tvar t = time.getTime() - Date.now()\n\t\tvar times = [\n\t\t\tMath.floor( t/(1000*60*60*24) ) + ' days',\n\t\t\tMath.floor( (t/(1000*60*60)) % 24 ) + ' hours',\n\t\t\tMath.floor( (t/1000/60) % 60 ) + ' minutes'\n\t\t].slice(0,-1);\n\t\tfor(var i=0; i<times.length; i++) {\n\t\t\tif(times[i][0] == 0) {\n\t\t\t\ttimes.shift();\n\t\t\t\ti--;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\ttimes = times.slice(0,2);\n\t\ttimes = times.map(item => {\n\t\t\tif(parseInt(item) == 1) return item.replace(/s$/, '');\n\t\t\telse\n\t\t\treturn item;\n\t\t});\n\t\tif(t < 0) return 'Should be soon!';\n\t\treturn times.join(' ');\n\t}\n\tlet release;\n\t\tif(Reader.current.next_release_time)\n\t\t\trelease = Reader.current.next_release_time;\n\t\telse\n\t\t\trelease = Reader.SCP.chapterObject.release_date[Object.keys(Reader.SCP.chapterObject.release_date)[0]] + 7 * 24 * 60 * 60;\nvar notice = new UI_Dummy({\n\t\thtml: ('<div class=\"ReaderNotice\">' +\n\t\t\t(Reader.current.next_release_html || `<h2>You're caught up!</h2>\n\t\t\t<p>Next chapter should come out in about:</p>\n\t\t\t<div class=\"timer\">$countdown</div>\n\t\t\t<a href=\"https://discord.gg/BDpCRUJ\" target=\"_blank\">Discuss the chapter in the Kaguya Discord</a>\n\t\t\t<a href=\"https://twitter.com/GuyaMoe\" target=\"_blank\">Follow our Twitter for updates</a>\n\t\t\t<a href=\"https://www.viz.com/read/manga/kaguya-sama-love-is-war/all\" target=\"_blank\">Buy the official volumes</a>`\n\t\t) + '</div>').replace('$countdown', countdown(release))\n\t});\n\tnotice.parentWrapper = this;\n\tnotice.load = () => {};\n\tthis.imageInstances.push(notice);\n\tthis.add(notice);\n\n\tthis.load = function() {};\n\tthis.getIndices = function() {return [1]}\n\tthis.checkTooWide = width => {}\n\n\tthis.destroy = () => {\n\t\tvar children = this.$.children.slice()\n\t\tfor(var i=0; i<children.length; i++) {\n\t\t\tif(children[i]._struct) children[i]._struct.destroy();\n\t\t}\n\t\talg.discardElement(this.$);\n\t\tif(this.S) this.S.destroy();\n\t}\n\tthis.S.proxyOut('loaded');\n\tthis.S.proxyOut('dead');\n}\n\nfunction UI_ReaderImage(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ReaderImage'].concat(o.kind || []),\n\t\thtml: o.html || '<img src=\"\" />'\n\t});\n\tLinkable.call(this);\n\n\tthis.index = o.index;\n\tthis.url = o.url;\n\tthis.parentWrapper = o.parentWrapper;\n\n\tthis.onloadHandler = function(e) {\n\t\tif(e.type == 'load') {\n\t\t\tthis.S.out('loaded', this.index);\n\t\t\tcancelAnimationFrame(this.RAF);\n\t\t\treturn;\n\t\t}\n\t\t//if(!IS_MOBILE) dragscroll.reset([this.$])\n\t\t//if(this.fore) this._.image.style.background = 'url('+this.fore+') no-repeat scroll 0% 0% / 0%';\n\t}\n\n\tthis.errorHandler = (e) => {\n\t\tthis.loaded = false;\n\t\tthis.$.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAACXCAYAAAAYn8l5AAAACXBIWXMAAC4jAAAuIwF4pT92AAAGWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgNzkuMTY0NDYwLCAyMDIwLzA1LzEyLTE2OjA0OjE3ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjEuMiAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIxLTA5LTEyVDAyOjI5OjI3KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMS0wOS0xMlQwMjozMDo1MSswMzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMS0wOS0xMlQwMjozMDo1MSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozZjZjZGUxNy02YWRiLTU5NDAtYTEyNC05NTgyOTIyODczZDkiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo0MjhkYWUwMi1lYThhLTdhNDQtODA5OS1iNjE2MTRmNGE5YTIiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyNWM1MzcwOC1hOGRmLTY4NDAtYTI2NS0xZDdlNzNiOWFhMzciPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjI1YzUzNzA4LWE4ZGYtNjg0MC1hMjY1LTFkN2U3M2I5YWEzNyIgc3RFdnQ6d2hlbj0iMjAyMS0wOS0xMlQwMjoyOToyNyswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjb252ZXJ0ZWQiIHN0RXZ0OnBhcmFtZXRlcnM9ImZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjNmNmNkZTE3LTZhZGItNTk0MC1hMTI0LTk1ODI5MjI4NzNkOSIgc3RFdnQ6d2hlbj0iMjAyMS0wOS0xMlQwMjozMDo1MSswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDwvcmRmOlNlcT4gPC94bXBNTTpIaXN0b3J5PiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnYis8YAAASvSURBVHja7d3BkdpAEEZhQiAEhbAhbAgO4Q+FDBzChMJJZ0IhBBtcUpmigBWoZ9Q9/Q7PN9ur1lcItGJmN47jzqDh0jd11bDWxbt/YX9Jl8ql06U/lKLTdM41GTDFNUz/+JlBp+88WRgscB1ARU+QHT7FdX35OzJE+qHjs0vlK1i8p6J33pPtl+ACFpkAe4SLSyGtuUQ+xXVgQLSywyNcA58KyehT5HCPqzAYMqrc4trzqkXGr177GZcYCBknLolU7dI44+K+Fpnf95pxMQwyD1xUFdfAIKgWrm8GQeAicBGBi8BF4CICF4GLwEUELgIXgYsIXAQuAhcRuAhcBC4icBG4CFxE4CJwEbiIwEXgInARgYvAReDKhOvMSQdXjcrI7iBzGhusg5sF1xUW28/8h9VkoeUMuG5hZQemB7MQuOxgZQWmF7MQuOxgZQOmBbMQuOxgZQGmN2YhcNnB6h2YPpiFwGUHq1dgWjELWeHqZXuWNbB6AyaDWcgKV3RgFrB6ASbDWcgKV1RglrCiA1OFWcgKVzRgNWBFBaaKs5AVrijAasKKBkwNZiErXN6BtYAVBZgazkJWuLwCawnLOzBtMAtZ4fIGbAtYXoFpw1nICpcXYFvC8gZMDmYhK1xbA/MAywswOZqFrHBtBcwTrK2ByeEsZIWrNTCPsLYCJsezkBWuVsA8w2oNTAFmIStctYFFgNUKmALNQla4agGLBKs2MAWchaxwWQMrlQ/6NEGIAKwmrNJg1n8sf1jvsOb/JwKw2rCazLzWD+0VVgRgrWBVn32LH94bLM/AWsOqeg5aH4QXWB6BbQWr2rno6mA+fDTEA7CtYVU5J7ueXoZXPDW5JTAvsMzPTe17HiUArC2BeYNleo6uf3xd+tXDR1+DWwAtgXmFZXaubr8UG/6mnVEtgHmHZQLs/hvXoX/dEATYLgis1cAefZ1fyWFFBebuQYJna0UoOaxowFw+AvVqIRIlhxUFmNuHN39a5UbJYXkH5vqx8yVLKCk5LK/A3H9hZun6XEoOyxuwEF/1e2fxNyWH5QVYmC8pv7uyoJLD2hpYqOUVPlm2UslhbQUs3MIwn66JquSwWgMLuaTVmgV3lRxWK2BhF+Nbu5qzksOqDSz0MqIWS4UrOaxawMIvgGy1Dr2Sw7IG1sXS7ZabHCg5LCtgpZdZWO+goeSw1gIrPc2hxvYsSg7rU2CltxnU2vtHyWG9C6z0ePw1N5ZSclhLgZVej732rmVKDusnYKXn426xJZ6Sw3oGrPR+zK32W1RyWPfASobj7X0DdY+dsxwruAhcBC4icBG4CFxE4CJwEbiIwEXgInARgYvAReAiAheBi8BFBC4CF4GLCFwELgIXEbgIXAQuhkHgInAR/cP1xSCoFq4dgyBwUUhcJ4ZBxp3SrM9JzSsshEu10ozrugjsmYGQUVdL+zRrolPbS+I4bYk3N/DqRUavWsM9rmsHhkMrO4w3O8Xed2RA9GHH8W6P6/v23PeiT+5rjXf7Gz3bSQtgtArWK1wzMC6RtORS+HDLvyU7mB74FElPPhUeXtlZukXuMN27ABldDfyebzdY4Lq9VGqCxnuyXO+pynTuF+/b/RcicxyLess/6AAAAABJRU5ErkJggg=='\n\t\tthis.$.style.background = 'transparent';\n\t\tthis.$.style.minHeight = '64px';\n\t\tthis.$.style.minWidth = '64px';\n\t\tthis.$.style.padding = '2em';\n\t\tthis.S.out('dead', this)\n\t\tif(!Reader.gdrivePrompt) {\n\t\t\tif(this.url.indexOf('drive.google') > -1) {\n\t\t\t\tReader.gdrivePrompt = true;\n\t\t\t\tLoda.display('gdrive');\t\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.watchImageDimensions = () => {\n\t\tthis.RAF = requestAnimationFrame(this.watchImageDimensions);\n\t\tif(this.$.naturalWidth > 0) {\n\t\t\tthis.S.out('imageWidth', this.$.offsetWidth);\n\t\t\tthis.S.out('imageDimensions', {h: this.$.offsetHeight, w: this.$.offsetWidth});\n\t\t\tcancelAnimationFrame(this.RAF);\n\t\t\tthis.RAF = null;\n\t\t\treturn;\n\t\t}\n\t}\n\n\tthis.load = function() {\n\t\tif(this.loaded) return;\n\t\tthis.RAF = requestAnimationFrame(this.watchImageDimensions);\n\t\tthis.$.loading = 'eager';\n\t\tthis.$.onload = e => this.onloadHandler(e);\n\t\tthis.$.onerror = e => this.errorHandler(e);\n\t\tthis.$.src = this.url;\n\t\tthis.loaded = true;\n\t}\n\n\tthis.destroy = () => {\n\t\tthis.$.src = 'data:image/gif;base64, R0lGODlhAQABAAAAACH5BAEAAAAALAAAAAABAAEAAAI=';\n\t\tif(this.RAF) cancelAnimationFrame(this.RAF);\n\t\talg.discardElement(this.$);\n\t\tif(this.S) this.S.destroy();\n\t\tthis.load = () => {}\n\t}\n\n}\n\nfunction UI_PageSelector(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['PageSelector'].concat(o.kind || []),\n\t});\n\tLinkable.call(this);\n\n\tthis.keys = new UI_Tabs({\n\t\tnode: this._.page_keys\n\t});\n\n\tthis.render = function(SCP) {\n\t\tif(SCP.pageCount != this.keys.$.children.length) {\n\t\tvar keys = [];\n\t\t\tfor (var i = 0; i < SCP.pageCount; i++) {\n\t\t\tvar key = new UI_Dummy();\n\t\t\t\t// key.$.onmouseover = e => this.hoverChange(e);\n\t\t\t\tkey.$.innerHTML = i+1;\n\t\t\t\tkeys.push(key);\n\t\t\t}\n\t\t\tthis.keys.clear().add(keys)\n\t\t}\n\t\tthis.keys.select(SCP.page, undefined, undefined, true)\n\tvar keys = this.keys.get();\n\t\tkeys.forEach((key, i) => {\n\t\t\tif(SCP.visiblePages.indexOf(i) > -1) {\n\t\t\t\tkey.$.classList.add('shown');\n\t\t\t}else{\n\t\t\t\tkey.$.classList.remove('shown');\n\t\t\t}\n\t\t})\n\t\tthis._.page_keys_count.innerHTML = SCP.page + 1 + '/' + (SCP.pageCount);\n\t}\n\tthis.proxy = function(i) {\n\t\tthis.S.out('page', i);\n\t}\n\n\tthis.displayPreload = function(index) {\n\t\tthis.keys.$.children[+index].classList.add('preloaded');\n\t}\n\tthis.clearPreload = function() {\n\t\tthis.keys.$.children.forEach(key => key.classList.remove('preloaded'));\n\t}\n\t// this.hoverChange = function(e){\n\t// \tthis._.page_keys_count.innerHTML = this.keys.$.children.indexOf(e.target) + 1;\n\t// }\n\n\t// this.$.onmouseleave = e => {\n\t// \tthis._.page_keys_count.innerHTML = SCP.page + 1;\n\t// };\n\n\tthis.S.mapIn({\n\t\t'number': this.proxy,\n\t\t'SCP': dpraw(data => this.render(data.payload)),\n\t\t'loaded': this.displayPreload\n\t})\n\n\n\tthis.keys.S.link(this);\n}\n\nfunction URLChanger(o) {\n\to=be(o);\n\tLinkable.call(this);\n\tthis.hostname = location.hostname[0].toUpperCase() + location.hostname.slice(1);\n\tthis.recentState = {};\n\n\tthis.updateURL = function (SCP) {\n\t\tif(Reader.SCP.chapterObject.notice)\n\t\t\treturn;\n\t\tif(this.recentState.chapter == SCP.chapter && this.recentState.page == SCP.page)\n\t\t\treturn;\n\tvar pathSplit = location.pathname.split(\"/\");\n\t\tpathSplit = pathSplit.slice(0, pathSplit.indexOf(SCP.series));\n\tvar pathName = pathSplit\n\t\t\t.concat([SCP.series, SCP.chapter.replace('.', '-'), SCP.page + 1, ''])\n\t\t\t.join('/');\n\n\t\tswitch(Settings.get('bhv.historyUpdate')) {\n\t\t\tcase 'none':\n\t\t\tvar\ttitle = `${Reader.current.title} | ${this.hostname}`;\n\t\t\t\twindow.history.replaceState(null, title, pathName);\n\t\t\t\tdocument.title = title;\n\t\t\t\tbreak;\n\t\t\tcase 'replace':\n\t\t\t\ttitle = `${SCP.chapter} - ${SCP.chapterName}, Page ${SCP.page + 1} - ${Reader.current.title} | ${this.hostname}`\n\t\t\t\tsetTimeout(() => window.history.replaceState(null, title, pathName), 300);\n\t\t\t\t// document.title = title;\n\t\t\t\tbreak;\n\t\t\tcase 'chap':\n\t\t\t\ttitle = `${SCP.chapter} - ${SCP.chapterName}, Page ${SCP.page + 1} - ${Reader.current.title} | ${this.hostname}`\n\t\t\t\twindow.history.replaceState(null, title, pathName);\n\t\t\t\tdocument.title = title;\n\t\t\t\tif(SCP.chapter == this.chapter) return;\n\t\t\t\twindow.history.pushState({chapter: SCP.chapter, page: SCP.page}, title, pathName);\n\t\t\t\tbreak;\n\t\t\tcase 'jump':\n\t\t\t\ttitle = `${SCP.chapter} - ${SCP.chapterName}, Page ${SCP.page + 1} - ${Reader.current.title} | ${this.hostname}`\n\t\t\t\tif(Math.abs(this.page - SCP.page) > 2 || SCP.chapter != this.chapter) {\n\t\t\t\t\twindow.history.pushState({chapter: SCP.chapter, page: SCP.page}, title, pathName);\n\t\t\t\t}else{\n\t\t\t\t\twindow.history.replaceState(null, title, pathName);\n\t\t\t\t}\n\t\t\t\tdocument.title = title;\n\t\t\t\tbreak;\n\t\t\tcase 'all':\n\t\t\t\tif(this.page != SCP.page || SCP.chapter != this.chapter) {\n\t\t\t\t\ttitle = `${SCP.chapter} - ${SCP.chapterName}, Page ${SCP.page + 1} - ${Reader.current.title} | ${this.hostname}`\n\t\t\t\t\twindow.history.pushState({chapter: SCP.chapter, page: SCP.page}, title, pathName);\n\t\t\t\t\tdocument.title = title;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tif(Reader.getGroup(undefined, true) !== Reader.SCP.group)\n\t\t\tlocation.hash = '#' + Reader.SCP.group;\n\n\t\t// Metrics -- check tracking.html for the implementation\n\t\tif (this.page && this.page !== SCP.page) {\n\t\t\tif (window.science) {\n\t\t\t\twindow.science();\n\t\t\t}\n\t\t}\n\n\t\tthis.page = SCP.page;\n\t\tthis.chapter = SCP.chapter;\n\t}\n\n\tthis.onHistory = (e) => {\n\t\tif(!e.state) return;\n\t\tthis.recentState = e.state;\n\t\tif(Reader.SCP.chapter != e.state.chapter)\n\t\t\tReader.initChapter(e.state.chapter, e.state.page);\n\t\telse\n\t\t\tReader.displayPage(e.state.page);\n\t}\n\twindow.addEventListener('popstate', this.onHistory);\n\n\tthis.scrollDefer = (fn) => {\n\t\tthis.deferFn = fn;\n\t\tif(this.deferScrolling) clearTimeout(this.deferScrolling);\n\t\tvar scroller = () => {\n\t\t\tif(fallbackDefer) clearTimeout(fallbackDefer);\n\t\t\tfallbackDefer = undefined;\n\t\t\tclearTimeout(this.deferScrolling);\n\t\t\tthis.deferScrolling = setTimeout(() => {\n\t\t\t\twindow.removeEventListener('scroll', scroller);\n\t\t\t\tthis.deferFn();\n\t\t\t}, 100);\n\t\t}\n\t\twindow.addEventListener('scroll', scroller, false);\n\t\tlet fallbackDefer = setTimeout(() => {\n\t\t\tthis.deferFn();\n\t\t}, 20);\n\t};\n\n\tthis.S.mapIn({\n\t\tSCP: (SCP) => {this.scrollDefer(() => this.updateURL(SCP))}\n\t})\n}\n\nfunction UI_MessageBox(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['MessageBox'].concat(o.kind || []),\n\t});\n\tLinkable.call(this);\n\n\tthis.allowedStyles = ['flash', 'fade', 'slide', 'none']\n\tthis.fadeTime = 500;\n\n\tthis.timers = [];\n\n\tthis.displayMessage = function(text, style, time) {\n\t\ttime = time || 2000;\n\t\tstyle = style || 'flash';\n\t\tthis.timers.forEach(timer => window.clearTimeout(timer));\n\t\tif(this.allowedStyles.indexOf(style) > -1) {\n\t\t\tthis.allowedStyles.forEach(style => this.$.classList.remove(style));\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.$.classList.add(style);\n\t\t\t\tthis.$.classList.remove('fadeOut');\n\t\t\t}, 1)\n\t\t}\n\t\tthis.$.innerHTML = text;\n\t\tthis.timers.push(setTimeout(() => this.$.classList.add('fadeOut'), time));\n\t\tthis.timers.push(setTimeout(() => {\n\t\t\tthis.$.innerHTML = '';\n\t\t\tthis.allowedStyles.forEach(style => this.$.classList.remove(style));\n\t\t}, time + this.fadeTime));\n\t}\n\n\tthis.S.mapIn({\n\t\ttext: this.displayMessage\n\t});\n}\n\n\nfunction UI_FauxDrop(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['FauxDrop'].concat(o.kind || []),\n\t});\n\tLinkable.call(this);\n\n\tthis._.label = this.$.querySelector('label');\n\tthis._.drop = this.$.querySelector('select');\n\n\tthis.drop = new UI_SimpleList({\n\t\tnode: this._.drop\n\t})\n\n\tthis.handler = e => {\n\t\tthis._.label.textContent = this._.drop.options[this._.drop.selectedIndex].text;\n\t}\n\n\tthis.add = this.drop.add.bind(this.drop);\n\tthis.clear = this.drop.clear.bind(this.drop);\n\tthis.get = this.drop.get.bind(this.drop);\n\tthis.set = function (value, dry) {\n\t\tthis.drop.set(value, dry);\n\t\tthis.handler();\n\t}\n\n\n\tthis._.drop.addEventListener('change', e => this.handler(e));\n\n\tthis.S.proxyOut('value', this.drop)\n}\n\nfunction UI_SimpleList(o) {\n\to=be(o);\n\tUI_List.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['SimpleList'].concat(o.kind || []),\n\t});\n\tLinkable.call(this);\n\n\tthis.handler = e => {\n\t\tthis.S.out('value', this.$.value);\n\t\tthis.$.blur();\n\t}\n\n\tthis.set = function (value, dry) {\n\t\tthis.$.value = value;\n\t\tif(!dry)\n\t\t\tthis.S.out('value', this.$.value);\n\t}\n\n\tthis.add = function(pairs) {\n\t\tthis.lastAdded = [];\n\t\tpairs.forEach(pair => {\n\t\tvar item = new UI_SimpleListItem(pair);\n\t\t\tthis.$.appendChild(item.$);\n\t\t\tthis.lastAdded.push(item);\n\t\t});\n\t\treturn this;\n\t}\n\n\tthis.$.onchange = this.handler;\n\n\n}\n\nfunction UI_SimpleListItem(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['SimpleListItem'].concat(o.kind || []),\n\t\thtml: o.html || '<option></option>'\n\t});\n\tthis.value = o.value;\n\tthis.$.value = o.value;\n\tif(this.$.innerHTML.length < 1)\n\t\tthis.$.textContent = (o.text || o.value || '1');\n}\n\n\nfunction UI_LodaManager(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['LodaManager'].concat(o.kind || []),\n\t\thtml: o.html || '<div></div>'\n\t});\n\tLinkable.call(this);\n\n\tthis.library = {\n\t\ttest: new UI_Loda().S.link(this),\n\t\tsearch: new UI_Loda_Search().S.link(this),\n\t\tsettings: new UI_Loda_Settings().S.link(this),\n\t\tjump: new UI_Loda_Jump().S.link(this),\n\t\tnotice: new UI_Loda_Notice().S.link(this),\n\t\tgdrive: new UI_Loda_Gdrive().S.link(this),\n\t\twebtoon: new UI_Loda_Webtoon().S.link(this),\n\t}\n\n\tthis.scrollTop = 0;\n\n\tthis.display = function(loda) {\n\t\tthis.open = true;\n\t\tthis.$.classList.remove('hidden');\n\t\tthis.$.innerHTML = '';\n\t\tthis.$.appendChild(this.library[loda].$);\n\n\t\tthis.$.focus();\n\t\tthis.keyListener.noPropagation(!!this.library[loda].noPropagation);\n\t\tif(this.currentLoda == loda && this.scrollTop > 0)\n\t\t\tscroll(this.$, 0, this.scrollTop)\n\t\telse\n\t\t\tsetTimeout(() => this.library[loda].focus(), 100);\n\t\tthis.currentLoda = loda;\n\t}\n\n\tthis.close = function() {\n\t\tthis.$.classList.add('hidden');\n\t\tthis.$.innerHTML = '';\n\t\tReader.$.focus();\n\t\tthis.open = false;\n\t}\n\n\tthis.keyListener = new KeyListener(this.$)\n\t\t.noPropagation(true)\n\t\t.attach('close', ['Escape'], this.close.bind(this))\n\n\tthis.$.onmousedown = (e) => {\n\t\tif(e.target == this.$) {\n\t\t\tthis.close();\n\t\t}\n\t}\n\n\tthis.$.onscroll = (e) => {\n\t\tthis.scrollTop = this.$.scrollTop; \n\t}\n\t\n\tthis.S.mapIn({\n\t\t'close': this.close\n\t})\n}\n\nfunction UI_Loda(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda'].concat(o.kind || []),\n\t\thtml: o.html || '<div class=\"Loda-window\" tabindex=\"-1\"><header data-bind=\"header\"></header><button class=\"ico-btn close\" data-bind=\"close\"></button><content data-bind=\"content\"></content></div>'\n\t});\n\tLinkable.call(this);\n\tthis.manager = o.manager;\n\tif(o.name) this._.header.innerHTML = o.name;\n\n\tthis.close = function() {\n\t\tthis.S.out('close');\n\t}\n\n\tthis.focus = function() {\n\t\tthis.focusElement.focus();\n\t\tif(this.focusElement.select) this.focusElement.select();\n\t}\n\n\tthis._.close.onclick = this.close.bind(this)\n}\n\nfunction UI_Loda_Notice(o) {\n\to=be(o);\n\tUI_Loda.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda_Notice'].concat(o.kind || []),\n\t\tname: 'Notice',\n\t\thtml: o.html || `<div class=\"Loda-window\" tabindex=\"-1\"><header data-bind=\"header\">Notice</header><button class=\"ico-btn close\" data-bind=\"close\"></button><content data-bind=\"content\">\n\t\t\t\tYou have been redirected to cubari.moe. This is where the image proxy lives now. Happy reading!\n\t\t\t</content><button data-bind=\"button\"></button></div>`\n\t});\n\tthis.name = 'Notice';\n\tthis.focusElement = this.$;\n\tthis.noPropagation = true;\n\tthis._.button.onclick = this.close.bind(this);\n\n}\t\n\nfunction UI_Loda_Gdrive(o) {\n\to=be(o);\n\tif(navigator.userAgent.indexOf('Firefox') > -1 && navigator.userAgent.indexOf('Seamonkey') < 0) var ff = true;\n\tUI_Loda.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda_Notice'].concat(o.kind || []),\n\t\tname: 'Google Drive failure',\n\t\thtml: o.html || `<div class=\"Loda-window\" tabindex=\"-1\"><header data-bind=\"header\">Google Drive failure</header><button class=\"ico-btn close\" data-bind=\"close\"></button><content data-bind=\"content\">\n\t\t\t\tImages failed to load. This gallery uses Google Drive links. This might help:<br><br>\n\t\t\t\t<div style=\"text-align: left; padding-bottom: 1em;\">a) Log in to a Google account in this browser for the images to display.\n\t\t\t\t${(ff?'<br>b) <a href=\"https://support.mozilla.org/en-US/kb/enhanced-tracking-protection-firefox-desktop#w_what-to-do-if-a-site-seems-broken\" style=\"color: var(--accentCol)\">Disable Tracking Protection</a> in the browser':'')}</div>\n\t\t\t</content><button data-bind=\"button\"></button></div>`\n\t});\n\tthis.name = 'Google Drive failure';\n\tthis.focusElement = this.$;\n\tthis.noPropagation = true;\n\tthis._.button.onclick = this.close.bind(this);\n\n}\n\nfunction UI_Loda_Webtoon(o) {\n\to=be(o);\n\tUI_Loda.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda_Webtoon'].concat(o.kind || []),\n\t\tname: 'Long images detected',\n\t\thtml: o.html || `<div class=\"Loda-window\" tabindex=\"-1\"><header data-bind=\"header\"></header><button class=\"ico-btn close\" data-bind=\"close\"></button><content data-bind=\"content\">\n\t\t\t\tSwitch to webtoon mode? You can use the options menu to switch reading direction later.\n\t\t\t</content>\n\t\t\t<div class=\"buttons\">\n\t\t\t<button data-bind=\"yes\" class=\"yes\"></button><button data-bind=\"no\" class=\"no\"></button>\n\t\t\t</div></div>`\n\t});\n\tthis.name = 'Webtoon';\n\tthis.focusElement = this.$;\n\tthis.noPropagation = true;\n\tthis._.no.onclick = this.close.bind(this);\n\tthis._.yes.onclick = () => {\n\t\tSettings.set('lyt.direction', 'ttb');\n\t\tSettings.set('lyt.gap', true);\n\t\tthis.close();\n\t}\n\n}\t\n\nfunction UI_Loda_Search(o) {\n\to=be(o);\n\tUI_Loda.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda_Search'].concat(o.kind || []),\n\t\tname: 'Search',\n\t\thtml: o.html || `<div class=\"Loda-window\" tabindex=\"-1\"><header data-bind=\"header\"></header><button class=\"ico-btn close\" data-bind=\"close\"></button><content data-bind=\"content\">\n\t\t\t\t<input type=\"text\" data-bind=\"input\" placeholder=\"\u2315\" />\n\t\t\t\t<div class=\"search-tabs\" data-bind=\"tabs\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"list-container\" data-bind=\"container\">\n\t\t\t\t\t<div class=\"list\" data-bind=\"lookup\"></div>\n\t\t\t\t\t<div class=\"list is-hidden\" data-bind=\"indexer\"></div>\n\t\t\t\t</div>\n\t\t\t</content></div>`\n\t});\n\tthis.manager = o.manager;\n\tthis.name = 'Indexer';\n\tthis.noPropagation = true;\n\tthis.focusElement = this._.input;\n\tthis.isIndexed = typeof(IS_INDEXED) !== \"undefined\" ? IS_INDEXED : false;\n\tthis.container = new UI_ContainerList({\n\t\tnode: this._.container\n\t});\n\n\tthis.lookup = new UI_MangaSearch({\n\t\tnode: this._.lookup\n\t})\n\n\tthis.tabs = new UI_Tabs({\n\t\t\tnode: this._.tabs\n\t\t})\n\t\t.add(new UI_Tab({\n\t\t\ttext: 'Title search'\n\t\t}))\n\t\t.S.link(this.container)\n\t\t.S.linkAnonymous('number', num => {\n\t\t\tthis._.input.focus();\n\t\t});\n\n\tthis.tabs.select(0);\n\n\tthis.lookup.S.link(this.tabs.get(0));\n\tthis.input = new UI_Input({\n\t\tnode: this._.input\n\t\t})\n\t\t.S.link(this.lookup)\n\n\tif (this.isIndexed) {\n\t\tthis.indexer = new UI_IndexSearch({\n\t\t\tnode: this._.indexer\n\t\t});\n\n\t\tthis.tabs.add(new UI_Tab({\n\t\t\ttext: 'Text search',\n\t\t\tcounterText: 'Press <span class=\"inline-icon\">\u2ba0</span>'\n\t\t}))\n\n\t\tthis.tabs.get(1).$.onmousedown = e => {\n\t\t\tthis.input.handler(e);\n\t\t}\n\n\t\tthis.indexer.S.link(this.tabs.get(1));\n\n\n\t\tthis.input.S.link(this.indexer)\n\t\t.S.linkAnonymous('text', text => {\n\t\t\tthis.tabs.select(1);\n\t\t\tthis.tabs.get(1).update('Loading...');\n\t\t})\n\t}\n\n}\n\nfunction UI_Loda_Jump(o) {\n\to=be(o);\n\tUI_Loda.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda_Jump'].concat(o.kind || []),\n\t\tname: 'Jump',\n\t\thtml: o.html || `<div class=\"Loda-window\" tabindex=\"-1\"><header data-bind=\"header\"></header><button class=\"ico-btn close\" data-bind=\"close\"></button><content data-bind=\"content\">\n\t\t\t\t<div class=\"Jump-Wrapper\">\n\t\t\t\t\t<input type=\"tel\" data-bind=\"input_chap\" class=\"UI Input\" placeholder=\"Chapter\">\n\t\t\t\t\t<input type=\"tel\" data-bind=\"input_page\" placeholder=\"Page\" class=\"UI Input\">\n\t\t\t\t\t<button data-bind=\"btn\" class=\"Jump-Btn UI Button ico-btn\">\ue90a</button>\n\t\t\t\t</div>\n\t\t\t</content></div>`\n\t});\n\tthis.manager = o.manager;\n\tthis.name = 'Jumper';\n\tthis.noPropagation = true;\n\tthis.focusElement = this._.input_chap;\n\n\tthis.btn = new UI_Button({\n\t\tnode: this._.btn,\n\t\ttext: 'Go'\n\t});\n\n\tthis.input_chap = new UI_Input({\n\t\tnode: this._.input_chap\n\t\t})\n\n\tthis.input_page = new UI_Input({\n\t\tnode: this._.input_page\n\t\t})\n\n\n\tthis.jump = async () => {\n\t\tlet chap = this._.input_chap.value || Reader.SCP.chapter, page = parseInt(this._.input_page.value) || 1;\n\t\ttry {\n\t\t\tawait Reader.fetchChapter(chap);\n\t\t\tif (page > Reader.current.chapters[chap].images[Reader.getGroup(chap)].length) throw \"Invalid Chapter or Page!\"\n\t\t\tthis._.input_chap.value = this._.input_page.value = \"\";\n\t\t\tLoda.close();\n\t\t\tReader.initChapter(chap, page-1);\n\t\t}\n\t\tcatch (err) {\n\t\t\tTooltippy.set('Please enter valid chapter and page!');\n\t\t}\n\t}\n\n\tthis.chapPrev = \"\", this.pagePrev = \"\", this.cursorPrev = \"\";\n\n\tthis.prejump = (el) => {\n\n\t\tif(isNaN(this._.input_chap.value)) {\n\t\t\tthis._.input_chap.value = this.chapPrev;\n\t\t\tthis._.input_chap.setSelectionRange(this.cursorPrev,this.cursorPrev); \n\t\t}\n\n\t\tif(this._.input_page.value.includes(\".\") || isNaN(this._.input_page.value)) {\n\t\t\tthis._.input_page.value = this.pagePrev;\n\t\t\tthis._.input_page.setSelectionRange(this.cursorPrev,this.cursorPrev); \n\t\t}\n\n\t\tif(parseInt(el.value) > parseInt(Reader.SCP.lastChapter) && this.chapPrev.length <= Reader.SCP.lastChapter.length && el.selectionStart === el.value.length && !el.value.substring(el.selectionStart, el.selectionEnd) && this._.input_chap === document.activeElement && el.value.length > this.chapPrev.length && !el.value.endsWith(\".\")) {\n\t\t\tthis._.input_page.value = el.value.charAt(el.value.length-1);\n\t\t\tel.value = el.value.substring(0, el.value.length-1);\n\t\t\tthis._.input_page.focus();\n\t\t}\n\n\t\tthis.chapPrev = this._.input_chap.value;\n\t\tthis.pagePrev = this._.input_page.value;\n\t}\n\n\tthis._.btn.onclick = this.jump;\n\t[this._.input_chap, this._.input_page].forEach(el => { \n\t\tel.oninput = e => {\n\t\t this.prejump(el); \n\t\t}\n\t});\n\n\t[this._.input_chap, this._.input_page].forEach(el => { \n\t\tel.onkeydown = e => {\n\t\t\tthis.cursorPrev = el.selectionEnd;\t\t  \n\t\t}\n\t}); \n\n\t[this._.input_chap, this._.input_page].forEach(el => { new KeyListener(el)\n\t\t.attach('Jump', ['Enter'], e => this.jump())\n\t});\n\n}\n\nfunction UI_IndexSearch(o) {\n\to=be(o);\n\tUI_Tabs.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['IndexSearch'].concat(o.kind || []),\n\t\thtml: o.html || `<div></div>`\n\t});\n\tLoadable.call(this);\n\n\tthis.search = function(query) {\n\t\tif(query.length < 3) {\n\t\t\treturn this.clear();\n\t\t}\n\t\tAPI.requestIndex({\n\t\t\tquery: query,\n\t\t\tslug: Reader.SCP.series\n\t\t}).then(data => {\n\t\t\tfor(var searchWord in data.result) {\n\t\t\tvar searchResult = data.result[searchWord];\n\t\t\t\tif(!searchResult._merged) searchResult._merged = {};\n\t\t\t\tfor(var wordVariant in searchResult) {\n\t\t\t\tvar chapters = searchResult[wordVariant];\n\t\t\t\t\tif(wordVariant[0] == '_') continue;\n\t\t\t\t\tfor(var chapter in chapters) {\n\t\t\t\t\tvar pageList = chapters[chapter];\n\t\t\t\t\t\tif(!searchResult._merged[chapter])\n\t\t\t\t\t\t\tsearchResult._merged[chapter] = pageList || [];\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tpageList.forEach(page => {\n\t\t\t\t\t\t\t\tif(searchResult._merged[chapter].indexOf(page) < 0)\n\t\t\t\t\t\t\t\t\tsearchResult._merged[chapter].push(page);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\tvar wordAddrMap = {};\n\t\t\tif(Object.keys(data.result).length > 1) {\n\t\t\t\tfor(var word in data.result) {\n\t\t\t\tvar chapters = data.result[word]._merged;\n\t\t\t\t\tfor(var chapter in chapters) {\n\t\t\t\t\tvar pageArray = chapters[chapter];\n\t\t\t\t\t\tpageArray.forEach(page => {\n\t\t\t\t\t\tvar id = '' + chapter + '/' + page;\n\t\t\t\t\t\t\tif(!wordAddrMap[id]) wordAddrMap[id] = 0;\n\t\t\t\t\t\t\twordAddrMap[id] += 1;\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\tvar wordAddrMap = Object.filter(wordAddrMap, id => {\n\t\t\t\t\treturn id == Object.keys(data.result).length;\n\t\t\t\t})\n\t\t\tvar chapters = {};\n\t\t\t\tfor(var key in wordAddrMap) {\n\t\t\t\tvar id = key.split('/')\n\t\t\t\t\tif(!chapters[id[0]]) chapters[id[0]] = [];\n\t\t\t\t\tchapters[id[0]].push(id[1]);\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tchapters = data.result[Object.keys(data.result)[0]]._merged;\n\t\t\t}\n\n\n\t\t\t// if(Object.keys(data.result).length > 1) {\n\t\t\t// var chapters = Object.keys(data.result[firstWord]._merged).filter((item, key) => {\n\t\t\t// \t\tfor(var word in data.result) {\n\t\t\t// \t\t\tif(word == firstWord) continue;\n\t\t\t// \t\tvar chapters = Object.keys(data.result[word]._merged);\n\t\t\t// \t\t\tif(chapters.indexOf(item) < 0)\n\t\t\t// \t\t\t\treturn false;\n\t\t\t// \t\t}\n\t\t\t// \t\treturn true;\n\t\t\t// \t})\t\n\t\t\t// }else{\n\t\t\t// \tvar chapters = Object.keys(data.result[firstWord]._merged);\n\t\t\t// }\n\n\t\tvar chapterElements = [];\n\t\tvar chapKeys = Object.keys(chapters).sort((a,b) => parseFloat(a) - parseFloat(b));\n\t\t\tfor(var i=0;i<chapKeys.length;i++) {\n\t\t\tvar key = chapKeys[i];\n\t\t\tvar item = chapters[key];\n\t\t\t\ttry{\n\t\t\t\tchapterElements.push(new UI_ChapterUnit({\n\t\t\t\t\tchapter: Reader.current.chapters[key.replace('-', '.')],\n\t\t\t\t//\tsubstring: Object.keys(data.result)[0],\n\t\t\t\t\tpages: item.sort((a,b) => a-b)\n\t\t\t\t}))\t\n\t\t\t\t}catch(e){\n\t\t\t\t\tconsole.warn('Chapter', key, 'wasn\\'t found?')\n\t\t\t\t}\t\n\t\t\t};\n\n\t\t\tthis.clear().add(chapterElements);\n\n\t\t}).catch(err => {throw new Error(err)})\n\n\t}\n\n\tthis.S.mapIn({\n\t\t'text': this.search,\n\t\t// 'quickText': this.clear\n\t})\n}\n\nfunction UI_MangaSearch(o) {\n\to=be(o);\n\tUI_Tabs.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['MangaSearch'].concat(o.kind || []),\n\t\thtml: o.html || `<div></div>`\n\t});\n\n\tthis.search = function(query, force) {\n\tthis.query = query;\n\t\tif(query.length < 1) {\n\t\t\tthis.clear(); return;\n\t\t}\n\t\tif(this.debounce) {\n\t\t\tclearTimeout(this.debouncer);\n\t\t\tthis.debouncer = setTimeout(e => {\n\t\t\t\tthis.debounce = false;\n\t\t\t\tthis.search(this.query, true);\n\t\t\t}, 200);\n\t\t\treturn;\n\t\t}\n\t\tif(!force) this.debounce = true;\n\n\tvar chapters = {};\n\t\tif(isNaN(this.query) == false) {\n\t\t\tReader.current.chaptersIndex.filter(id => {\n\t\t\t\treturn (''+id).indexOf(this.query) > -1;\n\t\t\t}).map(id => {\n\t\t\t\treturn Reader.current.chapters[id];\n\t\t\t}).forEach(chapter => {\n\t\t\t\tchapters[chapter.id] = chapter;\n\t\t\t})\n\t\t}else{\n\t\t\tif(this.query.length < 3) return;\n\t\t}\n\t\tfor(var id in Reader.current.chapters) {\n\t\tvar chapter = Reader.current.chapters[id];\n\t\t\tif(chapter.title.toLowerCase().indexOf(this.query.toLowerCase()) > -1) {\n\t\t\t\tchapters[id] = chapter;\n\t\t\t}\n\t\t}\n\tvar chapterElements = [];\n\t\tfor(var id in chapters) {\n\t\tvar chapter = chapters[id];\n\t\t\tchapterElements.push(new UI_ChapterUnit({\n\t\t\t\tchapter: chapter,\n\t\t\t\tsubstring: query\n\t\t\t}))\n\t\t}\n\t\t\n\t\tthis.clear().add(chapterElements);\n\t}\n\n\tthis.S.mapIn({\n\t\t'text': this.search,\n\t\t'quickText': this.search\n\t})\n}\n\n\nfunction UI_ChapterUnit(o) {\n\to=be(o);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['ChapterUnit'].concat(o.kind || []),\n\t\tname: 'ChapterUnit',\n\t\thtml: o.html || `<div><figure data-bind=\"figure\"></figure><content><h2 data-bind=\"title\"></h2><blockquote data-bind=\"text\"></blockquote><div class=\"pages\" data-bind=\"pages\"></div></content></div>`\n\t});\n\n\tthis.chapter = o.chapter;\n\tthis.pages = o.pages;\n\tthis.substring = o.substring\n\tthis.pageList = new UI_Tabs({\n\t\tnode: this._.pages,\n\t\theld: true\n\t})\n\t// TODO should this innerHTML exist?\n\tthis._.title.innerHTML = (o.chapter.id + ' - ' + o.chapter.title).replace(new RegExp('('+o.substring+')', 'gi'), '<i>$1</i>');\n\tfor(var group in o.chapter.images) {\n\t\tthis._.figure.style.backgroundImage = 'url('+(this.pages?o.chapter.previews[group][+this.pages[0]-1]:o.chapter.previews[group][0])+')';\n\t\tbreak;\n\t}\n\tif(this.pages) {\n\t\tthis.pages.forEach(page => {\n\t\tvar pageButton = new UI_Dummy({text: page});\n\t\t\tpageButton.$.onclick = e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\te.preventDefault();\n\t\t\tvar pg = +e.target.innerHTML-1;\n\t\t\t\tLoda.close();\n\t\t\t\tReader.initChapter(this.chapter.id, pg);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.pageList.add(pageButton);\n\t\t})\n\t}\n\n\tthis.$.onclick = e => {\n\t\tReader.initChapter(this.chapter.id, 0);\n\t\tLoda.close();\n\t}\n}\n\nfunction UI_Loda_Settings(o) {\n\to=be(o);\n\tUI_Loda.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['Loda_Settings'].concat(o.kind || []),\n\t\tname: 'Settings',\n\t\thtml: o.html || `<div class=\"Loda-window UI Loda Loda_Settings\" tabindex=\"-1\">\n\t\t\t<aside>\n\t\t\t\t<button class=\"ico-btn close\" data-bind=\"close\"></button>\n\t\t\t\t<header data-bind=\"header\">Settings</header>\n\t\t\t\t<div class=\"settings-tabs\" data-bind=\"tabs\">\n\t\t\t\t</div>\n\t\t\t</aside>\n\t\t\t<content data-bind=\"content\">\n\t\t\t</content>\n\t\t</div>`\n\t});\n\tthis.focusElement = this.$;\n\tthis.manager = o.manager;\n\tthis.name = 'Settings';\n\tthis.noPropagation = false;\n\n\tthis.content = new UI_ContainerList({\n\t\tnode: this._.content\n\t});\n\tthis.tabs = new UI_Tabs({\n\t\tnode: this._.tabs\n\t}).S.link(this.content);\n\n\tthis.createCategory = (tabName, content) => {\n\t\tthis.tabs.add(new UI_IconTab({\n\t\t\ttext: tabName\n\t\t}));\n\t\tthis.content.add(content);\n\t\treturn this;\n\t} \n\n\tfor(let category in Settings.settings) {\n\t\tif(Settings.settings[category].hidden) continue;\n\tvar container = new UI_Dummy();\n\t\tfor(let setting in Settings.settings[category]) {\n\t\t\tif(Settings.settings[category][setting].hidden) continue;\n\t\tlet sU = new UI_SettingUnit({\n\t\t\t\tsetting: Settings.settings[category][setting]\n\t\t\t});\n\t\t\tSettings.S.link(sU);\n\t\t\tcontainer.$.appendChild(sU.$);\n\t\t}\n\t\tthis.createCategory(Settings.settings[category].name, container);\n\t}\n\n\tthis.tabs.select(0);\n}\n\nfunction UI_SettingUnit(o) {\n\to=be(o);\n\tLinkable.call(this);\n\tUI.call(this, {\n\t\tnode: o.node,\n\t\tkind: ['SettingUnit'].concat(o.kind || []),\n\t\tname: 'SettingUnit',\n\t\thtml: o.html || `\n\t\t<div class=\"setting-wrapper\">\n\t\t\t<header class=\"setting-header\" data-bind=\"header\"></header>\n\t\t\t<div class=\"setting-field\" data-bind=\"field\"></div>\n\t\t</div>`\n\t});\n\n\tthis.setting = o.setting;\n\n\tthis._.header.innerHTML = this.setting.prettyName;\n\tthis.controls = new UI_SettingDisplay({\n\t\tnode: this._.field,\n\t\tsetting: this.setting\n\t})\n\n\tthis.packetHandler = (packet) => {\n\t\tif(packet.setting != this.setting.addr) return;\n\t\tif(packet.type == 'disable')\n\t\t\tthis.hide();\n\t\telse if(packet.type == 'enable')\n\t\t\tthis.show();\n\t}\n\tthis.hide = () => {\n\t\tthis._.header.classList.add('disabled');\n\t\tthis._.field.classList.add('disabled');\n\t}\n\tthis.show = () => {\n\t\tthis._.header.classList.remove('disabled');\n\t\tthis._.field.classList.remove('disabled');\n\t}\n\n\tif(this.setting.disabled)\n\t\tthis.hide()\n\n\tif(this.setting.nomobile)\n\t\tthis.$.classList.add('nomobile');\n\n\tif(this.setting.compact)\n\t\tthis.$.classList.add('compact');\n\n\tthis.S.mapIn({\n\t\tsettingsPacket: this.packetHandler\n\t})\n}\n\nfunction UI_SettingDisplay(o) {\n\to=be(o);\n\tUI.call(this, Object.assign(o, {\n\t\tkind: ['SettingDisplay'].concat(o.kind || [])\n\t}));\n\tthis.setting = o.setting;\n\tthis.disabled = o.disabled || false;\n\tthis.entity = null;\n\tswitch(this.setting.type) {\n\t\tcase SETTING_MULTI:\n\t\tcase SETTING_BOOLEAN:\n\t\t\tthis.entity = new UI_ButtonGroup({\n\t\t\t\thtml: this.setting.html,\n\t\t\t\tsetting: this.setting\n\t\t\t}).S.biLink(Settings);\n\t\t\tbreak;\n\t\tcase SETTING_VALUE:\n\t\tcase SETTING_VALUE_STEPPED:\n\t\t\tthis.entity = new UI_Slider({\n\t\t\t\tsetting: this.setting\n\t\t\t}).S.biLink(Settings);\n\t\t\tbreak;\n\t\tcase SETTING_COLOR:\n\t\t\tthis.entity = new UI_ColorPicker({\n\t\t\t\tsetting: this.setting\n\t\t\t}).S.biLink(Settings);\n\t\t\tbreak;\n\t\tcase SETTING_BUTTON: \n\t\t\tthis.entity = new UI_ResetButton({\n\t\t\t\tsetting: this.setting,\n\t\t\t\thtml: `<button class=\"reset-btn\"></button>`,\n\t\t\t\ttext: 'Reset'\n\t\t\t}).S.link(Settings);\n\t\t\tbreak;\n\t\tcase SETTING_MULTI_DROPDOWN:\n\t\tthis.entity = new UI_Dropdown({\n\t\t\tsetting: this.setting,\n\t\t\toptions: this.setting.optionsPrimitive,\n\t\t\tdisabled: false\n\t\t}).S.link(Settings);\n\t\tbreak;\n\t}\n\n\n\tif(this.entity) this.$.appendChild(this.entity.$);\n\n\treturn this;\n}\n\n\nconst WIDE_FLAG = \"_w.\";\n\nfunction firstPartySeriesHandler(mediaURL, chapter, group, slug) {\n\tfor (let i = 0; i < chapter.groups[group].length; i++) {\n\t\tchapter.images[group].push(\n\t\t\tmediaURL\n\t\t\t\t+ slug \n\t\t\t\t+ '/chapters/' \n\t\t\t\t+ chapter.folder \n\t\t\t\t+ '/' \n\t\t\t\t+ group \n\t\t\t\t+ '/' \n\t\t\t\t+ chapter.groups[group][i]\n\t\t)\n\t\tchapter.blurs[group].push(\n\t\t\tmediaURL\n\t\t\t\t+ slug \n\t\t\t\t+ '/chapters/' \n\t\t\t\t+ chapter.folder \n\t\t\t\t+ '/' \n\t\t\t\t// + \"shrunk_blur_\"+ group\n\t\t\t\t+ group+\"_shrunk_blur\" \n\t\t\t\t+ '/' \n\t\t\t\t+ chapter.groups[group][i]\n\t\t)\n\t\tchapter.previews[group].push(\n\t\t\tmediaURL\n\t\t\t\t+ slug \n\t\t\t\t+ '/chapters/' \n\t\t\t\t+ chapter.folder \n\t\t\t\t+ '/' \n\t\t\t\t// + \"shrunk_\"+ group\n\t\t\t\t+ group+\"_shrunk\" \n\t\t\t\t+ '/' \n\t\t\t\t+ chapter.groups[group][i]\n\t\t)\n\t\tif (chapter.groups[group][i].includes(WIDE_FLAG)) {\n\t\t\tchapter.wides[group].push(i);\n\t\t}\n\t}\n\tchapter.loaded[group] = true;\n}\n\n// NH API response returns an array, whereas others returns a chapter ID\nfunction thirdPartySeriesHandler(url, chapter, group) {\n\tif (Array.isArray(chapter.groups[group])) {\n\t\t// TODO page handling is pretty ugly here. I'd recommend a refactor someday.\n\t\tfor (let i = 0; i < chapter.groups[group].length; i++) {\n\t\t\tlet image = chapter.groups[group][i];\n\t\t\tif (typeof image === 'string' || image instanceof String) {\n\t\t\t\tchapter.images[group].push(image);\n\t\t\t\tif (image.includes(WIDE_FLAG)) {\n\t\t\t\t\tchapter.wides[group].push(i);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tchapter.descriptions[group].push(image.description);\n\t\t\t\tchapter.images[group].push(image.src);\n\t\t\t\tif (image.src.includes(WIDE_FLAG)) {\n\t\t\t\t\tchapter.wides[group].push(i);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tchapter.loaded[group] = true;\n\t} else {\n\t\tif (!chapter.pageRequest) chapter.pageRequest = {};\n\t\tchapter.loaded[group] = false;\n\t\tchapter.pageRequest[group] = async () => {\n\t\t\tlet images = chapter.images[group];\n\t\t\tlet wides = chapter.wides[group];\n\t\t\tlet descriptions = chapter.descriptions[group];\n\t\t\ttry {\n\t\t\t\t// Each group/chapter pair has a unique ID, returned by API\n\t\t\t\tlet pages = await fetch(`${chapter.groups[group]}`)\n\t\t\t\t\t\t\t\t.then(r => r.json());\n\t\t\t\tpages.forEach((p, i) => {\n\t\t\t\t\tif (typeof p === 'string' || p instanceof String) {\n\t\t\t\t\t\timages.push(p);\n\t\t\t\t\t\tif (p.includes(WIDE_FLAG)) {\n\t\t\t\t\t\t\twides.push(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdescriptions.push(p.description);\n\t\t\t\t\t\timages.push(p.src);\n\t\t\t\t\t\tif (p.src.includes(WIDE_FLAG)) {\n\t\t\t\t\t\t\twides.push(i);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn pages.length;\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction DownloadManager() {\n\tthis.chapterDownloadURL = \"\";\n\tlet latestRef;\n\tthis.downloadChapter = async function() {\n\t\t// Shenanigans to allow download cancellation\n\t\tlet localRef = latestRef = Reader.SCP.chapter;\n\t\tif(this.chapterDownloadURL) {\n\t\t\tURL.revokeObjectURL(this.chapterDownloadURL)\n\t\t}\n\t\tlet chapter = localRef;\n\t\tReader._.download_chapter.classList.add(\"hidden\");\n\t\tReader._.downloading_chapter.textContent = `Ch.${chapter} : 0%`;\n\t\tReader._.download_wrapper.classList.remove(\"hidden\");\n\t\tlet mimeMap = {\n\t\t\t'image/gif': '.gif',\n\t\t\t'image/jpeg': '.jpg',\n\t\t\t'image/png': '.png',\n\t\t\t'image/webp': '.webp',\n\t\t}\n\t\tawait Reader.fetchChapter(chapter)\n\t\tlet chapURLArray = Reader.SCP.chapterObject.images[Reader.getGroup(chapter)];\n\t\tif (await shouldUseProxy(chapURLArray[0])) {\n\t\t\t// Base64 URL encode the URLs\n\t\t\tchapURLArray = chapURLArray.map((url) => `${IMAGE_PROXY_URL}/v1/image/${btoa(url).replace(/\\+/g, \"-\").replace(/\\//g, \"_\")}?source=reader_download`);\n\t\t}\n\n\t\ttry {\n\t\t\tlet parallelDownloads = Settings.get(\"adv.parallelDownloads\");\n\t\t\tlet zip = new JSZip();\n\t\t\tlet progress = 0;\n\t\t\tfor (let i = 0; i < chapURLArray.length; i += parallelDownloads) {\n\t\t\t\tlet imageBlobs = await Promise.all(\n\t\t\t\t\tchapURLArray\n\t\t\t\t\t.slice(i, i + parallelDownloads)\n\t\t\t\t\t.map((url, subIndex) => {\n\t\t\t\t\t\treturn (async () => {\n\t\t\t\t\t\t\tlet contents = await downloadHandler(url);\n\t\t\t\t\t\t\tif (latestRef !== localRef) throw { name: \"changedRef\" };\n\t\t\t\t\t\t\tprogress++;\n\t\t\t\t\t\t\tReader._.downloading_chapter.textContent = `Ch.${chapter} : ${Math.round(progress / chapURLArray.length * 98)}%`;\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tcontents,\n\t\t\t\t\t\t\t\t\"fileIndex\": String(i + subIndex + 1).padStart(String(chapURLArray.length).length, \"0\"),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t})();\n\t\t\t\t\t})\n\t\t\t\t);\n\n\t\t\t\timageBlobs.forEach((data) => {\n\t\t\t\t\tzip.file(data.fileIndex + mimeMap[data.contents.type], data.contents, { binary: true });\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet zipBlob = await zip.generateAsync({type:\"blob\"});\n\n\t\t\tthis.chapterDownloadURL = URL.createObjectURL(zipBlob);\n\t\t\tif (latestRef === localRef) initiateDownload(this.chapterDownloadURL, filename = chapter + \".zip\");\n\n\t\t} catch (err) {\n\t\t\tif (err.name !== \"changedRef\") {\n\t\t\t\tTooltippyError.set(\"An error occured while downloading: \" + err.message);\n\t\t\t}\n\t\t} finally {\n\t\t\twrapUp(ref = localRef)\n\t\t}\n\t}\n\n\tasync function shouldUseProxy(testUrl) {\n\t\t// We don't know the actual error so we'll play it\n\t\t// safe and assume this error is due to CORS\n\t\ttry {\n\t\t\tawait fetch(testUrl);\n\t\t\treturn false;\n\t\t} catch (err) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tasync function downloadHandler(url) {\n\t\tconst TRIES = 3;\n\t\tfor (let attempt = 1; attempt <= TRIES; attempt++) {\n\t\t\ttry {\n\t\t\t\treturn (await fetch(url)).blob();\n\t\t\t} catch (e) {\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 1000 * attempt));\n\t\t\t}\n\t\t}\n\t\tthrow new Error(`Failed to download after exhausting all ${TRIES} tries.`);\n\t}\n\n\tfunction wrapUp(ref) {\n\t\tif (ref === latestRef) {\n\t\tReader._.download_wrapper.classList.add(\"hidden\");\n\t\tReader._.download_chapter.classList.remove(\"hidden\");\n\t\tlatestRef = null;\n\t\t}\n\t}\n\n\tthis.cancelDownload = function() {\n\t\twrapUp(ref = latestRef);\n\t}\n\n\tfunction initiateDownload(url, filename) {\n\t\tlet elem = window.document.createElement('a');\n\t\telem.href = url;\n\t\telem.download = filename;        \n\t\tdocument.body.appendChild(elem);\n\t\telem.click();        \n\t\tdocument.body.removeChild(elem);\n\t}\n}\n\nfunction UI_About(o) {\n\to=be(o);\n\tUI.call(this, Object.assign(o, {\n\t\tkind: ['About'].concat(o.kind || []),\n\t\thtml: `<div>\n\t\t\t<p class=\"muted\"> </p>\n\t\t\t<p class=\"muted\"> </p>\n\t\t\t<p class=\"muted\">Powered by</p>\n\t\t\t<div class=\"cubari\" data-bind=\"cubari\"><div></div></div>\n\t\t\t<hr>\n\t\t\t<p>Design, UX: Algoinde</p>\n\t\t\t<p>Reader code: Algoinde, funkyhippo, Einlion</p>\n\t\t\t<p>Backend: appu</p>\n\t\t\t<hr>\n\t\t\t<a href=\"https://ko-fi.com/cubari\" target=\"_blank\">Send coffee :P</a>\n\t\t\t<hr>\n\t\t\t<p style=\"max-width: 15em; text-align: center; line-height: 1.5\">Cubari does not host any of the content you are viewing. Just like your computer does not store or own all the images you see on the internet, Cubari is doing the same thing. We are simply a service that lets you view other data on the internet using our custom UI.</p>\n\t\t</div>`\n\t}));\n\n\tthis.cubariMove = (e) => {\n\t\tvar x = e.pageX;\n\t\tvar y = e.pageY;\n\t\tvar\tcCR = this._.cubari.getBoundingClientRect();\t\n\t\tvar cX = cCR.left + cCR.width / 2;\n\t\tvar cY = cCR.top + cCR.height / 2;\n\t\tvar\txDist = (cX - x) / (cX - x<0?document.documentElement.clientWidth - cX:cX) * -16;\n\t\tvar yDist = (cY - y) / (cY - y<0?document.documentElement.clientHeight - cY:cY) * -12;\n\t\t\tthis._.cubari.children[0].style.transform = `translate3d(${xDist}%, ${yDist}%, 0)`\n\t\t}\n\tthis._.cubari.onmouseover = () => {\n\t\tif(this.listener) return;\n\t\tthis.listener = true;\n\t\tdocument.addEventListener('mousemove', this.cubariMove);\n\t\tthis._.cubari.children[0].style.transition = '';\n\t\tsetTimeout(() => {\n\t\t\tdocument.removeEventListener('mousemove', this.cubariMove);\n\t\t\tthis._.cubari.children[0].style.transform = '';\n\t\t\tthis._.cubari.children[0].style.transition = 'transform 0.3s ease';\n\t\t\tthis.listener = false;\n\t\t}, 5000);\n\t}\n\n\treturn this;\n}\n\nalg.createBin();\n\nAPI = new ReaderAPI();\nSettings = new SettingsHandler();\n\nTooltippy = new UI_Tooltippy({\n\tnode: document.querySelector('.Tooltippy'),\n});\n\nTooltippyError = new UI_Tooltippy({\n\tnode: document.querySelector('.Tooltippy.Error'),\n\tkind: 'Error'\n})\n\nReader = new UI_Reader({\n\tnode: document.getElementById('rdr-main'),\n});\nLoader = new LoadHandler();\nURLC = new URLChanger();\nLoda = new UI_LodaManager({\n\tnode: document.querySelector('.LodaManager'),\n});\nThemeManager = new themeHandler();\nDownloadManagerObj = new DownloadManager()\n\nLoda.library.settings.createCategory('About', new UI_About());\n\nAPI.S.link(Reader);\nSettings.S.link(Reader);\nReader.S.link(URLC);\nReader.S.link(Settings);\nReader.$.focus();\nThemeManager.S.link(Settings);\n//Settings.sendInit();\nThemeManager.themeUpdated();\n\nfunction _redirects (){\n\tif(window.location.hash == '#s') Loda.display('search');\n\tif(window.location.hash == '#redirect') {\n\t\tif(localStorage) {\n\t\t\tif(localStorage.getItem('redirected')) return window.location.hash = '';\n\t\t\tlocalStorage.setItem('redirected', 1);\n\t\t}\n\t\twindow.location.hash = '';\n\t\tLoda.display('notice');\n\t}\n}\n\n_redirects();\n\nfunction debug() {\n\tvar el = document.createElement('div');\n\tel.id = 'test_element';\n\tdocument.getElementsByClassName('rdr-image-wrap')[0].appendChild(el)\n}\n\n\n// This is a hacky fix that prevents the last div of a\n// flexbox from not receiving the scroll event from a\n// mousewheel. Probably requires some more investigation.\n// window.addEventListener(\"wheel\", () => {});\n\n";
    const reader_html = "<main id=\"rdr-main\" class=\"\" tabindex=\"-1\">\n    <aside class=\"unload\">\n      <div class=\"hide-side\" data-bind=\"sidebar_button\">\n        <div class=\"hide-side-actual ico-btn\"></div>\n      </div>\n      <header>\n        <a href=\"#\" class=\"ico-btn guya\"></a>\n        <h1 data-bind=\"title\"><a href=\"#\">Custom Reader</a></h1>\n        <button class=\"ico-btn\"></button>\n      </header>\n      <div class=\"rdr-aside-buffer\" data-bind=\"rdr_aside_buffer\"></div>\n      <div class=\"rdr-aside-content\" data-bind=\"rdr_aside_content\">\n        <section class=\"rdr-selector\" data-bind=\"rdr_selector\">\n          <div class=\"rdr-selector-top\">\n            <button data-bind=\"vol_next\" class=\"rdr-selector-vol ico-btn prev\" data-tip=\"Previous volume\"></button>\n            <div class=\"flex-spacer\" data-bind=\"message\"></div>\n            <button data-bind=\"download_chapter\" class=\"ico-btn download\"></button>\n            <div class=\"download-anchor\">\n              <div class=\"download-wrapper hidden\" data-bind=\"download_wrapper\">\n                <button data-bind=\"downloading_chapter\" class=\"ico-btn downloading\" disabled></button>\n                <button data-bind=\"download_cancel\" class=\"ico-btn download-cancel\"></button>\n              </div> \n            </div>\n            <a data-bind=\"share_button\" data-tip=\"Short link to current page\" class=\"rdr-share ico-btn \"></a>\n            <button data-bind=\"jump\" class=\"ico-btn jump\"></button>\n            <button data-bind=\"search\" class=\"ico-btn search\"></button>\n          </div>\n          <div class=\"rdr-selector-mid\">\n            <button data-bind=\"chap_prev\" class=\"rdr-selector-chap ico-btn prev\"></button>\n            <div class=\"rdr-vol-wrap\" data-bind=\"selector_vol\">\n              <label></label>\n              <select id=\"rdr-vol\"></select>\n            </div>\n            <div class=\"rdr-chap-wrap\" data-bind=\"selector_chap\">\n              <label></label>\n              <select id=\"rdr-chap\"></select>\n            </div>\n            <button data-bind=\"chap_next\" class=\"rdr-selector-chap ico-btn next\"></button>\n          </div>\n          <div class=\"rdr-selector-bot\">\n            <button data-bind=\"vol_prev\" class=\"rdr-selector-vol ico-btn next\" data-tip=\"Next volume\"></button>\n            <div class=\"flex-spacer\"></div>\n            <button data-bind=\"preload_button\" class=\"ico-btn hidden\"></button>\n            <button data-bind=\"fit_button\" class=\"ico-btn\"></button>\n            <button data-bind=\"layout_button\" class=\"ico-btn\"></button>\n            <button data-bind=\"spread_button\" class=\"ico-btn\"></button>\n            <button data-bind=\"sel_pin_button\" class=\"ico-btn\"></button>\n            <button data-bind=\"settings_button\" class=\"ico-btn\"></button>\n          </div>\n        </section>\n        <section class=\"rdr-groups\" data-bind=\"groups\">\n        </section>\n        <section class=\"rdr-previews\">\n          <div class=\"header\" data-bind=\"previews_button\">\n            <span>Previews</span>\n            <div class=\"ico-btn expander\"></div>\n          </div>\n          <div data-bind=\"previews\" class=\"rdr-previews-gallery\">\n          </div>\n        </section>\n        <section class=\"rdr-description\">\n          <div data-bind=\"image_description\">\n          </div>\n        </section>\n      </div>\n    </aside>\n    <div class=\"rdr-page-selector vis\" data-bind=\"page_selector\">\n      <div class=\"rdr-page-selector-counter\" data-bind=\"page_keys_count\"></div>\n      <div class=\"rdr-page-selector-keys\" data-bind=\"page_keys\"></div>\n    </div>\n    <content data-bind=\"image_viewer\" class=\"rdr-area\">\n      <div class=\"preload-entity\" data-bind=\"preload_entity\">\n        <img /><img /><img /><img />\n      </div>\n      <div class=\"rdr-image-wrap\" data-bind=\"image_container\" tabindex=\"-1\">\n      </div>\n      <div class=\"zoom-level refresh-chapter is-hidden\" data-bind=\"random_chapter\">\n        <div class=\"refresh-chapter-note\">This is the Blu-ray extras \"random chapter\".<br>Click this button to reshuffle the chapter.</div>\n        <div class=\"ico-btn\" data-bind=\"random_chapter_button\">\u21bb</div>\n      </div>\n      <div class=\"hover-prev\" data-bind=\"hover_prev\">\n        <div class=\"hover-wrap\">\n          <div class=\"hover-arrow\">\ue909</div>\n          <div class=\"hover-sub\"></div>\n        </div>\n      </div>\n      <div class=\"hover-next\" data-bind=\"hover_next\">\n        <div class=\"hover-wrap\">\n          <div class=\"hover-arrow\">\ue90a</div>\n          <div class=\"hover-sub\"></div>\n        </div>\n      </div>\n    </content>\n    <div class=\"zoom-level vis\" data-bind=\"zoom_level\">\n      <div class=\"ico-btn\" data-bind=\"zoom_level_plus\">\ue92e</div>\n      <div class=\"ico-btn\" data-bind=\"zoom_level_minus\">\ue930</div>\n    </div>\n</main>\n<div class=\"Tooltippy\"></div>\n<div class=\"Tooltippy Error\"></div>\n<div class=\"LodaManager hidden\" tabindex=\"-1\"></div>";

    let activeIframe = null;

    function startReader(imagesJSON) {
        if (activeIframe) return;

        const iframe = document.createElement('iframe');
        activeIframe = iframe;
        iframe.style.position = 'fixed';
        iframe.style.top = '0';
        iframe.style.left = '0';
        iframe.style.width = '100vw';
        iframe.style.height = '100vh';
        iframe.style.border = 'none';
        iframe.style.zIndex = '999999';
        document.body.appendChild(iframe);

        // Load saved settings for the reader
        const savedSettings = GM_getValue('reader_settings', {});

        // Construct script content
        // We use a self-invoking function inside the iframe to avoid polluting global scope more than necessary
        const scriptContent = `
            window.BASE_API_PATH = "";
            window.IS_FIRST_PARTY = false;
            window.IS_INDEXED = false;
            window.IMAGE_PROXY_URL = "";
            window.version_query = "";
            window.tag = window.tag || (() => {});

            // Shim localStorage to persist settings across domains
            (function() {
                try {
                    const store = ${JSON.stringify(savedSettings)};
                    const myLocalStorage = {
                        getItem: function(key) { return store[key] || null; },
                        setItem: function(key, value) {
                            store[key] = String(value);
                            window.parent.postMessage({ type: 'cubari-save-setting', key: key, value: String(value) }, '*');
                        },
                        removeItem: function(key) {
                            delete store[key];
                            window.parent.postMessage({ type: 'cubari-delete-setting', key: key }, '*');
                        },
                        clear: function() {
                            for (var member in store) delete store[member];
                        },
                        key: function(i) { return Object.keys(store)[i] || null; },
                        get length() { return Object.keys(store).length; }
                    };
                    
                    Object.defineProperty(window, 'localStorage', {
                        value: myLocalStorage,
                        writable: true,
                        configurable: true
                    });
                } catch(e) {
                    console.error("Cubari Reader: Failed to shim localStorage", e);
                }
            })();

            ${combined_js}

            (function() {
                const extractedImages = ${imagesJSON};
                if (window.Reader) {
                    const data = {
                        title: "Extracted Series",
                        slug: "custom",
                        chapters: {
                            "1": {
                                title: "Extracted Images",
                                chapter: "1",
                                volume: "1",
                                groups: { "Extracted": extractedImages },
                                loaded: { "Extracted": true },
                                images: { "Extracted": extractedImages },
                                wides: { "Extracted": [] },
                                descriptions: { "Extracted": [] },
                                previews: { "Extracted": [] }
                            }
                        },
                        chaptersIndex: ["1"],
                        volMap: {"1": "1"},
                        groups: {"Extracted": "Extracted"},
                        preferred_sort: ["Extracted"]
                    };

                    const SCP = {
                        series: "custom",
                        chapter: "1",
                        page: 0,
                        group: "Extracted"
                    };

                    window.API.requestSeries = () => Promise.resolve(data);
                    Reader.updateData(data);
                    Reader.displaySCP(SCP);

                    const logo = document.querySelector(".ico-btn.guya");
                    if (logo) {
                        logo.onclick = (e) => {
                            e.preventDefault();
                            window.parent.postMessage("close-cubari-reader", "*");
                        };
                        logo.style.cursor = "pointer";
                        if (window.Tooltippy) Tooltippy.attach(logo, "Exit Reader [Esc]");
                    }
                }

                document.addEventListener("keydown", (e) => {
                    if (e.key === "Escape") {
                        if (window.Loda && window.Loda.open) return;
                        window.parent.postMessage("close-cubari-reader", "*");
                    }
                }, true);
            })();
        `;

        const doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write('<!DOCTYPE html><html><head><meta charset="UTF-8"><style>' + combined_css + '</style></head><body>' + reader_html + '</body></html>');
        doc.close();

        const script = doc.createElement('script');
        script.textContent = scriptContent;
        doc.body.appendChild(script);
        iframe.focus();
    }

    window.addEventListener('message', (event) => {
        if (event.data === 'close-cubari-reader') {
            if (activeIframe) {
                document.body.removeChild(activeIframe);
                activeIframe = null;
            }
        }
        if (event.data && event.data.type === 'cubari-save-setting') {
            const settings = GM_getValue('reader_settings', {});
            settings[event.data.key] = event.data.value;
            GM_setValue('reader_settings', settings);
        }
        if (event.data && event.data.type === 'cubari-delete-setting') {
            const settings = GM_getValue('reader_settings', {});
            delete settings[event.data.key];
            GM_setValue('reader_settings', settings);
        }
    });

    function extractImages(selector) {
        const elements = document.querySelectorAll(selector);
        const images = [];
        elements.forEach(el => {
            if (el.tagName === 'IMG') {
                if (el.src && el.src.startsWith('http')) images.push(el.src);
            } else if (el.tagName === 'CANVAS') {
                try { images.push(el.toDataURL()); } catch(e) {}
            } else {
                const bg = window.getComputedStyle(el).backgroundImage;
                if (bg && bg !== 'none') {
                    const match = bg.match(/url\((['"]?)(.*?)\1\)/);
                    if (match && match[2]) images.push(match[2]);
                }
            }
        });
        return images;
    }

    GM_registerMenuCommand("Launch Cubari Reader", () => {
        const hostname = window.location.hostname;
        const savedSelector = GM_getValue('selector_' + hostname, 'img');
        const selector = prompt('Enter CSS selector for images (e.g. img, .manga-page):', savedSelector);
        if (selector) {
            if (selector !== savedSelector) {
                GM_setValue('selector_' + hostname, selector);
            }
            const images = extractImages(selector);
            if (images.length > 0) {
                startReader(JSON.stringify(images));
            } else {
                alert('No images found with that selector!');
            }
        }
    });

})();